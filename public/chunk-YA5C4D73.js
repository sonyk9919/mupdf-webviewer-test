import{a as Bp}from"./chunk-YGY6EGAB.js";import{a as Po,f as wp,k as yp,l as Ep,m as Bo,n as Pp,o as Rp,p as Ip,q as Ap,r as Np,s as Dp,t as kp,u as da,v as Vp,w as Lp,x as Fp}from"./chunk-HQGKOERF.js";import{$c as vn,$d as zl,$f as Ut,$h as kr,$i as Mp,A as dn,Ab as yi,Ac as Bn,Ae as Je,Ah as cp,Ai as Fo,B as nl,Ba as ml,Bb as be,Be as Pr,Bh as st,C as ol,Ca as wo,Cb as ti,Cc as lo,Db as Or,Dc as Tt,Dh as lp,E as Ka,Eb as _t,Ec as El,Ee as ql,Eg as ic,Eh as pp,F as Oo,Fa as Zt,Fb as Za,Fc as fs,Fd as Hn,Fg as op,Fh as xn,G as rl,Gd as Fl,Ge as Bt,Gg as rp,Gh as dp,H as Ge,Ha as vl,Hc as Un,He as Kl,Hg as jt,Hi as _s,I as er,Ia as _l,Ib as G,Ic as Pl,Id as Er,Ie as F,Ig as Zi,Ii as ca,J as sl,Ja as un,Jb as Y,Jc as ir,Jd as Bl,Je as Xl,Jh as Ar,Ji as Se,K as at,Ka as x,Kc as ms,Ke as Vi,Kf as Jl,Kg as Ei,Kh as hp,Ki as bp,L as Fs,Lb as ci,Lc as Rl,Ld as Qs,Le as li,Lg as Ht,Lh as Nr,Li as ht,M as L,Mb as ye,Mc as Il,Md as qs,Mf as ep,Mi as V,N as Bs,Na as At,Nc as Al,Ne as xh,Nf as Ir,Ng as Ro,Ni as Tn,O as al,Oa as v,Oc as Nl,Od as Ul,Og as Io,Oh as ko,P as cl,Pa as Xa,Pe as Rr,Pf as Ci,Pg as ta,Q as ll,Qa as Ce,Qb as xl,Qc as Dl,Qe as Zs,Qi as xp,R as us,Ra as Jt,Rb as co,Re as ec,Rf as tp,Ri as Tp,S as pl,Sa as gn,Sb as Si,Sc as nr,Sd as ho,Sf as ii,Sg as Ot,Si as Br,T as dl,Tb as lt,Tc as Ja,Tf as pi,Tg as Nt,Th as up,U as hl,Ua as se,Ue as go,Uf as ji,Ug as we,Uh as gp,Ui as la,V as ri,Va as Sl,Ve as $n,Vg as fo,Vh as fp,Vi as Ur,W as ao,Wa as Cl,Wg as he,Wh as mp,Wi as Op,X as Us,Xa as ue,Xb as Gt,Xc as jn,Xd as jl,Xf as Js,Xg as H,Xh as vp,Xi as jr,Y as Fn,Ya as O,Yb as $s,Yc as mn,Yd as Hl,Yg as bi,Yh as _p,Yi as pa,Z as ul,Za as Gi,Zb as Tl,Zd as $l,Zf as Eo,Zg as Ji,Zh as na,Zi as oi,_ as tr,_a as Ye,_c as Di,_d as Wl,_h as Dr,a as vi,ab as gs,ac as Ui,ad as _n,af as Q,ag as Ki,ah as Ao,b as Cr,bb as fn,be as Gl,bh as sp,cb as R,cc as Ol,ce as Ks,ch as ap,ci as ni,d as bh,db as N,de as Xs,df as J,e as Jc,eb as X,ec as Ml,ee as Yl,ef as Zl,f as A,fa as js,fb as Lt,fe as Ql,fg as Ae,fh as ia,ga as Mo,gb as Ft,gd as Gs,gf as Rn,gg as Xi,gi as oa,ha as ut,hb as Pn,hg as Hi,hh as No,hi as Sp,i as Kt,ib as _e,ih as xi,ii as Le,j as Bi,ja as gl,jb as bl,jd as Sn,jh as Do,ji as ot,k as Yt,ka as ct,kd as kl,kf as Ve,kg as ne,kh as it,ki as Pi,la as xr,lb as ce,lf as Cn,lg as Ct,lh as en,li as ra,ma as fl,mb as w,md as Vl,mh as Wn,n as el,nc as wl,nd as or,ni as Vo,oa as Oi,od as po,og as ip,oh as bn,oi as sa,p as Ln,pa as Xt,pb as yo,pc as yl,pd as Ll,pi as nc,q as Qe,qb as Ue,qd as vs,qg as K,qi as Vr,ra as Ze,rb as Re,rc as Mr,re as rr,ri as Lr,sb as Ie,si as Cp,t as Ls,tb as ei,te as uo,u as xt,ua as qi,ub as me,ue as qe,ui as Lo,v as br,va as W,vb as xe,vc as Z,vd as Ys,ve as ki,vi as aa,wa as z,wb as Tr,wc as Ws,wh as $i,wi as Fr,x as tl,xa as _i,xb as Hs,xc as zs,xd as wr,xe as $t,xf as Ee,xg as np,y as il,yb as Mi,yd as yr,yg as ea,yh as de,z as ze,zb as wi,zg as tc,zh as nt}from"./chunk-6FTJLYMX.js";var Zp=bh((Xp,xs)=>{(function(a,t){"use strict";typeof xs=="object"&&typeof xs.exports=="object"?xs.exports=a.document?t(a,!0):function(n){if(!n.document)throw new Error("jQuery requires a window with a document");return t(n)}:t(a)})(typeof window<"u"?window:Xp,function(a,t){"use strict";var n=[],e=a.document,i=Object.getPrototypeOf,r=n.slice,l=n.concat,g=n.push,S=n.indexOf,y={},I=y.toString,B=y.hasOwnProperty,ee=B.toString,ge=ee.call(Object),le={};function Te(o,s){s=s||e;var c=s.createElement("script");c.text=o,s.head.appendChild(c).parentNode.removeChild(c)}var $e="3.2.0",p=function(o,s){return new p.fn.init(o,s)},vt=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,gt=/^-ms-/,ft=/-([a-z])/g,Et=function(o,s){return s.toUpperCase()};p.fn=p.prototype={jquery:$e,constructor:p,length:0,toArray:function(){return r.call(this)},get:function(o){return o==null?r.call(this):o<0?this[o+this.length]:this[o]},pushStack:function(o){var s=p.merge(this.constructor(),o);return s.prevObject=this,s},each:function(o){return p.each(this,o)},map:function(o){return this.pushStack(p.map(this,function(s,c){return o.call(s,c,s)}))},slice:function(){return this.pushStack(r.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(o){var s=this.length,c=+o+(o<0?s:0);return this.pushStack(c>=0&&c<s?[this[c]]:[])},end:function(){return this.prevObject||this.constructor()},push:g,sort:n.sort,splice:n.splice},p.extend=p.fn.extend=function(){var o,s,c,d,m,f,_=arguments[0]||{},E=1,k=arguments.length,j=!1;for(typeof _=="boolean"&&(j=_,_=arguments[E]||{},E++),typeof _=="object"||p.isFunction(_)||(_={}),E===k&&(_=this,E--);E<k;E++)if((o=arguments[E])!=null)for(s in o)c=_[s],d=o[s],_!==d&&(j&&d&&(p.isPlainObject(d)||(m=Array.isArray(d)))?(m?(m=!1,f=c&&Array.isArray(c)?c:[]):f=c&&p.isPlainObject(c)?c:{},_[s]=p.extend(j,f,d)):d!==void 0&&(_[s]=d));return _},p.extend({expando:"jQuery"+($e+Math.random()).replace(/\D/g,""),isReady:!0,error:function(o){throw new Error(o)},noop:function(){},isFunction:function(o){return p.type(o)==="function"},isWindow:function(o){return o!=null&&o===o.window},isNumeric:function(o){var s=p.type(o);return(s==="number"||s==="string")&&!isNaN(o-parseFloat(o))},isPlainObject:function(o){var s,c;return!(!o||I.call(o)!=="[object Object]")&&(!(s=i(o))||(c=B.call(s,"constructor")&&s.constructor,typeof c=="function"&&ee.call(c)===ge))},isEmptyObject:function(o){var s;for(s in o)return!1;return!0},type:function(o){return o==null?o+"":typeof o=="object"||typeof o=="function"?y[I.call(o)]||"object":typeof o},globalEval:function(o){Te(o)},camelCase:function(o){return o.replace(gt,"ms-").replace(ft,Et)},each:function(o,s){var c,d=0;if(Li(o))for(c=o.length;d<c&&s.call(o[d],d,o[d])!==!1;d++);else for(d in o)if(s.call(o[d],d,o[d])===!1)break;return o},trim:function(o){return o==null?"":(o+"").replace(vt,"")},makeArray:function(o,s){var c=s||[];return o!=null&&(Li(Object(o))?p.merge(c,typeof o=="string"?[o]:o):g.call(c,o)),c},inArray:function(o,s,c){return s==null?-1:S.call(s,o,c)},merge:function(o,s){for(var c=+s.length,d=0,m=o.length;d<c;d++)o[m++]=s[d];return o.length=m,o},grep:function(o,s,c){for(var d,m=[],f=0,_=o.length,E=!c;f<_;f++)d=!s(o[f],f),d!==E&&m.push(o[f]);return m},map:function(o,s,c){var d,m,f=0,_=[];if(Li(o))for(d=o.length;f<d;f++)m=s(o[f],f,c),m!=null&&_.push(m);else for(f in o)m=s(o[f],f,c),m!=null&&_.push(m);return l.apply([],_)},guid:1,proxy:function(o,s){var c,d,m;if(typeof s=="string"&&(c=o[s],s=o,o=c),p.isFunction(o))return d=r.call(arguments,2),m=function(){return o.apply(s||this,d.concat(r.call(arguments)))},m.guid=o.guid=o.guid||p.guid++,m},now:Date.now,support:le}),typeof Symbol=="function"&&(p.fn[Symbol.iterator]=n[Symbol.iterator]),p.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(o,s){y["[object "+s+"]"]=s.toLowerCase()});function Li(o){var s=!!o&&"length"in o&&o.length,c=p.type(o);return c!=="function"&&!p.isWindow(o)&&(c==="array"||s===0||typeof s=="number"&&s>0&&s-1 in o)}var si=function(o){var s,c,d,m,f,_,E,k,j,ie,pe,$,re,He,et,Ne,gi,ai,an,Rt="sizzle"+1*new Date,Xe=o.document,Qi=0,mt=0,qt=Wa(),cs=Wa(),Sr=Wa(),yn=function(b,M){return b===M&&(pe=!0),0},ls={}.hasOwnProperty,cn=[],xo=cn.pop,To=cn.push,fi=cn.push,zc=cn.slice,Xo=function(b,M){for(var D=0,te=b.length;D<te;D++)if(b[D]===M)return D;return-1},ja="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",It="[\\x20\\t\\r\\n\\f]",Zo="(?:\\\\.|[\\w-]|[^\0-\\xa0])+",Gc="\\["+It+"*("+Zo+")(?:"+It+"*([*^$|!~]?=)"+It+`*(?:'((?:\\\\.|[^\\\\'])*)'|"((?:\\\\.|[^\\\\"])*)"|(`+Zo+"))|)"+It+"*\\]",Ha=":("+Zo+`)(?:\\((('((?:\\\\.|[^\\\\'])*)'|"((?:\\\\.|[^\\\\"])*)")|((?:\\\\.|[^\\\\()[\\]]|`+Gc+")*)|.*)\\)|)",ah=new RegExp(It+"+","g"),As=new RegExp("^"+It+"+|((?:^|[^\\\\])(?:\\\\.)*)"+It+"+$","g"),ch=new RegExp("^"+It+"*,"+It+"*"),lh=new RegExp("^"+It+"*([>+~]|"+It+")"+It+"*"),ph=new RegExp("="+It+`*([^\\]'"]*?)`+It+"*\\]","g"),dh=new RegExp(Ha),hh=new RegExp("^"+Zo+"$"),Ns={ID:new RegExp("^#("+Zo+")"),CLASS:new RegExp("^\\.("+Zo+")"),TAG:new RegExp("^("+Zo+"|[*])"),ATTR:new RegExp("^"+Gc),PSEUDO:new RegExp("^"+Ha),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+It+"*(even|odd|(([+-]|)(\\d*)n|)"+It+"*(?:([+-]|)"+It+"*(\\d+)|))"+It+"*\\)|)","i"),bool:new RegExp("^(?:"+ja+")$","i"),needsContext:new RegExp("^"+It+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+It+"*((?:-\\d)?\\d*)"+It+"*\\)|)(?=[^-]|$)","i")},uh=/^(?:input|select|textarea|button)$/i,gh=/^h\d$/i,ps=/^[^{]+\{\s*\[native \w/,fh=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,$a=/[+~]/,ro=new RegExp("\\\\([\\da-f]{1,6}"+It+"?|("+It+")|.)","ig"),so=function(b,M,D){var te="0x"+M-65536;return te!==te||D?M:te<0?String.fromCharCode(te+65536):String.fromCharCode(te>>10|55296,1023&te|56320)},Yc=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,Qc=function(b,M){return M?b==="\0"?"\uFFFD":b.slice(0,-1)+"\\"+b.charCodeAt(b.length-1).toString(16)+" ":"\\"+b},qc=function(){$()},mh=ks(function(b){return b.disabled===!0&&("form"in b||"label"in b)},{dir:"parentNode",next:"legend"});try{fi.apply(cn=zc.call(Xe.childNodes),Xe.childNodes),cn[Xe.childNodes.length].nodeType}catch{fi={apply:cn.length?function(M,D){To.apply(M,zc.call(D))}:function(M,D){for(var te=M.length,U=0;M[te++]=D[U++];);M.length=te-1}}}function kt(b,M,D,te){var U,oe,ae,fe,ve,Fe,ke,We=M&&M.ownerDocument,pt=M?M.nodeType:9;if(D=D||[],typeof b!="string"||!b||pt!==1&&pt!==9&&pt!==11)return D;if(!te&&((M?M.ownerDocument||M:Xe)!==re&&$(M),M=M||re,et)){if(pt!==11&&(ve=fh.exec(b)))if(U=ve[1]){if(pt===9){if(!(ae=M.getElementById(U)))return D;if(ae.id===U)return D.push(ae),D}else if(We&&(ae=We.getElementById(U))&&an(M,ae)&&ae.id===U)return D.push(ae),D}else{if(ve[2])return fi.apply(D,M.getElementsByTagName(b)),D;if((U=ve[3])&&c.getElementsByClassName&&M.getElementsByClassName)return fi.apply(D,M.getElementsByClassName(U)),D}if(c.qsa&&!Sr[b+" "]&&(!Ne||!Ne.test(b))){if(pt!==1)We=M,ke=b;else if(M.nodeName.toLowerCase()!=="object"){for((fe=M.getAttribute("id"))?fe=fe.replace(Yc,Qc):M.setAttribute("id",fe=Rt),Fe=_(b),oe=Fe.length;oe--;)Fe[oe]="#"+fe+" "+Ds(Fe[oe]);ke=Fe.join(","),We=$a.test(b)&&Ga(M.parentNode)||M}if(ke)try{return fi.apply(D,We.querySelectorAll(ke)),D}catch{}finally{fe===Rt&&M.removeAttribute("id")}}}return k(b.replace(As,"$1"),M,D,te)}function Wa(){var b=[];function M(D,te){return b.push(D+" ")>d.cacheLength&&delete M[b.shift()],M[D+" "]=te}return M}function En(b){return b[Rt]=!0,b}function Vn(b){var M=re.createElement("fieldset");try{return!!b(M)}catch{return!1}finally{M.parentNode&&M.parentNode.removeChild(M),M=null}}function za(b,M){for(var D=b.split("|"),te=D.length;te--;)d.attrHandle[D[te]]=M}function Kc(b,M){var D=M&&b,te=D&&b.nodeType===1&&M.nodeType===1&&b.sourceIndex-M.sourceIndex;if(te)return te;if(D){for(;D=D.nextSibling;)if(D===M)return-1}return b?1:-1}function vh(b){return function(M){var D=M.nodeName.toLowerCase();return D==="input"&&M.type===b}}function _h(b){return function(M){var D=M.nodeName.toLowerCase();return(D==="input"||D==="button")&&M.type===b}}function Xc(b){return function(M){return"form"in M?M.parentNode&&M.disabled===!1?"label"in M?"label"in M.parentNode?M.parentNode.disabled===b:M.disabled===b:M.isDisabled===b||M.isDisabled!==!b&&mh(M)===b:M.disabled===b:"label"in M&&M.disabled===b}}function Jo(b){return En(function(M){return M=+M,En(function(D,te){for(var U,oe=b([],D.length,M),ae=oe.length;ae--;)D[U=oe[ae]]&&(D[U]=!(te[U]=D[U]))})})}function Ga(b){return b&&typeof b.getElementsByTagName<"u"&&b}c=kt.support={},f=kt.isXML=function(b){var M=b&&(b.ownerDocument||b).documentElement;return!!M&&M.nodeName!=="HTML"},$=kt.setDocument=function(b){var M,D,te=b?b.ownerDocument||b:Xe;return te!==re&&te.nodeType===9&&te.documentElement&&(re=te,He=re.documentElement,et=!f(re),Xe!==re&&(D=re.defaultView)&&D.top!==D&&(D.addEventListener?D.addEventListener("unload",qc,!1):D.attachEvent&&D.attachEvent("onunload",qc)),c.attributes=Vn(function(U){return U.className="i",!U.getAttribute("className")}),c.getElementsByTagName=Vn(function(U){return U.appendChild(re.createComment("")),!U.getElementsByTagName("*").length}),c.getElementsByClassName=ps.test(re.getElementsByClassName),c.getById=Vn(function(U){return He.appendChild(U).id=Rt,!re.getElementsByName||!re.getElementsByName(Rt).length}),c.getById?(d.filter.ID=function(U){var oe=U.replace(ro,so);return function(ae){return ae.getAttribute("id")===oe}},d.find.ID=function(U,oe){if(typeof oe.getElementById<"u"&&et){var ae=oe.getElementById(U);return ae?[ae]:[]}}):(d.filter.ID=function(U){var oe=U.replace(ro,so);return function(ae){var fe=typeof ae.getAttributeNode<"u"&&ae.getAttributeNode("id");return fe&&fe.value===oe}},d.find.ID=function(U,oe){if(typeof oe.getElementById<"u"&&et){var ae,fe,ve,Fe=oe.getElementById(U);if(Fe){if(ae=Fe.getAttributeNode("id"),ae&&ae.value===U)return[Fe];for(ve=oe.getElementsByName(U),fe=0;Fe=ve[fe++];)if(ae=Fe.getAttributeNode("id"),ae&&ae.value===U)return[Fe]}return[]}}),d.find.TAG=c.getElementsByTagName?function(U,oe){return typeof oe.getElementsByTagName<"u"?oe.getElementsByTagName(U):c.qsa?oe.querySelectorAll(U):void 0}:function(U,oe){var ae,fe=[],ve=0,Fe=oe.getElementsByTagName(U);if(U==="*"){for(;ae=Fe[ve++];)ae.nodeType===1&&fe.push(ae);return fe}return Fe},d.find.CLASS=c.getElementsByClassName&&function(U,oe){if(typeof oe.getElementsByClassName<"u"&&et)return oe.getElementsByClassName(U)},gi=[],Ne=[],(c.qsa=ps.test(re.querySelectorAll))&&(Vn(function(U){He.appendChild(U).innerHTML="<a id='"+Rt+"'></a><select id='"+Rt+"-\r\\' msallowcapture=''><option selected=''></option></select>",U.querySelectorAll("[msallowcapture^='']").length&&Ne.push("[*^$]="+It+`*(?:''|"")`),U.querySelectorAll("[selected]").length||Ne.push("\\["+It+"*(?:value|"+ja+")"),U.querySelectorAll("[id~="+Rt+"-]").length||Ne.push("~="),U.querySelectorAll(":checked").length||Ne.push(":checked"),U.querySelectorAll("a#"+Rt+"+*").length||Ne.push(".#.+[+~]")}),Vn(function(U){U.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var oe=re.createElement("input");oe.setAttribute("type","hidden"),U.appendChild(oe).setAttribute("name","D"),U.querySelectorAll("[name=d]").length&&Ne.push("name"+It+"*[*^$|!~]?="),U.querySelectorAll(":enabled").length!==2&&Ne.push(":enabled",":disabled"),He.appendChild(U).disabled=!0,U.querySelectorAll(":disabled").length!==2&&Ne.push(":enabled",":disabled"),U.querySelectorAll("*,:x"),Ne.push(",.*:")})),(c.matchesSelector=ps.test(ai=He.matches||He.webkitMatchesSelector||He.mozMatchesSelector||He.oMatchesSelector||He.msMatchesSelector))&&Vn(function(U){c.disconnectedMatch=ai.call(U,"*"),ai.call(U,"[s!='']:x"),gi.push("!=",Ha)}),Ne=Ne.length&&new RegExp(Ne.join("|")),gi=gi.length&&new RegExp(gi.join("|")),M=ps.test(He.compareDocumentPosition),an=M||ps.test(He.contains)?function(U,oe){var ae=U.nodeType===9?U.documentElement:U,fe=oe&&oe.parentNode;return U===fe||!(!fe||fe.nodeType!==1||!(ae.contains?ae.contains(fe):U.compareDocumentPosition&&16&U.compareDocumentPosition(fe)))}:function(U,oe){if(oe){for(;oe=oe.parentNode;)if(oe===U)return!0}return!1},yn=M?function(U,oe){if(U===oe)return pe=!0,0;var ae=!U.compareDocumentPosition-!oe.compareDocumentPosition;return ae||(ae=(U.ownerDocument||U)===(oe.ownerDocument||oe)?U.compareDocumentPosition(oe):1,1&ae||!c.sortDetached&&oe.compareDocumentPosition(U)===ae?U===re||U.ownerDocument===Xe&&an(Xe,U)?-1:oe===re||oe.ownerDocument===Xe&&an(Xe,oe)?1:ie?Xo(ie,U)-Xo(ie,oe):0:4&ae?-1:1)}:function(U,oe){if(U===oe)return pe=!0,0;var ae,fe=0,ve=U.parentNode,Fe=oe.parentNode,ke=[U],We=[oe];if(!ve||!Fe)return U===re?-1:oe===re?1:ve?-1:Fe?1:ie?Xo(ie,U)-Xo(ie,oe):0;if(ve===Fe)return Kc(U,oe);for(ae=U;ae=ae.parentNode;)ke.unshift(ae);for(ae=oe;ae=ae.parentNode;)We.unshift(ae);for(;ke[fe]===We[fe];)fe++;return fe?Kc(ke[fe],We[fe]):ke[fe]===Xe?-1:We[fe]===Xe?1:0}),re},kt.matches=function(b,M){return kt(b,null,null,M)},kt.matchesSelector=function(b,M){if((b.ownerDocument||b)!==re&&$(b),M=M.replace(ph,"='$1']"),c.matchesSelector&&et&&!Sr[M+" "]&&(!gi||!gi.test(M))&&(!Ne||!Ne.test(M)))try{var D=ai.call(b,M);if(D||c.disconnectedMatch||b.document&&b.document.nodeType!==11)return D}catch{}return kt(M,re,null,[b]).length>0},kt.contains=function(b,M){return(b.ownerDocument||b)!==re&&$(b),an(b,M)},kt.attr=function(b,M){(b.ownerDocument||b)!==re&&$(b);var D=d.attrHandle[M.toLowerCase()],te=D&&ls.call(d.attrHandle,M.toLowerCase())?D(b,M,!et):void 0;return te!==void 0?te:c.attributes||!et?b.getAttribute(M):(te=b.getAttributeNode(M))&&te.specified?te.value:null},kt.escape=function(b){return(b+"").replace(Yc,Qc)},kt.error=function(b){throw new Error("Syntax error, unrecognized expression: "+b)},kt.uniqueSort=function(b){var M,D=[],te=0,U=0;if(pe=!c.detectDuplicates,ie=!c.sortStable&&b.slice(0),b.sort(yn),pe){for(;M=b[U++];)M===b[U]&&(te=D.push(U));for(;te--;)b.splice(D[te],1)}return ie=null,b},m=kt.getText=function(b){var M,D="",te=0,U=b.nodeType;if(U){if(U===1||U===9||U===11){if(typeof b.textContent=="string")return b.textContent;for(b=b.firstChild;b;b=b.nextSibling)D+=m(b)}else if(U===3||U===4)return b.nodeValue}else for(;M=b[te++];)D+=m(M);return D},d=kt.selectors={cacheLength:50,createPseudo:En,match:Ns,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(b){return b[1]=b[1].replace(ro,so),b[3]=(b[3]||b[4]||b[5]||"").replace(ro,so),b[2]==="~="&&(b[3]=" "+b[3]+" "),b.slice(0,4)},CHILD:function(b){return b[1]=b[1].toLowerCase(),b[1].slice(0,3)==="nth"?(b[3]||kt.error(b[0]),b[4]=+(b[4]?b[5]+(b[6]||1):2*(b[3]==="even"||b[3]==="odd")),b[5]=+(b[7]+b[8]||b[3]==="odd")):b[3]&&kt.error(b[0]),b},PSEUDO:function(b){var M,D=!b[6]&&b[2];return Ns.CHILD.test(b[0])?null:(b[3]?b[2]=b[4]||b[5]||"":D&&dh.test(D)&&(M=_(D,!0))&&(M=D.indexOf(")",D.length-M)-D.length)&&(b[0]=b[0].slice(0,M),b[2]=D.slice(0,M)),b.slice(0,3))}},filter:{TAG:function(b){var M=b.replace(ro,so).toLowerCase();return b==="*"?function(){return!0}:function(D){return D.nodeName&&D.nodeName.toLowerCase()===M}},CLASS:function(b){var M=qt[b+" "];return M||(M=new RegExp("(^|"+It+")"+b+"("+It+"|$)"))&&qt(b,function(D){return M.test(typeof D.className=="string"&&D.className||typeof D.getAttribute<"u"&&D.getAttribute("class")||"")})},ATTR:function(b,M,D){return function(te){var U=kt.attr(te,b);return U==null?M==="!=":!M||(U+="",M==="="?U===D:M==="!="?U!==D:M==="^="?D&&U.indexOf(D)===0:M==="*="?D&&U.indexOf(D)>-1:M==="$="?D&&U.slice(-D.length)===D:M==="~="?(" "+U.replace(ah," ")+" ").indexOf(D)>-1:M==="|="&&(U===D||U.slice(0,D.length+1)===D+"-"))}},CHILD:function(b,M,D,te,U){var oe=b.slice(0,3)!=="nth",ae=b.slice(-4)!=="last",fe=M==="of-type";return te===1&&U===0?function(ve){return!!ve.parentNode}:function(ve,Fe,ke){var We,pt,Vt,Be,mi,Fi,ln=oe!==ae?"nextSibling":"previousSibling",zt=ve.parentNode,ds=fe&&ve.nodeName.toLowerCase(),hs=!ke&&!fe,pn=!1;if(zt){if(oe){for(;ln;){for(Be=ve;Be=Be[ln];)if(fe?Be.nodeName.toLowerCase()===ds:Be.nodeType===1)return!1;Fi=ln=b==="only"&&!Fi&&"nextSibling"}return!0}if(Fi=[ae?zt.firstChild:zt.lastChild],ae&&hs){for(Be=zt,Vt=Be[Rt]||(Be[Rt]={}),pt=Vt[Be.uniqueID]||(Vt[Be.uniqueID]={}),We=pt[b]||[],mi=We[0]===Qi&&We[1],pn=mi&&We[2],Be=mi&&zt.childNodes[mi];Be=++mi&&Be&&Be[ln]||(pn=mi=0)||Fi.pop();)if(Be.nodeType===1&&++pn&&Be===ve){pt[b]=[Qi,mi,pn];break}}else if(hs&&(Be=ve,Vt=Be[Rt]||(Be[Rt]={}),pt=Vt[Be.uniqueID]||(Vt[Be.uniqueID]={}),We=pt[b]||[],mi=We[0]===Qi&&We[1],pn=mi),pn===!1)for(;(Be=++mi&&Be&&Be[ln]||(pn=mi=0)||Fi.pop())&&!((fe?Be.nodeName.toLowerCase()===ds:Be.nodeType===1)&&++pn&&(hs&&(Vt=Be[Rt]||(Be[Rt]={}),pt=Vt[Be.uniqueID]||(Vt[Be.uniqueID]={}),pt[b]=[Qi,pn]),Be===ve)););return pn-=U,pn===te||pn%te===0&&pn/te>=0}}},PSEUDO:function(b,M){var D,te=d.pseudos[b]||d.setFilters[b.toLowerCase()]||kt.error("unsupported pseudo: "+b);return te[Rt]?te(M):te.length>1?(D=[b,b,"",M],d.setFilters.hasOwnProperty(b.toLowerCase())?En(function(U,oe){for(var ae,fe=te(U,M),ve=fe.length;ve--;)ae=Xo(U,fe[ve]),U[ae]=!(oe[ae]=fe[ve])}):function(U){return te(U,0,D)}):te}},pseudos:{not:En(function(b){var M=[],D=[],te=E(b.replace(As,"$1"));return te[Rt]?En(function(U,oe,ae,fe){for(var ve,Fe=te(U,null,fe,[]),ke=U.length;ke--;)(ve=Fe[ke])&&(U[ke]=!(oe[ke]=ve))}):function(U,oe,ae){return M[0]=U,te(M,null,ae,D),M[0]=null,!D.pop()}}),has:En(function(b){return function(M){return kt(b,M).length>0}}),contains:En(function(b){return b=b.replace(ro,so),function(M){return(M.textContent||M.innerText||m(M)).indexOf(b)>-1}}),lang:En(function(b){return hh.test(b||"")||kt.error("unsupported lang: "+b),b=b.replace(ro,so).toLowerCase(),function(M){var D;do if(D=et?M.lang:M.getAttribute("xml:lang")||M.getAttribute("lang"))return D=D.toLowerCase(),D===b||D.indexOf(b+"-")===0;while((M=M.parentNode)&&M.nodeType===1);return!1}}),target:function(b){var M=o.location&&o.location.hash;return M&&M.slice(1)===b.id},root:function(b){return b===He},focus:function(b){return b===re.activeElement&&(!re.hasFocus||re.hasFocus())&&!!(b.type||b.href||~b.tabIndex)},enabled:Xc(!1),disabled:Xc(!0),checked:function(b){var M=b.nodeName.toLowerCase();return M==="input"&&!!b.checked||M==="option"&&!!b.selected},selected:function(b){return b.parentNode&&b.parentNode.selectedIndex,b.selected===!0},empty:function(b){for(b=b.firstChild;b;b=b.nextSibling)if(b.nodeType<6)return!1;return!0},parent:function(b){return!d.pseudos.empty(b)},header:function(b){return gh.test(b.nodeName)},input:function(b){return uh.test(b.nodeName)},button:function(b){var M=b.nodeName.toLowerCase();return M==="input"&&b.type==="button"||M==="button"},text:function(b){var M;return b.nodeName.toLowerCase()==="input"&&b.type==="text"&&((M=b.getAttribute("type"))==null||M.toLowerCase()==="text")},first:Jo(function(){return[0]}),last:Jo(function(b,M){return[M-1]}),eq:Jo(function(b,M,D){return[D<0?D+M:D]}),even:Jo(function(b,M){for(var D=0;D<M;D+=2)b.push(D);return b}),odd:Jo(function(b,M){for(var D=1;D<M;D+=2)b.push(D);return b}),lt:Jo(function(b,M,D){for(var te=D<0?D+M:D;--te>=0;)b.push(te);return b}),gt:Jo(function(b,M,D){for(var te=D<0?D+M:D;++te<M;)b.push(te);return b})}},d.pseudos.nth=d.pseudos.eq;for(s in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})d.pseudos[s]=vh(s);for(s in{submit:!0,reset:!0})d.pseudos[s]=_h(s);function Zc(){}Zc.prototype=d.filters=d.pseudos,d.setFilters=new Zc,_=kt.tokenize=function(b,M){var D,te,U,oe,ae,fe,ve,Fe=cs[b+" "];if(Fe)return M?0:Fe.slice(0);for(ae=b,fe=[],ve=d.preFilter;ae;){D&&!(te=ch.exec(ae))||(te&&(ae=ae.slice(te[0].length)||ae),fe.push(U=[])),D=!1,(te=lh.exec(ae))&&(D=te.shift(),U.push({value:D,type:te[0].replace(As," ")}),ae=ae.slice(D.length));for(oe in d.filter)!(te=Ns[oe].exec(ae))||ve[oe]&&!(te=ve[oe](te))||(D=te.shift(),U.push({value:D,type:oe,matches:te}),ae=ae.slice(D.length));if(!D)break}return M?ae.length:ae?kt.error(b):cs(b,fe).slice(0)};function Ds(b){for(var M=0,D=b.length,te="";M<D;M++)te+=b[M].value;return te}function ks(b,M,D){var te=M.dir,U=M.next,oe=U||te,ae=D&&oe==="parentNode",fe=mt++;return M.first?function(ve,Fe,ke){for(;ve=ve[te];)if(ve.nodeType===1||ae)return b(ve,Fe,ke);return!1}:function(ve,Fe,ke){var We,pt,Vt,Be=[Qi,fe];if(ke){for(;ve=ve[te];)if((ve.nodeType===1||ae)&&b(ve,Fe,ke))return!0}else for(;ve=ve[te];)if(ve.nodeType===1||ae)if(Vt=ve[Rt]||(ve[Rt]={}),pt=Vt[ve.uniqueID]||(Vt[ve.uniqueID]={}),U&&U===ve.nodeName.toLowerCase())ve=ve[te]||ve;else{if((We=pt[oe])&&We[0]===Qi&&We[1]===fe)return Be[2]=We[2];if(pt[oe]=Be,Be[2]=b(ve,Fe,ke))return!0}return!1}}function Ya(b){return b.length>1?function(M,D,te){for(var U=b.length;U--;)if(!b[U](M,D,te))return!1;return!0}:b[0]}function Sh(b,M,D){for(var te=0,U=M.length;te<U;te++)kt(b,M[te],D);return D}function Vs(b,M,D,te,U){for(var oe,ae=[],fe=0,ve=b.length,Fe=M!=null;fe<ve;fe++)(oe=b[fe])&&(D&&!D(oe,te,U)||(ae.push(oe),Fe&&M.push(fe)));return ae}function Qa(b,M,D,te,U,oe){return te&&!te[Rt]&&(te=Qa(te)),U&&!U[Rt]&&(U=Qa(U,oe)),En(function(ae,fe,ve,Fe){var ke,We,pt,Vt=[],Be=[],mi=fe.length,Fi=ae||Sh(M||"*",ve.nodeType?[ve]:ve,[]),ln=!b||!ae&&M?Fi:Vs(Fi,Vt,b,ve,Fe),zt=D?U||(ae?b:mi||te)?[]:fe:ln;if(D&&D(ln,zt,ve,Fe),te)for(ke=Vs(zt,Be),te(ke,[],ve,Fe),We=ke.length;We--;)(pt=ke[We])&&(zt[Be[We]]=!(ln[Be[We]]=pt));if(ae){if(U||b){if(U){for(ke=[],We=zt.length;We--;)(pt=zt[We])&&ke.push(ln[We]=pt);U(null,zt=[],ke,Fe)}for(We=zt.length;We--;)(pt=zt[We])&&(ke=U?Xo(ae,pt):Vt[We])>-1&&(ae[ke]=!(fe[ke]=pt))}}else zt=Vs(zt===fe?zt.splice(mi,zt.length):zt),U?U(null,fe,zt,Fe):fi.apply(fe,zt)})}function qa(b){for(var M,D,te,U=b.length,oe=d.relative[b[0].type],ae=oe||d.relative[" "],fe=oe?1:0,ve=ks(function(We){return We===M},ae,!0),Fe=ks(function(We){return Xo(M,We)>-1},ae,!0),ke=[function(We,pt,Vt){var Be=!oe&&(Vt||pt!==j)||((M=pt).nodeType?ve(We,pt,Vt):Fe(We,pt,Vt));return M=null,Be}];fe<U;fe++)if(D=d.relative[b[fe].type])ke=[ks(Ya(ke),D)];else{if(D=d.filter[b[fe].type].apply(null,b[fe].matches),D[Rt]){for(te=++fe;te<U&&!d.relative[b[te].type];te++);return Qa(fe>1&&Ya(ke),fe>1&&Ds(b.slice(0,fe-1).concat({value:b[fe-2].type===" "?"*":""})).replace(As,"$1"),D,fe<te&&qa(b.slice(fe,te)),te<U&&qa(b=b.slice(te)),te<U&&Ds(b))}ke.push(D)}return Ya(ke)}function Ch(b,M){var D=M.length>0,te=b.length>0,U=function(oe,ae,fe,ve,Fe){var ke,We,pt,Vt=0,Be="0",mi=oe&&[],Fi=[],ln=j,zt=oe||te&&d.find.TAG("*",Fe),ds=Qi+=ln==null?1:Math.random()||.1,hs=zt.length;for(Fe&&(j=ae===re||ae||Fe);Be!==hs&&(ke=zt[Be])!=null;Be++){if(te&&ke){for(We=0,ae||ke.ownerDocument===re||($(ke),fe=!et);pt=b[We++];)if(pt(ke,ae||re,fe)){ve.push(ke);break}Fe&&(Qi=ds)}D&&((ke=!pt&&ke)&&Vt--,oe&&mi.push(ke))}if(Vt+=Be,D&&Be!==Vt){for(We=0;pt=M[We++];)pt(mi,Fi,ae,fe);if(oe){if(Vt>0)for(;Be--;)mi[Be]||Fi[Be]||(Fi[Be]=xo.call(ve));Fi=Vs(Fi)}fi.apply(ve,Fi),Fe&&!oe&&Fi.length>0&&Vt+M.length>1&&kt.uniqueSort(ve)}return Fe&&(Qi=ds,j=ln),mi};return D?En(U):U}return E=kt.compile=function(b,M){var D,te=[],U=[],oe=Sr[b+" "];if(!oe){for(M||(M=_(b)),D=M.length;D--;)oe=qa(M[D]),oe[Rt]?te.push(oe):U.push(oe);oe=Sr(b,Ch(U,te)),oe.selector=b}return oe},k=kt.select=function(b,M,D,te){var U,oe,ae,fe,ve,Fe=typeof b=="function"&&b,ke=!te&&_(b=Fe.selector||b);if(D=D||[],ke.length===1){if(oe=ke[0]=ke[0].slice(0),oe.length>2&&(ae=oe[0]).type==="ID"&&M.nodeType===9&&et&&d.relative[oe[1].type]){if(M=(d.find.ID(ae.matches[0].replace(ro,so),M)||[])[0],!M)return D;Fe&&(M=M.parentNode),b=b.slice(oe.shift().value.length)}for(U=Ns.needsContext.test(b)?0:oe.length;U--&&(ae=oe[U],!d.relative[fe=ae.type]);)if((ve=d.find[fe])&&(te=ve(ae.matches[0].replace(ro,so),$a.test(oe[0].type)&&Ga(M.parentNode)||M))){if(oe.splice(U,1),b=te.length&&Ds(oe),!b)return fi.apply(D,te),D;break}}return(Fe||E(b,ke))(te,M,!et,D,!M||$a.test(b)&&Ga(M.parentNode)||M),D},c.sortStable=Rt.split("").sort(yn).join("")===Rt,c.detectDuplicates=!!pe,$(),c.sortDetached=Vn(function(b){return 1&b.compareDocumentPosition(re.createElement("fieldset"))}),Vn(function(b){return b.innerHTML="<a href='#'></a>",b.firstChild.getAttribute("href")==="#"})||za("type|href|height|width",function(b,M,D){if(!D)return b.getAttribute(M,M.toLowerCase()==="type"?1:2)}),c.attributes&&Vn(function(b){return b.innerHTML="<input/>",b.firstChild.setAttribute("value",""),b.firstChild.getAttribute("value")===""})||za("value",function(b,M,D){if(!D&&b.nodeName.toLowerCase()==="input")return b.defaultValue}),Vn(function(b){return b.getAttribute("disabled")==null})||za(ja,function(b,M,D){var te;if(!D)return b[M]===!0?M.toLowerCase():(te=b.getAttributeNode(M))&&te.specified?te.value:null}),kt}(a);p.find=si,p.expr=si.selectors,p.expr[":"]=p.expr.pseudos,p.uniqueSort=p.unique=si.uniqueSort,p.text=si.getText,p.isXMLDoc=si.isXML,p.contains=si.contains,p.escapeSelector=si.escape;var Ii=function(o,s,c){for(var d=[],m=c!==void 0;(o=o[s])&&o.nodeType!==9;)if(o.nodeType===1){if(m&&p(o).is(c))break;d.push(o)}return d},Oe=function(o,s){for(var c=[];o;o=o.nextSibling)o.nodeType===1&&o!==s&&c.push(o);return c},De=p.expr.match.needsContext;function h(o,s){return o.nodeName&&o.nodeName.toLowerCase()===s.toLowerCase()}var u=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i,C=/^.[^:#\[\.,]*$/;function T(o,s,c){return p.isFunction(s)?p.grep(o,function(d,m){return!!s.call(d,m,d)!==c}):s.nodeType?p.grep(o,function(d){return d===s!==c}):typeof s!="string"?p.grep(o,function(d){return S.call(s,d)>-1!==c}):C.test(s)?p.filter(s,o,c):(s=p.filter(s,o),p.grep(o,function(d){return S.call(s,d)>-1!==c&&d.nodeType===1}))}p.filter=function(o,s,c){var d=s[0];return c&&(o=":not("+o+")"),s.length===1&&d.nodeType===1?p.find.matchesSelector(d,o)?[d]:[]:p.find.matches(o,p.grep(s,function(m){return m.nodeType===1}))},p.fn.extend({find:function(o){var s,c,d=this.length,m=this;if(typeof o!="string")return this.pushStack(p(o).filter(function(){for(s=0;s<d;s++)if(p.contains(m[s],this))return!0}));for(c=this.pushStack([]),s=0;s<d;s++)p.find(o,m[s],c);return d>1?p.uniqueSort(c):c},filter:function(o){return this.pushStack(T(this,o||[],!1))},not:function(o){return this.pushStack(T(this,o||[],!0))},is:function(o){return!!T(this,typeof o=="string"&&De.test(o)?p(o):o||[],!1).length}});var P,q=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/,Me=p.fn.init=function(o,s,c){var d,m;if(!o)return this;if(c=c||P,typeof o=="string"){if(d=o[0]==="<"&&o[o.length-1]===">"&&o.length>=3?[null,o,null]:q.exec(o),!d||!d[1]&&s)return!s||s.jquery?(s||c).find(o):this.constructor(s).find(o);if(d[1]){if(s=s instanceof p?s[0]:s,p.merge(this,p.parseHTML(d[1],s&&s.nodeType?s.ownerDocument||s:e,!0)),u.test(d[1])&&p.isPlainObject(s))for(d in s)p.isFunction(this[d])?this[d](s[d]):this.attr(d,s[d]);return this}return m=e.getElementById(d[2]),m&&(this[0]=m,this.length=1),this}return o.nodeType?(this[0]=o,this.length=1,this):p.isFunction(o)?c.ready!==void 0?c.ready(o):o(p):p.makeArray(o,this)};Me.prototype=p.fn,P=p(e);var Ke=/^(?:parents|prev(?:Until|All))/,rt={children:!0,contents:!0,next:!0,prev:!0};p.fn.extend({has:function(o){var s=p(o,this),c=s.length;return this.filter(function(){for(var d=0;d<c;d++)if(p.contains(this,s[d]))return!0})},closest:function(o,s){var c,d=0,m=this.length,f=[],_=typeof o!="string"&&p(o);if(!De.test(o)){for(;d<m;d++)for(c=this[d];c&&c!==s;c=c.parentNode)if(c.nodeType<11&&(_?_.index(c)>-1:c.nodeType===1&&p.find.matchesSelector(c,o))){f.push(c);break}}return this.pushStack(f.length>1?p.uniqueSort(f):f)},index:function(o){return o?typeof o=="string"?S.call(p(o),this[0]):S.call(this,o.jquery?o[0]:o):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(o,s){return this.pushStack(p.uniqueSort(p.merge(this.get(),p(o,s))))},addBack:function(o){return this.add(o==null?this.prevObject:this.prevObject.filter(o))}});function St(o,s){for(;(o=o[s])&&o.nodeType!==1;);return o}p.each({parent:function(o){var s=o.parentNode;return s&&s.nodeType!==11?s:null},parents:function(o){return Ii(o,"parentNode")},parentsUntil:function(o,s,c){return Ii(o,"parentNode",c)},next:function(o){return St(o,"nextSibling")},prev:function(o){return St(o,"previousSibling")},nextAll:function(o){return Ii(o,"nextSibling")},prevAll:function(o){return Ii(o,"previousSibling")},nextUntil:function(o,s,c){return Ii(o,"nextSibling",c)},prevUntil:function(o,s,c){return Ii(o,"previousSibling",c)},siblings:function(o){return Oe((o.parentNode||{}).firstChild,o)},children:function(o){return Oe(o.firstChild)},contents:function(o){return h(o,"iframe")?o.contentDocument:(h(o,"template")&&(o=o.content||o),p.merge([],o.childNodes))}},function(o,s){p.fn[o]=function(c,d){var m=p.map(this,s,c);return o.slice(-5)!=="Until"&&(d=c),d&&typeof d=="string"&&(m=p.filter(d,m)),this.length>1&&(rt[o]||p.uniqueSort(m),Ke.test(o)&&m.reverse()),this.pushStack(m)}});var dt=/[^\x20\t\r\n\f]+/g;function di(o){var s={};return p.each(o.match(dt)||[],function(c,d){s[d]=!0}),s}p.Callbacks=function(o){o=typeof o=="string"?di(o):p.extend({},o);var s,c,d,m,f=[],_=[],E=-1,k=function(){for(m=m||o.once,d=s=!0;_.length;E=-1)for(c=_.shift();++E<f.length;)f[E].apply(c[0],c[1])===!1&&o.stopOnFalse&&(E=f.length,c=!1);o.memory||(c=!1),s=!1,m&&(f=c?[]:"")},j={add:function(){return f&&(c&&!s&&(E=f.length-1,_.push(c)),function ie(pe){p.each(pe,function($,re){p.isFunction(re)?o.unique&&j.has(re)||f.push(re):re&&re.length&&p.type(re)!=="string"&&ie(re)})}(arguments),c&&!s&&k()),this},remove:function(){return p.each(arguments,function(ie,pe){for(var $;($=p.inArray(pe,f,$))>-1;)f.splice($,1),$<=E&&E--}),this},has:function(ie){return ie?p.inArray(ie,f)>-1:f.length>0},empty:function(){return f&&(f=[]),this},disable:function(){return m=_=[],f=c="",this},disabled:function(){return!f},lock:function(){return m=_=[],c||s||(f=c=""),this},locked:function(){return!!m},fireWith:function(ie,pe){return m||(pe=pe||[],pe=[ie,pe.slice?pe.slice():pe],_.push(pe),s||k()),this},fire:function(){return j.fireWith(this,arguments),this},fired:function(){return!!d}};return j};function rn(o){return o}function Xn(o){throw o}function Zn(o,s,c,d){var m;try{o&&p.isFunction(m=o.promise)?m.call(o).done(s).fail(c):o&&p.isFunction(m=o.then)?m.call(o,s,c):s.apply(void 0,[o].slice(d))}catch(f){c.apply(void 0,[f])}}p.extend({Deferred:function(o){var s=[["notify","progress",p.Callbacks("memory"),p.Callbacks("memory"),2],["resolve","done",p.Callbacks("once memory"),p.Callbacks("once memory"),0,"resolved"],["reject","fail",p.Callbacks("once memory"),p.Callbacks("once memory"),1,"rejected"]],c="pending",d={state:function(){return c},always:function(){return m.done(arguments).fail(arguments),this},catch:function(f){return d.then(null,f)},pipe:function(){var f=arguments;return p.Deferred(function(_){p.each(s,function(E,k){var j=p.isFunction(f[k[4]])&&f[k[4]];m[k[1]](function(){var ie=j&&j.apply(this,arguments);ie&&p.isFunction(ie.promise)?ie.promise().progress(_.notify).done(_.resolve).fail(_.reject):_[k[0]+"With"](this,j?[ie]:arguments)})}),f=null}).promise()},then:function(f,_,E){var k=0;function j(ie,pe,$,re){return function(){var He=this,et=arguments,Ne=function(){var ai,an;if(!(ie<k)){if(ai=$.apply(He,et),ai===pe.promise())throw new TypeError("Thenable self-resolution");an=ai&&(typeof ai=="object"||typeof ai=="function")&&ai.then,p.isFunction(an)?re?an.call(ai,j(k,pe,rn,re),j(k,pe,Xn,re)):(k++,an.call(ai,j(k,pe,rn,re),j(k,pe,Xn,re),j(k,pe,rn,pe.notifyWith))):($!==rn&&(He=void 0,et=[ai]),(re||pe.resolveWith)(He,et))}},gi=re?Ne:function(){try{Ne()}catch(ai){p.Deferred.exceptionHook&&p.Deferred.exceptionHook(ai,gi.stackTrace),ie+1>=k&&($!==Xn&&(He=void 0,et=[ai]),pe.rejectWith(He,et))}};ie?gi():(p.Deferred.getStackHook&&(gi.stackTrace=p.Deferred.getStackHook()),a.setTimeout(gi))}}return p.Deferred(function(ie){s[0][3].add(j(0,ie,p.isFunction(E)?E:rn,ie.notifyWith)),s[1][3].add(j(0,ie,p.isFunction(f)?f:rn)),s[2][3].add(j(0,ie,p.isFunction(_)?_:Xn))}).promise()},promise:function(f){return f!=null?p.extend(f,d):d}},m={};return p.each(s,function(f,_){var E=_[2],k=_[5];d[_[1]]=E.add,k&&E.add(function(){c=k},s[3-f][2].disable,s[0][2].lock),E.add(_[3].fire),m[_[0]]=function(){return m[_[0]+"With"](this===m?void 0:this,arguments),this},m[_[0]+"With"]=E.fireWith}),d.promise(m),o&&o.call(m,m),m},when:function(o){var s=arguments.length,c=s,d=Array(c),m=r.call(arguments),f=p.Deferred(),_=function(E){return function(k){d[E]=this,m[E]=arguments.length>1?r.call(arguments):k,--s||f.resolveWith(d,m)}};if(s<=1&&(Zn(o,f.done(_(c)).resolve,f.reject,!s),f.state()==="pending"||p.isFunction(m[c]&&m[c].then)))return f.then();for(;c--;)Zn(m[c],_(c),f.reject);return f.promise()}});var Yo=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;p.Deferred.exceptionHook=function(o,s){a.console&&a.console.warn&&o&&Yo.test(o.name)&&a.console.warn("jQuery.Deferred exception: "+o.message,o.stack,s)},p.readyException=function(o){a.setTimeout(function(){throw o})};var Co=p.Deferred();p.fn.ready=function(o){return Co.then(o).catch(function(s){p.readyException(s)}),this},p.extend({isReady:!1,readyWait:1,ready:function(o){(o===!0?--p.readyWait:p.isReady)||(p.isReady=!0,o!==!0&&--p.readyWait>0||Co.resolveWith(e,[p]))}}),p.ready.then=Co.then;function Jn(){e.removeEventListener("DOMContentLoaded",Jn),a.removeEventListener("load",Jn),p.ready()}e.readyState==="complete"||e.readyState!=="loading"&&!e.documentElement.doScroll?a.setTimeout(p.ready):(e.addEventListener("DOMContentLoaded",Jn),a.addEventListener("load",Jn));var Wi=function(o,s,c,d,m,f,_){var E=0,k=o.length,j=c==null;if(p.type(c)==="object"){m=!0;for(E in c)Wi(o,s,E,c[E],!0,f,_)}else if(d!==void 0&&(m=!0,p.isFunction(d)||(_=!0),j&&(_?(s.call(o,d),s=null):(j=s,s=function(ie,pe,$){return j.call(p(ie),$)})),s))for(;E<k;E++)s(o[E],c,_?d:d.call(o[E],E,s(o[E],c)));return m?o:j?s.call(o):k?s(o[0],c):f},bo=function(o){return o.nodeType===1||o.nodeType===9||!+o.nodeType};function sn(){this.expando=p.expando+sn.uid++}sn.uid=1,sn.prototype={cache:function(o){var s=o[this.expando];return s||(s={},bo(o)&&(o.nodeType?o[this.expando]=s:Object.defineProperty(o,this.expando,{value:s,configurable:!0}))),s},set:function(o,s,c){var d,m=this.cache(o);if(typeof s=="string")m[p.camelCase(s)]=c;else for(d in s)m[p.camelCase(d)]=s[d];return m},get:function(o,s){return s===void 0?this.cache(o):o[this.expando]&&o[this.expando][p.camelCase(s)]},access:function(o,s,c){return s===void 0||s&&typeof s=="string"&&c===void 0?this.get(o,s):(this.set(o,s,c),c!==void 0?c:s)},remove:function(o,s){var c,d=o[this.expando];if(d!==void 0){if(s!==void 0)for(Array.isArray(s)?s=s.map(p.camelCase):(s=p.camelCase(s),s=s in d?[s]:s.match(dt)||[]),c=s.length;c--;)delete d[s[c]];(s===void 0||p.isEmptyObject(d))&&(o.nodeType?o[this.expando]=void 0:delete o[this.expando])}},hasData:function(o){var s=o[this.expando];return s!==void 0&&!p.isEmptyObject(s)}};var je=new sn,hi=new sn,Dn=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,ur=/[A-Z]/g;function ys(o){return o==="true"||o!=="false"&&(o==="null"?null:o===+o+""?+o:Dn.test(o)?JSON.parse(o):o)}function hn(o,s,c){var d;if(c===void 0&&o.nodeType===1)if(d="data-"+s.replace(ur,"-$&").toLowerCase(),c=o.getAttribute(d),typeof c=="string"){try{c=ys(c)}catch{}hi.set(o,s,c)}else c=void 0;return c}p.extend({hasData:function(o){return hi.hasData(o)||je.hasData(o)},data:function(o,s,c){return hi.access(o,s,c)},removeData:function(o,s){hi.remove(o,s)},_data:function(o,s,c){return je.access(o,s,c)},_removeData:function(o,s){je.remove(o,s)}}),p.fn.extend({data:function(o,s){var c,d,m,f=this[0],_=f&&f.attributes;if(o===void 0){if(this.length&&(m=hi.get(f),f.nodeType===1&&!je.get(f,"hasDataAttrs"))){for(c=_.length;c--;)_[c]&&(d=_[c].name,d.indexOf("data-")===0&&(d=p.camelCase(d.slice(5)),hn(f,d,m[d])));je.set(f,"hasDataAttrs",!0)}return m}return typeof o=="object"?this.each(function(){hi.set(this,o)}):Wi(this,function(E){var k;if(f&&E===void 0){if(k=hi.get(f,o),k!==void 0||(k=hn(f,o),k!==void 0))return k}else this.each(function(){hi.set(this,o,E)})},null,s,arguments.length>1,null,!0)},removeData:function(o){return this.each(function(){hi.remove(this,o)})}}),p.extend({queue:function(o,s,c){var d;if(o)return s=(s||"fx")+"queue",d=je.get(o,s),c&&(!d||Array.isArray(c)?d=je.access(o,s,p.makeArray(c)):d.push(c)),d||[]},dequeue:function(o,s){s=s||"fx";var c=p.queue(o,s),d=c.length,m=c.shift(),f=p._queueHooks(o,s),_=function(){p.dequeue(o,s)};m==="inprogress"&&(m=c.shift(),d--),m&&(s==="fx"&&c.unshift("inprogress"),delete f.stop,m.call(o,_,f)),!d&&f&&f.empty.fire()},_queueHooks:function(o,s){var c=s+"queueHooks";return je.get(o,c)||je.access(o,c,{empty:p.Callbacks("once memory").add(function(){je.remove(o,[s+"queue",c])})})}}),p.fn.extend({queue:function(o,s){var c=2;return typeof o!="string"&&(s=o,o="fx",c--),arguments.length<c?p.queue(this[0],o):s===void 0?this:this.each(function(){var d=p.queue(this,o,s);p._queueHooks(this,o),o==="fx"&&d[0]!=="inprogress"&&p.dequeue(this,o)})},dequeue:function(o){return this.each(function(){p.dequeue(this,o)})},clearQueue:function(o){return this.queue(o||"fx",[])},promise:function(o,s){var c,d=1,m=p.Deferred(),f=this,_=this.length,E=function(){--d||m.resolveWith(f,[f])};for(typeof o!="string"&&(s=o,o=void 0),o=o||"fx";_--;)c=je.get(f[_],o+"queueHooks"),c&&c.empty&&(d++,c.empty.add(E));return E(),m.promise(s)}});var gr=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Wt=new RegExp("^(?:([+-])=|)("+gr+")([a-z%]*)$","i"),eo=["Top","Right","Bottom","Left"],to=function(o,s){return o=s||o,o.style.display==="none"||o.style.display===""&&p.contains(o.ownerDocument,o)&&p.css(o,"display")==="none"},fr=function(o,s,c,d){var m,f,_={};for(f in s)_[f]=o.style[f],o.style[f]=s[f];m=c.apply(o,d||[]);for(f in s)o.style[f]=_[f];return m};function io(o,s,c,d){var m,f=1,_=20,E=d?function(){return d.cur()}:function(){return p.css(o,s,"")},k=E(),j=c&&c[3]||(p.cssNumber[s]?"":"px"),ie=(p.cssNumber[s]||j!=="px"&&+k)&&Wt.exec(p.css(o,s));if(ie&&ie[3]!==j){j=j||ie[3],c=c||[],ie=+k||1;do f=f||".5",ie/=f,p.style(o,s,ie+j);while(f!==(f=E()/k)&&f!==1&&--_)}return c&&(ie=+ie||+k||0,m=c[1]?ie+(c[1]+1)*c[2]:+c[2],d&&(d.unit=j,d.start=ie,d.end=m)),m}var kn={};function Qo(o){var s,c=o.ownerDocument,d=o.nodeName,m=kn[d];return m||(s=c.body.appendChild(c.createElement(d)),m=p.css(s,"display"),s.parentNode.removeChild(s),m==="none"&&(m="block"),kn[d]=m,m)}function tt(o,s){for(var c,d,m=[],f=0,_=o.length;f<_;f++)d=o[f],d.style&&(c=d.style.display,s?(c==="none"&&(m[f]=je.get(d,"display")||null,m[f]||(d.style.display="")),d.style.display===""&&to(d)&&(m[f]=Qo(d))):c!=="none"&&(m[f]="none",je.set(d,"display",c)));for(f=0;f<_;f++)m[f]!=null&&(o[f].style.display=m[f]);return o}p.fn.extend({show:function(){return tt(this,!0)},hide:function(){return tt(this)},toggle:function(o){return typeof o=="boolean"?o?this.show():this.hide():this.each(function(){to(this)?p(this).show():p(this).hide()})}});var Ai=/^(?:checkbox|radio)$/i,Pt=/<([a-z][^\/\0>\x20\t\r\n\f]+)/i,ui=/^$|\/(?:java|ecma)script/i,zi={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};zi.optgroup=zi.option,zi.tbody=zi.tfoot=zi.colgroup=zi.caption=zi.thead,zi.th=zi.td;function Ni(o,s){var c;return c=typeof o.getElementsByTagName<"u"?o.getElementsByTagName(s||"*"):typeof o.querySelectorAll<"u"?o.querySelectorAll(s||"*"):[],s===void 0||s&&h(o,s)?p.merge([o],c):c}function Mn(o,s){for(var c=0,d=o.length;c<d;c++)je.set(o[c],"globalEval",!s||je.get(s[c],"globalEval"))}var no=/<|&#?\w+;/;function ns(o,s,c,d,m){for(var f,_,E,k,j,ie,pe=s.createDocumentFragment(),$=[],re=0,He=o.length;re<He;re++)if(f=o[re],f||f===0)if(p.type(f)==="object")p.merge($,f.nodeType?[f]:f);else if(no.test(f)){for(_=_||pe.appendChild(s.createElement("div")),E=(Pt.exec(f)||["",""])[1].toLowerCase(),k=zi[E]||zi._default,_.innerHTML=k[1]+p.htmlPrefilter(f)+k[2],ie=k[0];ie--;)_=_.lastChild;p.merge($,_.childNodes),_=pe.firstChild,_.textContent=""}else $.push(s.createTextNode(f));for(pe.textContent="",re=0;f=$[re++];)if(d&&p.inArray(f,d)>-1)m&&m.push(f);else if(j=p.contains(f.ownerDocument,f),_=Ni(pe.appendChild(f),"script"),j&&Mn(_),c)for(ie=0;f=_[ie++];)ui.test(f.type||"")&&c.push(f);return pe}(function(){var o=e.createDocumentFragment(),s=o.appendChild(e.createElement("div")),c=e.createElement("input");c.setAttribute("type","radio"),c.setAttribute("checked","checked"),c.setAttribute("name","t"),s.appendChild(c),le.checkClone=s.cloneNode(!0).cloneNode(!0).lastChild.checked,s.innerHTML="<textarea>x</textarea>",le.noCloneChecked=!!s.cloneNode(!0).lastChild.defaultValue})();var oo=e.documentElement,wd=/^key/,yd=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,Sc=/^([^.]*)(?:\.(.+)|)/;function Es(){return!0}function mr(){return!1}function Cc(){try{return e.activeElement}catch{}}function Aa(o,s,c,d,m,f){var _,E;if(typeof s=="object"){typeof c!="string"&&(d=d||c,c=void 0);for(E in s)Aa(o,E,c,d,s[E],f);return o}if(d==null&&m==null?(m=c,d=c=void 0):m==null&&(typeof c=="string"?(m=d,d=void 0):(m=d,d=c,c=void 0)),m===!1)m=mr;else if(!m)return o;return f===1&&(_=m,m=function(k){return p().off(k),_.apply(this,arguments)},m.guid=_.guid||(_.guid=p.guid++)),o.each(function(){p.event.add(this,s,m,d,c)})}p.event={global:{},add:function(o,s,c,d,m){var f,_,E,k,j,ie,pe,$,re,He,et,Ne=je.get(o);if(Ne)for(c.handler&&(f=c,c=f.handler,m=f.selector),m&&p.find.matchesSelector(oo,m),c.guid||(c.guid=p.guid++),(k=Ne.events)||(k=Ne.events={}),(_=Ne.handle)||(_=Ne.handle=function(gi){return typeof p<"u"&&p.event.triggered!==gi.type?p.event.dispatch.apply(o,arguments):void 0}),s=(s||"").match(dt)||[""],j=s.length;j--;)E=Sc.exec(s[j])||[],re=et=E[1],He=(E[2]||"").split(".").sort(),re&&(pe=p.event.special[re]||{},re=(m?pe.delegateType:pe.bindType)||re,pe=p.event.special[re]||{},ie=p.extend({type:re,origType:et,data:d,handler:c,guid:c.guid,selector:m,needsContext:m&&p.expr.match.needsContext.test(m),namespace:He.join(".")},f),($=k[re])||($=k[re]=[],$.delegateCount=0,pe.setup&&pe.setup.call(o,d,He,_)!==!1||o.addEventListener&&o.addEventListener(re,_)),pe.add&&(pe.add.call(o,ie),ie.handler.guid||(ie.handler.guid=c.guid)),m?$.splice($.delegateCount++,0,ie):$.push(ie),p.event.global[re]=!0)},remove:function(o,s,c,d,m){var f,_,E,k,j,ie,pe,$,re,He,et,Ne=je.hasData(o)&&je.get(o);if(Ne&&(k=Ne.events)){for(s=(s||"").match(dt)||[""],j=s.length;j--;)if(E=Sc.exec(s[j])||[],re=et=E[1],He=(E[2]||"").split(".").sort(),re){for(pe=p.event.special[re]||{},re=(d?pe.delegateType:pe.bindType)||re,$=k[re]||[],E=E[2]&&new RegExp("(^|\\.)"+He.join("\\.(?:.*\\.|)")+"(\\.|$)"),_=f=$.length;f--;)ie=$[f],!m&&et!==ie.origType||c&&c.guid!==ie.guid||E&&!E.test(ie.namespace)||d&&d!==ie.selector&&(d!=="**"||!ie.selector)||($.splice(f,1),ie.selector&&$.delegateCount--,pe.remove&&pe.remove.call(o,ie));_&&!$.length&&(pe.teardown&&pe.teardown.call(o,He,Ne.handle)!==!1||p.removeEvent(o,re,Ne.handle),delete k[re])}else for(re in k)p.event.remove(o,re+s[j],c,d,!0);p.isEmptyObject(k)&&je.remove(o,"handle events")}},dispatch:function(o){var s=p.event.fix(o),c,d,m,f,_,E,k=new Array(arguments.length),j=(je.get(this,"events")||{})[s.type]||[],ie=p.event.special[s.type]||{};for(k[0]=s,c=1;c<arguments.length;c++)k[c]=arguments[c];if(s.delegateTarget=this,!ie.preDispatch||ie.preDispatch.call(this,s)!==!1){for(E=p.event.handlers.call(this,s,j),c=0;(f=E[c++])&&!s.isPropagationStopped();)for(s.currentTarget=f.elem,d=0;(_=f.handlers[d++])&&!s.isImmediatePropagationStopped();)s.rnamespace&&!s.rnamespace.test(_.namespace)||(s.handleObj=_,s.data=_.data,m=((p.event.special[_.origType]||{}).handle||_.handler).apply(f.elem,k),m!==void 0&&(s.result=m)===!1&&(s.preventDefault(),s.stopPropagation()));return ie.postDispatch&&ie.postDispatch.call(this,s),s.result}},handlers:function(o,s){var c,d,m,f,_,E=[],k=s.delegateCount,j=o.target;if(k&&j.nodeType&&!(o.type==="click"&&o.button>=1)){for(;j!==this;j=j.parentNode||this)if(j.nodeType===1&&(o.type!=="click"||j.disabled!==!0)){for(f=[],_={},c=0;c<k;c++)d=s[c],m=d.selector+" ",_[m]===void 0&&(_[m]=d.needsContext?p(m,this).index(j)>-1:p.find(m,this,null,[j]).length),_[m]&&f.push(d);f.length&&E.push({elem:j,handlers:f})}}return j=this,k<s.length&&E.push({elem:j,handlers:s.slice(k)}),E},addProp:function(o,s){Object.defineProperty(p.Event.prototype,o,{enumerable:!0,configurable:!0,get:p.isFunction(s)?function(){if(this.originalEvent)return s(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[o]},set:function(c){Object.defineProperty(this,o,{enumerable:!0,configurable:!0,writable:!0,value:c})}})},fix:function(o){return o[p.expando]?o:new p.Event(o)},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==Cc()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===Cc()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if(Ai.test(this.type)&&this.click&&h(this,"input"))return this.click(),!1},_default:function(o){return h(o.target,"a")}},beforeunload:{postDispatch:function(o){o.result!==void 0&&o.originalEvent&&(o.originalEvent.returnValue=o.result)}}}},p.removeEvent=function(o,s,c){o.removeEventListener&&o.removeEventListener(s,c)},p.Event=function(o,s){return this instanceof p.Event?(o&&o.type?(this.originalEvent=o,this.type=o.type,this.isDefaultPrevented=o.defaultPrevented||o.defaultPrevented===void 0&&o.returnValue===!1?Es:mr,this.target=o.target&&o.target.nodeType===3?o.target.parentNode:o.target,this.currentTarget=o.currentTarget,this.relatedTarget=o.relatedTarget):this.type=o,s&&p.extend(this,s),this.timeStamp=o&&o.timeStamp||p.now(),void(this[p.expando]=!0)):new p.Event(o,s)},p.Event.prototype={constructor:p.Event,isDefaultPrevented:mr,isPropagationStopped:mr,isImmediatePropagationStopped:mr,isSimulated:!1,preventDefault:function(){var o=this.originalEvent;this.isDefaultPrevented=Es,o&&!this.isSimulated&&o.preventDefault()},stopPropagation:function(){var o=this.originalEvent;this.isPropagationStopped=Es,o&&!this.isSimulated&&o.stopPropagation()},stopImmediatePropagation:function(){var o=this.originalEvent;this.isImmediatePropagationStopped=Es,o&&!this.isSimulated&&o.stopImmediatePropagation(),this.stopPropagation()}},p.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(o){var s=o.button;return o.which==null&&wd.test(o.type)?o.charCode!=null?o.charCode:o.keyCode:!o.which&&s!==void 0&&yd.test(o.type)?1&s?1:2&s?3:4&s?2:0:o.which}},p.event.addProp),p.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(o,s){p.event.special[o]={delegateType:s,bindType:s,handle:function(c){var d,m=this,f=c.relatedTarget,_=c.handleObj;return f&&(f===m||p.contains(m,f))||(c.type=_.origType,d=_.handler.apply(this,arguments),c.type=s),d}}}),p.fn.extend({on:function(o,s,c,d){return Aa(this,o,s,c,d)},one:function(o,s,c,d){return Aa(this,o,s,c,d,1)},off:function(o,s,c){var d,m;if(o&&o.preventDefault&&o.handleObj)return d=o.handleObj,p(o.delegateTarget).off(d.namespace?d.origType+"."+d.namespace:d.origType,d.selector,d.handler),this;if(typeof o=="object"){for(m in o)this.off(m,s,o[m]);return this}return s!==!1&&typeof s!="function"||(c=s,s=void 0),c===!1&&(c=mr),this.each(function(){p.event.remove(this,o,c,s)})}});var Ed=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,Pd=/<script|<style|<link/i,Rd=/checked\s*(?:[^=]|=\s*.checked.)/i,Id=/^true\/(.*)/,Ad=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function bc(o,s){return h(o,"table")&&h(s.nodeType!==11?s:s.firstChild,"tr")&&p(">tbody",o)[0]||o}function Nd(o){return o.type=(o.getAttribute("type")!==null)+"/"+o.type,o}function Dd(o){var s=Id.exec(o.type);return s?o.type=s[1]:o.removeAttribute("type"),o}function xc(o,s){var c,d,m,f,_,E,k,j;if(s.nodeType===1){if(je.hasData(o)&&(f=je.access(o),_=je.set(s,f),j=f.events)){delete _.handle,_.events={};for(m in j)for(c=0,d=j[m].length;c<d;c++)p.event.add(s,m,j[m][c])}hi.hasData(o)&&(E=hi.access(o),k=p.extend({},E),hi.set(s,k))}}function kd(o,s){var c=s.nodeName.toLowerCase();c==="input"&&Ai.test(o.type)?s.checked=o.checked:c!=="input"&&c!=="textarea"||(s.defaultValue=o.defaultValue)}function vr(o,s,c,d){s=l.apply([],s);var m,f,_,E,k,j,ie=0,pe=o.length,$=pe-1,re=s[0],He=p.isFunction(re);if(He||pe>1&&typeof re=="string"&&!le.checkClone&&Rd.test(re))return o.each(function(et){var Ne=o.eq(et);He&&(s[0]=re.call(this,et,Ne.html())),vr(Ne,s,c,d)});if(pe&&(m=ns(s,o[0].ownerDocument,!1,o,d),f=m.firstChild,m.childNodes.length===1&&(m=f),f||d)){for(_=p.map(Ni(m,"script"),Nd),E=_.length;ie<pe;ie++)k=m,ie!==$&&(k=p.clone(k,!0,!0),E&&p.merge(_,Ni(k,"script"))),c.call(o[ie],k,ie);if(E)for(j=_[_.length-1].ownerDocument,p.map(_,Dd),ie=0;ie<E;ie++)k=_[ie],ui.test(k.type||"")&&!je.access(k,"globalEval")&&p.contains(j,k)&&(k.src?p._evalUrl&&p._evalUrl(k.src):Te(k.textContent.replace(Ad,""),j))}return o}function Tc(o,s,c){for(var d,m=s?p.filter(s,o):o,f=0;(d=m[f])!=null;f++)c||d.nodeType!==1||p.cleanData(Ni(d)),d.parentNode&&(c&&p.contains(d.ownerDocument,d)&&Mn(Ni(d,"script")),d.parentNode.removeChild(d));return o}p.extend({htmlPrefilter:function(o){return o.replace(Ed,"<$1></$2>")},clone:function(o,s,c){var d,m,f,_,E=o.cloneNode(!0),k=p.contains(o.ownerDocument,o);if(!(le.noCloneChecked||o.nodeType!==1&&o.nodeType!==11||p.isXMLDoc(o)))for(_=Ni(E),f=Ni(o),d=0,m=f.length;d<m;d++)kd(f[d],_[d]);if(s)if(c)for(f=f||Ni(o),_=_||Ni(E),d=0,m=f.length;d<m;d++)xc(f[d],_[d]);else xc(o,E);return _=Ni(E,"script"),_.length>0&&Mn(_,!k&&Ni(o,"script")),E},cleanData:function(o){for(var s,c,d,m=p.event.special,f=0;(c=o[f])!==void 0;f++)if(bo(c)){if(s=c[je.expando]){if(s.events)for(d in s.events)m[d]?p.event.remove(c,d):p.removeEvent(c,d,s.handle);c[je.expando]=void 0}c[hi.expando]&&(c[hi.expando]=void 0)}}}),p.fn.extend({detach:function(o){return Tc(this,o,!0)},remove:function(o){return Tc(this,o)},text:function(o){return Wi(this,function(s){return s===void 0?p.text(this):this.empty().each(function(){this.nodeType!==1&&this.nodeType!==11&&this.nodeType!==9||(this.textContent=s)})},null,o,arguments.length)},append:function(){return vr(this,arguments,function(o){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var s=bc(this,o);s.appendChild(o)}})},prepend:function(){return vr(this,arguments,function(o){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var s=bc(this,o);s.insertBefore(o,s.firstChild)}})},before:function(){return vr(this,arguments,function(o){this.parentNode&&this.parentNode.insertBefore(o,this)})},after:function(){return vr(this,arguments,function(o){this.parentNode&&this.parentNode.insertBefore(o,this.nextSibling)})},empty:function(){for(var o,s=0;(o=this[s])!=null;s++)o.nodeType===1&&(p.cleanData(Ni(o,!1)),o.textContent="");return this},clone:function(o,s){return o=o!=null&&o,s=s??o,this.map(function(){return p.clone(this,o,s)})},html:function(o){return Wi(this,function(s){var c=this[0]||{},d=0,m=this.length;if(s===void 0&&c.nodeType===1)return c.innerHTML;if(typeof s=="string"&&!Pd.test(s)&&!zi[(Pt.exec(s)||["",""])[1].toLowerCase()]){s=p.htmlPrefilter(s);try{for(;d<m;d++)c=this[d]||{},c.nodeType===1&&(p.cleanData(Ni(c,!1)),c.innerHTML=s);c=0}catch{}}c&&this.empty().append(s)},null,o,arguments.length)},replaceWith:function(){var o=[];return vr(this,arguments,function(s){var c=this.parentNode;p.inArray(this,o)<0&&(p.cleanData(Ni(this)),c&&c.replaceChild(s,this))},o)}}),p.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(o,s){p.fn[o]=function(c){for(var d,m=[],f=p(c),_=f.length-1,E=0;E<=_;E++)d=E===_?this:this.clone(!0),p(f[E])[s](d),g.apply(m,d.get());return this.pushStack(m)}});var Oc=/^margin/,Na=new RegExp("^("+gr+")(?!px)[a-z%]+$","i"),Ps=function(o){var s=o.ownerDocument.defaultView;return s&&s.opener||(s=a),s.getComputedStyle(o)};(function(){function o(){if(_){_.style.cssText="box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",_.innerHTML="",oo.appendChild(f);var E=a.getComputedStyle(_);s=E.top!=="1%",m=E.marginLeft==="2px",c=E.width==="4px",_.style.marginRight="50%",d=E.marginRight==="4px",oo.removeChild(f),_=null}}var s,c,d,m,f=e.createElement("div"),_=e.createElement("div");_.style&&(_.style.backgroundClip="content-box",_.cloneNode(!0).style.backgroundClip="",le.clearCloneStyle=_.style.backgroundClip==="content-box",f.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",f.appendChild(_),p.extend(le,{pixelPosition:function(){return o(),s},boxSizingReliable:function(){return o(),c},pixelMarginRight:function(){return o(),d},reliableMarginLeft:function(){return o(),m}}))})();function os(o,s,c){var d,m,f,_,E=o.style;return c=c||Ps(o),c&&(_=c.getPropertyValue(s)||c[s],_!==""||p.contains(o.ownerDocument,o)||(_=p.style(o,s)),!le.pixelMarginRight()&&Na.test(_)&&Oc.test(s)&&(d=E.width,m=E.minWidth,f=E.maxWidth,E.minWidth=E.maxWidth=E.width=_,_=c.width,E.width=d,E.minWidth=m,E.maxWidth=f)),_!==void 0?_+"":_}function Mc(o,s){return{get:function(){return o()?void delete this.get:(this.get=s).apply(this,arguments)}}}var Vd=/^(none|table(?!-c[ea]).+)/,wc=/^--/,Ld={position:"absolute",visibility:"hidden",display:"block"},yc={letterSpacing:"0",fontWeight:"400"},Ec=["Webkit","Moz","ms"],Pc=e.createElement("div").style;function Fd(o){if(o in Pc)return o;for(var s=o[0].toUpperCase()+o.slice(1),c=Ec.length;c--;)if(o=Ec[c]+s,o in Pc)return o}function Rc(o){var s=p.cssProps[o];return s||(s=p.cssProps[o]=Fd(o)||o),s}function Ic(o,s,c){var d=Wt.exec(s);return d?Math.max(0,d[2]-(c||0))+(d[3]||"px"):s}function Ac(o,s,c,d,m){var f,_=0;for(f=c===(d?"border":"content")?4:s==="width"?1:0;f<4;f+=2)c==="margin"&&(_+=p.css(o,c+eo[f],!0,m)),d?(c==="content"&&(_-=p.css(o,"padding"+eo[f],!0,m)),c!=="margin"&&(_-=p.css(o,"border"+eo[f]+"Width",!0,m))):(_+=p.css(o,"padding"+eo[f],!0,m),c!=="padding"&&(_+=p.css(o,"border"+eo[f]+"Width",!0,m)));return _}function Nc(o,s,c){var d,m=Ps(o),f=os(o,s,m),_=p.css(o,"boxSizing",!1,m)==="border-box";return Na.test(f)?f:(d=_&&(le.boxSizingReliable()||f===o.style[s]),f=parseFloat(f)||0,f+Ac(o,s,c||(_?"border":"content"),d,m)+"px")}p.extend({cssHooks:{opacity:{get:function(o,s){if(s){var c=os(o,"opacity");return c===""?"1":c}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:"cssFloat"},style:function(o,s,c,d){if(o&&o.nodeType!==3&&o.nodeType!==8&&o.style){var m,f,_,E=p.camelCase(s),k=wc.test(s),j=o.style;return k||(s=Rc(E)),_=p.cssHooks[s]||p.cssHooks[E],c===void 0?_&&"get"in _&&(m=_.get(o,!1,d))!==void 0?m:j[s]:(f=typeof c,f==="string"&&(m=Wt.exec(c))&&m[1]&&(c=io(o,s,m),f="number"),c!=null&&c===c&&(f==="number"&&(c+=m&&m[3]||(p.cssNumber[E]?"":"px")),le.clearCloneStyle||c!==""||s.indexOf("background")!==0||(j[s]="inherit"),_&&"set"in _&&(c=_.set(o,c,d))===void 0||(k?j.setProperty(s,c):j[s]=c)),void 0)}},css:function(o,s,c,d){var m,f,_,E=p.camelCase(s),k=wc.test(s);return k||(s=Rc(E)),_=p.cssHooks[s]||p.cssHooks[E],_&&"get"in _&&(m=_.get(o,!0,c)),m===void 0&&(m=os(o,s,d)),m==="normal"&&s in yc&&(m=yc[s]),c===""||c?(f=parseFloat(m),c===!0||isFinite(f)?f||0:m):m}}),p.each(["height","width"],function(o,s){p.cssHooks[s]={get:function(c,d,m){if(d)return!Vd.test(p.css(c,"display"))||c.getClientRects().length&&c.getBoundingClientRect().width?Nc(c,s,m):fr(c,Ld,function(){return Nc(c,s,m)})},set:function(c,d,m){var f,_=m&&Ps(c),E=m&&Ac(c,s,m,p.css(c,"boxSizing",!1,_)==="border-box",_);return E&&(f=Wt.exec(d))&&(f[3]||"px")!=="px"&&(c.style[s]=d,d=p.css(c,s)),Ic(c,d,E)}}}),p.cssHooks.marginLeft=Mc(le.reliableMarginLeft,function(o,s){if(s)return(parseFloat(os(o,"marginLeft"))||o.getBoundingClientRect().left-fr(o,{marginLeft:0},function(){return o.getBoundingClientRect().left}))+"px"}),p.each({margin:"",padding:"",border:"Width"},function(o,s){p.cssHooks[o+s]={expand:function(c){for(var d=0,m={},f=typeof c=="string"?c.split(" "):[c];d<4;d++)m[o+eo[d]+s]=f[d]||f[d-2]||f[0];return m}},Oc.test(o)||(p.cssHooks[o+s].set=Ic)}),p.fn.extend({css:function(o,s){return Wi(this,function(c,d,m){var f,_,E={},k=0;if(Array.isArray(d)){for(f=Ps(c),_=d.length;k<_;k++)E[d[k]]=p.css(c,d[k],!1,f);return E}return m!==void 0?p.style(c,d,m):p.css(c,d)},o,s,arguments.length>1)}});function Yi(o,s,c,d,m){return new Yi.prototype.init(o,s,c,d,m)}p.Tween=Yi,Yi.prototype={constructor:Yi,init:function(o,s,c,d,m,f){this.elem=o,this.prop=c,this.easing=m||p.easing._default,this.options=s,this.start=this.now=this.cur(),this.end=d,this.unit=f||(p.cssNumber[c]?"":"px")},cur:function(){var o=Yi.propHooks[this.prop];return o&&o.get?o.get(this):Yi.propHooks._default.get(this)},run:function(o){var s,c=Yi.propHooks[this.prop];return this.options.duration?this.pos=s=p.easing[this.easing](o,this.options.duration*o,0,1,this.options.duration):this.pos=s=o,this.now=(this.end-this.start)*s+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):Yi.propHooks._default.set(this),this}},Yi.prototype.init.prototype=Yi.prototype,Yi.propHooks={_default:{get:function(o){var s;return o.elem.nodeType!==1||o.elem[o.prop]!=null&&o.elem.style[o.prop]==null?o.elem[o.prop]:(s=p.css(o.elem,o.prop,""),s&&s!=="auto"?s:0)},set:function(o){p.fx.step[o.prop]?p.fx.step[o.prop](o):o.elem.nodeType!==1||o.elem.style[p.cssProps[o.prop]]==null&&!p.cssHooks[o.prop]?o.elem[o.prop]=o.now:p.style(o.elem,o.prop,o.now+o.unit)}}},Yi.propHooks.scrollTop=Yi.propHooks.scrollLeft={set:function(o){o.elem.nodeType&&o.elem.parentNode&&(o.elem[o.prop]=o.now)}},p.easing={linear:function(o){return o},swing:function(o){return .5-Math.cos(o*Math.PI)/2},_default:"swing"},p.fx=Yi.prototype.init,p.fx.step={};var _r,Rs,Bd=/^(?:toggle|show|hide)$/,Ud=/queueHooks$/;function Da(){Rs&&(e.hidden===!1&&a.requestAnimationFrame?a.requestAnimationFrame(Da):a.setTimeout(Da,p.fx.interval),p.fx.tick())}function Dc(){return a.setTimeout(function(){_r=void 0}),_r=p.now()}function Is(o,s){var c,d=0,m={height:o};for(s=s?1:0;d<4;d+=2-s)c=eo[d],m["margin"+c]=m["padding"+c]=o;return s&&(m.opacity=m.width=o),m}function kc(o,s,c){for(var d,m=(wn.tweeners[s]||[]).concat(wn.tweeners["*"]),f=0,_=m.length;f<_;f++)if(d=m[f].call(c,s,o))return d}function jd(o,s,c){var d,m,f,_,E,k,j,ie,pe="width"in s||"height"in s,$=this,re={},He=o.style,et=o.nodeType&&to(o),Ne=je.get(o,"fxshow");c.queue||(_=p._queueHooks(o,"fx"),_.unqueued==null&&(_.unqueued=0,E=_.empty.fire,_.empty.fire=function(){_.unqueued||E()}),_.unqueued++,$.always(function(){$.always(function(){_.unqueued--,p.queue(o,"fx").length||_.empty.fire()})}));for(d in s)if(m=s[d],Bd.test(m)){if(delete s[d],f=f||m==="toggle",m===(et?"hide":"show")){if(m!=="show"||!Ne||Ne[d]===void 0)continue;et=!0}re[d]=Ne&&Ne[d]||p.style(o,d)}if(k=!p.isEmptyObject(s),k||!p.isEmptyObject(re)){pe&&o.nodeType===1&&(c.overflow=[He.overflow,He.overflowX,He.overflowY],j=Ne&&Ne.display,j==null&&(j=je.get(o,"display")),ie=p.css(o,"display"),ie==="none"&&(j?ie=j:(tt([o],!0),j=o.style.display||j,ie=p.css(o,"display"),tt([o]))),(ie==="inline"||ie==="inline-block"&&j!=null)&&p.css(o,"float")==="none"&&(k||($.done(function(){He.display=j}),j==null&&(ie=He.display,j=ie==="none"?"":ie)),He.display="inline-block")),c.overflow&&(He.overflow="hidden",$.always(function(){He.overflow=c.overflow[0],He.overflowX=c.overflow[1],He.overflowY=c.overflow[2]})),k=!1;for(d in re)k||(Ne?"hidden"in Ne&&(et=Ne.hidden):Ne=je.access(o,"fxshow",{display:j}),f&&(Ne.hidden=!et),et&&tt([o],!0),$.done(function(){et||tt([o]),je.remove(o,"fxshow");for(d in re)p.style(o,d,re[d])})),k=kc(et?Ne[d]:0,d,$),d in Ne||(Ne[d]=k.start,et&&(k.end=k.start,k.start=0))}}function Hd(o,s){var c,d,m,f,_;for(c in o)if(d=p.camelCase(c),m=s[d],f=o[c],Array.isArray(f)&&(m=f[1],f=o[c]=f[0]),c!==d&&(o[d]=f,delete o[c]),_=p.cssHooks[d],_&&"expand"in _){f=_.expand(f),delete o[d];for(c in f)c in o||(o[c]=f[c],s[c]=m)}else s[d]=m}function wn(o,s,c){var d,m,f=0,_=wn.prefilters.length,E=p.Deferred().always(function(){delete k.elem}),k=function(){if(m)return!1;for(var pe=_r||Dc(),$=Math.max(0,j.startTime+j.duration-pe),re=$/j.duration||0,He=1-re,et=0,Ne=j.tweens.length;et<Ne;et++)j.tweens[et].run(He);return E.notifyWith(o,[j,He,$]),He<1&&Ne?$:(Ne||E.notifyWith(o,[j,1,0]),E.resolveWith(o,[j]),!1)},j=E.promise({elem:o,props:p.extend({},s),opts:p.extend(!0,{specialEasing:{},easing:p.easing._default},c),originalProperties:s,originalOptions:c,startTime:_r||Dc(),duration:c.duration,tweens:[],createTween:function(pe,$){var re=p.Tween(o,j.opts,pe,$,j.opts.specialEasing[pe]||j.opts.easing);return j.tweens.push(re),re},stop:function(pe){var $=0,re=pe?j.tweens.length:0;if(m)return this;for(m=!0;$<re;$++)j.tweens[$].run(1);return pe?(E.notifyWith(o,[j,1,0]),E.resolveWith(o,[j,pe])):E.rejectWith(o,[j,pe]),this}}),ie=j.props;for(Hd(ie,j.opts.specialEasing);f<_;f++)if(d=wn.prefilters[f].call(j,o,ie,j.opts))return p.isFunction(d.stop)&&(p._queueHooks(j.elem,j.opts.queue).stop=p.proxy(d.stop,d)),d;return p.map(ie,kc,j),p.isFunction(j.opts.start)&&j.opts.start.call(o,j),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always),p.fx.timer(p.extend(k,{elem:o,anim:j,queue:j.opts.queue})),j}p.Animation=p.extend(wn,{tweeners:{"*":[function(o,s){var c=this.createTween(o,s);return io(c.elem,o,Wt.exec(s),c),c}]},tweener:function(o,s){p.isFunction(o)?(s=o,o=["*"]):o=o.match(dt);for(var c,d=0,m=o.length;d<m;d++)c=o[d],wn.tweeners[c]=wn.tweeners[c]||[],wn.tweeners[c].unshift(s)},prefilters:[jd],prefilter:function(o,s){s?wn.prefilters.unshift(o):wn.prefilters.push(o)}}),p.speed=function(o,s,c){var d=o&&typeof o=="object"?p.extend({},o):{complete:c||!c&&s||p.isFunction(o)&&o,duration:o,easing:c&&s||s&&!p.isFunction(s)&&s};return p.fx.off?d.duration=0:typeof d.duration!="number"&&(d.duration in p.fx.speeds?d.duration=p.fx.speeds[d.duration]:d.duration=p.fx.speeds._default),d.queue!=null&&d.queue!==!0||(d.queue="fx"),d.old=d.complete,d.complete=function(){p.isFunction(d.old)&&d.old.call(this),d.queue&&p.dequeue(this,d.queue)},d},p.fn.extend({fadeTo:function(o,s,c,d){return this.filter(to).css("opacity",0).show().end().animate({opacity:s},o,c,d)},animate:function(o,s,c,d){var m=p.isEmptyObject(o),f=p.speed(s,c,d),_=function(){var E=wn(this,p.extend({},o),f);(m||je.get(this,"finish"))&&E.stop(!0)};return _.finish=_,m||f.queue===!1?this.each(_):this.queue(f.queue,_)},stop:function(o,s,c){var d=function(m){var f=m.stop;delete m.stop,f(c)};return typeof o!="string"&&(c=s,s=o,o=void 0),s&&o!==!1&&this.queue(o||"fx",[]),this.each(function(){var m=!0,f=o!=null&&o+"queueHooks",_=p.timers,E=je.get(this);if(f)E[f]&&E[f].stop&&d(E[f]);else for(f in E)E[f]&&E[f].stop&&Ud.test(f)&&d(E[f]);for(f=_.length;f--;)_[f].elem!==this||o!=null&&_[f].queue!==o||(_[f].anim.stop(c),m=!1,_.splice(f,1));!m&&c||p.dequeue(this,o)})},finish:function(o){return o!==!1&&(o=o||"fx"),this.each(function(){var s,c=je.get(this),d=c[o+"queue"],m=c[o+"queueHooks"],f=p.timers,_=d?d.length:0;for(c.finish=!0,p.queue(this,o,[]),m&&m.stop&&m.stop.call(this,!0),s=f.length;s--;)f[s].elem===this&&f[s].queue===o&&(f[s].anim.stop(!0),f.splice(s,1));for(s=0;s<_;s++)d[s]&&d[s].finish&&d[s].finish.call(this);delete c.finish})}}),p.each(["toggle","show","hide"],function(o,s){var c=p.fn[s];p.fn[s]=function(d,m,f){return d==null||typeof d=="boolean"?c.apply(this,arguments):this.animate(Is(s,!0),d,m,f)}}),p.each({slideDown:Is("show"),slideUp:Is("hide"),slideToggle:Is("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(o,s){p.fn[o]=function(c,d,m){return this.animate(s,c,d,m)}}),p.timers=[],p.fx.tick=function(){var o,s=0,c=p.timers;for(_r=p.now();s<c.length;s++)o=c[s],o()||c[s]!==o||c.splice(s--,1);c.length||p.fx.stop(),_r=void 0},p.fx.timer=function(o){p.timers.push(o),p.fx.start()},p.fx.interval=13,p.fx.start=function(){Rs||(Rs=!0,Da())},p.fx.stop=function(){Rs=null},p.fx.speeds={slow:600,fast:200,_default:400},p.fn.delay=function(o,s){return o=p.fx&&p.fx.speeds[o]||o,s=s||"fx",this.queue(s,function(c,d){var m=a.setTimeout(c,o);d.stop=function(){a.clearTimeout(m)}})},function(){var o=e.createElement("input"),s=e.createElement("select"),c=s.appendChild(e.createElement("option"));o.type="checkbox",le.checkOn=o.value!=="",le.optSelected=c.selected,o=e.createElement("input"),o.value="t",o.type="radio",le.radioValue=o.value==="t"}();var Vc,rs=p.expr.attrHandle;p.fn.extend({attr:function(o,s){return Wi(this,p.attr,o,s,arguments.length>1)},removeAttr:function(o){return this.each(function(){p.removeAttr(this,o)})}}),p.extend({attr:function(o,s,c){var d,m,f=o.nodeType;if(f!==3&&f!==8&&f!==2)return typeof o.getAttribute>"u"?p.prop(o,s,c):(f===1&&p.isXMLDoc(o)||(m=p.attrHooks[s.toLowerCase()]||(p.expr.match.bool.test(s)?Vc:void 0)),c!==void 0?c===null?void p.removeAttr(o,s):m&&"set"in m&&(d=m.set(o,c,s))!==void 0?d:(o.setAttribute(s,c+""),c):m&&"get"in m&&(d=m.get(o,s))!==null?d:(d=p.find.attr(o,s),d??void 0))},attrHooks:{type:{set:function(o,s){if(!le.radioValue&&s==="radio"&&h(o,"input")){var c=o.value;return o.setAttribute("type",s),c&&(o.value=c),s}}}},removeAttr:function(o,s){var c,d=0,m=s&&s.match(dt);if(m&&o.nodeType===1)for(;c=m[d++];)o.removeAttribute(c)}}),Vc={set:function(o,s,c){return s===!1?p.removeAttr(o,c):o.setAttribute(c,c),c}},p.each(p.expr.match.bool.source.match(/\w+/g),function(o,s){var c=rs[s]||p.find.attr;rs[s]=function(d,m,f){var _,E,k=m.toLowerCase();return f||(E=rs[k],rs[k]=_,_=c(d,m,f)!=null?k:null,rs[k]=E),_}});var $d=/^(?:input|select|textarea|button)$/i,Wd=/^(?:a|area)$/i;p.fn.extend({prop:function(o,s){return Wi(this,p.prop,o,s,arguments.length>1)},removeProp:function(o){return this.each(function(){delete this[p.propFix[o]||o]})}}),p.extend({prop:function(o,s,c){var d,m,f=o.nodeType;if(f!==3&&f!==8&&f!==2)return f===1&&p.isXMLDoc(o)||(s=p.propFix[s]||s,m=p.propHooks[s]),c!==void 0?m&&"set"in m&&(d=m.set(o,c,s))!==void 0?d:o[s]=c:m&&"get"in m&&(d=m.get(o,s))!==null?d:o[s]},propHooks:{tabIndex:{get:function(o){var s=p.find.attr(o,"tabindex");return s?parseInt(s,10):$d.test(o.nodeName)||Wd.test(o.nodeName)&&o.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),le.optSelected||(p.propHooks.selected={get:function(o){var s=o.parentNode;return s&&s.parentNode&&s.parentNode.selectedIndex,null},set:function(o){var s=o.parentNode;s&&(s.selectedIndex,s.parentNode&&s.parentNode.selectedIndex)}}),p.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){p.propFix[this.toLowerCase()]=this});function qo(o){var s=o.match(dt)||[];return s.join(" ")}function Ko(o){return o.getAttribute&&o.getAttribute("class")||""}p.fn.extend({addClass:function(o){var s,c,d,m,f,_,E,k=0;if(p.isFunction(o))return this.each(function(j){p(this).addClass(o.call(this,j,Ko(this)))});if(typeof o=="string"&&o){for(s=o.match(dt)||[];c=this[k++];)if(m=Ko(c),d=c.nodeType===1&&" "+qo(m)+" "){for(_=0;f=s[_++];)d.indexOf(" "+f+" ")<0&&(d+=f+" ");E=qo(d),m!==E&&c.setAttribute("class",E)}}return this},removeClass:function(o){var s,c,d,m,f,_,E,k=0;if(p.isFunction(o))return this.each(function(j){p(this).removeClass(o.call(this,j,Ko(this)))});if(!arguments.length)return this.attr("class","");if(typeof o=="string"&&o){for(s=o.match(dt)||[];c=this[k++];)if(m=Ko(c),d=c.nodeType===1&&" "+qo(m)+" "){for(_=0;f=s[_++];)for(;d.indexOf(" "+f+" ")>-1;)d=d.replace(" "+f+" "," ");E=qo(d),m!==E&&c.setAttribute("class",E)}}return this},toggleClass:function(o,s){var c=typeof o;return typeof s=="boolean"&&c==="string"?s?this.addClass(o):this.removeClass(o):p.isFunction(o)?this.each(function(d){p(this).toggleClass(o.call(this,d,Ko(this),s),s)}):this.each(function(){var d,m,f,_;if(c==="string")for(m=0,f=p(this),_=o.match(dt)||[];d=_[m++];)f.hasClass(d)?f.removeClass(d):f.addClass(d);else o!==void 0&&c!=="boolean"||(d=Ko(this),d&&je.set(this,"__className__",d),this.setAttribute&&this.setAttribute("class",d||o===!1?"":je.get(this,"__className__")||""))})},hasClass:function(o){var s,c,d=0;for(s=" "+o+" ";c=this[d++];)if(c.nodeType===1&&(" "+qo(Ko(c))+" ").indexOf(s)>-1)return!0;return!1}});var zd=/\r/g;p.fn.extend({val:function(o){var s,c,d,m=this[0];{if(arguments.length)return d=p.isFunction(o),this.each(function(f){var _;this.nodeType===1&&(_=d?o.call(this,f,p(this).val()):o,_==null?_="":typeof _=="number"?_+="":Array.isArray(_)&&(_=p.map(_,function(E){return E==null?"":E+""})),s=p.valHooks[this.type]||p.valHooks[this.nodeName.toLowerCase()],s&&"set"in s&&s.set(this,_,"value")!==void 0||(this.value=_))});if(m)return s=p.valHooks[m.type]||p.valHooks[m.nodeName.toLowerCase()],s&&"get"in s&&(c=s.get(m,"value"))!==void 0?c:(c=m.value,typeof c=="string"?c.replace(zd,""):c??"")}}}),p.extend({valHooks:{option:{get:function(o){var s=p.find.attr(o,"value");return s??qo(p.text(o))}},select:{get:function(o){var s,c,d,m=o.options,f=o.selectedIndex,_=o.type==="select-one",E=_?null:[],k=_?f+1:m.length;for(d=f<0?k:_?f:0;d<k;d++)if(c=m[d],(c.selected||d===f)&&!c.disabled&&(!c.parentNode.disabled||!h(c.parentNode,"optgroup"))){if(s=p(c).val(),_)return s;E.push(s)}return E},set:function(o,s){for(var c,d,m=o.options,f=p.makeArray(s),_=m.length;_--;)d=m[_],(d.selected=p.inArray(p.valHooks.option.get(d),f)>-1)&&(c=!0);return c||(o.selectedIndex=-1),f}}}}),p.each(["radio","checkbox"],function(){p.valHooks[this]={set:function(o,s){if(Array.isArray(s))return o.checked=p.inArray(p(o).val(),s)>-1}},le.checkOn||(p.valHooks[this].get=function(o){return o.getAttribute("value")===null?"on":o.value})});var Lc=/^(?:focusinfocus|focusoutblur)$/;p.extend(p.event,{trigger:function(o,s,c,d){var m,f,_,E,k,j,ie,pe=[c||e],$=B.call(o,"type")?o.type:o,re=B.call(o,"namespace")?o.namespace.split("."):[];if(f=_=c=c||e,c.nodeType!==3&&c.nodeType!==8&&!Lc.test($+p.event.triggered)&&($.indexOf(".")>-1&&(re=$.split("."),$=re.shift(),re.sort()),k=$.indexOf(":")<0&&"on"+$,o=o[p.expando]?o:new p.Event($,typeof o=="object"&&o),o.isTrigger=d?2:3,o.namespace=re.join("."),o.rnamespace=o.namespace?new RegExp("(^|\\.)"+re.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,o.result=void 0,o.target||(o.target=c),s=s==null?[o]:p.makeArray(s,[o]),ie=p.event.special[$]||{},d||!ie.trigger||ie.trigger.apply(c,s)!==!1)){if(!d&&!ie.noBubble&&!p.isWindow(c)){for(E=ie.delegateType||$,Lc.test(E+$)||(f=f.parentNode);f;f=f.parentNode)pe.push(f),_=f;_===(c.ownerDocument||e)&&pe.push(_.defaultView||_.parentWindow||a)}for(m=0;(f=pe[m++])&&!o.isPropagationStopped();)o.type=m>1?E:ie.bindType||$,j=(je.get(f,"events")||{})[o.type]&&je.get(f,"handle"),j&&j.apply(f,s),j=k&&f[k],j&&j.apply&&bo(f)&&(o.result=j.apply(f,s),o.result===!1&&o.preventDefault());return o.type=$,d||o.isDefaultPrevented()||ie._default&&ie._default.apply(pe.pop(),s)!==!1||!bo(c)||k&&p.isFunction(c[$])&&!p.isWindow(c)&&(_=c[k],_&&(c[k]=null),p.event.triggered=$,c[$](),p.event.triggered=void 0,_&&(c[k]=_)),o.result}},simulate:function(o,s,c){var d=p.extend(new p.Event,c,{type:o,isSimulated:!0});p.event.trigger(d,null,s)}}),p.fn.extend({trigger:function(o,s){return this.each(function(){p.event.trigger(o,s,this)})},triggerHandler:function(o,s){var c=this[0];if(c)return p.event.trigger(o,s,c,!0)}}),p.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(o,s){p.fn[s]=function(c,d){return arguments.length>0?this.on(s,null,c,d):this.trigger(s)}}),p.fn.extend({hover:function(o,s){return this.mouseenter(o).mouseleave(s||o)}}),le.focusin="onfocusin"in a,le.focusin||p.each({focus:"focusin",blur:"focusout"},function(o,s){var c=function(d){p.event.simulate(s,d.target,p.event.fix(d))};p.event.special[s]={setup:function(){var d=this.ownerDocument||this,m=je.access(d,s);m||d.addEventListener(o,c,!0),je.access(d,s,(m||0)+1)},teardown:function(){var d=this.ownerDocument||this,m=je.access(d,s)-1;m?je.access(d,s,m):(d.removeEventListener(o,c,!0),je.remove(d,s))}}});var ss=a.location,Fc=p.now(),ka=/\?/;p.parseXML=function(o){var s;if(!o||typeof o!="string")return null;try{s=new a.DOMParser().parseFromString(o,"text/xml")}catch{s=void 0}return s&&!s.getElementsByTagName("parsererror").length||p.error("Invalid XML: "+o),s};var Gd=/\[\]$/,Bc=/\r?\n/g,Yd=/^(?:submit|button|image|reset|file)$/i,Qd=/^(?:input|select|textarea|keygen)/i;function Va(o,s,c,d){var m;if(Array.isArray(s))p.each(s,function(f,_){c||Gd.test(o)?d(o,_):Va(o+"["+(typeof _=="object"&&_!=null?f:"")+"]",_,c,d)});else if(c||p.type(s)!=="object")d(o,s);else for(m in s)Va(o+"["+m+"]",s[m],c,d)}p.param=function(o,s){var c,d=[],m=function(f,_){var E=p.isFunction(_)?_():_;d[d.length]=encodeURIComponent(f)+"="+encodeURIComponent(E??"")};if(Array.isArray(o)||o.jquery&&!p.isPlainObject(o))p.each(o,function(){m(this.name,this.value)});else for(c in o)Va(c,o[c],s,m);return d.join("&")},p.fn.extend({serialize:function(){return p.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var o=p.prop(this,"elements");return o?p.makeArray(o):this}).filter(function(){var o=this.type;return this.name&&!p(this).is(":disabled")&&Qd.test(this.nodeName)&&!Yd.test(o)&&(this.checked||!Ai.test(o))}).map(function(o,s){var c=p(this).val();return c==null?null:Array.isArray(c)?p.map(c,function(d){return{name:s.name,value:d.replace(Bc,`\r
`)}}):{name:s.name,value:c.replace(Bc,`\r
`)}}).get()}});var qd=/%20/g,Kd=/#.*$/,Xd=/([?&])_=[^&]*/,Zd=/^(.*?):[ \t]*([^\r\n]*)$/gm,Jd=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,eh=/^(?:GET|HEAD)$/,th=/^\/\//,Uc={},La={},jc="*/".concat("*"),Fa=e.createElement("a");Fa.href=ss.href;function Hc(o){return function(s,c){typeof s!="string"&&(c=s,s="*");var d,m=0,f=s.toLowerCase().match(dt)||[];if(p.isFunction(c))for(;d=f[m++];)d[0]==="+"?(d=d.slice(1)||"*",(o[d]=o[d]||[]).unshift(c)):(o[d]=o[d]||[]).push(c)}}function $c(o,s,c,d){var m={},f=o===La;function _(E){var k;return m[E]=!0,p.each(o[E]||[],function(j,ie){var pe=ie(s,c,d);return typeof pe!="string"||f||m[pe]?f?!(k=pe):void 0:(s.dataTypes.unshift(pe),_(pe),!1)}),k}return _(s.dataTypes[0])||!m["*"]&&_("*")}function Ba(o,s){var c,d,m=p.ajaxSettings.flatOptions||{};for(c in s)s[c]!==void 0&&((m[c]?o:d||(d={}))[c]=s[c]);return d&&p.extend(!0,o,d),o}function ih(o,s,c){for(var d,m,f,_,E=o.contents,k=o.dataTypes;k[0]==="*";)k.shift(),d===void 0&&(d=o.mimeType||s.getResponseHeader("Content-Type"));if(d){for(m in E)if(E[m]&&E[m].test(d)){k.unshift(m);break}}if(k[0]in c)f=k[0];else{for(m in c){if(!k[0]||o.converters[m+" "+k[0]]){f=m;break}_||(_=m)}f=f||_}if(f)return f!==k[0]&&k.unshift(f),c[f]}function nh(o,s,c,d){var m,f,_,E,k,j={},ie=o.dataTypes.slice();if(ie[1])for(_ in o.converters)j[_.toLowerCase()]=o.converters[_];for(f=ie.shift();f;)if(o.responseFields[f]&&(c[o.responseFields[f]]=s),!k&&d&&o.dataFilter&&(s=o.dataFilter(s,o.dataType)),k=f,f=ie.shift()){if(f==="*")f=k;else if(k!=="*"&&k!==f){if(_=j[k+" "+f]||j["* "+f],!_){for(m in j)if(E=m.split(" "),E[1]===f&&(_=j[k+" "+E[0]]||j["* "+E[0]])){_===!0?_=j[m]:j[m]!==!0&&(f=E[0],ie.unshift(E[1]));break}}if(_!==!0)if(_&&o.throws)s=_(s);else try{s=_(s)}catch(pe){return{state:"parsererror",error:_?pe:"No conversion from "+k+" to "+f}}}}return{state:"success",data:s}}p.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ss.href,type:"GET",isLocal:Jd.test(ss.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":jc,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":p.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(o,s){return s?Ba(Ba(o,p.ajaxSettings),s):Ba(p.ajaxSettings,o)},ajaxPrefilter:Hc(Uc),ajaxTransport:Hc(La),ajax:function(o,s){typeof o=="object"&&(s=o,o=void 0),s=s||{};var c,d,m,f,_,E,k,j,ie,pe,$=p.ajaxSetup({},s),re=$.context||$,He=$.context&&(re.nodeType||re.jquery)?p(re):p.event,et=p.Deferred(),Ne=p.Callbacks("once memory"),gi=$.statusCode||{},ai={},an={},Rt="canceled",Xe={readyState:0,getResponseHeader:function(mt){var qt;if(k){if(!f)for(f={};qt=Zd.exec(m);)f[qt[1].toLowerCase()]=qt[2];qt=f[mt.toLowerCase()]}return qt??null},getAllResponseHeaders:function(){return k?m:null},setRequestHeader:function(mt,qt){return k==null&&(mt=an[mt.toLowerCase()]=an[mt.toLowerCase()]||mt,ai[mt]=qt),this},overrideMimeType:function(mt){return k==null&&($.mimeType=mt),this},statusCode:function(mt){var qt;if(mt)if(k)Xe.always(mt[Xe.status]);else for(qt in mt)gi[qt]=[gi[qt],mt[qt]];return this},abort:function(mt){var qt=mt||Rt;return c&&c.abort(qt),Qi(0,qt),this}};if(et.promise(Xe),$.url=((o||$.url||ss.href)+"").replace(th,ss.protocol+"//"),$.type=s.method||s.type||$.method||$.type,$.dataTypes=($.dataType||"*").toLowerCase().match(dt)||[""],$.crossDomain==null){E=e.createElement("a");try{E.href=$.url,E.href=E.href,$.crossDomain=Fa.protocol+"//"+Fa.host!=E.protocol+"//"+E.host}catch{$.crossDomain=!0}}if($.data&&$.processData&&typeof $.data!="string"&&($.data=p.param($.data,$.traditional)),$c(Uc,$,s,Xe),k)return Xe;j=p.event&&$.global,j&&p.active++===0&&p.event.trigger("ajaxStart"),$.type=$.type.toUpperCase(),$.hasContent=!eh.test($.type),d=$.url.replace(Kd,""),$.hasContent?$.data&&$.processData&&($.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&($.data=$.data.replace(qd,"+")):(pe=$.url.slice(d.length),$.data&&(d+=(ka.test(d)?"&":"?")+$.data,delete $.data),$.cache===!1&&(d=d.replace(Xd,"$1"),pe=(ka.test(d)?"&":"?")+"_="+Fc+++pe),$.url=d+pe),$.ifModified&&(p.lastModified[d]&&Xe.setRequestHeader("If-Modified-Since",p.lastModified[d]),p.etag[d]&&Xe.setRequestHeader("If-None-Match",p.etag[d])),($.data&&$.hasContent&&$.contentType!==!1||s.contentType)&&Xe.setRequestHeader("Content-Type",$.contentType),Xe.setRequestHeader("Accept",$.dataTypes[0]&&$.accepts[$.dataTypes[0]]?$.accepts[$.dataTypes[0]]+($.dataTypes[0]!=="*"?", "+jc+"; q=0.01":""):$.accepts["*"]);for(ie in $.headers)Xe.setRequestHeader(ie,$.headers[ie]);if($.beforeSend&&($.beforeSend.call(re,Xe,$)===!1||k))return Xe.abort();if(Rt="abort",Ne.add($.complete),Xe.done($.success),Xe.fail($.error),c=$c(La,$,s,Xe)){if(Xe.readyState=1,j&&He.trigger("ajaxSend",[Xe,$]),k)return Xe;$.async&&$.timeout>0&&(_=a.setTimeout(function(){Xe.abort("timeout")},$.timeout));try{k=!1,c.send(ai,Qi)}catch(mt){if(k)throw mt;Qi(-1,mt)}}else Qi(-1,"No Transport");function Qi(mt,qt,cs,Sr){var yn,ls,cn,xo,To,fi=qt;k||(k=!0,_&&a.clearTimeout(_),c=void 0,m=Sr||"",Xe.readyState=mt>0?4:0,yn=mt>=200&&mt<300||mt===304,cs&&(xo=ih($,Xe,cs)),xo=nh($,xo,Xe,yn),yn?($.ifModified&&(To=Xe.getResponseHeader("Last-Modified"),To&&(p.lastModified[d]=To),To=Xe.getResponseHeader("etag"),To&&(p.etag[d]=To)),mt===204||$.type==="HEAD"?fi="nocontent":mt===304?fi="notmodified":(fi=xo.state,ls=xo.data,cn=xo.error,yn=!cn)):(cn=fi,!mt&&fi||(fi="error",mt<0&&(mt=0))),Xe.status=mt,Xe.statusText=(qt||fi)+"",yn?et.resolveWith(re,[ls,fi,Xe]):et.rejectWith(re,[Xe,fi,cn]),Xe.statusCode(gi),gi=void 0,j&&He.trigger(yn?"ajaxSuccess":"ajaxError",[Xe,$,yn?ls:cn]),Ne.fireWith(re,[Xe,fi]),j&&(He.trigger("ajaxComplete",[Xe,$]),--p.active||p.event.trigger("ajaxStop")))}return Xe},getJSON:function(o,s,c){return p.get(o,s,c,"json")},getScript:function(o,s){return p.get(o,void 0,s,"script")}}),p.each(["get","post"],function(o,s){p[s]=function(c,d,m,f){return p.isFunction(d)&&(f=f||m,m=d,d=void 0),p.ajax(p.extend({url:c,type:s,dataType:f,data:d,success:m},p.isPlainObject(c)&&c))}}),p._evalUrl=function(o){return p.ajax({url:o,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,throws:!0})},p.fn.extend({wrapAll:function(o){var s;return this[0]&&(p.isFunction(o)&&(o=o.call(this[0])),s=p(o,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&s.insertBefore(this[0]),s.map(function(){for(var c=this;c.firstElementChild;)c=c.firstElementChild;return c}).append(this)),this},wrapInner:function(o){return p.isFunction(o)?this.each(function(s){p(this).wrapInner(o.call(this,s))}):this.each(function(){var s=p(this),c=s.contents();c.length?c.wrapAll(o):s.append(o)})},wrap:function(o){var s=p.isFunction(o);return this.each(function(c){p(this).wrapAll(s?o.call(this,c):o)})},unwrap:function(o){return this.parent(o).not("body").each(function(){p(this).replaceWith(this.childNodes)}),this}}),p.expr.pseudos.hidden=function(o){return!p.expr.pseudos.visible(o)},p.expr.pseudos.visible=function(o){return!!(o.offsetWidth||o.offsetHeight||o.getClientRects().length)},p.ajaxSettings.xhr=function(){try{return new a.XMLHttpRequest}catch{}};var oh={0:200,1223:204},as=p.ajaxSettings.xhr();le.cors=!!as&&"withCredentials"in as,le.ajax=as=!!as,p.ajaxTransport(function(o){var s,c;if(le.cors||as&&!o.crossDomain)return{send:function(d,m){var f,_=o.xhr();if(_.open(o.type,o.url,o.async,o.username,o.password),o.xhrFields)for(f in o.xhrFields)_[f]=o.xhrFields[f];o.mimeType&&_.overrideMimeType&&_.overrideMimeType(o.mimeType),o.crossDomain||d["X-Requested-With"]||(d["X-Requested-With"]="XMLHttpRequest");for(f in d)_.setRequestHeader(f,d[f]);s=function(E){return function(){s&&(s=c=_.onload=_.onerror=_.onabort=_.onreadystatechange=null,E==="abort"?_.abort():E==="error"?typeof _.status!="number"?m(0,"error"):m(_.status,_.statusText):m(oh[_.status]||_.status,_.statusText,(_.responseType||"text")!=="text"||typeof _.responseText!="string"?{binary:_.response}:{text:_.responseText},_.getAllResponseHeaders()))}},_.onload=s(),c=_.onerror=s("error"),_.onabort!==void 0?_.onabort=c:_.onreadystatechange=function(){_.readyState===4&&a.setTimeout(function(){s&&c()})},s=s("abort");try{_.send(o.hasContent&&o.data||null)}catch(E){if(s)throw E}},abort:function(){s&&s()}}}),p.ajaxPrefilter(function(o){o.crossDomain&&(o.contents.script=!1)}),p.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(o){return p.globalEval(o),o}}}),p.ajaxPrefilter("script",function(o){o.cache===void 0&&(o.cache=!1),o.crossDomain&&(o.type="GET")}),p.ajaxTransport("script",function(o){if(o.crossDomain){var s,c;return{send:function(d,m){s=p("<script>").prop({charset:o.scriptCharset,src:o.url}).on("load error",c=function(f){s.remove(),c=null,f&&m(f.type==="error"?404:200,f.type)}),e.head.appendChild(s[0])},abort:function(){c&&c()}}}});var Wc=[],Ua=/(=)\?(?=&|$)|\?\?/;p.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var o=Wc.pop()||p.expando+"_"+Fc++;return this[o]=!0,o}}),p.ajaxPrefilter("json jsonp",function(o,s,c){var d,m,f,_=o.jsonp!==!1&&(Ua.test(o.url)?"url":typeof o.data=="string"&&(o.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&Ua.test(o.data)&&"data");if(_||o.dataTypes[0]==="jsonp")return d=o.jsonpCallback=p.isFunction(o.jsonpCallback)?o.jsonpCallback():o.jsonpCallback,_?o[_]=o[_].replace(Ua,"$1"+d):o.jsonp!==!1&&(o.url+=(ka.test(o.url)?"&":"?")+o.jsonp+"="+d),o.converters["script json"]=function(){return f||p.error(d+" was not called"),f[0]},o.dataTypes[0]="json",m=a[d],a[d]=function(){f=arguments},c.always(function(){m===void 0?p(a).removeProp(d):a[d]=m,o[d]&&(o.jsonpCallback=s.jsonpCallback,Wc.push(d)),f&&p.isFunction(m)&&m(f[0]),f=m=void 0}),"script"}),le.createHTMLDocument=function(){var o=e.implementation.createHTMLDocument("").body;return o.innerHTML="<form></form><form></form>",o.childNodes.length===2}(),p.parseHTML=function(o,s,c){if(typeof o!="string")return[];typeof s=="boolean"&&(c=s,s=!1);var d,m,f;return s||(le.createHTMLDocument?(s=e.implementation.createHTMLDocument(""),d=s.createElement("base"),d.href=e.location.href,s.head.appendChild(d)):s=e),m=u.exec(o),f=!c&&[],m?[s.createElement(m[1])]:(m=ns([o],s,f),f&&f.length&&p(f).remove(),p.merge([],m.childNodes))},p.fn.load=function(o,s,c){var d,m,f,_=this,E=o.indexOf(" ");return E>-1&&(d=qo(o.slice(E)),o=o.slice(0,E)),p.isFunction(s)?(c=s,s=void 0):s&&typeof s=="object"&&(m="POST"),_.length>0&&p.ajax({url:o,type:m||"GET",dataType:"html",data:s}).done(function(k){f=arguments,_.html(d?p("<div>").append(p.parseHTML(k)).find(d):k)}).always(c&&function(k,j){_.each(function(){c.apply(this,f||[k.responseText,j,k])})}),this},p.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(o,s){p.fn[s]=function(c){return this.on(s,c)}}),p.expr.pseudos.animated=function(o){return p.grep(p.timers,function(s){return o===s.elem}).length},p.offset={setOffset:function(o,s,c){var d,m,f,_,E,k,j,ie=p.css(o,"position"),pe=p(o),$={};ie==="static"&&(o.style.position="relative"),E=pe.offset(),f=p.css(o,"top"),k=p.css(o,"left"),j=(ie==="absolute"||ie==="fixed")&&(f+k).indexOf("auto")>-1,j?(d=pe.position(),_=d.top,m=d.left):(_=parseFloat(f)||0,m=parseFloat(k)||0),p.isFunction(s)&&(s=s.call(o,c,p.extend({},E))),s.top!=null&&($.top=s.top-E.top+_),s.left!=null&&($.left=s.left-E.left+m),"using"in s?s.using.call(o,$):pe.css($)}},p.fn.extend({offset:function(o){if(arguments.length)return o===void 0?this:this.each(function(_){p.offset.setOffset(this,o,_)});var s,c,d,m,f=this[0];if(f)return f.getClientRects().length?(d=f.getBoundingClientRect(),s=f.ownerDocument,c=s.documentElement,m=s.defaultView,{top:d.top+m.pageYOffset-c.clientTop,left:d.left+m.pageXOffset-c.clientLeft}):{top:0,left:0}},position:function(){if(this[0]){var o,s,c=this[0],d={top:0,left:0};return p.css(c,"position")==="fixed"?s=c.getBoundingClientRect():(o=this.offsetParent(),s=this.offset(),h(o[0],"html")||(d=o.offset()),d={top:d.top+p.css(o[0],"borderTopWidth",!0),left:d.left+p.css(o[0],"borderLeftWidth",!0)}),{top:s.top-d.top-p.css(c,"marginTop",!0),left:s.left-d.left-p.css(c,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var o=this.offsetParent;o&&p.css(o,"position")==="static";)o=o.offsetParent;return o||oo})}}),p.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(o,s){var c=s==="pageYOffset";p.fn[o]=function(d){return Wi(this,function(m,f,_){var E;return p.isWindow(m)?E=m:m.nodeType===9&&(E=m.defaultView),_===void 0?E?E[s]:m[f]:void(E?E.scrollTo(c?E.pageXOffset:_,c?_:E.pageYOffset):m[f]=_)},o,d,arguments.length)}}),p.each(["top","left"],function(o,s){p.cssHooks[s]=Mc(le.pixelPosition,function(c,d){if(d)return d=os(c,s),Na.test(d)?p(c).position()[s]+"px":d})}),p.each({Height:"height",Width:"width"},function(o,s){p.each({padding:"inner"+o,content:s,"":"outer"+o},function(c,d){p.fn[d]=function(m,f){var _=arguments.length&&(c||typeof m!="boolean"),E=c||(m===!0||f===!0?"margin":"border");return Wi(this,function(k,j,ie){var pe;return p.isWindow(k)?d.indexOf("outer")===0?k["inner"+o]:k.document.documentElement["client"+o]:k.nodeType===9?(pe=k.documentElement,Math.max(k.body["scroll"+o],pe["scroll"+o],k.body["offset"+o],pe["offset"+o],pe["client"+o])):ie===void 0?p.css(k,j,E):p.style(k,j,ie,E)},s,_?m:void 0,_)}})}),p.fn.extend({bind:function(o,s,c){return this.on(o,null,s,c)},unbind:function(o,s){return this.off(o,null,s)},delegate:function(o,s,c,d){return this.on(s,o,c,d)},undelegate:function(o,s,c){return arguments.length===1?this.off(o,"**"):this.off(s,o||"**",c)},holdReady:function(o){o?p.readyWait++:p.ready(!0)}}),p.isArray=Array.isArray,p.parseJSON=JSON.parse,p.nodeName=h,typeof define=="function"&&define.amd&&define("jquery",[],function(){return p});var rh=a.jQuery,sh=a.$;return p.noConflict=function(o){return a.$===p&&(a.$=sh),o&&a.jQuery===p&&(a.jQuery=rh),p},t||(a.jQuery=a.$=p),p});jQuery=xs.exports;(function(a){function t(h,u,C){if(!C[0]||typeof C[0]=="object")return u.init.apply(h,C);if(u[C[0]])return u[C[0]].apply(h,Array.prototype.slice.call(C,1));throw B(C[0]+" is not a method or property")}function n(h,u,C,T){return{css:{position:"absolute",top:h,left:u,overflow:T||"hidden",zIndex:C||"auto"}}}function e(h,u,C,T,P){var q=1-P,Me=q*q*q,Ke=P*P*P;return i(Math.round(Me*h.x+3*P*q*q*u.x+3*P*P*q*C.x+Ke*T.x),Math.round(Me*h.y+3*P*q*q*u.y+3*P*P*q*C.y+Ke*T.y))}function i(h,u){return{x:h,y:u}}function r(h,u,C){return ge&&C?" translate3d("+h+"px,"+u+"px, 0px) ":" translate("+h+"px, "+u+"px) "}function l(h){return" rotate("+h+"deg) "}function g(h,u){return Object.prototype.hasOwnProperty.call(u,h)}function S(){for(var h=["Moz","Webkit","Khtml","O","ms"],u=h.length,C="";u--;)h[u]+"Transform"in document.body.style&&(C="-"+h[u].toLowerCase()+"-");return C}function y(h,u,C,T,P){var q,Me=[];if(Te=="-webkit-"){for(q=0;q<P;q++)Me.push("color-stop("+T[q][0]+", "+T[q][1]+")");h.css({"background-image":"-webkit-gradient(linear, "+u.x+"% "+u.y+"%,"+C.x+"% "+C.y+"%, "+Me.join(",")+" )"})}else{var u={x:u.x/100*h.width(),y:u.y/100*h.height()},C={x:C.x/100*h.width(),y:C.y/100*h.height()},St=C.x-u.x;q=C.y-u.y;var Ke=Math.atan2(q,St),rt=Ke-Math.PI/2,rt=Math.abs(h.width()*Math.sin(rt))+Math.abs(h.height()*Math.cos(rt)),St=Math.sqrt(q*q+St*St),C=i(C.x<u.x?h.width():0,C.y<u.y?h.height():0),dt=Math.tan(Ke);for(q=-1/dt,dt=(q*C.x-C.y-dt*u.x+u.y)/(q-dt),C=q*dt-q*C.x+C.y,u=Math.sqrt(Math.pow(dt-u.x,2)+Math.pow(C-u.y,2)),q=0;q<P;q++)Me.push(" "+T[q][1]+" "+100*(u+St*T[q][0])/rt+"%");h.css({"background-image":Te+"linear-gradient("+-Ke+"rad,"+Me.join(",")+")"})}}function I(h,u,C){return h=a.Event(h),u.trigger(h,C),h.isDefaultPrevented()?"prevented":h.isPropagationStopped()?"stopped":""}function B(h){function u(C){this.name="TurnJsError",this.message=C}return u.prototype=Error(),u.prototype.constructor=u,new u(h)}function ee(h){var u={top:0,left:0};do u.left+=h.offsetLeft,u.top+=h.offsetTop;while(h=h.offsetParent);return u}var ge,le,Te="",$e=Math.PI,p=$e/2,vt="ontouchstart"in window,gt=vt?{down:"touchstart",move:"touchmove",up:"touchend",over:"touchstart",out:"touchend"}:{down:"mousedown",move:"mousemove",up:"mouseup",over:"mouseover",out:"mouseout"},ft={backward:["bl","tl"],forward:["br","tr"],all:"tl bl tr br l r".split(" ")},Et=["single","double"],Li=["ltr","rtl"],si={acceleration:!0,display:"double",duration:600,page:1,gradients:!0,turnCorners:"bl,br",when:null},Ii={cornerSize:100},Oe={init:function(q){ge="WebKitCSSMatrix"in window||"MozPerspective"in document.body.style;var u;le=(u=/AppleWebkit\/([0-9\.]+)/i.exec(navigator.userAgent))?534.3<parseFloat(u[1]):!0,Te=S();var C;u=0;var T=this.data(),P=this.children(),q=a.extend({width:this.width(),height:this.height(),direction:this.attr("dir")||this.css("direction")||"ltr"},si,q);if(T.opts=q,T.pageObjs={},T.pages={},T.pageWrap={},T.pageZoom={},T.pagePlace={},T.pageMv=[],T.zoom=1,T.totalPages=q.pages||0,T.eventHandlers={touchStart:a.proxy(Oe._touchStart,this),touchMove:a.proxy(Oe._touchMove,this),touchEnd:a.proxy(Oe._touchEnd,this),start:a.proxy(Oe._eventStart,this)},q.when)for(C in q.when)g(C,q.when)&&this.bind(C,q.when[C]);for(this.css({position:"relative",width:q.width,height:q.height}),this.turn("display",q.display),q.direction!==""&&this.turn("direction",q.direction),ge&&!vt&&q.acceleration&&this.transform(r(0,0,!0)),C=0;C<P.length;C++)a(P[C]).attr("ignore")!="1"&&this.turn("addPage",P[C],++u);return a(this).bind(gt.down,T.eventHandlers.touchStart).bind("end",Oe._eventEnd).bind("pressed",Oe._eventPressed).bind("released",Oe._eventReleased).bind("flip",Oe._flip),a(this).parent().bind("start",T.eventHandlers.start),a(document).bind(gt.move,T.eventHandlers.touchMove).bind(gt.up,T.eventHandlers.touchEnd),this.turn("page",q.page),T.done=!0,this},addPage:function(h,u){var C,T=!1,P=this.data(),q=P.totalPages+1;if(P.destroying)return!1;if((C=/\bp([0-9]+)\b/.exec(a(h).attr("class")))&&(u=parseInt(C[1],10)),u){if(u==q)T=!0;else if(u>q)throw B('Page "'+u+'" cannot be inserted')}else u=q,T=!0;return 1<=u&&u<=q&&(C=P.display=="double"?u%2?" odd":" even":"",P.done&&this.turn("stop"),u in P.pageObjs&&Oe._movePages.call(this,u,1),T&&(P.totalPages=q),P.pageObjs[u]=a(h).css({float:"left"}).addClass("page p"+u+C),navigator.userAgent.indexOf("MSIE 9.0")!=-1&&P.pageObjs[u].hasClass("hard")&&P.pageObjs[u].removeClass("hard"),Oe._addPage.call(this,u),Oe._removeFromDOM.call(this)),this},_addPage:function(h){var u=this.data(),C=u.pageObjs[h];if(C)if(Oe._necessPage.call(this,h)){if(!u.pageWrap[h]){u.pageWrap[h]=a("<div/>",{class:"page-wrapper",page:h,css:{position:"absolute",overflow:"hidden"}}),this.append(u.pageWrap[h]),u.pagePlace[h]||(u.pagePlace[h]=h,u.pageObjs[h].appendTo(u.pageWrap[h]));var T=Oe._pageSize.call(this,h,!0);C.css({width:T.width,height:T.height}),u.pageWrap[h].css(T)}u.pagePlace[h]==h&&Oe._makeFlip.call(this,h)}else u.pagePlace[h]=0,u.pageObjs[h]&&u.pageObjs[h].remove()},hasPage:function(h){return g(h,this.data().pageObjs)},center:function(h){var u=this.data(),C=a(this).turn("size"),T=0;return u.noCenter||(u.display=="double"&&(h=this.turn("view",h||u.tpage||u.page),u.direction=="ltr"?h[0]?h[1]||(T+=C.width/4):T-=C.width/4:h[0]?h[1]||(T-=C.width/4):T+=C.width/4),a(this).css({marginLeft:T})),this},destroy:function(){var h=this,u=this.data(),C="end first flip last pressed released start turning turned zooming missing".split(" ");if(I("destroying",this)!="prevented"){for(u.destroying=!0,a.each(C,function(T,P){h.unbind(P)}),this.parent().unbind("start",u.eventHandlers.start),a(document).unbind(gt.move,u.eventHandlers.touchMove).unbind(gt.up,u.eventHandlers.touchEnd);u.totalPages!==0;)this.turn("removePage",u.totalPages);return u.fparent&&u.fparent.remove(),u.shadow&&u.shadow.remove(),this.removeData(),u=null,this}},is:function(){return typeof this.data().pages=="object"},zoom:function(h){var u=this.data();if(typeof h=="number"){if(.001>h||100<h)throw B(h+" is not a value for zoom");if(I("zooming",this,[h,u.zoom])=="prevented")return this;var q=this.turn("size"),C=this.turn("view"),T=1/u.zoom,P=Math.round(q.width*T*h),q=Math.round(q.height*T*h);for(u.zoom=h,a(this).turn("stop").turn("size",P,q),u.opts.autoCenter&&this.turn("center"),Oe._updateShadow.call(this),h=0;h<C.length;h++)C[h]&&u.pageZoom[C[h]]!=u.zoom&&(this.trigger("zoomed",[C[h],C,u.pageZoom[C[h]],u.zoom]),u.pageZoom[C[h]]=u.zoom);return this}return u.zoom},_pageSize:function(h,u){var C=this.data(),T={};if(C.display=="single")T.width=this.width(),T.height=this.height(),u&&(T.top=0,T.left=0,T.right="auto");else{var P=this.width()/2,q=this.height();if(C.pageObjs[h].hasClass("own-size")?(T.width=C.pageObjs[h].width(),T.height=C.pageObjs[h].height()):(T.width=P,T.height=q),u){var Me=h%2;T.top=(q-T.height)/2,C.direction=="ltr"?(T[Me?"right":"left"]=P-T.width,T[Me?"left":"right"]="auto"):(T[Me?"left":"right"]=P-T.width,T[Me?"right":"left"]="auto")}}return T},_makeFlip:function(h){var u=this.data();if(!u.pages[h]&&u.pagePlace[h]==h){var C=u.display=="single",T=h%2;u.pages[h]=u.pageObjs[h].css(Oe._pageSize.call(this,h)).flip({page:h,next:T||C?h+1:h-1,turn:this}).flip("disable",u.disabled),Oe._setPageLoc.call(this,h),u.pageZoom[h]=u.zoom}return u.pages[h]},_makeRange:function(){var h,u;if(!(1>this.data().totalPages))for(u=this.turn("range"),h=u[0];h<=u[1];h++)Oe._addPage.call(this,h)},range:function(q){var u,C,T,P=this.data(),q=q||P.tpage||P.page||1;if(T=Oe._view.call(this,q),1>q||q>P.totalPages)throw B('"'+q+'" is not a valid page');return T[1]=T[1]||T[0],1<=T[0]&&T[1]<=P.totalPages?(q=Math.floor(2),P.totalPages-T[1]>T[0]?(u=Math.min(T[0]-1,q),C=2*q-u):(C=Math.min(P.totalPages-T[1],q),u=2*q-C)):C=u=5,[Math.max(1,T[0]-u),Math.min(P.totalPages,T[1]+C)]},_necessPage:function(h){if(h===0)return!0;var u=this.turn("range");return this.data().pageObjs[h].hasClass("fixed")||h>=u[0]&&h<=u[1]},_removeFromDOM:function(){var h,u=this.data();for(h in u.pageWrap)g(h,u.pageWrap)&&!Oe._necessPage.call(this,h)&&Oe._removePageFromDOM.call(this,h)},_removePageFromDOM:function(h){var u=this.data();if(u.pages[h]){var C=u.pages[h].data();De._moveFoldingPage.call(u.pages[h],!1),C.f&&C.f.fwrapper&&C.f.fwrapper.remove(),u.pages[h].removeData(),u.pages[h].remove(),delete u.pages[h]}u.pageObjs[h]&&u.pageObjs[h].remove(),u.pageWrap[h]&&(u.pageWrap[h].remove(),delete u.pageWrap[h]),Oe._removeMv.call(this,h),delete u.pagePlace[h],delete u.pageZoom[h]},removePage:function(h){var u=this.data();if(h=="*")for(;u.totalPages!==0;)this.turn("removePage",u.totalPages);else{if(1>h||h>u.totalPages)throw B("The page "+h+" doesn't exist");u.pageObjs[h]&&(this.turn("stop"),Oe._removePageFromDOM.call(this,h),delete u.pageObjs[h]),Oe._movePages.call(this,h,-1),u.totalPages-=1,u.page>u.totalPages?(u.page=null,Oe._fitPage.call(this,u.totalPages)):(Oe._makeRange.call(this),this.turn("update"))}return this},_movePages:function(h,u){var C,T=this,P=this.data(),q=P.display=="single",Me=function(Ke){var rt=Ke+u,St=rt%2,dt=St?" odd ":" even ";P.pageObjs[Ke]&&(P.pageObjs[rt]=P.pageObjs[Ke].removeClass("p"+Ke+" odd even").addClass("p"+rt+dt)),P.pagePlace[Ke]&&P.pageWrap[Ke]&&(P.pagePlace[rt]=rt,P.pageWrap[rt]=P.pageObjs[rt].hasClass("fixed")?P.pageWrap[Ke].attr("page",rt):P.pageWrap[Ke].css(Oe._pageSize.call(T,rt,!0)).attr("page",rt),P.pages[Ke]&&(P.pages[rt]=P.pages[Ke].flip("options",{page:rt,next:q||St?rt+1:rt-1})),u&&(delete P.pages[Ke],delete P.pagePlace[Ke],delete P.pageZoom[Ke],delete P.pageObjs[Ke],delete P.pageWrap[Ke]))};if(0<u)for(C=P.totalPages;C>=h;C--)Me(C);else for(C=h;C<=P.totalPages;C++)Me(C)},display:function(h){var u=this.data(),C=u.display;if(h===void 0)return C;if(a.inArray(h,Et)==-1)throw B('"'+h+'" is not a value for display');switch(h){case"single":u.pageObjs[0]||(this.turn("stop").css({overflow:"hidden"}),u.pageObjs[0]=a("<div />",{class:"page p-temporal"}).css({width:this.width(),height:this.height()}).appendTo(this)),this.addClass("shadow");break;case"double":u.pageObjs[0]&&(this.turn("stop").css({overflow:""}),u.pageObjs[0].remove(),delete u.pageObjs[0]),this.removeClass("shadow")}return u.display=h,C&&(h=this.turn("size"),Oe._movePages.call(this,1,0),this.turn("size",h.width,h.height).turn("update")),this},direction:function(h){var u=this.data();if(h===void 0)return u.direction;if(h=h.toLowerCase(),a.inArray(h,Li)==-1)throw B('"'+h+'" is not a value for direction');return h=="rtl"&&a(this).attr("dir","ltr").css({direction:"ltr"}),u.direction=h,u.done&&this.turn("size",a(this).width(),a(this).height()),this},animating:function(){return 0<this.data().pageMv.length},corner:function(){var h,u,C=this.data();for(u in C.pages)if(g(u,C.pages)&&(h=C.pages[u].flip("corner")))return h;return!1},data:function(){return this.data()},disable:function(h){var u,C=this.data(),T=this.turn("view");C.disabled=h===void 0||h===!0;for(u in C.pages)g(u,C.pages)&&C.pages[u].flip("disable",C.disabled?!0:a.inArray(parseInt(u,10),T)==-1);return this},disabled:function(h){return h===void 0?this.data().disabled===!0:this.turn("disable",h)},size:function(h,u){if(h===void 0||u===void 0)return{width:this.width(),height:this.height()};this.turn("stop");var C,T,P=this.data();T=P.display=="double"?h/2:h,this.css({width:h,height:u}),P.pageObjs[0]&&P.pageObjs[0].css({width:T,height:u});for(C in P.pageWrap)g(C,P.pageWrap)&&(T=Oe._pageSize.call(this,C,!0),P.pageObjs[C].css({width:T.width,height:T.height}),P.pageWrap[C].css(T),P.pages[C]&&P.pages[C].css({width:T.width,height:T.height}));return this.turn("resize"),this},resize:function(){var h,u=this.data();for(u.pages[0]&&(u.pageWrap[0].css({left:-this.width()}),u.pages[0].flip("resize",!0)),h=1;h<=u.totalPages;h++)u.pages[h]&&u.pages[h].flip("resize",!0);Oe._updateShadow.call(this),u.opts.autoCenter&&this.turn("center")},_removeMv:function(h){var u,C=this.data();for(u=0;u<C.pageMv.length;u++)if(C.pageMv[u]==h)return C.pageMv.splice(u,1),!0;return!1},_addMv:function(h){var u=this.data();Oe._removeMv.call(this,h),u.pageMv.push(h)},_view:function(C){var u=this.data(),C=C||u.page;return u.display=="double"?C%2?[C-1,C]:[C,C+1]:[C]},view:function(C){var u=this.data(),C=Oe._view.call(this,C);return u.display=="double"?[0<C[0]?C[0]:0,C[1]<=u.totalPages?C[1]:0]:[0<C[0]&&C[0]<=u.totalPages?C[0]:0]},stop:function(h,u){if(this.turn("animating")){var C,T,P,q=this.data();for(q.tpage&&(q.page=q.tpage,delete q.tpage),C=0;C<q.pageMv.length;C++)q.pageMv[C]&&q.pageMv[C]!==h&&(P=q.pages[q.pageMv[C]],T=P.data().f.opts,P.flip("hideFoldedPage",u),u||De._moveFoldingPage.call(P,!1),T.force&&(T.next=T.page%2===0?T.page-1:T.page+1,delete T.force))}return this.turn("update"),this},pages:function(h){var u=this.data();if(h){if(h<u.totalPages)for(var C=u.totalPages;C>h;C--)this.turn("removePage",C);return u.totalPages=h,Oe._fitPage.call(this,u.page),this}return u.totalPages},_missing:function(h){var u=this.data();if(!(1>u.totalPages)){for(var C=this.turn("range",h),T=[],h=C[0];h<=C[1];h++)u.pageObjs[h]||T.push(h);0<T.length&&this.trigger("missing",[T])}},_fitPage:function(h){var u=this.data(),C=this.turn("view",h);if(Oe._missing.call(this,h),u.pageObjs[h]){u.page=h,this.turn("stop");for(var T=0;T<C.length;T++)C[T]&&u.pageZoom[C[T]]!=u.zoom&&(this.trigger("zoomed",[C[T],C,u.pageZoom[C[T]],u.zoom]),u.pageZoom[C[T]]=u.zoom);Oe._removeFromDOM.call(this),Oe._makeRange.call(this),Oe._updateShadow.call(this),this.trigger("turned",[h,C]),this.turn("update"),u.opts.autoCenter&&this.turn("center")}},_turnPage:function(h){var u,C,T=this.data(),P=T.pagePlace[h],q=this.turn("view"),Me=this.turn("view",h);if(T.page!=h){var Ke=T.page;if(I("turning",this,[h,Me])=="prevented"){Ke==T.page&&a.inArray(P,T.pageMv)!=-1&&T.pages[P].flip("hideFoldedPage",!0);return}a.inArray(1,Me)!=-1&&this.trigger("first"),a.inArray(T.totalPages,Me)!=-1&&this.trigger("last")}T.display=="single"?(u=q[0],C=Me[0]):q[1]&&h>q[1]?(u=q[1],C=Me[0]):q[0]&&h<q[0]&&(u=q[0],C=Me[1]),P=T.opts.turnCorners.split(","),q=T.pages[u].data().f,Me=q.opts,Ke=q.point,Oe._missing.call(this,h),T.pageObjs[h]&&(this.turn("stop"),T.page=h,Oe._makeRange.call(this),T.tpage=C,Me.next!=C&&(Me.next=C,Me.force=!0),this.turn("update"),q.point=Ke,q.effect=="hard"?T.direction=="ltr"?T.pages[u].flip("turnPage",h>u?"r":"l"):T.pages[u].flip("turnPage",h>u?"l":"r"):T.direction=="ltr"?T.pages[u].flip("turnPage",P[h>u?1:0]):T.pages[u].flip("turnPage",P[h>u?0:1]))},page:function(h){var u=this.data();if(h===void 0)return u.page;if(!u.disabled&&!u.destroying){if(h=parseInt(h,10),0<h&&h<=u.totalPages)return h!=u.page&&(!u.done||a.inArray(h,this.turn("view"))!=-1?Oe._fitPage.call(this,h):Oe._turnPage.call(this,h)),this;throw B("The page "+h+" does not exist")}},next:function(){return this.turn("page",Math.min(this.data().totalPages,Oe._view.call(this,this.data().page).pop()+1))},previous:function(){return this.turn("page",Math.max(1,Oe._view.call(this,this.data().page).shift()-1))},peel:function(h,P){var C=this.data(),T=this.turn("view"),P=P===void 0?!0:P===!0;return h===!1?this.turn("stop",null,P):C.display=="single"?C.pages[C.page].flip("peel",h,P):(T=C.direction=="ltr"?h.indexOf("l")!=-1?T[0]:T[1]:h.indexOf("l")!=-1?T[1]:T[0],C.pages[T]&&C.pages[T].flip("peel",h,P)),this},_addMotionPage:function(){var h=a(this).data().f.opts,u=h.turn;u.data(),Oe._addMv.call(u,h.page)},_eventStart:function(h,u,C){var T=u.turn.data(),P=T.pageZoom[u.page];h.isDefaultPrevented()||(P&&P!=T.zoom&&(u.turn.trigger("zoomed",[u.page,u.turn.turn("view",u.page),P,T.zoom]),T.pageZoom[u.page]=T.zoom),T.display=="single"&&C&&(C.charAt(1)=="l"&&T.direction=="ltr"||C.charAt(1)=="r"&&T.direction=="rtl"?(u.next=u.next<u.page?u.next:u.page-1,u.force=!0):u.next=u.next>u.page?u.next:u.page+1),Oe._addMotionPage.call(h.target)),Oe._updateShadow.call(u.turn)},_eventEnd:function(T,u,C){a(T.target).data();var T=u.turn,P=T.data();C?(C=P.tpage||P.page,(C==u.next||C==u.page)&&(delete P.tpage,Oe._fitPage.call(T,C||u.next,!0))):(Oe._removeMv.call(T,u.page),Oe._updateShadow.call(T),T.turn("update"))},_eventPressed:function(u){var u=a(u.target).data().f,C=u.opts.turn;return C.data().mouseAction=!0,C.turn("update"),u.time=new Date().getTime()},_eventReleased:function(h,u){var C;C=a(h.target);var T=C.data().f,P=T.opts.turn,q=P.data();C=q.display=="single"?u.corner=="br"||u.corner=="tr"?u.x<C.width()/2:u.x>C.width()/2:0>u.x||u.x>C.width(),(200>new Date().getTime()-T.time||C)&&(h.preventDefault(),Oe._turnPage.call(P,T.opts.next)),q.mouseAction=!1},_flip:function(h){h.stopPropagation(),h=a(h.target).data().f.opts,h.turn.trigger("turn",[h.next]),h.turn.data().opts.autoCenter&&h.turn.turn("center",h.next)},_touchStart:function(){var h=this.data(),u;for(u in h.pages)if(g(u,h.pages)&&De._eventStart.apply(h.pages[u],arguments)===!1)return!1},_touchMove:function(){var h=this.data(),u;for(u in h.pages)g(u,h.pages)&&De._eventMove.apply(h.pages[u],arguments)},_touchEnd:function(){var h=this.data(),u;for(u in h.pages)g(u,h.pages)&&De._eventEnd.apply(h.pages[u],arguments)},calculateZ:function(h){var u,C,T,P,q=this,Me=this.data();u=this.turn("view");var Ke=u[0]||u[1],rt=h.length-1,St={pageZ:{},partZ:{},pageV:{}},dt=function(di){di=q.turn("view",di),di[0]&&(St.pageV[di[0]]=!0),di[1]&&(St.pageV[di[1]]=!0)};for(u=0;u<=rt;u++)C=h[u],T=Me.pages[C].data().f.opts.next,P=Me.pagePlace[C],dt(C),dt(T),C=Me.pagePlace[T]==T?T:C,St.pageZ[C]=Me.totalPages-Math.abs(Ke-C),St.partZ[P]=2*Me.totalPages-rt+u;return St},update:function(){var h,u=this.data();if(this.turn("animating")&&u.pageMv[0]!==0){var C,T=this.turn("calculateZ",u.pageMv),P=this.turn("corner"),q=this.turn("view"),Me=this.turn("view",u.tpage);for(h in u.pageWrap)g(h,u.pageWrap)&&(C=u.pageObjs[h].hasClass("fixed"),u.pageWrap[h].css({display:T.pageV[h]||C?"":"none",zIndex:(u.pageObjs[h].hasClass("hard")?T.partZ[h]:T.pageZ[h])||(C?-1:0)}),C=u.pages[h])&&(C.flip("z",T.partZ[h]||null),T.pageV[h]&&C.flip("resize"),u.tpage?C.flip("hover",!1).flip("disable",a.inArray(parseInt(h,10),u.pageMv)==-1&&h!=Me[0]&&h!=Me[1]):C.flip("hover",P===!1).flip("disable",h!=q[0]&&h!=q[1]))}else for(h in u.pageWrap)g(h,u.pageWrap)&&(T=Oe._setPageLoc.call(this,h),u.pages[h]&&u.pages[h].flip("disable",u.disabled||T!=1).flip("hover",!0).flip("z",null));return this},_updateShadow:function(){var h,u,C=this.data(),T=this.width(),P=this.height(),q=C.display=="single"?T:T/2;h=this.turn("view"),C.shadow||(C.shadow=a("<div />",{class:"shadow",css:n(0,0,0).css}).appendTo(this));for(var Me=0;Me<C.pageMv.length&&h[0]&&h[1];Me++)h=this.turn("view",C.pages[C.pageMv[Me]].data().f.opts.next),u=this.turn("view",C.pageMv[Me]),h[0]=h[0]&&u[0],h[1]=h[1]&&u[1];switch(h[0]?h[1]?3:C.direction=="ltr"?2:1:C.direction=="ltr"?1:2){case 1:C.shadow.css({width:q,height:P,top:0,left:q});break;case 2:C.shadow.css({width:q,height:P,top:0,left:0});break;case 3:C.shadow.css({width:T,height:P,top:0,left:0})}},_setPageLoc:function(h){var u=this.data(),C=this.turn("view"),T=0;if(h==C[0]||h==C[1]?T=1:(u.display=="single"&&h==C[0]+1||u.display=="double"&&h==C[0]-2||h==C[1]+2)&&(T=2),!this.turn("animating"))switch(T){case 1:u.pageWrap[h].css({zIndex:u.totalPages,display:""});break;case 2:u.pageWrap[h].css({zIndex:u.totalPages-1,display:""});break;case 0:u.pageWrap[h].css({zIndex:0,display:u.pageObjs[h].hasClass("fixed")?"":"none"})}return T},options:function(h){if(h===void 0)return this.data().opts;var u=this.data();if(a.extend(u.opts,h),h.pages&&this.turn("pages",h.pages),h.page&&this.turn("page",h.page),h.display&&this.turn("display",h.display),h.direction&&this.turn("direction",h.direction),h.width&&h.height&&this.turn("size",h.width,h.height),h.when)for(var C in h.when)g(C,h.when)&&this.unbind(C).bind(C,h.when[C]);return this},version:function(){return"4.1.0"}},De={init:function(h){return this.data({f:{disabled:!1,hover:!1,effect:this.hasClass("hard")?"hard":"sheet"}}),this.flip("options",h),De._addPageWrapper.call(this),this},setData:function(h){var u=this.data();return u.f=a.extend(u.f,h),this},options:function(h){var u=this.data().f;return h?(De.setData.call(this,{opts:a.extend({},u.opts||Ii,h)}),this):u.opts},z:function(h){var u=this.data().f;return u.opts["z-index"]=h,u.fwrapper&&u.fwrapper.css({zIndex:h||parseInt(u.parent.css("z-index"),10)||0}),this},_cAllowed:function(){var h=this.data().f,u=h.opts.page,C=h.opts.turn.data(),T=u%2;return h.effect=="hard"?C.direction=="ltr"?[T?"r":"l"]:[T?"l":"r"]:C.display=="single"?u==1?C.direction=="ltr"?ft.forward:ft.backward:u==C.totalPages?C.direction=="ltr"?ft.backward:ft.forward:ft.all:C.direction=="ltr"?ft[T?"forward":"backward"]:ft[T?"backward":"forward"]},_cornerActivated:function(P){var u=this.data().f,C=this.width(),T=this.height(),P={x:P.x,y:P.y,corner:""},q=u.opts.cornerSize;if(0>=P.x||0>=P.y||P.x>=C||P.y>=T)return!1;var Me=De._cAllowed.call(this);switch(u.effect){case"hard":if(P.x>C-q)P.corner="r";else if(P.x<q)P.corner="l";else return!1;break;case"sheet":if(P.y<q)P.corner+="t";else if(P.y>=T-q)P.corner+="b";else return!1;if(P.x<=q)P.corner+="l";else if(P.x>=C-q)P.corner+="r";else return!1}return!P.corner||a.inArray(P.corner,Me)==-1?!1:P},_isIArea:function(C){var u=this.data().f.parent.offset(),C=vt&&C.originalEvent?C.originalEvent.touches[0]:C;return De._cornerActivated.call(this,{x:C.pageX-u.left,y:C.pageY-u.top})},_c:function(h,u){switch(u=u||0,h){case"tl":return i(u,u);case"tr":return i(this.width()-u,u);case"bl":return i(u,this.height()-u);case"br":return i(this.width()-u,this.height()-u);case"l":return i(u,0);case"r":return i(this.width()-u,0)}},_c2:function(h){switch(h){case"tl":return i(2*this.width(),0);case"tr":return i(-this.width(),0);case"bl":return i(2*this.width(),this.height());case"br":return i(-this.width(),this.height());case"l":return i(2*this.width(),0);case"r":return i(-this.width(),0)}},_foldingPage:function(){var h=this.data().f;if(h){var u=h.opts;if(u.turn)return h=u.turn.data(),h.display=="single"?1<u.next||1<u.page?h.pageObjs[0]:null:h.pageObjs[u.next]}},_backGradient:function(){var h=this.data().f,u=h.opts.turn.data();return(u=u.opts.gradients&&(u.display=="single"||h.opts.page!=2&&h.opts.page!=u.totalPages-1))&&!h.bshadow&&(h.bshadow=a("<div/>",n(0,0,1)).css({position:"",width:this.width(),height:this.height()}).appendTo(h.parent)),u},type:function(){return this.data().f.effect},resize:function(h){var u=this.data().f,C=u.opts.turn.data(),T=this.width(),P=this.height();switch(u.effect){case"hard":h&&(u.wrapper.css({width:T,height:P}),u.fpage.css({width:T,height:P}),C.opts.gradients&&(u.ashadow.css({width:T,height:P}),u.bshadow.css({width:T,height:P})));break;case"sheet":h&&(h=Math.round(Math.sqrt(Math.pow(T,2)+Math.pow(P,2))),u.wrapper.css({width:h,height:h}),u.fwrapper.css({width:h,height:h}).children(":first-child").css({width:T,height:P}),u.fpage.css({width:T,height:P}),C.opts.gradients&&u.ashadow.css({width:T,height:P}),De._backGradient.call(this)&&u.bshadow.css({width:T,height:P})),u.parent.is(":visible")&&(C=ee(u.parent[0]),u.fwrapper.css({top:C.top,left:C.left}),C=ee(u.opts.turn[0]),u.fparent.css({top:-C.top,left:-C.left})),this.flip("z",u.opts["z-index"])}},_addPageWrapper:function(){var h=this.data().f,u=h.opts.turn.data(),C=this.parent();if(h.parent=C,!h.wrapper)switch(h.effect){case"hard":var T={};T[Te+"transform-style"]="preserve-3d",T[Te+"backface-visibility"]="hidden",h.wrapper=a("<div/>",n(0,0,2)).css(T).appendTo(C).prepend(this),h.fpage=a("<div/>",n(0,0,1)).css(T).appendTo(C),u.opts.gradients&&(h.ashadow=a("<div/>",n(0,0,0)).hide().appendTo(C),h.bshadow=a("<div/>",n(0,0,0)));break;case"sheet":var T=this.width(),P=this.height();Math.round(Math.sqrt(Math.pow(T,2)+Math.pow(P,2))),h.fparent=h.opts.turn.data().fparent,h.fparent||(T=a("<div/>",{css:{"pointer-events":"none"}}).hide(),T.data().flips=0,T.css(n(0,0,"auto","visible").css).appendTo(h.opts.turn),h.opts.turn.data().fparent=T,h.fparent=T),this.css({position:"absolute",top:0,left:0,bottom:"auto",right:"auto"}),h.wrapper=a("<div/>",n(0,0,this.css("z-index"))).appendTo(C).prepend(this),h.fwrapper=a("<div/>",n(C.offset().top,C.offset().left)).hide().appendTo(h.fparent),h.fpage=a("<div/>",n(0,0,0,"visible")).css({cursor:"default"}).appendTo(h.fwrapper),u.opts.gradients&&(h.ashadow=a("<div/>",n(0,0,1)).appendTo(h.fpage)),De.setData.call(this,h)}De.resize.call(this,!0)},_fold:function(h){var u=this.data().f,C=u.opts.turn.data(),T=De._c.call(this,h.corner),P=this.width(),q=this.height();switch(u.effect){case"hard":h.x=h.corner=="l"?Math.min(Math.max(h.x,0),2*P):Math.max(Math.min(h.x,P),-P);var Me,Ke,rt,St,dt,di=C.totalPages,rn=u.opts["z-index"]||di,Xn={overflow:"visible"},Zn=T.x?(T.x-h.x)/P:h.x/P,Yo=90*Zn,Co=90>Yo;switch(h.corner){case"l":St="0% 50%",dt="100% 50%",Co?(Me=0,Ke=0<u.opts.next-1,rt=1):(Me="100%",Ke=u.opts.page+1<di,rt=0);break;case"r":St="100% 50%",dt="0% 50%",Yo=-Yo,P=-P,Co?(Me=0,Ke=u.opts.next+1<di,rt=0):(Me="-100%",Ke=u.opts.page!=1,rt=1)}Xn[Te+"perspective-origin"]=dt,u.wrapper.transform("rotateY("+Yo+"deg)translate3d(0px, 0px, "+(this.attr("depth")||0)+"px)",dt),u.fpage.transform("translateX("+P+"px) rotateY("+(180+Yo)+"deg)",St),u.parent.css(Xn),Co?(Zn=-Zn+1,u.wrapper.css({zIndex:rn+1}),u.fpage.css({zIndex:rn})):(Zn-=1,u.wrapper.css({zIndex:rn}),u.fpage.css({zIndex:rn+1})),C.opts.gradients&&(Ke?u.ashadow.css({display:"",left:Me,backgroundColor:"rgba(0,0,0,"+.5*Zn+")"}).transform("rotateY(0deg)"):u.ashadow.hide(),u.bshadow.css({opacity:-Zn+1}),Co?u.bshadow.parent()[0]!=u.wrapper[0]&&u.bshadow.appendTo(u.wrapper):u.bshadow.parent()[0]!=u.fpage[0]&&u.bshadow.appendTo(u.fpage),y(u.bshadow,i(100*rt,0),i(100*(-rt+1),0),[[0,"rgba(0,0,0,0.3)"],[1,"rgba(0,0,0,0)"]],2));break;case"sheet":var Jn=this,Wi=0,bo,sn,je,hi,Dn,ur,ys,hn=i(0,0),gr=i(0,0),Wt=i(0,0),eo=De._foldingPage.call(this);Math.tan(0);var to=C.opts.acceleration,fr=u.wrapper.height(),io=h.corner.substr(0,1)=="t",kn=h.corner.substr(1,1)=="l",Qo=function(){var tt=i(0,0),Ai=i(0,0);tt.x=T.x?T.x-h.x:h.x,tt.y=le?T.y?T.y-h.y:h.y:0,Ai.x=kn?P-tt.x/2:h.x+tt.x/2,Ai.y=tt.y/2;var Pt=p-Math.atan2(tt.y,tt.x),ui=Pt-Math.atan2(Ai.y,Ai.x),ui=Math.max(0,Math.sin(ui)*Math.sqrt(Math.pow(Ai.x,2)+Math.pow(Ai.y,2)));return Wi=180*(Pt/$e),Wt=i(ui*Math.sin(Pt),ui*Math.cos(Pt)),Pt>p&&(Wt.x+=Math.abs(Wt.y*tt.y/tt.x),Wt.y=0,Math.round(Wt.x*Math.tan($e-Pt))<q)?(h.y=Math.sqrt(Math.pow(q,2)+2*Ai.x*tt.x),io&&(h.y=q-h.y),Qo()):(Pt>p&&(tt=$e-Pt,Ai=fr-q/Math.sin(tt),hn=i(Math.round(Ai*Math.cos(tt)),Math.round(Ai*Math.sin(tt))),kn&&(hn.x=-hn.x),io&&(hn.y=-hn.y)),bo=Math.round(Wt.y/Math.tan(Pt)+Wt.x),tt=P-bo,Ai=tt*Math.cos(2*Pt),ui=tt*Math.sin(2*Pt),gr=i(Math.round(kn?tt-Ai:bo+Ai),Math.round(io?ui:q-ui)),C.opts.gradients&&(Dn=tt*Math.sin(Pt),tt=De._c2.call(Jn,h.corner),tt=Math.sqrt(Math.pow(tt.x-h.x,2)+Math.pow(tt.y-h.y,2))/P,ys=Math.sin(p*(1<tt?2-tt:tt)),ur=Math.min(tt,1),hi=100<Dn?(Dn-100)/Dn:0,sn=i(100*(Dn*Math.sin(Pt)/P),100*(Dn*Math.cos(Pt)/q)),De._backGradient.call(Jn)&&(je=i(100*(1.2*Dn*Math.sin(Pt)/P),100*(1.2*Dn*Math.cos(Pt)/q)),kn||(je.x=100-je.x),io||(je.y=100-je.y))),Wt.x=Math.round(Wt.x),Wt.y=Math.round(Wt.y),!0)};switch(Me=function(tt,Mn,Pt,ui){var no=["0","auto"],zi=(P-fr)*Pt[0]/100,Ni=(q-fr)*Pt[1]/100,Mn={left:no[Mn[0]],top:no[Mn[1]],right:no[Mn[2]],bottom:no[Mn[3]]},no={},ns=ui!=90&&ui!=-90?kn?-1:1:0,oo=Pt[0]+"% "+Pt[1]+"%";Jn.css(Mn).transform(l(ui)+r(tt.x+ns,tt.y,to),oo),u.fpage.css(Mn).transform(l(ui)+r(tt.x+gr.x-hn.x-P*Pt[0]/100,tt.y+gr.y-hn.y-q*Pt[1]/100,to)+l((180/ui-2)*ui),oo),u.wrapper.transform(r(-tt.x+zi-ns,-tt.y+Ni,to)+l(-ui),oo),u.fwrapper.transform(r(-tt.x+hn.x+zi,-tt.y+hn.y+Ni,to)+l(-ui),oo),C.opts.gradients&&(Pt[0]&&(sn.x=100-sn.x),Pt[1]&&(sn.y=100-sn.y),no["box-shadow"]="0 0 20px rgba(0,0,0,"+.5*ys+")",eo.css(no),y(u.ashadow,i(kn?100:0,io?0:100),i(sn.x,sn.y),[[hi,"rgba(0,0,0,0)"],[.8*(1-hi)+hi,"rgba(0,0,0,"+.2*ur+")"],[1,"rgba(255,255,255,"+.2*ur+")"]],3,0),De._backGradient.call(Jn)&&y(u.bshadow,i(kn?0:100,io?0:100),i(je.x,je.y),[[.6,"rgba(0,0,0,0)"],[.8,"rgba(0,0,0,"+.3*ur+")"],[1,"rgba(0,0,0,0)"]],3))},h.corner){case"tl":h.x=Math.max(h.x,1),Qo(),Me(Wt,[1,0,0,1],[100,0],Wi);break;case"tr":h.x=Math.min(h.x,P-1),Qo(),Me(i(-Wt.x,Wt.y),[0,0,0,1],[0,0],-Wi);break;case"bl":h.x=Math.max(h.x,1),Qo(),Me(i(Wt.x,-Wt.y),[1,1,0,0],[100,100],-Wi);break;case"br":h.x=Math.min(h.x,P-1),Qo(),Me(i(-Wt.x,-Wt.y),[0,1,1,0],[0,100],Wi)}}u.point=h},_moveFoldingPage:function(h){var u=this.data().f;if(u){var C=u.opts.turn,T=C.data(),P=T.pagePlace;h?(T=u.opts.next,P[T]!=u.opts.page&&(u.folding&&De._moveFoldingPage.call(this,!1),De._foldingPage.call(this).appendTo(u.fpage),P[T]=u.opts.page,u.folding=T),C.turn("update")):u.folding&&(T.pages[u.folding]?(C=T.pages[u.folding].data().f,T.pageObjs[u.folding].appendTo(C.wrapper)):T.pageWrap[u.folding]&&T.pageObjs[u.folding].appendTo(T.pageWrap[u.folding]),u.folding in P&&(P[u.folding]=u.folding),delete u.folding)}},_showFoldedPage:function(h,u){var C=De._foldingPage.call(this),T=this.data(),P=T.f,q=P.visible;if(C){if((!q||!P.point||P.point.corner!=h.corner)&&(C=P.status=="hover"||P.status=="peel"||P.opts.turn.data().mouseAction?h.corner:null,q=!1,I("start",this,[P.opts,C])=="prevented"))return!1;if(u){var Me=this,T=P.point&&P.point.corner==h.corner?P.point:De._c.call(this,h.corner,1);this.animatef({from:[T.x,T.y],to:[h.x,h.y],duration:500,frame:function(rt){h.x=Math.round(rt[0]),h.y=Math.round(rt[1]),De._fold.call(Me,h)}})}else De._fold.call(this,h),T.effect&&!T.effect.turning&&this.animatef(!1);if(!q)switch(P.effect){case"hard":P.visible=!0,De._moveFoldingPage.call(this,!0),P.fpage.show(),P.opts.shadows&&P.bshadow.show();break;case"sheet":P.visible=!0,P.fparent.show().data().flips++,De._moveFoldingPage.call(this,!0),P.fwrapper.show(),P.bshadow&&P.bshadow.show()}return!0}return!1},hide:function(){var h=this.data().f,u=h.opts.turn.data(),C=De._foldingPage.call(this);switch(h.effect){case"hard":u.opts.gradients&&(h.bshadowLoc=0,h.bshadow.remove(),h.ashadow.hide()),h.wrapper.transform(""),h.fpage.hide();break;case"sheet":--h.fparent.data().flips===0&&h.fparent.hide(),this.css({left:0,top:0,right:"auto",bottom:"auto"}).transform(""),h.wrapper.transform(""),h.fwrapper.hide(),h.bshadow&&h.bshadow.hide(),C.transform("")}return h.visible=!1,this},hideFoldedPage:function(h){var u=this.data().f;if(u.point){var C=this,T=u.point,P=function(){u.point=null,u.status="",C.flip("hide"),C.trigger("end",[u.opts,!1])};if(h){var q=De._c.call(this,T.corner),h=T.corner.substr(0,1)=="t"?Math.min(0,T.y-q.y)/2:Math.max(0,T.y-q.y)/2,Me=i(T.x,T.y+h),Ke=i(q.x,q.y-h);this.animatef({from:0,to:1,frame:function(St){St=e(T,Me,Ke,q,St),T.x=St.x,T.y=St.y,De._fold.call(C,T)},complete:P,duration:800,hiding:!0})}else this.animatef(!1),P()}},turnPage:function(P){var u=this,C=this.data().f,T=C.opts.turn.data(),P={corner:C.corner?C.corner.corner:P||De._cAllowed.call(this)[0]},q=C.point||De._c.call(this,P.corner,C.opts.turn?T.opts.elevation:0),Me=De._c2.call(this,P.corner);this.trigger("flip").animatef({from:0,to:1,frame:function(Ke){Ke=e(q,q,Me,Me,Ke),P.x=Ke.x,P.y=Ke.y,De._showFoldedPage.call(u,P)},complete:function(){u.trigger("end",[C.opts,!0])},duration:T.opts.duration,turning:!0}),C.corner=null},moving:function(){return"effect"in this.data()},isTurning:function(){return this.flip("moving")&&this.data().effect.turning},corner:function(){return this.data().f.corner},_eventStart:function(h){var u=this.data().f,C=u.opts.turn;if(!u.corner&&!u.disabled&&!this.flip("isTurning")&&u.opts.page==C.data().pagePlace[u.opts.page]){if(u.corner=De._isIArea.call(this,h),u.corner&&De._foldingPage.call(this))return this.trigger("pressed",[u.point]),De._showFoldedPage.call(this,u.corner),!1;u.corner=null}},_eventMove:function(h){var u=this.data().f;if(!u.disabled)if(h=vt?h.originalEvent.touches:[h],u.corner){var C=u.parent.offset();u.corner.x=h[0].pageX-C.left,u.corner.y=h[0].pageY-C.top,De._showFoldedPage.call(this,u.corner)}else u.hover&&!this.data().effect&&this.is(":visible")&&((h=De._isIArea.call(this,h[0]))?(u.effect=="sheet"&&h.corner.length==2||u.effect=="hard")&&(u.status="hover",u=De._c.call(this,h.corner,u.opts.cornerSize/2),h.x=u.x,h.y=u.y,De._showFoldedPage.call(this,h,!0)):u.status=="hover"&&(u.status="",De.hideFoldedPage.call(this,!0)))},_eventEnd:function(){var h=this.data().f,u=h.corner;!h.disabled&&u&&I("released",this,[h.point||u])!="prevented"&&De.hideFoldedPage.call(this,!0),h.corner=null},disable:function(h){return De.setData.call(this,{disabled:h}),this},hover:function(h){return De.setData.call(this,{hover:h}),this},peel:function(h,u){var C=this.data().f;if(h){if(a.inArray(h,ft.all)==-1)throw B("Corner "+h+" is not permitted");if(a.inArray(h,De._cAllowed.call(this))!=-1){var T=De._c.call(this,h,C.opts.cornerSize/2);C.status="peel",De._showFoldedPage.call(this,{corner:h,x:T.x,y:T.y},u)}}else C.status="",De.hideFoldedPage.call(this,u);return this}};window.requestAnim=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(h){window.setTimeout(h,1e3/60)},a.extend(a.fn,{flip:function(){return t(a(this[0]),De,arguments)},turn:function(){return t(a(this[0]),Oe,arguments)},transform:function(h,u){var C={};return u&&(C[Te+"transform-origin"]=u),C[Te+"transform"]=h,this.css(C)},animatef:function(h){var u=this.data();if(u.effect&&u.effect.stop(),h){h.to.length||(h.to=[h.to]),h.from.length||(h.from=[h.from]);for(var C=[],T=h.to.length,P=!0,q=this,Me=new Date().getTime(),Ke=function(){if(u.effect&&P){for(var St=[],dt=Math.min(h.duration,new Date().getTime()-Me),di=0;di<T;di++)St.push(u.effect.easing(1,dt,h.from[di],C[di],h.duration));h.frame(T==1?St[0]:St),dt==h.duration?(delete u.effect,q.data(u),h.complete&&h.complete()):window.requestAnim(Ke)}},rt=0;rt<T;rt++)C.push(h.to[rt]-h.from[rt]);u.effect=a.extend({stop:function(){P=!1},easing:function(St,dt,di,rn,Xn){return rn*Math.sqrt(1-(dt=dt/Xn-1)*dt)+di}},h),this.data(u),Ke()}else delete u.effect}}),a.isTouch=vt,a.mouseEvents=gt,a.cssPrefix=S,a.cssTransitionEnd=function(){var h,u=document.createElement("fakeelement"),C={transition:"transitionend",OTransition:"oTransitionEnd",MSTransition:"transitionend",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(h in C)if(u.style[h]!==void 0)return C[h]},a.findPos=ee})(jQuery)});var ha=(()=>{let t=class t{store$;documentService;loggingService;leftSideViewModeMap={THUMBNAIL:we.Thumbnail,BOOKMARK:we.Outline,ANNOTATION:we.Annotation,REDACTION:we.Redaction,ATTACHMENT:we.EmbeddedFile,FORM:we.Form,SIGNATURE:we.Signature};rightSideViewModeMap={DAP:Nt.DAP,TEXT_SEARCH:Nt.TextSearch,ANNOTATION_PROPERTY:Nt.AnnotProperty};sideViewVisible;sideViewMode;rightSideViewVisible;rightSideViewMode;constructor(e,i,r){this.store$=e,this.documentService=i,this.loggingService=r,this.store$.pipe(H("sideViewVisible")).subscribe({next:l=>this.sideViewVisible=l}),this.store$.pipe(H("sideViewMode")).subscribe({next:l=>this.sideViewMode=l}),this.store$.pipe(H("rightSideViewVisible")).subscribe({next:l=>this.rightSideViewVisible=l}),this.store$.pipe(H("rightSideViewMode")).subscribe({next:l=>this.rightSideViewMode=l})}getExportableFunctions(){return[{name:"openPanel",function:e=>{let i;if(e.type in this.leftSideViewModeMap)i=this.openSideView(this.leftSideViewModeMap[e.type]);else if(e.type in this.rightSideViewModeMap)i=this.openRightSideView(this.rightSideViewModeMap[e.type]);else throw this.loggingService.common("warn",pi.INVALID,"args.type"),new Tt("Cannot find suitable sideview");if(i)throw i;return xt(void 0)}},{name:"closePanel",function:e=>(e.type==="LEFT"?this.closeSideView():e.type==="RIGHT"&&this.closeRightSideView(),xt(void 0))},{name:"togglePanel",function:e=>{let i;if(e.type in this.leftSideViewModeMap)i=this.toggleSideView(this.leftSideViewModeMap[e.type]);else if(e.type in this.rightSideViewModeMap)i=this.toggleRightSideView(this.rightSideViewModeMap[e.type]);else throw this.loggingService.common("warn",pi.INVALID,"sideview args.type"),new Tt("Cannot find suitable sideview");if(i)throw i;return xt(void 0)}}]}getExportableEvents(){return[{type:"sideViewOpen",subject:at(this.store$.pipe(H("sideViewVisible"),L(e=>e),ze(()=>({type:"LEFT"}))),this.store$.pipe(H("rightSideViewVisible"),L(e=>e),ze(()=>({type:"RIGHT"}))))},{type:"sideViewClose",subject:at(this.store$.pipe(H("sideViewVisible"),L(e=>!e),ze(()=>({type:"LEFT"}))),this.store$.pipe(H("rightSideViewVisible"),L(e=>!e),ze(()=>({type:"RIGHT"}))))}]}toggleSideView(e){return this.sideViewVisible&&this.sideViewMode===e?this.closeSideView():this.openSideView(e)}openSideView(e){let i={[we.Thumbnail]:!0,[we.EmbeddedFile]:this.documentService.checkAuthority(Le.DOWNLOAD_EMBEDDED_FILE)||this.documentService.checkAuthority(Le.UPLOAD_EMBEDDED_FILE)||this.documentService.checkAuthority(Le.REMOVE_EMBEDDED_FILE),[we.Outline]:!0,[we.Redaction]:this.documentService.checkAuthority(Le.ANNOTATION),[we.SearchingRedaction]:this.documentService.checkAuthority(Le.ANNOTATION),[we.Annotation]:this.documentService.checkAuthority(Le.ANNOTATION),[we.Form]:this.documentService.checkAuthority(Le.FORM),[we.Signature]:this.documentService.checkAuthority(Le.FORM)},r={[we.Thumbnail]:!0,[we.EmbeddedFile]:!1,[we.Outline]:!1,[we.Redaction]:!1,[we.SearchingRedaction]:!1,[we.Annotation]:!1,[we.Form]:!1,[we.Signature]:!1};return i[e]?this.documentService.isDAP&&!r[e]?new Tt("Error detail: Not supported in DAP"):(this.store$.dispatch(he.set({key:"sideViewMode",value:e})),this.store$.dispatch(he.set({key:"sideViewVisible",value:!0})),null):new Tt("Error detail: Unauthorized")}closeSideView(){return this.store$.dispatch(he.set({key:"sideViewVisible",value:!1})),null}toggleRightSideView(e){return this.rightSideViewVisible&&this.rightSideViewMode===e?this.closeRightSideView():this.openRightSideView(e)}openRightSideView(e){let i={[Nt.DAP]:!0,[Nt.TextSearch]:this.documentService.checkAuthority(Le.SEARCH_TEXT),[Nt.AnnotProperty]:this.documentService.checkAuthority(Le.EDIT_ANNOTATION)},r={[Nt.DAP]:!0,[Nt.TextSearch]:!0,[Nt.AnnotProperty]:!0};return i[e]?this.documentService.isDAP&&!r[e]?new Tt("Error detail: Not supported in DAP"):!this.documentService.isDAP&&e===Nt.DAP?new Tt("Error detail: Not supported in PDF"):(this.store$.dispatch(he.set({key:"rightSideViewMode",value:e})),this.store$.dispatch(he.set({key:"rightSideViewVisible",value:!0})),null):new Tt("Error detail: Unauthorized")}closeRightSideView(){return this.store$.dispatch(he.set({key:"rightSideViewVisible",value:!1})),null}};A(t,"\u0275fac",function(i){return new(i||t)(Ze(Ee),Ze(ot),Ze(ji))}),A(t,"\u0275prov",Oi({token:t,factory:t.\u0275fac}));let a=t;return a})();var Uo=(()=>{let t=class t{pageService;documentService;loggingService;store$;highlightInfoMapChange$;get highlightInfoMap(){return this._highlightInfoMap}highlightInfoMapChangeSrc=new Bi;_highlightInfoMap={};idPageIndexMap={};viewMode;constructor(e,i,r,l){this.pageService=e,this.documentService=i,this.loggingService=r,this.store$=l,this.highlightInfoMapChange$=this.highlightInfoMapChangeSrc.asObservable(),this.store$.pipe(H("viewMode")).subscribe({next:g=>this.viewMode=g})}getExportableFunctions(){return[{name:"highlightRects",function:e=>{if(this.viewMode===4)throw this.loggingService.error(Ja,"NOT_SUPPORTED_ON_EBOOK");if(!this.documentService.checkAuthority(Le.ANNOTATION))throw this.loggingService.error(nr,"NO_AUTHORITY");let i;try{i=e.rects.map(r=>({id:this.appendRect(r.pageIndex,r.rect,r.color,r.opacity)}))}catch(r){if(r instanceof Error)throw new Tt(`Error detail: ${r.message}`)}return xt({rects:i})}},{name:"unhighlightRects",function:e=>{if(this.viewMode===4)throw this.loggingService.error(Ja,"NOT_SUPPORTED_ON_EBOOK");if(!this.documentService.checkAuthority(Le.ANNOTATION))throw this.loggingService.error(nr,"NO_AUTHORITY");return e.rects.forEach(i=>this.removeRect(i.id)),xt(void 0)}}]}appendRect(e,i,r,l=.5){let{pdfPages:g}=this.pageService;if(e<0||g.length-1<e)throw new Error("pageIndex is invalid");if(i.left>i.right||i.bottom>i.top)throw new Error("rect is invalid");let{bbox:S}=this.pageService.pdfPages[e];i.top=Math.min(S.y+S.h,S.y+S.h-i.top),i.right=Math.min(S.x+S.w,i.right),i.bottom=Math.max(S.y,S.y+S.h-i.bottom),i.left=Math.max(S.x,i.left),this._highlightInfoMap[e]||(this._highlightInfoMap[e]=[]);let y=ap.getNewOid();return this.idPageIndexMap[y]=e,this._highlightInfoMap[e].push({id:y,path:`M ${i.left.toFixed(2)} ${i.top.toFixed(2)} L ${i.right.toFixed(2)} ${i.top.toFixed(2)} L ${i.right.toFixed(2)} ${i.bottom.toFixed(2)} L ${i.left.toFixed(2)} ${i.bottom.toFixed(2)} Z`,color:Kl.applyOpacityToHex(r,l)}),this.highlightInfoMapChangeSrc.next({pageIndex:e}),y}removeRect(e){let i=this.idPageIndexMap[e];if(i===void 0)throw new Error("id is invalid");delete this.idPageIndexMap[e];let r=this.highlightInfoMap[i].findIndex(l=>l.id===e);if(r<0)throw new Error("id is invalid");this.highlightInfoMap[i].splice(r,1),this.highlightInfoMapChangeSrc.next({pageIndex:i})}};A(t,"\u0275fac",function(i){return new(i||t)(Ze(Ht),Ze(ot),Ze(ji),Ze(Ee))}),A(t,"\u0275prov",Oi({token:t,factory:t.\u0275fac}));let a=t;return a})();var Dm=(()=>{let t=class t{static forRoot(){return{ngModule:t,providers:[Uo]}}};A(t,"\u0275fac",function(i){return new(i||t)}),A(t,"\u0275mod",Jt({type:t})),A(t,"\u0275inj",Xt({}));let a=t;return a})();function Ss(a){let t,n,e;return typeof a=="object"?(t=a.hashFunction,n=a.expiring,e=a.tags):t=a,(i,r,l)=>{if(l.value!=null)l.value=jp(l.value,t,n,e);else if(l.get!=null)l.get=jp(l.get,t,n,e);else throw"Only put a Memoize() decorator on a method or get accessor."}}var oc=new Map;function jp(a,t,n=0,e){let i=Symbol("__memoized_map__");return function(...r){let l;this.hasOwnProperty(i)||Object.defineProperty(this,i,{configurable:!1,enumerable:!1,writable:!1,value:new Map});let g=this[i];if(Array.isArray(e))for(let S of e)oc.has(S)?oc.get(S).push(g):oc.set(S,[g]);if(t||r.length>0||n>0){let S;t===!0?S=r.map(B=>B.toString()).join("!"):t?S=t.apply(this,r):S=r[0];let y=`${S}__timestamp`,I=!1;if(n>0)if(!g.has(y))I=!0;else{let B=g.get(y);I=Date.now()-B>n}g.has(S)&&!I?l=g.get(S):(l=a.apply(this,r),g.set(S,l),n>0&&g.set(y,Date.now()))}else{let S=this;g.has(S)?l=g.get(S):(l=a.apply(this,r),g.set(S,l))}return l}}var jo=class jo{pdfPages;constructor(t){this.pdfPages=t}getPageContainerSize(t,n,e,i){if(!J.isContinuousMode(t))return this.getRowSize(t,n,e,i);let r=J.getPageMovement(t);return Array.from({length:this.pdfPages.length}).map((l,g)=>g).filter(l=>l%r===0).map(l=>this.getRowSize(t,n,l)).reduce((l,g)=>({width:Math.max(l.width,g.width),height:l.height+g.height}),{width:0,height:0})}getRowSize(t,n,e,i){let r=J.getPageMovement(t),l=Math.floor(e/r);return this.pdfPages.slice(l*r,(l+1)*r).reduce((S,y,I)=>{let B=this.getPageSize(n,l*r+I),ee=B.width+(i?0:jo.HORIZONTAL_MARGIN*2),ge=B.height+(i?0:jo.VERTICAL_MARGIN*2);return{width:S.width+ee,height:Math.max(S.height,ge)}},{width:0,height:0})}getPageSize(t,n){if(!this.pdfPages.length)return{width:0,height:0};let e=this.pdfPages[n],i=e.bbox.w,r=e.bbox.h;return(e.r+t)%180!==0&&([i,r]=[r,i]),{width:i,height:r}}getPageFrameOffset(t,n,e,i,r){let l=J.getPageMovement(t),g=Math.floor(i/l),S=this.getRowSize(t,n,i),y=this.getPageSize(n,i).height+jo.VERTICAL_MARGIN*2,I={offsetX:0,offsetY:0};if(J.isContinuousMode(t)){let ee=this.getPageContainerSize(t,n).width;I.offsetX=(ee-S.width)/2,I.offsetY=Array.from({length:g}).reduce((ge,le,Te)=>ge+this.getRowSize(t,n,Te*l).height,0)}let B=(()=>{let ee=Array.from({length:this.pdfPages.length}).map((ge,le)=>le);return e?ee.slice(i+1,(g+1)*l):ee.slice(g*l,i)})();return I.offsetX+=B.reduce((ee,ge)=>{let le=this.getPageSize(n,ge).width+jo.HORIZONTAL_MARGIN*2;return ee+le},0),r||(I.offsetY+=(S.height-y)/2),I}};A(jo,"HORIZONTAL_MARGIN",5),A(jo,"VERTICAL_MARGIN",5);var An=jo;Qe([Ss((a,t,n)=>J.isContinuousMode(a)?`${a}.${t}`:`${a}.${t}.${n-n%J.getPageMovement(a)}`)],An.prototype,"getPageContainerSize",null);Qe([Ss((a,t,n)=>`${a}.${t}.${n-n%J.getPageMovement(a)}`)],An.prototype,"getRowSize",null);Qe([Ss((a,t)=>`${a}.${t}`)],An.prototype,"getPageSize",null);Qe([Ss((a,t,n,e)=>`${a}.${t}.${n}.${e}`)],An.prototype,"getPageFrameOffset",null);var Hr=class{scrollController;rootElement;get currentPageNo(){return this.scrollController.currentPageNo}constructor(t,n){this.scrollController=t,this.rootElement=n}discontinuousOnScroll(t){let n=this.isScrollAtLeft(),e=this.isScrollAtRight(),i=this.isScrollAtTop(t),r=this.isScrollAtBottom(t),l=this.rootElement.scrollTop,g=this.rootElement.scrollLeft,S=t&&t.srcEvent||t;(this.scrollController.isR2L&&n||!this.scrollController.isR2L&&e||r)&&!this.isLastRowPage()?(this.scrollController.moveToNextPage(),S.stopPropagation(),S.preventDefault(),this.scrollController.scrollTo(e?0:g,e?l:0),this.scrollController.fitMode!==null&&this.scrollController.contentService.requestViewChange({fitMode:this.scrollController.fitMode})):(this.scrollController.isR2L&&e||!this.scrollController.isR2L&&n||i)&&!this.isFirstRowPage()&&(this.scrollController.moveToPrevPage(),S.stopPropagation(),S.preventDefault(),this.scrollController.scrollTo(n?this.rootElement.scrollWidth-this.rootElement.scrollLeft:g,n?l:this.rootElement.scrollHeight-this.rootElement.scrollTop),this.scrollController.fitMode!==null&&this.scrollController.contentService.requestViewChange({fitMode:this.scrollController.fitMode}))}isFirstRowPage(){return J.isTwoPageMode(this.scrollController.viewMode)?this.currentPageNo<3:this.currentPageNo===1}isLastRowPage(){return J.isTwoPageMode(this.scrollController.viewMode)?this.currentPageNo>=Math.ceil(this.scrollController.pageCount/2)*2-1:this.currentPageNo===this.scrollController.pageCount}};var ua=class extends Hr{isScrollAtTop(t){return this.rootElement.scrollTop<=0&&t.key==="PageUp"}isScrollAtBottom(t){let n=this.rootElement.offsetHeight,e=this.rootElement.offsetWidth;return this.rootElement.scrollWidth>e&&(n-=15),this.rootElement.scrollHeight-this.rootElement.scrollTop<=n&&t.key==="PageDown"}isScrollAtLeft(){return!1}isScrollAtRight(){return!1}};var ga=class extends Hr{isScrollAtTop(t){return this.rootElement.scrollTop+t.deltaY<=0&&t.deltaY<0}isScrollAtBottom(t){let n=this.rootElement.offsetHeight,e=this.rootElement.offsetWidth;return this.rootElement.scrollWidth>e&&(n-=15),this.rootElement.scrollHeight-this.rootElement.scrollTop-t.deltaY<=n&&t.deltaY>=0}isScrollAtLeft(){return!1}isScrollAtRight(){return!1}};var tn=(()=>{let t=class t{contentService;store$;documentService;sdContextMenuService;apiEventBridgeService;pageService;annotService;loggingService;stateHolder;rootElement;currentViewRectSrc=new Yt(null);currentViewRect$=this.currentViewRectSrc.asObservable();viewScrollSrc=new Bi;viewScroll$=this.viewScrollSrc.asObservable();lastScrollTop=0;lastIndex;viewMode;currentPageNo;pageCount;isR2L;isContextMenuOpened=!1;get currentPageIndex(){return this.currentPageNo-1}wheel$;scroll$;touchStart$;touchMove$;touchEnd$;mouseWheelSub;scrollEdgeSub;windowKeyDownSub;wheelControl;keyDownControl;subs=[];scale;jumping;jumpingSrc=new Bi;calcViewRectSrc=new Bi;jumpingOrigin={x:0,y:0};fitMode=null;constructor(e,i,r,l,g,S,y,I){this.contentService=e,this.store$=i,this.documentService=r,this.sdContextMenuService=l,this.apiEventBridgeService=g,this.pageService=S,this.annotService=y,this.loggingService=I,this.store$.pipe(H("viewMode")).subscribe({next:B=>this.viewMode=B}),this.store$.pipe(H("currentPageNo")).subscribe({next:B=>this.currentPageNo=B}),this.store$.pipe(H("pageCount")).subscribe({next:B=>this.pageCount=B}),this.store$.pipe(H("isR2L")).subscribe({next:B=>this.isR2L=B}),this.store$.pipe(H("fitMode")).subscribe({next:B=>this.fitMode=B}),this.store$.pipe(H("scale")).subscribe({next:B=>this.scale=B})}getExportableFunctions(){return[{name:"scrollToPage",function:e=>new Kt(i=>{this.viewMode===4&&i.error(new Tt("Error detail: Not supported in ebook mode"));let r=this.stateHolder.pdfPages,l=e.pageIndex;l<0&&(l=r.length+l),l=Math.max(Math.min(l,r.length-1),0),this.lastIndex=void 0,e.centerPoint?this.contentService.requestViewChange({pageNo:l+1,center:e.centerPoint}):this.contentService.requestViewChange({pageNo:l+1}),i.next(),i.complete()})},{name:"scrollToAnnotation",function:e=>{if(!F.isDefined(this.documentService.openedDocument))throw new Un("No opened document found.");if(this.viewMode===4)throw new Tt("Error detail: Not supported in ebook mode");return Bs(xt(this.annotService.getActionLog()).pipe(ze(i=>(i.forEach(r=>{r.annots=r.annots.filter(l=>l.action==="create")}),i.filter(r=>r.annots.length>0)))),this.annotService.getAnnotations()).pipe(ze(([i,r])=>{let l=r;return i.forEach(g=>r[g.pageIdx].push(...g.annots)),l}),ut(i=>{for(let r of i)for(let l of r){if(F.isDefined(e.oid)&&l.oid===e.oid)return xt(l);if(F.isDefined(e.name)&&F.isDefined(e.pageIndex)&&l.attributes.pageIdx===e.pageIndex&&l.attributes.NM===e.name)return xt(l)}throw new fs("Cannot find annotation")}),ut(i=>{let r=i.attributes.pageIdx,l=i.attributes.rect;return new Kt(g=>{this.contentService.requestViewChange({pageNo:r+1,center:{x:(l.left+l.right)/2,y:(l.top+l.bottom)/2}}),e.select&&this.contentService.fireAnnotEvent({sdEventType:en.SELECTED,annot:i}),g.next(),g.complete()})}))}}]}getExportableEvents(){return[{type:"scrollPositionChange",subject:this.apiEventBridgeService.handleResultObservable(this.apiEventBridgeService.scrollEventSrc).pipe(ze(e=>({position:e.position})))},{type:"currentReadingPageChange",subject:this.apiEventBridgeService.currentReadingPageChange$.pipe(ze(e=>({pageInfos:e.pageInfos})))}]}start(e,i){this.loggingService.common("debug",pi.STARTED,"scroll service"),this.wheelControl=new ga(this,i),this.keyDownControl=new ua(this,i),this.stateHolder=e,this.rootElement=i,this.wheel$=Ge(this.rootElement,"wheel",{passive:!0}),this.scroll$=Ge(this.rootElement,"scroll",{passive:!0}),this.touchStart$=Ge(this.rootElement,"touchstart"),this.touchMove$=Ge(this.rootElement,"touchmove",{passive:!0}),this.touchEnd$=Ge(this.rootElement,"touchend",{passive:!0}),this.subscribeEvents()}stop(){this.loggingService.common("debug",pi.STOPPED,"scroll service"),Vi.unsubscribe(this.scrollEdgeSub,this.mouseWheelSub,this.windowKeyDownSub,...this.subs),this.subs.splice(0),this.stateHolder=null,this.scale=null}publishScrollEvent(e){this.viewScrollSrc.next(e)}moveToPage(e){let i=J.getNextPageNo(e,this.viewMode,this.pageCount);this.contentService.requestViewChange({pageNo:i})}moveToPrevPage(){let e=J.getPageMovement(this.viewMode);this.moveToPage(this.currentPageNo-e)}moveToNextPage(){let e=J.getPageMovement(this.viewMode);this.moveToPage(this.currentPageNo+e)}scrollTo(e,i){this.lockScrollEvent(),this.rootElement.scrollLeft=e,this.rootElement.scrollTop=i,this.releaseScrollEvent()}updateReadStatus(){if(J.isContinuousMode(this.viewMode)){let e=J.normalizeScale(this.scale),i=this.rootElement.scrollTop/e,r=(this.rootElement.scrollTop+this.rootElement.clientHeight)/e,l=[],g=I=>{let B=this.stateHolder.getPageFrameOffset(this.viewMode,I),ee=this.stateHolder.getPageSize(I),ge=B.offsetY,le=B.offsetY+ee.height+An.VERTICAL_MARGIN*2,Te=Math.max(i,ge),$e=Math.min(r,le);return Te+1<$e};g(this.currentPageIndex)&&this.pageService.pdfPages.length&&l.push(this.pageService.pdfPages[this.currentPageIndex]);for(let I=this.currentPageIndex-1;0<I&&g(I);I--)l.unshift(this.pageService.pdfPages[I]);for(let I=this.currentPageIndex+1;I<this.pageService.pdfPages.length&&g(I);I++)l.push(this.pageService.pdfPages[I]);let S=[];if(this.lastIndex!==void 0&&l.length)if(this.lastScrollTop-i<0)for(let B=this.lastIndex;B<l[l.length-1].i;B++)S.push(B);else for(let B=this.lastIndex;B>l[l.length-1].i;B--)S.push(B);this.lastIndex=l[l.length-1]?.i,this.lastScrollTop=i;let y=l.concat(S.map(I=>this.pageService.pdfPages[I]).filter(I=>!!I)).filter((I,B,ee)=>ee.indexOf(I)===B).sort((I,B)=>I.i-B.i);y.forEach(I=>I.read=!0),this.apiEventBridgeService.currentReadingPageChangeSrc.next({ok:!0,data:{pageInfos:y.map(({i:I})=>({pageIndex:I}))}})}else if(this.viewMode===4){let e=J.getEbookPageNo(this.currentPageNo);if(e===1){let i=this.pageService.pdfPages.find(({i:r})=>e-1===r);i.read=!0,this.apiEventBridgeService.currentReadingPageChangeSrc.next({ok:!0,data:{pageInfos:[{pageIndex:0}]}})}else{let i=[{pageIndex:e-1}];e<this.pageCount&&i.push({pageIndex:e}),i.forEach(({pageIndex:r})=>this.pageService.pdfPages.find(({i:l})=>r===l).read=!0),this.apiEventBridgeService.currentReadingPageChangeSrc.next({ok:!0,data:{pageInfos:i}})}}else{let e=[this.currentPageIndex];J.isTwoPageMode(this.viewMode)&&this.currentPageIndex<this.pageCount-1&&e.push(this.currentPageIndex+(this.currentPageIndex%2===0?1:-1));let i=e.filter((r,l,g)=>g.indexOf(r)===l).sort((r,l)=>r-l);i.forEach(r=>this.pageService.pdfPages.find(({i:l})=>r===l).read=!0),this.apiEventBridgeService.currentReadingPageChangeSrc.next({ok:!0,data:{pageInfos:i.map(r=>({pageIndex:r}))}})}}subscribeEvents(){this.subscribeMouseWheel(),this.subscribeScroll(),this.subscribeWindowKeyDown(),this.subscribeOverscroll(),this.subs.push(this.sdContextMenuService.contextMenuStatus$.subscribe({next:e=>this.isContextMenuOpened=e}),this.jumpingSrc.pipe(ri(100)).subscribe({next:()=>this.jumping=!1}),at(this.calcViewRectSrc,Q.windowResize$,this.store$.pipe(H("sideViewVisible")),this.store$.pipe(H("sideViewSize")),this.store$.pipe(H("rightSideViewVisible")),this.store$.pipe(H("rightSideViewSize"))).pipe(al(25)).subscribe({next:e=>{e&&this.calculateViewRect()}}),er(1e3).subscribe({next:()=>{this.updateReadStatus()}}))}subscribeOverscroll(){this.subs.push((()=>{let e=Je.scrollPositionDetectionSensitivity,i=[],r;return this.wheel$.pipe(this.scrollDetectableStatusFilter(),L(()=>this.viewMode!==4)).subscribe({next:l=>{this.isContextMenuOpened&&this.sdContextMenuService.publishContextMenuStatus(!1),this.isTop()&&l.deltaY<0?i.push("top"):this.isBottom()&&l.deltaY>0&&i.push("bottom"),clearTimeout(r),r=Q.nativeWindow.setTimeout(()=>{i.length<3||(this.isTop()&&i.every(g=>g==="top")?this.apiEventBridgeService.scrollEventSrc.next({ok:!0,data:{position:"topover"}}):this.isBottom()&&i.every(g=>g==="bottom")&&this.apiEventBridgeService.scrollEventSrc.next({ok:!0,data:{position:"bottomover"}}),i.splice(0))},e)}})})(),Q.windowKeyDown$.pipe(this.scrollDetectableStatusFilter(),L(()=>this.viewMode!==4)).subscribe({next:e=>{this.isTop()&&e.key==="PageUp"?this.apiEventBridgeService.scrollEventSrc.next({ok:!0,data:{position:"topover"}}):this.isBottom()&&e.key==="PageDown"&&this.apiEventBridgeService.scrollEventSrc.next({ok:!0,data:{position:"bottomover"}})}}),...(()=>{let i=0,r=0,l=0,g=0,S=0,y=0,I=0,B=0;return[this.touchStart$.pipe(L(()=>this.viewMode!==4)).subscribe({next:ee=>{i=this.rootElement.scrollTop,r=this.rootElement.scrollLeft;let ge=ee.touches[0];l=ge.clientY,g=ge.clientX,I=this.scale}}),this.touchMove$.pipe(L(()=>this.viewMode!==4)).subscribe({next:ee=>{let ge=ee.touches[0];S=l-ge.clientY,y=g-ge.clientX,B=I-this.scale}}),this.touchEnd$.pipe(L(()=>this.viewMode!==4),L(()=>!this.stateHolder.isSlideshow)).subscribe({next:()=>{if(!(Math.abs(B)>0)){if(Math.abs(y)>Math.abs(S)){if(J.isContinuousMode(this.viewMode))return;if(r+y/4<=0){if(this.currentPageNo>1){let ee=this.rootElement.scrollTop;this.moveToPrevPage(),this.rootElement.scrollLeft=this.rootElement.scrollWidth,this.rootElement.scrollTop=ee}}else if(r+this.rootElement.offsetWidth+y/4>=this.rootElement.scrollWidth&&this.currentPageNo<this.stateHolder.pdfPages.length){let ee=this.rootElement.scrollTop;this.moveToNextPage(),this.rootElement.scrollTop=ee}}else if(i+S/4<=0){if(this.currentPageNo===1)this.apiEventBridgeService.scrollEventSrc.next({ok:!0,data:{position:"topover"}});else if(!J.isContinuousMode(this.viewMode)){let ee=this.rootElement.scrollLeft;this.moveToPrevPage(),this.rootElement.scrollTop=this.rootElement.scrollHeight,this.rootElement.scrollLeft=ee}}else if(i+this.rootElement.offsetHeight+S/4>=this.rootElement.scrollHeight){if(this.currentPageNo>=this.stateHolder.pdfPages.length)this.apiEventBridgeService.scrollEventSrc.next({ok:!0,data:{position:"bottomover"}});else if(!J.isContinuousMode(this.viewMode)){let ee=this.rootElement.scrollLeft;this.moveToNextPage(),this.rootElement.scrollLeft=ee}}}}})]})())}subscribeScroll(){Vi.unsubscribe(this.scrollEdgeSub),this.scrollEdgeSub=xt(this.scroll$.pipe(ct(()=>{this.stateHolder&&this.updateReadStatus()})),this.store$.pipe(H("scale"))).pipe(L(()=>this.viewMode!==4),ol(),ri(10),this.scrollDetectableStatusFilter(),ze(()=>this.isBottom()?"bottom":this.isTop()?"top":"reset"),Fn(),L(e=>e!=="reset")).subscribe({next:e=>this.apiEventBridgeService.scrollEventSrc.next({ok:!0,data:{position:e}})})}scrollDetectableStatusFilter(){return e=>e.pipe(L(()=>{let i=this.currentPageNo===this.pageCount,r=this.currentPageNo===1&&this.currentPageNo<this.pageCount,l=this.currentPageNo===this.pageCount&&this.pageCount>1;return!(!J.isContinuousMode(this.viewMode)&&(!r&&!l&&!i||r&&this.isBottom()||l&&this.isTop()))}))}subscribeMouseWheel(){Vi.unsubscribe(this.mouseWheelSub),this.mouseWheelSub=this.wheel$.pipe(ri(50),L(e=>!e.ctrlKey&&!e.metaKey),L(()=>!this.jumping&&!J.isContinuousMode(this.viewMode))).subscribe({next:e=>this.wheelControl.discontinuousOnScroll(e)})}subscribeWindowKeyDown(){Vi.unsubscribe(this.windowKeyDownSub),this.windowKeyDownSub=Q.windowKeyDown$.pipe(L(()=>!this.stateHolder.isSlideshow),L(()=>!J.isContinuousMode(this.viewMode))).subscribe({next:e=>this.keyDownControl.discontinuousOnScroll(e)})}lockScrollEvent(){this.jumping=!0}releaseScrollEvent(){this.jumpingSrc.next(!1)}calculateViewRect(){if(this.viewMode===4)return;let e=this.currentPageIndex,i=J.getPageMovement(this.viewMode)-1,r=this.stateHolder,l=J.normalizeScale(this.scale),g=y=>{if(!r.pdfPages[y])return;let I=r.getPageFrameOffset(this.viewMode,y),{width:B,height:ee}=r.getPageSize(y),ge=I.offsetX,le=I.offsetY,Te=ge+B,$e=le+ee,p=this.rootElement.scrollLeft/l,vt=p+this.rootElement.clientWidth/l,gt=this.rootElement.scrollTop/l,ft=gt+this.rootElement.clientHeight/l;return{x:Math.max(p-ge,0),y:Math.max(gt-le,0),w:Math.min(vt,Te)-Math.max(p,ge),h:Math.min(ft,$e)-Math.max(gt,le)}},S={idx:e,rect:g(e)};if(S.rect){if(i===1){let y=e+(e%2===0?1:-1),I=g(y);I&&I.w*I.h>S.rect.w*S.rect.h&&(S.rect=I,S.idx=y,this.currentPageNo!==S.idx+1&&this.contentService.requestViewChange({pageNo:S.idx+1}))}this.currentViewRectSrc.next(S)}}isTop(){return this.rootElement.scrollTop<=0}isBottom(){return Math.ceil(this.rootElement.scrollTop)+this.rootElement.offsetHeight>=this.rootElement.scrollHeight}};A(t,"\u0275fac",function(i){return new(i||t)(Ze(it),Ze(Ee),Ze(ot),Ze(Bo),Ze(Ei),Ze(Ht),Ze(ni),Ze(ji))}),A(t,"\u0275prov",Oi({token:t,factory:t.\u0275fac}));let a=t;return a})();var $r=(()=>{let t=class t{logoHeight=24;logoDataURLSrc=new Yt(null);logoDataURL$=this.logoDataURLSrc.asObservable();getExportableFunctions(){return[{name:"setLogo",function:e=>new Kt(i=>{let r=new Image;r.onload=()=>{let l=document.createElement("canvas"),g=l.getContext("2d"),S=this.logoHeight/r.naturalHeight,y=r.naturalWidth*S,I=r.naturalHeight*S;if(l.width=y,l.height=I,!F.isDefined(g)){this.logoDataURLSrc.next(null),i.error(new Tt("Failed to get CanvasRenderingContext2D"));return}g.drawImage(r,0,0,y,I),this.logoDataURLSrc.next(l.toDataURL("image/png")),i.next(void 0)},r.onerror=l=>{this.logoDataURLSrc.next(null),i.error(l)},r.src=e.url}).pipe(il(1e3),us(i=>{throw i instanceof tl?new El("Something was wrong :("):new Tt(i)}))}]}};A(t,"\u0275fac",function(i){return new(i||t)}),A(t,"\u0275prov",Oi({token:t,factory:t.\u0275fac}));let a=t;return a})();var fa=(()=>{let t=class t{getExportableEvents(){return[{type:"keydown",subject:Q.windowKeyDown$.pipe(ze(e=>{let i={};return go.getAllPropertyNames(e).forEach(r=>{e[r]===Q.nativeWindow||e[r]instanceof Node||r==="path"||(i[r]=e[r])}),{event:i}}))},{type:"keyup",subject:Q.windowKeyUp$.pipe(ze(e=>{let i={};return go.getAllPropertyNames(e).forEach(r=>{e[r]===Q.nativeWindow||e[r]instanceof Node||r==="path"||(i[r]=e[r])}),{event:i}}))},{type:"mousedown",subject:Q.windowMousedown$.pipe(ze(e=>({event:$n.simplifyMouseEvent(e)})))},{type:"mouseup",subject:Q.windowMouseUp$.pipe(ze(e=>({event:$n.simplifyMouseEvent(e)})))},{type:"pointerdown",subject:Q.windowPointerDown$.pipe(ze(e=>({event:$n.simplifyPointerEvent(e)})))},{type:"pointerup",subject:Q.windowPointerUp$.pipe(ze(e=>({event:$n.simplifyPointerEvent(e)})))}]}};A(t,"\u0275fac",function(i){return new(i||t)}),A(t,"\u0275prov",Oi({token:t,factory:t.\u0275fac}));let a=t;return a})();var S0=(()=>{let t=class t{static forRoot(){return{ngModule:t,providers:[fa]}}};A(t,"\u0275fac",function(i){return new(i||t)}),A(t,"\u0275mod",Jt({type:t})),A(t,"\u0275inj",Xt({}));let a=t;return a})();var zp=Jc(xh());function Oh(a,t){if(a&1&&(R(0,"div",9)(1,"div",10),me(2),G(3,"translate"),N(),R(4,"div",11),me(5),N()()),a&2){let n=w(2);x(2),xe(Y(3,2,"ERROR_CODE")),x(3),xe(n.errorCode)}}function Mh(a,t){if(a&1&&(R(0,"div",9)(1,"div",10),me(2),G(3,"translate"),N(),R(4,"div",11),me(5),N()()),a&2){let n=w(2);x(2),xe(Y(3,2,"DOCUMENT_ID")),x(3),xe(n.streamdocsId)}}function wh(a,t){if(a&1&&(X(0,"img",7),G(1,"translate"),R(2,"span",8),me(3),G(4,"translate"),N(),R(5,"div",9)(6,"div",10),me(7),G(8,"translate"),N(),R(9,"div",11),me(10),N()(),se(11,Oh,6,4,"div",12)(12,Mh,6,4,"div",12)),a&2){let n=w();ue("src",n.illustImageSrc,un)("alt",Y(1,7,"ERROR_PAGE_ILLUST")),x(3),xe(Y(4,9,"APOLOGY_FOR_INCONVENIENCE")),x(4),xe(Y(8,11,"OCCURRED_DATE")),x(3),xe(n.occurredDate),x(),O("ngIf",n.errorCode),x(),O("ngIf",n.streamdocsId)}}function yh(a,t){if(a&1&&(X(0,"img",13),G(1,"translate"),X(2,"img",14),G(3,"translate"),R(4,"div",9)(5,"div",10),me(6),G(7,"translate"),N(),R(8,"div",11),me(9),G(10,"translate"),N()()),a&2){let n=w();ue("src",n.messageImageSrc,un)("alt",Y(1,6,"ERROR_STATUS_ILLUST")),x(2),ue("src",n.illustImageSrc,un)("alt",Y(3,8,"ERROR_PAGE_ILLUST")),x(4),xe(Y(7,10,"INFO")),x(3),xe(Y(10,12,"ERROR_PAGES_"+(n.errorCode||n.statusCode)))}}function Eh(a,t){if(a&1&&(R(0,"div",15)(1,"a",16),X(2,"img"),G(3,"translate"),R(4,"span"),me(5),N()()()),a&2){let n=w();x(),O("href","tel:"+n.environment.errorPage.telephone,un),x(),ue("src",n.callImageSrc,un)("alt",Y(3,4,"SUPPORT_TELEPHONE")),x(3),xe(n.environment.errorPage.telephone)}}function Ph(a,t){if(a&1&&(R(0,"div",17)(1,"a",18),X(2,"i",19),R(3,"span"),me(4),N()()()),a&2){let n=w();x(),O("href",n.environment.errorPage.link,un),x(3),xe(n.environment.errorPage.linkLabel||n.environment.errorPage.link)}}var P0=(()=>{let t=class t{activatedRoute;changeDetectorRef;contentService;subscriptionService;documentService;viewerService;productService;get environment(){return Je}assetDir="assets/images/error-pages";statusCode=jr.NOT_FOUND;errorCode;get logoImageSrc(){return`${this.assetDir}/logo.svg`}get messageImageSrc(){return`${this.assetDir}/${this.statusCode}_message.svg`}get illustImageSrc(){return this.isErrorCode?`${this.assetDir}/error_code_illust.svg`:`${this.assetDir}/${this.statusCode}_illust.svg`}get callImageSrc(){return`${this.assetDir}/call.svg`}get isErrorCode(){return!Object.values(jr).includes(this.statusCode)||this.statusCode===jr.INTERNAL_SERVER_ERROR&&F.isDefined(this.errorCode)}get occurredDate(){return(0,zp.default)(new Date).format("YYYY. MM. DD. HH:mm:ss")}get streamdocsId(){return this.documentService.openedDocument?.streamdocsId}get isStreamdocs(){return this.productService.isStreamDocs}constructor(e,i,r,l,g,S,y){this.activatedRoute=e,this.changeDetectorRef=i,this.contentService=r,this.subscriptionService=l,this.documentService=g,this.viewerService=S,this.productService=y}ngOnInit(){this.initSubscriptions(),this.viewerService.loadComplete(),this.contentService.togglePageLoader(!1)}initSubscriptions(){this.subscriptionService.push(this.activatedRoute.paramMap.pipe(ze(e=>({statusCode:parseInt(e.get("statusCode")),errorCode:e.get("errorCode")})),L(e=>F.isDefined(e.statusCode))).subscribe({next:e=>{this.statusCode=Number.isNaN(e.statusCode)?null:e.statusCode,this.errorCode=e.errorCode,this.changeDetectorRef.markForCheck()}}))}};A(t,"\u0275fac",function(i){return new(i||t)(v(yl),v(ye),v(it),v(Z),v(ot),v(oi),v(Ir))}),A(t,"\u0275cmp",Ce({type:t,selectors:[["sd-error-pages"]],standalone:!1,features:[be([Z])],decls:11,vars:11,consts:[["statusRef",""],[1,"logo-image"],[3,"ngIf","ngIfElse"],[1,"enquiry-box"],[1,"call-box-header"],["class","call-box",4,"ngIf"],["class","link-box",4,"ngIf"],[1,"illust-image","margin"],[1,"message-text"],[1,"info-box"],[1,"info-box-header"],[1,"info-box-body"],["class","info-box",4,"ngIf"],[1,"message-image"],[1,"illust-image"],[1,"call-box"],[1,"call-box-body",3,"href"],[1,"link-box"],[3,"href"],[1,"papycon","papycon-link"]],template:function(i,r){if(i&1&&(X(0,"img",1),G(1,"translate"),se(2,wh,13,13,"ng-template",2)(3,yh,11,14,"ng-template",null,0,ci),R(5,"div",3)(6,"div",4),me(7),G(8,"translate"),N(),se(9,Eh,6,6,"div",5)(10,Ph,5,2,"div",6),N()),i&2){let l=ei(4);ue("src",r.logoImageSrc,un)("alt",Y(1,7,r.isStreamdocs?"STREAMDOCS_LOGO":"STREAMDOCS_VU_LOGO")),x(2),O("ngIf",r.isErrorCode)("ngIfElse",l),x(5),xe(Y(8,9,"FAILURE_PERSISTS_MESSAGE")),x(2),O("ngIf",r.environment.errorPage.telephone),x(),O("ngIf",r.environment.errorPage.link)}},dependencies:[lt,Ve],styles:["[_nghost-%COMP%]{font-size:16px;line-height:26px;font-family:NotoSans-Medium,sans-serif;color:#1e1e1e;display:flex;flex-direction:column;justify-content:center;align-items:center;width:100%;height:100%;background-color:var(--mono-00);overflow-y:auto}[_nghost-%COMP%] > *[_ngcontent-%COMP%]{max-width:80%}a[_ngcontent-%COMP%]{text-decoration:none}a[_ngcontent-%COMP%]:hover{text-decoration:underline}.logo-image[_ngcontent-%COMP%]{height:24px}.message-image[_ngcontent-%COMP%]{height:184px;margin-top:70px;margin-bottom:40px}.illust-image[_ngcontent-%COMP%]{height:144px;margin-bottom:40px}.message-text[_ngcontent-%COMP%]{font-weight:700;font-size:32px;margin-bottom:40px}.info-box[_ngcontent-%COMP%]{width:400px;height:100px;border:1px solid var(--mono-99);box-sizing:border-box;text-align:center}.info-box-header[_ngcontent-%COMP%]{border-bottom:1px solid var(--mono-99);background-color:var(--mono-50)}.info-box-body[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:74px;white-space:pre-wrap}.info-box[_ngcontent-%COMP%] + .info-box[_ngcontent-%COMP%]{margin-top:20px}.enquiry-box[_ngcontent-%COMP%]{margin-top:28px;text-align:center}.call-box[_ngcontent-%COMP%]{text-align:center}.call-box-header[_ngcontent-%COMP%]{font-size:14px;line-height:24px;font-family:NotoSans-Regular,sans-serif;color:#6c6c6c}.call-box-body[_ngcontent-%COMP%]{font-family:NotoSans-Medium,sans-serif;font-size:16px;line-height:26px;color:#6c6c6c;display:flex;align-items:center;justify-content:center;margin-top:9px;-webkit-user-select:none;user-select:none}.call-box-body[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{margin-left:4px}.link-box[_ngcontent-%COMP%]{margin-top:8px;-webkit-user-select:none;user-select:none}.link-box[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration-color:#3884d0}.link-box[_ngcontent-%COMP%]   .papycon[_ngcontent-%COMP%]{margin-right:4px;font-size:20px;color:var(--mono-90)}.link-box[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#3884d0}.margin[_ngcontent-%COMP%]{margin-top:50px}"],changeDetection:0}));let a=t;return a})();var Gp=class{router;constructor(t){this.router=t.get(Mr)}canActivate(t){let n=Object.keys(ic).map(g=>ic[g].toString()),i=Object.values(pa).includes(t.paramMap.get("errorCode")),r=n.includes(t.paramMap.get("statusCode")),l=Je.errorPage.redirection;if(Object.keys(l).length>1||l.fallback.length>0){let S=`fallback${t.paramMap.get("statusCode")}`;if(l[S]&&l[S].length>0)return location.href=l[S],!1;if(l.fallback.length>0)return location.href=l.fallback,!1}return i||r?!0:this.router.createUrlTree([...t.url.slice(0,t.url.length-1).map(g=>g.path),jr.NOT_FOUND])}canDeactivate(){return!0}};Gp=Qe([Bp()],Gp);var Rh=(a,t,n,e)=>{let i={version:2,authKey:e,id:t===null?void 0:t||ep(),messageType:a,args:n};return Object.freeze(i)},Yp=[Wn,oi,xn,ot,Mp,bn,it,tn,ni,ha,fa,up,Ur,Uo,Eo,Br,Ht,Vo,Lr,Fr,Bo,vp,Zi,sa,Pi,Dr,$r],ar=class ar{injector;documentService;router;viewerService;exportedFunctions={};acknowledged=!1;message$=Q.windowMessage$.pipe(L(F.isDefined),L(t=>t.type==="message"&&typeof t.data=="string"),ze(t=>{try{return JSON.parse(t.data)}catch{return console.debug("StreamDocsApiService received message but failed to parse message"),null}}),L(F.isDefined),L(t=>!!t.messageType&&t.version===2));subscriptions=[];functionStatus={};_authKey;get authKey(){return this._authKey}set authKey(t){if(this._authKey){console.warn("authKey can't not be assigned more than twice");return}this._authKey=t}constructor(t,n,e,i){this.injector=t,this.documentService=n,this.router=e,this.viewerService=i,window.parent!==window&&(K.get(ne.USE_STREAMDOCS_API)&&(this.registerFunctions(),this.registerEvents()),this.subscribeMessageEvent(),this.connectWithParent())}emitEvent(t,n){this.dispatchEvent("EVENT",void 0,{type:t,data:n},this.authKey)}registerFunctions(){Yp.forEach(t=>{let n=this.injector.get(t);if(!n||!n.getExportableFunctions)return;n.getExportableFunctions().forEach(i=>{this.exportedFunctions[i.name]=i,this.functionStatus[i.name]={running:!1,queue:[]}})})}registerEvents(){Yp.forEach(t=>{let n=this.injector.get(t);if(!n||!n.getExportableEvents)return;n.getExportableEvents().forEach(i=>{this.subscriptions.push(i.subject.subscribe({next:r=>this.emitEvent(i.type,r)}))})})}connectWithParent(){this.acknowledged=!1,this.notifyToParent()}notifyToParent(t=100){if(this.acknowledged)return;if(t>100*Math.pow(2,8)){this.destroy();return}let n=K.get(ne.USE_STREAMDOCS_API)?"INITIATED":"REJECTED";this.dispatchEvent(n),setTimeout(()=>this.notifyToParent(t*2),t)}dispatchEvent(t,n,e,i){let r=Rh(t,n,e,i);Q.nativeWindow.parent!==Q.nativeWindow&&window.parent.postMessage(JSON.stringify(r),"*")}subscribeMessageEvent(){this.subscriptions.push(this.message$.subscribe({next:t=>this.listenMessageEvent(t)}))}listenMessageEvent(t){switch(t.messageType){case"ACKNOWLEDGED":this.acknowledged=!0;break;case"CALL_FUNCTION":this.handleFunctionCall(t);break;case"REQUEST_CHALLENGE":this.responseChallenge(t);break;case"REJECTED":this.router.navigateByUrl(`view/error-pages;errorCode=${pa.FSD000003}`);break;case"ADD_EVENT":break;default:console.warn(`Unhandled message received: ${t.messageType}`);break}}handleFunctionCall(t){if(t.authKey!==this.authKey){console.error("Calling function failed (authentication error)");return}if(!t.args){this.dispatchEvent("MESSAGE_ERROR",t.id,this.wrapError(new ir("Argument is empty")));return}if(!t.args.functionName){this.dispatchEvent("MESSAGE_ERROR",t.id,this.wrapError(new ir("Function name is empty")));return}let n=this.exportedFunctions[t.args.functionName];if(n===void 0){this.dispatchEvent("MESSAGE_ERROR",t.id,this.wrapError(new ir("Can't find function")));return}if(!n.noNeedDocumentLoaded&&this.documentService.openedDocument===null){this.dispatchEvent("MESSAGE_ERROR",t.id,this.wrapError(new ir("Document is not loaded. This function cannot be executed before document is loaded")));return}n.hasCallback&&this.replaceCallbackFunction(t.args.functionParams||{});let e={name:n.name,bindedFunction:n.function.bind(null,...t.args.functionParams||[]),replyId:t.id},i=this.functionStatus[n.name];!n.parallelizable&&F.isDefined(i)&&i.running?i.queue.push(e):this.executeFunction(e)}wrapError(t){return{__sd_symbol__object_type__:"error",name:t.name,message:t.message,stack:t.stack}}executeFunction(t){let n;this.functionStatus[t.name].running=!0;try{n=t.bindedFunction()}catch(e){this.functionStatus[t.name].running=!1,n=br(e)}n.pipe(ao(1),tr(()=>{this.functionStatus[t.name].running=!1;let e=this.functionStatus[t.name].queue;e.length>0&&this.executeFunction(e.shift())})).subscribe({next:e=>this.dispatchEvent("FUNCTION_SUCCESS",t.replyId,e),error:e=>this.dispatchEvent("FUNCTION_ERROR",t.replyId,e instanceof Error?this.wrapError(e):e)})}responseChallenge(t){if(!t?.authKey){console.error("Challenge message didn't have authKey");return}this.authKey&&this.authKey!==t.authKey?console.warn(`StreamDocs already has been connected with another adapter. (current iframe src: ${location.href})`):(this.authKey||(this.authKey=t.authKey),this.dispatchEvent("RESPONSE_CHALLENGE",void 0,null,this.authKey),this.viewerService.loadComplete(t.args))}replaceCallbackFunction(t){Object.keys(t).forEach(n=>{if(typeof t[n]=="object")if(t[n].__sd_symbol__object_type__==="callbackFunction"){let e=t[n].__sd_symbol__callback_id__;t[n]=(...i)=>{this.dispatchEvent("CALLBACK_FUNCTION",void 0,{functionArgs:i,functionId:e},this.authKey)}}else this.replaceCallbackFunction(t[n])})}destroy(){this.subscriptions.forEach(t=>t.unsubscribe());for(let t in this.exportedFunctions)delete this.exportedFunctions[t]}};A(ar,"\u0275fac",function(n){return new(n||ar)(Ze(ml),Ze(ot),Ze(Mr),Ze(oi))}),A(ar,"\u0275prov",Oi({token:ar,factory:ar.\u0275fac}));var cr=ar;Qe([lp()],cr.prototype,"listenMessageEvent",null);var Ah=a=>({content:a,gap:14}),ma=a=>({content:a});function Nh(a,t){a&1&&Pn(0)}function Dh(a,t){if(a&1&&(R(0,"section",1),se(1,Nh,1,0,"ng-container",7),X(2,"div",8),N()),a&2){w();let n=ei(8);x(),O("ngTemplateOutlet",n)}}function kh(a,t){a&1&&Pn(0)}function Vh(a,t){if(a&1&&(R(0,"section",9),se(1,kh,1,0,"ng-container",7),N(),X(2,"div",5)),a&2){w();let n=ei(8);x(),O("ngTemplateOutlet",n)}}function Lh(a,t){if(a&1){let n=_e();R(0,"button",16),G(1,"translate"),ce("click",function(){W(n);let i=w(2).$implicit,r=w(2);return z(r.expanderClicked(i))}),X(2,"i",17),N()}if(a&2){let n=w(4);Ye("dark",n.isDarkMode),ue("color",n.isDarkMode?"white":"dark")("aria-label",Y(1,4,"EXPAND"))}}function Fh(a,t){if(a&1){let n=_e();Lt(0),R(1,"button",19),ce("click",function(){W(n);let i=w(),r=i.$implicit,l=i.index,g=w(3).$implicit,S=w(2);return g.lastUsed=l,z(S.activateTool(r.tool))}),X(2,"i",13),N(),Ft()}if(a&2){let n=w().$implicit,e=w(5);x(),Ye("dark",e.isDarkMode)("active",e.isActivated(n.tool)),O("title",e.isMobile?"":n.alt)("tooltip",_t(9,ma,n.alt)),ue("color",e.isDarkMode?"white":e.styleOfMenuTool(n))("aria-label",n.alt),x(),O("ngClass",n.iconClass)}}function Bh(a,t){if(a&1&&(Lt(0),se(1,Fh,3,11,"ng-container",4),Ft()),a&2){let n=t.$implicit;x(),O("ngIf",n.use)}}function Uh(a,t){if(a&1&&(R(0,"div",18),se(1,Bh,2,1,"ng-container",10),N()),a&2){let n=w(2).$implicit;O("@menuState",n.menuState),x(),O("ngForOf",n.subtools)}}function jh(a,t){if(a&1){let n=_e();Lt(0),R(1,"div",11)(2,"button",12),ce("click",function(){W(n);let i=w().$implicit,r=w(2);return z(r.activateTool(r.isNestedMenuItem(i)?i.lastTool:i))}),X(3,"i",13),me(4),N(),se(5,Lh,3,6,"button",14)(6,Uh,2,2,"div",15),N(),Ft()}if(a&2){let n=w().$implicit,e=w(2);x(),Ye("expandable",e.isExpandable(n)),x(),Ye("dark",e.isDarkMode)("ep-text-button",!n.text)("ep-button",n.text)("active",e.isActivated(n))("expandable",e.isExpandable(n)),O("title",e.isMobile?"":n.alt)("tooltip",_t(21,Ah,n.alt)),ue("color",e.isDarkMode||n.text?"white":"dark")("size",n.text?"tiny":null)("aria-label",n.alt),x(),O("ngClass",n.iconClass),x(),Tr(" ",n.text||""," "),x(),O("ngIf",e.isExpandable(n)),x(),O("ngIf",e.isExpandable(n)&&e.breakPointOfMobile<=e.windowWidth)}}function Hh(a,t){if(a&1&&(Lt(0),se(1,jh,7,23,"ng-container",4),Ft()),a&2){let n=t.$implicit;x(),O("ngIf",n.use)}}function $h(a,t){if(a&1&&(Lt(0),se(1,Hh,2,1,"ng-container",10),Ft()),a&2){let n=w();x(),O("ngForOf",n.getToolMenus())}}function Wh(a,t){a&1&&X(0,"div",5)}function zh(a,t){if(a&1){let n=_e();R(0,"section",20)(1,"button",21),G(2,"translate"),G(3,"translate"),G(4,"translate"),ce("click",function(){W(n);let i=w();return z(i.toggleRightSideView())}),X(5,"i",22),N()()}if(a&2){let n=w();x(),Ye("dark",n.isDarkMode)("active",n.isAnnotPropertyViewActive()),O("title",n.isMobile?"":Y(2,8,"PROPERTIES_PANEL"))("tooltip",_t(14,ma,Y(3,10,"PROPERTIES_PANEL"))),ue("color",n.isDarkMode&&!n.isAnnotPropertyViewActive()?"white":n.isAnnotPropertyViewActive()?"primary":"dark")("aria-label",Y(4,12,"PROPERTIES_PANEL"))}}function Gh(a,t){if(a&1){let n=_e();R(0,"div",23)(1,"button",24),G(2,"translate"),ce("click",function(){W(n);let i=w();return z(i.onClickUndo())}),X(3,"i",25),N(),R(4,"button",24),G(5,"translate"),ce("click",function(){W(n);let i=w();return z(i.onClickRedo())}),X(6,"i",26),N()()}if(a&2){let n=w();x(),Ye("disabled",n.isDarkMode&&!n.canUndo),O("disabled",!n.canUndo)("tooltip",_t(16,ma,n.undoTooltipWithShortcut)),ue("color",n.isDarkMode?"white":"dark")("aria-label",Y(2,12,"UNDO")),x(3),Ye("disabled",n.isDarkMode&&!n.canRedo),O("disabled",!n.canRedo)("tooltip",_t(18,ma,n.redoTooltipWithShortcut)),ue("color",n.isDarkMode?"white":"dark")("aria-label",Y(5,14,"REDO"))}}var Wr=class Wr{annotService;autoSaveService;contentService;dialogService;changeDetectorRef;defaultAnnot;pageService;toastService;annotSelectedService;documentService;subscriptionService;preferenceService;actionHistoryService;store$;translatePipe;signatureService;selectTextService;apiEventBridgeService;quickActionService;viewerService;get RuntimeEnvKey(){return ne}get runtimeEnv(){return K}get DocumentAction(){return Le}get undoTooltipWithShortcut(){return`${this.translatePipe.transform("UNDO")} (${li.getShortcutString(Xi[Ae.UNDO_ACTION])})`}get redoTooltipWithShortcut(){return`${this.translatePipe.transform("REDO")} (${li.getShortcutString(Xi[Ae.REDO_ACTION])})`}rightSideViewMode;menuItems;visibleRightSideView;formFieldHighlighted=!0;rulerActive;viewMode;annotContext;sideViewMode=null;sideViewVisible=!1;canUndo=!1;canRedo=!1;hidableMenus={};screenTheme;get windowWidth(){return Q.width}get breakPointOfMobile(){return Q.breakpoints.mobile.width}get showUndoRedoBtn(){return!this.viewerService.isSubToolbarType(ht.REDACT)&&K.get(ne.ANNOT_TOOLBAR_UNDO_REDO_BUTTONS)&&!this.hidableMenus[V.ANNOTATION_UNDO_REDO]}get isVisiblePropertyButton(){return this.viewerService.isSubToolbarType(ht.ANNOTATE)&&this.runtimeEnv.get(ne.ANNOT_TOOLBAR_ANNOT_PROPERTY_BUTTON)&&!this.hidableMenus[V.ANNOTATION_PROPERTY_PANEL]||this.viewerService.isSubToolbarType(ht.FORM)&&this.runtimeEnv.get(ne.FORM_TOOLBAR_ANNOT_PROPERTY_BUTTON)&&!this.hidableMenus[V.FORM_PROPERTY_PANEL]||this.viewerService.isSubToolbarType(ht.INSERT)||this.viewerService.isSubToolbarType(ht.REDACT)||this.viewerService.isSubToolbarType(ht.SIGN)}get HidableView(){return V}get isFormHighlightAvailable(){return K.get(ne.WIDGET_HIGHLIGHT_BUTTON)&&this.documentService.checkAuthority(Le.FORM)}get isDarkMode(){return this.screenTheme==="light"?!1:this.screenTheme==="dark"||window.matchMedia("(prefers-color-scheme: dark)")?.matches}get isMobile(){return Q.isMobile()}annotateMenus=[];insertMenus=[];redactMenus=[];signMenus=[];currentTool=null;dragMode;isDeepCopy=!1;selectedSubtools=[];constructor(t,n,e,i,r,l,g,S,y,I,B,ee,ge,le,Te,$e,p,vt,gt,ft){this.annotService=t,this.autoSaveService=n,this.contentService=e,this.dialogService=i,this.changeDetectorRef=r,this.defaultAnnot=l,this.pageService=g,this.toastService=S,this.annotSelectedService=y,this.documentService=I,this.subscriptionService=B,this.preferenceService=ee,this.actionHistoryService=ge,this.store$=le,this.translatePipe=Te,this.signatureService=$e,this.selectTextService=p,this.apiEventBridgeService=vt,this.quickActionService=gt,this.viewerService=ft,this.annotateMenus=this.initAnnotateMenus(),this.insertMenus=this.initInsertMenus(),this.redactMenus=this.initRedactMenus(),this.signMenus=this.initSignMenus()}initAnnotateMenus(){return[{tool:qe.HIGHLIGHT,type:ki.ANNOT,alt:this.translatePipe.transform("HIGHLIGHT"),iconClass:"papycon-text-highlight",use:K.get(ne.HIGHLIGHT_ANNOTATION_BUTTON)},{tool:qe.STRIKE,type:ki.ANNOT,alt:this.translatePipe.transform("STRIKEOUT"),iconClass:"papycon-text-strikeout",use:K.get(ne.STRIKEOUT_ANNOTATION_BUTTON)},{tool:qe.UNDERLINE,type:ki.ANNOT,alt:this.translatePipe.transform("UNDERLINE"),iconClass:"papycon-text-underline",use:K.get(ne.UNDERLINE_ANNOTATION_BUTTON)},{tool:qe.TEXT_POPUP,type:ki.ANNOT,alt:this.translatePipe.transform("TEXT_TOOL"),iconClass:"papycon-memo3",use:K.get(ne.MEMO_ANNOTATION_BUTTON)},{tool:qe.STAMP,type:ki.ANNOT,alt:this.translatePipe.transform("STAMP_TOOL"),iconClass:"papycon-stamp2",use:K.get(ne.STAMP_ANNOTATION_BUTTON)}]}initInsertMenus(){return[{tool:qe.TEXT_FREE,type:ki.ANNOT,alt:this.translatePipe.transform("FREE_TEXT_TOOL"),iconClass:"papycon-add-text",use:K.get(ne.FREE_TEXT_ANNOTATION_BUTTON)},{tool:qe.STAMP,type:ki.ANNOT,alt:this.translatePipe.transform("STAMP_TOOL"),iconClass:"papycon-image",use:K.get(ne.STAMP_ANNOTATION_BUTTON)}]}initRedactMenus(){return[{tool:qe.REDACTION,type:ki.ANNOT,alt:this.translatePipe.transform("MARK_FOR_REDACTION"),iconClass:"papycon-redaction-partial2",use:this.documentService.checkAuthority(Le.DRAW_REDACTION)},{tool:we.SearchingRedaction,type:ki.SIDE_VIEW,alt:this.translatePipe.transform("SEARCH"),iconClass:"papycon-text-search",use:this.documentService.checkAuthority(Le.DRAW_REDACTION)}]}initSignMenus(){return[{tool:qe.SIGNATURE,type:ki.ANNOT,alt:this.translatePipe.transform("SIGN"),iconClass:"papycon-signature",use:K.get(ne.SIGNATURE_WIDGET_BUTTON)}]}ngOnInit(){this.initSubscriptions(),this.resize(),this.subscribeSubtoolMenuCloser(),this.initRegisterQuickActions()}onClickUndo(){if(this.autoSaveService.isAutoSaving||this.pageService.hasAnnotationAffectedLog()){this.toastService.create({toastStyle:jt.NOTIFICATION,header:this.translatePipe.transform("NOTIFICATION"),content:this.autoSaveService.isAutoSaving?this.translatePipe.transform("AUTO_SAVE_DETECTED"):this.translatePipe.transform("PAGE_CHANGELOG_DETECTED")});return}this.annotSelectedService.unselectAll(),this.actionHistoryService.undo()}onClickRedo(){if(this.autoSaveService.isAutoSaving||this.pageService.hasAnnotationAffectedLog()){this.toastService.create({toastStyle:jt.NOTIFICATION,header:this.translatePipe.transform("NOTIFICATION"),content:this.autoSaveService.isAutoSaving?this.translatePipe.transform("AUTO_SAVE_DETECTED"):this.translatePipe.transform("PAGE_CHANGELOG_DETECTED")});return}this.annotSelectedService.unselectAll(),this.actionHistoryService.redo()}activateTool(t){if(this.autoSaveService.isAutoSaving||this.pageService.hasAnnotationAffectedLog()){this.toastService.create({toastStyle:jt.NOTIFICATION,header:this.translatePipe.transform("NOTIFICATION"),content:this.autoSaveService.isAutoSaving?this.translatePipe.transform("AUTO_SAVE_DETECTED"):this.translatePipe.transform("PAGE_CHANGELOG_DETECTED")});return}switch(t.type){case ki.ANNOT:this.activateAnnotTool(t.tool);return;case ki.DRAG:this.activateDragModeTool(t.tool);return;case ki.SIDE_VIEW:this.activateSideView(t.tool);return}}activateAnnotTool(t,n){if(!this.documentService.checkAuthority(Le.DRAW_ANNOTATION))return;this.menuItems.forEach(i=>{i.menuState="off"}),this.initAnnotationState();let e=this.currentTool;if(qe.STAMP===t){this.dialogService.toggleDialogVisibility($i.STAMP_CREATION,!0);return}if(qe.INSTANT_SIGNATURE===t){this.signatureService.prepareSignature().subscribe({next:()=>{this.signatureService.toggleOverlay(!1),this.signatureService.toggleSignatureModuleLoadingDialog(!1),this.store$.dispatch(Ji.selectTool({payload:t})),this.changeDetectorRef.markForCheck()}});return}else if(qe.INVISIBLE_SIGNATURE===t){this.store$.dispatch(Ji.selectTool({payload:null})),this.signatureService.prepareSignature().pipe(ze(()=>this.signatureService.createEmptySignatureAnnot(0)),ut(i=>this.signatureService.injectSignature(i,"create")),L(i=>!!i)).subscribe();return}t===qe.REDACTION&&this.sideViewMode===we.SearchingRedaction&&this.store$.dispatch(he.set({key:"sideViewMode",value:we.Redaction})),t!==e?(this.store$.dispatch(Ji.selectTool({payload:t})),this.changeDetectorRef.markForCheck()):this.store$.dispatch(Ji.unselectTool()),this.windowWidth<this.breakPointOfMobile&&(this.selectedSubtools=[]),t===qe.ERASER&&this.store$.dispatch(he.set({key:"rightSideViewVisible",value:!1})),this.annotService.closeEditor()}activateDragModeTool(t){this.store$.dispatch(he.set({key:"dragMode",value:t})),this.store$.dispatch(Ji.unselectTool()),this.selectTextService.publishSelectedText(null),this.annotService.closeEditor()}activateSideView(t){switch(t){case we.SearchingRedaction:this.sideViewVisible||this.store$.dispatch(he.set({key:"sideViewVisible",value:!0})),this.currentTool===qe.REDACTION&&this.store$.dispatch(Ji.unselectTool());let n=this.sideViewMode===we.SearchingRedaction?we.Redaction:we.SearchingRedaction;this.store$.dispatch(he.set({key:"sideViewMode",value:n}));return}}activateAnnotToolForStatistics(t,n){this.activateAnnotTool(n)}getToolMenus(){return this.viewerService.isSubToolbarType(ht.ANNOTATE)?this.annotateMenus:this.viewerService.isSubToolbarType(ht.INSERT)?this.insertMenus:this.viewerService.isSubToolbarType(ht.REDACT)?this.redactMenus:this.viewerService.isSubToolbarType(ht.SIGN)?this.signMenus:[]}expanderClicked(t){t.menuState=t.menuState==="off"?"on":"off",this.menuItems.forEach(n=>{!n.hasOwnProperty("subtools")||n===t||(n.menuState="off")}),t.hasOwnProperty("subtools")&&(this.selectedSubtools=t.menuState==="off"?[]:[...t.subtools])}isEbookMode(){return this.viewMode===4&&this.documentService.eBookStatus}isActivated(t){switch(t.type){case ki.ANNOT:return this.currentTool===t.tool;case ki.DRAG:return this.dragMode===t.tool&&this.currentTool===null;case ki.SIDE_VIEW:return this.sideViewMode===t.tool}}styleOfMenuTool(t){return this.isActivated(t)||!F.isDefined(t.tool)?"white":"dark"}toggleRightSideView(){this.rightSideViewMode!==Nt.AnnotProperty&&this.store$.dispatch(he.set({key:"rightSideViewMode",value:Nt.AnnotProperty})),this.store$.dispatch(he.set({key:"rightSideViewVisible",value:!this.visibleRightSideView}))}toggleFormFieldHighlight(t){this.preferenceService.updatePreferences(["formFieldHighlighted"],!this.formFieldHighlighted)}toggleFormFieldHighlightForStatistics(t){this.toggleFormFieldHighlight()}toggleRuler(t){this.store$.dispatch(he.set({key:"rulerActive",value:!this.rulerActive}))}toggleRulerForStatistics(t){this.toggleRuler()}isAnnotPropertyViewActive(){return this.visibleRightSideView&&this.rightSideViewMode===Nt.AnnotProperty}createMenus(){let t=[...this.annotateMenus];if(!Q.isMobile())return t;let n=[qe.HIGHLIGHT,qe.STRIKE,qe.UNDERLINE];return t.filter(e=>!n.includes(e.tool))}subscribeAnnotContext(){this.subscriptionService.push(this.store$.pipe(Ao()).subscribe({next:t=>{if(this.currentTool=t,t===qe.ERASER){this.annotSelectedService.unselectAll();return}if(t!==null){this.isDeepCopy=!1;let n=this.defaultAnnot.getAnnot(t,this.isDeepCopy);if(!n)return;this.annotSelectedService.unselectAll(),this.annotSelectedService.add({data:n,elementRef:void 0})}else this.annotSelectedService.unselectAll();this.changeDetectorRef.markForCheck()}}))}initSubscriptions(){this.subscribeAnnotContext(),this.subscriptionService.push(this.store$.pipe(ii("screenTheme")).subscribe({next:t=>{this.screenTheme=t,this.changeDetectorRef.markForCheck()}}),this.store$.pipe(H("rightSideViewMode")).subscribe({next:t=>{this.rightSideViewMode=t,this.changeDetectorRef.detectChanges()}}),this.store$.pipe(H("sideViewMode")).subscribe({next:t=>this.sideViewMode=t}),this.store$.pipe(H("sideViewVisible")).subscribe({next:t=>this.sideViewVisible=t}),this.store$.pipe(bi([V.TOOLBAR_DRAG_MODE_SELECT_ANNOTATION,V.ANNOTATION_INK,V.ANNOTATION_LINE,V.ANNOTATION_SQUARE,V.ANNOTATION_CIRCLE,V.ANNOTATION_POLYLINE,V.ANNOTATION_POLYGON,V.ANNOTATION_CLOUD,V.ANNOTATION_TEXT_FREE,V.ANNOTATION_TEXT_CALLOUT,V.ANNOTATION_TEXT_POPUP,V.ANNOTATION_LINE_DIMENSION,V.ANNOTATION_POLYLINE_DIMENSION,V.ANNOTATION_POLYGON_DIMENSION,V.ANNOTATION_STAMP,V.ANNOTATION_HIGHLIGHT,V.ANNOTATION_STRIKE,V.ANNOTATION_UNDERLINE,V.ANNOTATION_LINK,V.ANNOTATION_SIGNATURE,V.ANNOTATION_TEXT_FIELD,V.ANNOTATION_COMBO_BOX,V.ANNOTATION_LIST_BOX,V.ANNOTATION_CHECK_BUTTON,V.ANNOTATION_RADIO_BUTTON,V.ANNOTATION_BUTTON,V.ANNOTATION_ERASER,V.ANNOTATION_PROPERTY_PANEL,V.ANNOTATION_UNDO_REDO,V.TOOLBAR_DRAG_MODE_SELECT_FORM,V.FORM_SIGNATURE,V.FORM_TEXT_FIELD,V.FORM_COMBO_BOX,V.FORM_LIST_BOX,V.FORM_CHECK_BUTTON,V.FORM_RADIO_BUTTON,V.FORM_BUTTON,V.FORM_PROPERTY_PANEL,V.FORM_UNDO_REDO,V.FORM_RULER,V.FORM_HIGHLIGHT])).subscribe({next:t=>{Object.assign(this.hidableMenus,t),this.annotateMenus=this.initAnnotateMenus(),Object.keys(this.hidableMenus).forEach(n=>{if(!this.hidableMenus[n])return;let[e,i]=n.split(".");this.hideAnnotTool(e,i)}),this.changeDetectorRef.markForCheck()}}),Q.windowResize$.subscribe({next:t=>this.resize(t)}),this.documentService.authorityUpdate$.subscribe({next:()=>this.changeDetectorRef.markForCheck()}),this.contentService.annotEvent$.pipe(L(t=>t!==null)).subscribe({next:()=>this.changeDetectorRef.markForCheck()}),this.contentService.annotListEvent$.pipe(L(t=>t!==null)).subscribe({next:()=>this.changeDetectorRef.markForCheck()}),this.annotSelectedService.selectionInfoChange$.subscribe({next:()=>{this.changeDetectorRef.markForCheck()}}),this.store$.pipe(H("rightSideViewVisible")).subscribe({next:t=>{this.visibleRightSideView=t,this.selectedSubtools=[],this.changeDetectorRef.markForCheck()}}),this.store$.pipe(ii("formFieldHighlighted")).subscribe({next:t=>{this.formFieldHighlighted=t,this.changeDetectorRef.markForCheck()}}),this.store$.pipe(H("rulerActive")).subscribe({next:t=>{this.rulerActive=t,this.changeDetectorRef.markForCheck()}}),this.store$.pipe(H("dragMode")).subscribe({next:t=>{this.dragMode=t,this.changeDetectorRef.markForCheck()}}),this.store$.pipe(H("viewMode")).subscribe({next:t=>this.viewMode=t}),this.actionHistoryService.availableUndoCount$.subscribe({next:t=>{this.canUndo=t>0,this.changeDetectorRef.detectChanges()}}),this.actionHistoryService.availableRedoCount$.subscribe({next:t=>{this.canRedo=t>0,this.changeDetectorRef.detectChanges()}}),this.store$.pipe(sp()).subscribe({next:t=>this.annotContext=t}),this.apiEventBridgeService.handleResultObservable(this.apiEventBridgeService.annotToolChangeAppliedSrc).subscribe({next:()=>{this.getToolMenus().forEach(t=>{if(!this.isNestedMenuItem(t)||!t.subtools.map(e=>e.tool).includes(this.annotService.annotTool))return;let n=t.subtools.findIndex(e=>e.tool===this.annotService.annotTool);n<0||(t.lastUsed=n)})}}),this.viewerService.subToolbar$.subscribe({next:()=>this.changeDetectorRef.markForCheck()}))}isNestedMenuItem(t){return"subtools"in t}isExpandable(t){return this.isNestedMenuItem(t)&&t.subtools.filter(n=>n.use).length>1}hideAnnotTool(t,n){let e;t==="ANNOTATION"&&(e=this.annotateMenus);let i=-1,r=e.findIndex(g=>this.isNestedMenuItem(g)?(i=g.subtools.findIndex(S=>S.tool===n),i!==-1):g.tool===n),l=e[r];if(F.isDefined(l))if(this.isNestedMenuItem(l)){if(l.subtools[i].use=!1,i===l.lastUsed){let g=l.subtools.findIndex(S=>S.use);g===-1&&(l.use=!1),l.lastUsed=g,this.store$.dispatch(Ji.unselectTool())}}else l.use=!1}resize(t){this.menuItems=this.buildMenu(),t&&this.changeDetectorRef.markForCheck()}buildMenu(){return this.menuItems?this.menuItems:this.createMenus()}subscribeSubtoolMenuCloser(){this.subscriptionService.push()}closeAnnotationToolbar(){this.viewerService.closeSubToolbar(),this.store$.dispatch(he.set({key:"rightSideViewVisible",value:!1}))}activateLastTool(t,n){this.menuItems.forEach(e=>{if(!this.isNestedMenuItem(e))return;let i=e.subtools.find(r=>r.tool===t.tool);F.isDefined(i)&&(e.lastUsed=n)})}initAnnotationState(){this.store$.dispatch(Ji.setAttributes({payload:null})),this.store$.dispatch(Ji.updateStampContext({payload:{width:null,height:null,dataURL:this.annotContext.stamp?.dataURL??null,name:null}})),this.annotService.initGesture()}initRegisterQuickActions(){this.quickActionService.registerActions([{id:Se.INK_TOOL,actionFn:()=>this.activateAnnotToolForStatistics(de.CHANGE_TOOL_TO_INK_BY_QUICK_SEARCH,qe.INK)},{id:Se.LINE_TOOL,actionFn:()=>this.activateAnnotToolForStatistics(de.CHANGE_TOOL_TO_LINE_BY_QUICK_SEARCH,qe.LINE)},{id:Se.SQUARE_TOOL,actionFn:()=>this.activateAnnotToolForStatistics(de.CHANGE_TOOL_TO_SQUARE_BY_QUICK_SEARCH,qe.SQUARE)},{id:Se.CIRCLE_TOOL,actionFn:()=>this.activateAnnotToolForStatistics(de.CHANGE_TOOL_TO_CIRCLE_BY_QUICK_SEARCH,qe.CIRCLE)},{id:Se.POLYGON_TOOL,actionFn:()=>this.activateAnnotToolForStatistics(de.CHANGE_TOOL_TO_POLYGON_BY_QUICK_SEARCH,qe.POLYGON)},{id:Se.POLYLINE_TOOL,actionFn:()=>this.activateAnnotToolForStatistics(de.CHANGE_TOOL_TO_POLYLINE_BY_QUICK_SEARCH,qe.POLYLINE)},{id:Se.POLYGON_CLOUD_TOOL,actionFn:()=>this.activateAnnotToolForStatistics(de.CHANGE_TOOL_TO_POLYGON_CLOUD_BY_QUICK_SEARCH,qe.CLOUD)},{id:Se.FREE_TEXT_TOOL,actionFn:()=>this.activateAnnotToolForStatistics(de.CHANGE_TOOL_TO_FREE_TEXT_BY_QUICK_SEARCH,qe.TEXT_FREE)},{id:Se.FREE_TEXT_CALLOUT_TOOL,actionFn:()=>this.activateAnnotToolForStatistics(de.CHANGE_TOOL_TO_FREE_TEXT_CALLOUT_BY_QUICK_SEARCH,qe.TEXT_CALLOUT)},{id:Se.TEXT_TOOL,actionFn:()=>this.activateAnnotToolForStatistics(de.CHANGE_TOOL_TO_TEXT_BY_QUICK_SEARCH,qe.TEXT_POPUP)},{id:Se.DISTANCE_TOOL,actionFn:()=>this.activateAnnotToolForStatistics(de.CHANGE_TOOL_TO_DISTANCE_BY_QUICK_SEARCH,qe.LINE_DIMENSION)},{id:Se.PERIMETER_TOOL,actionFn:()=>this.activateAnnotToolForStatistics(de.CHANGE_TOOL_TO_DISTANCE_BY_QUICK_SEARCH,qe.POLYLINE_DIMENSION)},{id:Se.AREA_TOOL,actionFn:()=>this.activateAnnotToolForStatistics(de.CHANGE_TOOL_TO_AREA_BY_QUICK_SEARCH,qe.POLYGON_DIMENSION)},{id:Se.STAMP_TOOL,actionFn:()=>this.activateAnnotToolForStatistics(de.CHANGE_TOOL_TO_STAMP_BY_QUICK_SEARCH,qe.STAMP)},{id:Se.HIGHLIGHT,actionFn:()=>this.activateAnnotToolForStatistics(de.CHANGE_TOOL_TO_HIGHLIGHT_BY_QUICK_SEARCH,qe.HIGHLIGHT)},{id:Se.STRIKEOUT,actionFn:()=>this.activateAnnotToolForStatistics(de.CHANGE_TOOL_TO_STRIKEOUT_BY_QUICK_SEARCH,qe.STRIKE)},{id:Se.UNDERLINE,actionFn:()=>this.activateAnnotToolForStatistics(de.CHANGE_TOOL_TO_UNDERLINE_BY_QUICK_SEARCH,qe.UNDERLINE)},{id:Se.CREATE_LINK,actionFn:()=>this.activateAnnotToolForStatistics(de.CHANGE_TOOL_TO_CREATE_LINK_BY_QUICK_SEARCH,qe.LINK)},{id:Se.ERASER,actionFn:()=>this.activateAnnotToolForStatistics(de.CHANGE_TOOL_TO_ERASER_BY_QUICK_SEARCH,qe.ERASER)},{id:Se.SIGN,actionFn:()=>this.activateAnnotToolForStatistics(de.CHANGE_TOOL_TO_SIGN_BY_QUICK_SEARCH,qe.SIGNATURE)},{id:Se.TEXT_FIELD,actionFn:()=>this.activateAnnotToolForStatistics(de.CHANGE_TOOL_TO_TEXT_FIELD_BY_QUICK_SEARCH,qe.TEXT_FIELD)},{id:Se.COMBO_BOX,actionFn:()=>this.activateAnnotToolForStatistics(de.CHANGE_TOOL_TO_COMBO_BOX_BY_QUICK_SEARCH,qe.COMBO_BOX)},{id:Se.LIST_BOX,actionFn:()=>this.activateAnnotToolForStatistics(de.CHANGE_TOOL_TO_LIST_BOX_BY_QUICK_SEARCH,qe.LIST_BOX)},{id:Se.CHECK_BUTTON,actionFn:()=>this.activateAnnotToolForStatistics(de.CHANGE_TOOL_TO_LIST_BOX_BY_QUICK_SEARCH,qe.CHECK_BUTTON)},{id:Se.RADIO_BUTTON,actionFn:()=>this.activateAnnotToolForStatistics(de.CHANGE_TOOL_TO_RADIO_BUTTON_BY_QUICK_SEARCH,qe.RADIO_BUTTON)},{id:Se.BUTTON,actionFn:()=>this.activateAnnotToolForStatistics(de.CHANGE_TOOL_TO_BUTTON_BY_QUICK_SEARCH,qe.BUTTON)},{id:Se.RULER,actionFn:()=>this.toggleRulerForStatistics(de.CHANGE_RULER_BY_QUICK_SEARCH)},{id:Se.FORMFIELD_HIGHLIGHTED,actionFn:()=>this.toggleFormFieldHighlightForStatistics(de.CHANGE_FORMFIELD_HIGHLIGHTED_BY_QUICK_SEARCH)}])}};A(Wr,"\u0275fac",function(n){return new(n||Wr)(v(ni),v(Vr),v(it),v(xn),v(ye),v(ip),v(Ht),v(Zi),v(Pi),v(ot),v(Z),v(Eo),v(Wn),v(Ee),v(Ve),v(Br),v(Fo),v(Ei),v(Tn),v(oi))}),A(Wr,"\u0275cmp",Ce({type:Wr,selectors:[["sd-annot-toolbar"]],standalone:!1,features:[be([Z,{provide:Bn,useValue:new Yt(300)}])],decls:9,vars:5,consts:[["redoUndo",""],[1,"left"],[1,"right"],[1,"annotation"],[4,"ngIf"],[1,"full","divider"],["class","panel",4,"ngIf"],[4,"ngTemplateOutlet"],[1,"divider"],[1,"redo-undo-container"],[4,"ngFor","ngForOf"],[1,"tool-container"],[1,"tool-button",3,"click","title","tooltip"],[1,"papycon",3,"ngClass"],["class","ep-text-button expand-button",3,"dark","click",4,"ngIf"],["class","subtool-menu",4,"ngIf"],[1,"ep-text-button","expand-button",3,"click"],[1,"papycon","papycon-chevron3-down"],[1,"subtool-menu"],[1,"ep-text-button",3,"click","title","tooltip"],[1,"panel"],[1,"ep-text-button","annot-property-toggle",3,"click","title","tooltip"],[1,"papycon","papycon-palette"],[1,"redo-undo"],["size","tiny",1,"ep-text-button",3,"click","disabled","tooltip"],[1,"papycon","papycon-undo"],[1,"papycon","papycon-redo"]],template:function(n,e){n&1&&(se(0,Dh,3,1,"section",1),R(1,"section",2),se(2,Vh,3,1),R(3,"section",3),se(4,$h,2,1,"ng-container",4),N(),se(5,Wh,1,0,"div",5)(6,zh,6,16,"section",6),N(),se(7,Gh,7,20,"ng-template",null,0,ci)),n&2&&(fn(e.showUndoRedoBtn?0:-1),x(2),fn(e.showUndoRedoBtn&&e.windowWidth<e.breakPointOfMobile?2:-1),x(2),O("ngIf",e.documentService.checkAuthority(e.DocumentAction.DRAW_ANNOTATION)),x(),fn(e.windowWidth<e.breakPointOfMobile?5:-1),x(),O("ngIf",e.isVisiblePropertyButton))},dependencies:[co,Si,lt,$s,lo,Ve],styles:["i.papycon-chevron3-down[_ngcontent-%COMP%]{transform:scale(.5);font-size:18px;line-height:48px;margin:-12px -7.5px;padding:0 6px;transform-origin:50% 50%}i[_ngcontent-%COMP%] + i.papycon-chevron3-down[_ngcontent-%COMP%]{margin:-12px -8.5px;padding:0 8px}i.papycon-chevron3-down.expanded[_ngcontent-%COMP%]{transform:scale(.5) rotate(-180deg)}[_nghost-%COMP%]{position:relative;display:flex;box-sizing:border-box;background-color:var(--mono-00);border-bottom:1px solid var(--mono-30);z-index:2}.ep-text-button[_ngcontent-%COMP%]:has(i.papycon){border-width:0;outline-offset:-2px;padding:2px}section[_ngcontent-%COMP%]{display:flex}section[_ngcontent-%COMP%] > .divider[_ngcontent-%COMP%]{align-self:center;height:24px;width:1px;background-color:var(--mono-30)}section[_ngcontent-%COMP%] > .divider.full[_ngcontent-%COMP%]{height:100%}section.right[_ngcontent-%COMP%]{width:100%}section.right[_ngcontent-%COMP%]   section.annotation[_ngcontent-%COMP%], section.right[_ngcontent-%COMP%]   section.option[_ngcontent-%COMP%]{align-items:center;padding:0 16px 0 24px}section.right[_ngcontent-%COMP%]   section.annotation[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%], section.right[_ngcontent-%COMP%]   section.option[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]{position:relative}section.right[_ngcontent-%COMP%]   section.annotation[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%], section.right[_ngcontent-%COMP%]   section.option[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]{color:var(--mono-90)}section.right[_ngcontent-%COMP%]   section.annotation[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   button.dark.active[_ngcontent-%COMP%], section.right[_ngcontent-%COMP%]   section.option[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   button.dark.active[_ngcontent-%COMP%]{color:var(--mono-00)}section.right[_ngcontent-%COMP%]   section.annotation[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]:not(:disabled,.active):hover, section.right[_ngcontent-%COMP%]   section.option[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]:not(:disabled,.active):hover{color:#d7d7d7}section.right[_ngcontent-%COMP%]   section.annotation[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   i.papycon.bold[_ngcontent-%COMP%], section.right[_ngcontent-%COMP%]   section.option[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   i.papycon.bold[_ngcontent-%COMP%]{font-weight:500}section.right[_ngcontent-%COMP%]   section.annotation[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   .ep-button[_ngcontent-%COMP%], section.right[_ngcontent-%COMP%]   section.option[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   .ep-button[_ngcontent-%COMP%]{background-color:var(--mono-00);border-color:var(--mono-50)}section.right[_ngcontent-%COMP%]   section.annotation[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   .tool-button[_ngcontent-%COMP%], section.right[_ngcontent-%COMP%]   section.option[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   .tool-button[_ngcontent-%COMP%]{border-radius:4px}section.right[_ngcontent-%COMP%]   section.annotation[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   .tool-button.active[_ngcontent-%COMP%], section.right[_ngcontent-%COMP%]   section.option[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   .tool-button.active[_ngcontent-%COMP%]{background-color:#f166251a;color:var(--primary-50)}section.right[_ngcontent-%COMP%]   section.annotation[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   .active-indicator[_ngcontent-%COMP%], section.right[_ngcontent-%COMP%]   section.option[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   .active-indicator[_ngcontent-%COMP%]{position:absolute;top:calc(100% + 3px);width:100%;height:3px;background-color:var(--primary-50);border-radius:2px}section.right[_ngcontent-%COMP%]   section.annotation[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   .tool-button[_ngcontent-%COMP%] + .expand-button[_ngcontent-%COMP%], section.right[_ngcontent-%COMP%]   section.option[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   .tool-button[_ngcontent-%COMP%] + .expand-button[_ngcontent-%COMP%]{margin-left:2px}section.right[_ngcontent-%COMP%]   section.annotation[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%] + div.tool-container[_ngcontent-%COMP%], section.right[_ngcontent-%COMP%]   section.option[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%] + div.tool-container[_ngcontent-%COMP%]{margin-left:20px}section.right[_ngcontent-%COMP%]   section.annotation[_ngcontent-%COMP%]   div.tool-container.expandable[_ngcontent-%COMP%] + div.tool-container[_ngcontent-%COMP%], section.right[_ngcontent-%COMP%]   section.option[_ngcontent-%COMP%]   div.tool-container.expandable[_ngcontent-%COMP%] + div.tool-container[_ngcontent-%COMP%]{margin-left:12px}section.right[_ngcontent-%COMP%]   section.panel[_ngcontent-%COMP%]{margin-left:auto}section.right[_ngcontent-%COMP%]   section.panel[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin:auto 12px}section.right[_ngcontent-%COMP%]   section.panel[_ngcontent-%COMP%] > button.dark[_ngcontent-%COMP%]:not(.active):hover{color:#d7d7d7}section.right[_ngcontent-%COMP%]   .subtool-menu[_ngcontent-%COMP%]{box-shadow:0 4px 32px #6c6c6c1f;position:absolute;top:calc(100% + 9px);column-gap:12px;box-sizing:border-box;padding:6px 8px;margin-top:5px;border:1px solid var(--mono-30);border-radius:2px;background-color:var(--mono-00);white-space:nowrap;z-index:3}section.right[_ngcontent-%COMP%]   .subtool-menu[_ngcontent-%COMP%]   .active[_ngcontent-%COMP%]{color:var(--mono-00);background-color:var(--primary-50)}section.right[_ngcontent-%COMP%]   .subtool-menu[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], section.right[_ngcontent-%COMP%]   .subtool-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:4px}.redo-undo[_ngcontent-%COMP%]{padding:0 24px 0 16px;display:flex;gap:24px;align-items:center}.redo-undo[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:0}.redo-undo[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   i.papycon[_ngcontent-%COMP%]{font-size:22px}@media screen and (max-width: 811px){[_nghost-%COMP%]{justify-content:flex-end}}@media screen and (max-width: 575px){section.left[_ngcontent-%COMP%]{display:none}section.right[_ngcontent-%COMP%]{width:100%;position:relative}section.right[_ngcontent-%COMP%]   section.subtool-container[_ngcontent-%COMP%]{align-items:center;position:absolute;top:43px;width:100%;height:43px;padding:0 12px;gap:12px;background-color:var(--mono-10);box-shadow:0 2px 1px rgba(var(--mono-70),.12);border-bottom:1px solid var(--mono-30)}section.right[_ngcontent-%COMP%]   section.subtool-container[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{color:var(--mono-00);background-color:var(--primary-50)}section.right[_ngcontent-%COMP%]   section.annotation[_ngcontent-%COMP%]{padding:0 14px;flex:1;white-space:nowrap;overflow-x:scroll;overflow-y:hidden;-ms-overflow-style:none;scrollbar-width:none}section.right[_ngcontent-%COMP%]   section.annotation[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}section.right[_ngcontent-%COMP%]   section.annotation[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]{display:inline-block}section.right[_ngcontent-%COMP%]   section.annotation[_ngcontent-%COMP%]   div.tool-container[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{vertical-align:middle}.redo-undo[_ngcontent-%COMP%]{padding:0 16px;display:flex;gap:10px;align-items:center}.redo-undo[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:0}.redo-undo[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   i.papycon[_ngcontent-%COMP%]{font-size:22px}}"],data:{animation:[Zl.expandSubTool()]},changeDetection:0}));var mo=Wr;Qe([st(nt.annotToolbarComp.onClickRedo)],mo.prototype,"onClickUndo",null);Qe([st(nt.annotToolbarComp.onClickUndo)],mo.prototype,"onClickRedo",null);Qe([st(nt.annotToolbarComp.activateAnnotToolForStatistics)],mo.prototype,"activateAnnotToolForStatistics",null);Qe([st(nt.annotToolbarComp.toggleFormFieldHighlightForStatistics)],mo.prototype,"toggleFormFieldHighlightForStatistics",null);Qe([st(nt.annotToolbarComp.toggleRulerForStatistics)],mo.prototype,"toggleRulerForStatistics",null);var Kp=(()=>{let t=class t{};A(t,"\u0275fac",function(i){return new(i||t)}),A(t,"\u0275mod",Jt({type:t})),A(t,"\u0275inj",Xt({imports:[Ui,Cn]}));let a=t;return a})();var Ti=(()=>{class a{bufferedPages=[];_pdfPages=[];get pdfPages(){return this._pdfPages}set pdfPages(n){this._pdfPages=n,this.resolver=new An(this._pdfPages)}degree=0;isR2L=!1;isSlideshow=!1;resolver=new An([]);getPageSize(n){return this.resolver.getPageSize(this.degree,n)}getPageFrameOffset(n,e){return this.resolver.getPageFrameOffset(n,this.degree,this.isR2L,e,this.isSlideshow)}getPageContainerSize(n,e){return this.resolver.getPageContainerSize(n,this.degree,e,this.isSlideshow)}}return A(a,"MARGIN",5),A(a,"OPTIONAL_VISIBLE_PAGE",2),a})();var Sa=(()=>{let t=class t{elementRef;renderer;page;constructor(e,i){this.elementRef=e,this.renderer=i}update(e){let{w:i,h:r}=this.page.bbox,l=this.page.r+e,g=Math.abs(Math.sin(l*Math.PI/180)),S=g*(i-r)/2,y=g*(r-i)/2,I=this.elementRef.nativeElement,B=I.querySelector(".loader");F.isDefined(B)&&this.renderer.setStyle(B,"display","flex"),this.renderer.setStyle(I,"marginTop",J.pixelOf(S)),this.renderer.setStyle(I,"marginLeft",J.pixelOf(y)),this.renderer.setStyle(I,"width",J.pixelOf(i)),this.renderer.setStyle(I,"height",J.pixelOf(r)),this.renderer.setStyle(I,"transform",J.rotationNote(l))}};A(t,"\u0275fac",function(i){return new(i||t)(v(Zt),v(At))}),A(t,"\u0275dir",gn({type:t,selectors:[["","sdPageContentLayout",""]],inputs:{page:"page"},standalone:!1}));let a=t;return a})();var Ca=(()=>{let t=class t{elementRef;renderer;margin=`${J.pixelOf(Ti.MARGIN)} ${J.pixelOf(Ti.MARGIN)}`;childLayout;page;constructor(e,i){this.elementRef=e,this.renderer=i}update(e,i,r,l){let g=this.elementRef.nativeElement;if(!J.isVisible(this.page.i,i-1,r)){this.renderer.setStyle(g,"visibility","hidden");return}let{height:S,width:y}=e.getPageSize(this.page.i),{offsetX:I,offsetY:B}=e.getPageFrameOffset(r,this.page.i);this.renderer.setStyle(g,"visibility",""),this.renderer.setStyle(g,"height",J.pixelOf(S)),this.renderer.setStyle(g,"width",J.pixelOf(y)),this.renderer.setStyle(g,"margin",e.isSlideshow?J.pixelOf(0):this.margin),this.renderer.setStyle(g,"top",J.pixelOf(B,3)),this.renderer.setStyle(g,"left",J.pixelOf(I,3)),this.childLayout?.update(l)}};A(t,"\u0275fac",function(i){return new(i||t)(v(Zt),v(At))}),A(t,"\u0275dir",gn({type:t,selectors:[["","sdPageFrameLayout",""]],contentQueries:function(i,r,l){if(i&1&&yo(l,Sa,5),i&2){let g;Re(g=Ie())&&(r.childLayout=g.first)}},inputs:{page:"page"},standalone:!1}));let a=t;return a})();var ba=(()=>{let t=class t{elementRef;renderer;childLayout;constructor(e,i){this.elementRef=e,this.renderer=i}update(e,i,r,l,g){this.renderer.setStyle(this.elementRef.nativeElement,"transform",`scale(${J.normalizeScale(i)})`),this.childLayout.forEach(S=>S.update(e,r,l,g))}};A(t,"\u0275fac",function(i){return new(i||t)(v(Zt),v(At))}),A(t,"\u0275dir",gn({type:t,selectors:[["","sdScrollExpanderLayout",""]],contentQueries:function(i,r,l){if(i&1&&yo(l,Ca,4),i&2){let g;Re(g=Ie())&&(r.childLayout=g)}},standalone:!1}));let a=t;return a})();var zn=(()=>{let t=class t{elementRef;renderer;static getOffset(e,i,r,l,g){let S=J.normalizeScale(r),y=e.getPageContainerSize(l,g-1),I=y.width*S,B=y.height*S,ee=i.offsetWidth-Q.scrollbarSize.vertical,ge=i.offsetHeight-Q.scrollbarSize.horizontal;return{offsetX:Math.max((ee-I)/2,0),offsetY:Math.max((ge-B)/2,0)}}childLayout;constructor(e,i){this.elementRef=e,this.renderer=i}update(e,i,r,l,g,S){let y=J.normalizeScale(r),I=e.getPageContainerSize(l,g-1),B=I.width*y,ee=I.height*y,ge=t.getOffset(e,i,r,l,g),le=this.elementRef.nativeElement;this.renderer.setStyle(le,"paddingLeft",J.pixelOf(ge.offsetX,3)),this.renderer.setStyle(le,"paddingRight",J.pixelOf(ge.offsetX,3)),this.renderer.setStyle(le,"marginTop",J.pixelOf(ge.offsetY,3)),this.renderer.setStyle(le,"width",J.pixelOf(B,3)),this.renderer.setStyle(le,"height",J.pixelOf(ee,3)),this.renderer.setStyle(le,"overflow","hidden"),this.childLayout?.update(e,r,g,l,S)}};A(t,"\u0275fac",function(i){return new(i||t)(v(Zt),v(At))}),A(t,"\u0275dir",gn({type:t,selectors:[["","sdScaleWrapperLayout",""]],contentQueries:function(i,r,l){if(i&1&&yo(l,ba,5),i&2){let g;Re(g=Ie())&&(r.childLayout=g.first)}},standalone:!1}));let a=t;return a})();var xa=(()=>{let t=class t{elementRef;childLayout;constructor(e){this.elementRef=e}update(e,i,r,l,g){this.childLayout?.update(e,this.elementRef.nativeElement,i,r,l,g)}};A(t,"\u0275fac",function(i){return new(i||t)(v(Zt))}),A(t,"\u0275dir",gn({type:t,selectors:[["","sdContentViewLayout",""]],contentQueries:function(i,r,l){if(i&1&&yo(l,zn,5),i&2){let g;Re(g=Ie())&&(r.childLayout=g.first)}},standalone:!1}));let a=t;return a})();var Jp=Jc(Zp());var Qh=["containerWrapperRef"],qh=()=>({"object-fit":"contain"});function Kh(a,t){a&1&&X(0,"sd-loader")}function Xh(a,t){if(a&1){let n=_e();R(0,"sd-image",8),ce("rendered",function(){W(n);let i=w().$implicit,r=w(2);return z(r.onImageRendered(i))}),N()}if(a&2){let n=w().$implicit,e=w(2);O("pdfPage",n)("documentId",e.documentId)("ngStyle",e.rotateImage(n.r))("imgStyle",Or(4,qh))}}function Zh(a,t){if(a&1&&(R(0,"div",5),se(1,Kh,1,0,"sd-loader",6)(2,Xh,1,5,"sd-image",7),N()),a&2){let n=t.$implicit,e=w(2);x(),O("ngIf",!e.isLoadedPage(n)),x(),O("ngIf",e.isVisiblePage(n))}}function Jh(a,t){if(a&1&&(R(0,"div",3),se(1,Zh,3,2,"div",4),N()),a&2){let n=w();Gi("visibility",n.eBookReady?"visible":"hidden"),O("ngStyle",n.eBookContainerStyle()),x(),O("ngForOf",n.pdfPages)}}var lr=function(a){return a.SINGLE="single",a.DOUBLE="double",a}(lr||{}),Ta=function(a){return a.TL_TR="tl,tr",a.BL_BR="bl,br",a}(Ta||{}),sc=(()=>{let t=class t{contentService;documentService;elementRef;changeDetectorRef;shortcutService;subscriptionService;renderer;scrollController;store$;pageService;documentId;containerWrapperRef;eBookReady=!1;containerWrapperStyle={};WIDTH_MARGIN=64;HEIGHT_MARGIN=64;currentPageNo;pageCount;eBook;bookPageRatio;isR2L=!1;bookSize={width:0,height:0};bookDisplayMode;containerStyle={};loadedPageNoArr=[];prevPageNoRange;scale=100;dragListeners=[];prevDragEvent;pdfPages=[];get isDragging(){return this.dragListeners.length>0}get scrollContainer(){if(!F.isDefined(this.elementRef.nativeElement.parentElement))throw new Un("Parent element is not defined.");return this.elementRef.nativeElement.parentElement}constructor(e,i,r,l,g,S,y,I,B,ee){this.contentService=e,this.documentService=i,this.elementRef=r,this.changeDetectorRef=l,this.shortcutService=g,this.subscriptionService=S,this.renderer=y,this.scrollController=I,this.store$=B,this.pageService=ee}ngOnInit(){this.initSubscriptions()}ngOnChanges(){this.eBookReady=!1,this.calcBookPageRatio(),this.eBook&&(this.eBook.turn("destroy"),this.eBook=void 0),setTimeout(()=>{this.bindEbook()})}onWrapperMousedown(e){this.prevDragEvent=e,this.dragListeners.push(this.renderer.listen(this.containerWrapperRef.nativeElement,"mousemove",i=>this.onMoveEvent(i)),this.renderer.listen(this.containerWrapperRef.nativeElement,"mouseup",()=>this.onEndDragEvent()),this.renderer.listen(this.containerWrapperRef.nativeElement,"mouseleave",()=>this.onEndDragEvent()))}eBookContainerStyle(){return this.containerStyle}isLoadedPage(e){return!!this.loadedPageNoArr[e.i+1]}isVisiblePage(e){return(this.prevPageNoRange||[]).includes(e.i+1)}onImageRendered(e){this.loadedPageNoArr[e.i+1]=!0,this.contentService.publishSomePageLoaded(!0),this.changeDetectorRef.markForCheck()}hasPageNo(e){return e.referencePoint===void 0}initSubscriptions(){this.subscriptionService.push(this.store$.pipe(H("currentPageNo")).subscribe({next:e=>this.currentPageNo=e}),this.store$.pipe(H("pageCount")).subscribe({next:e=>this.pageCount=e}),this.shortcutService.getShortcutEvent(Ae.EBOOK_PREVIOUS_PAGE).pipe(xr(100),L(()=>this.eBook)).subscribe({next:()=>this.eBook.turn("previous")}),this.shortcutService.getShortcutEvent(Ae.EBOOK_NEXT_PAGE).pipe(xr(100),L(()=>this.eBook)).subscribe({next:()=>this.eBook.turn("next")}),this.contentService.viewChangeRequest$.pipe(L(()=>this.eBook),L(this.hasPageNo),ze(e=>e.pageNo),L(F.isDefined),ze(e=>Math.min(Math.max(1,e),this.pageCount)),Fn()).subscribe({next:e=>this.eBook.turn("page",e)}),at(Q.windowResize$,this.store$.pipe(H("sideViewVisible")),this.store$.pipe(H("sideViewSize")),this.store$.pipe(H("rightSideViewVisible")),this.store$.pipe(H("rightSideViewSize"))).subscribe({next:()=>{this.eBook&&this.safeCallTurnJS(()=>{this.decideDisplayMode(),this.calcBookSize(),this.eBook.turn("size",this.bookSize.width,this.bookSize.height)})}}),this.documentService.pdfInfo$.pipe(dl(this.store$.pipe(ii("viewerDirection")))).subscribe({next:([e,i])=>this.decideR2L(e,i)}),this.store$.pipe(H("scale")).subscribe({next:e=>{if(this.scale=e,this.eBook){let i=1,r=this.bookSize.width;this.safeCallTurnJS(()=>{this.decideDisplayMode(),this.calcBookSize(),i=this.bookSize.width/r,this.eBook.turn("size",this.bookSize.width,this.bookSize.height)});let l=this.scrollController.jumpingOrigin;l.x>0&&(this.scrollContainer.scrollLeft=(this.scrollContainer.scrollLeft+l.x)*i-l.x),l.y>0&&(this.scrollContainer.scrollTop=(this.scrollContainer.scrollTop+l.y)*i-l.y)}}}),this.pageService.pdfPages$.subscribe({next:e=>this.pdfPages=e}))}calcBookPageRatio(){if(!this.pdfPages)return;let e={},i=0,r=0;this.pdfPages.forEach(l=>{let g=(l.bbox.h/l.bbox.w).toFixed(5);e[g]?e[g]++:e[g]=1});for(let l in e)e[l]>i&&(i=e[l],r=Number(l));this.bookPageRatio=r}decideDisplayMode(){let e=this.bookDisplayMode||null;this.bookDisplayMode=Q.isMobile()?lr.SINGLE:lr.DOUBLE,e&&e!==this.bookDisplayMode&&this.eBook.turn("display",this.bookDisplayMode)}calcBookSize(){this.bookPageRatio||this.calcBookPageRatio();let e=this.scrollContainer.clientWidth-(Q.isMobile()?0:this.WIDTH_MARGIN*2),i=this.scrollContainer.clientHeight-(Q.isMobile()?0:this.HEIGHT_MARGIN*2),r=i/e,l=this.bookDisplayMode===lr.SINGLE?this.bookPageRatio:this.bookPageRatio/2,g,S;l>r?(S=i,g=S/l):(g=e,S=g*l),this.pdfPages.some(B=>B.r===90||B.r===270)&&(S=this.bookDisplayMode===lr.SINGLE?g:g/2),this.bookSize.width=g*(this.scale/100),this.bookSize.height=S*(this.scale/100),this.containerWrapperStyle.width=`${this.bookSize.width}px`,this.containerWrapperStyle.height=`${this.bookSize.height}px`;let y="0",I="0";return this.bookSize.width<this.scrollContainer.clientWidth&&(y=`${((this.scrollContainer.clientWidth-this.bookSize.width)/2).toFixed(2)}px`),this.bookSize.height<this.scrollContainer.clientHeight&&(I=`${((this.scrollContainer.clientHeight-this.bookSize.height)/2).toFixed(2)}px`),this.containerWrapperStyle.transform=`translate(${y}, ${I})`,this.bookSize}bindEbook(){this.decideDisplayMode(),this.calcBookSize(),this.updateEbookStyle(),this.eBook=(0,Jp.default)("#ebook"),this.eBook.turn({display:this.bookDisplayMode,elevation:50,gradients:!0,autoCenter:!1,acceleration:!0,pages:this.pdfPages.length,duration:500,page:this.currentPageNo,width:this.bookSize.width,height:this.bookSize.height,direction:this.isR2L?"rtl":"ltr",when:{start:(r,l,g)=>{let S=Ta.TL_TR.includes(g)?Ta.TL_TR:Ta.BL_BR;this.eBook.turn("options",{turnCorners:S})},turning:(r,l)=>{let g=J.getEbookPageNo(l);this.updateEbookStyle(g),this.store$.dispatch(he.set({key:"currentPageNo",value:this.bookDisplayMode===lr.SINGLE?l:g})),this.scrollController.updateReadStatus(),this.changeDetectorRef.markForCheck()},end:()=>{let[r,l]=this.eBook.turn("range"),g=Array.from(new Array(l-r+1),(S,y)=>y+r);this.prevPageNoRange&&this.prevPageNoRange.forEach(S=>{g.includes(S)||(this.loadedPageNoArr[S]=!1)}),this.prevPageNoRange=g,this.changeDetectorRef.markForCheck()}}});let[e,i]=this.eBook.turn("range");this.prevPageNoRange=Array.from(new Array(i-e+1),(r,l)=>l+e),this.eBookReady=!0,this.changeDetectorRef.markForCheck()}updateEbookStyle(e){if(this.bookDisplayMode===lr.SINGLE)return;let i=e;if(F.isDefined(i)||(i=this.currentPageNo),!F.isDefined(this.containerWrapperStyle.width))throw new Un("Container wrapper style width is not defined.");let r=parseInt(this.containerWrapperStyle.width,10),l=Math.min(r-this.bookSize.width,this.bookSize.width/2)+(r-this.bookSize.width<this.bookSize.width/2?(this.bookSize.width/2-(r-this.bookSize.width))/2:0);i===1||i===this.pageCount?this.containerStyle["margin-left"]=`${this.isR2L!==(i===1)?"-":""}${l.toFixed(3)}px`:this.containerStyle["margin-left"]=null}decideR2L(e,i){let r=i===0?e?.ViewerPreferences?.Direction==="R2L":i===2;this.store$.dispatch(he.set({key:"isR2L",value:r})),this.changeDirection(this.isR2L?"rtl":"ltr")}changeDirection(e){if(!this.eBook)return;this.eBook.turn("direction")!==e&&this.safeCallTurnJS(()=>{this.eBook.turn("direction",e)})}safeCallTurnJS(e){this.containerStyle.transition="none",this.containerStyle["margin-left"]=null,this.changeDetectorRef.markForCheck(),this.changeDetectorRef.detectChanges(),e(),this.updateEbookStyle(),this.changeDetectorRef.markForCheck(),this.changeDetectorRef.detectChanges(),this.containerStyle.transition=null}onMoveEvent(e){let i=e.clientX-this.prevDragEvent.clientX,r=e.clientY-this.prevDragEvent.clientY;i&&(this.scrollContainer.scrollLeft-=i),r&&(this.scrollContainer.scrollTop-=r),!(!r&&!i)&&(this.prevDragEvent=e)}onEndDragEvent(){this.dragListeners.forEach(e=>e()),this.dragListeners.splice(0),this.changeDetectorRef.markForCheck()}rotateImage(e){return{transform:`rotate(${e}deg)`}}};A(t,"\u0275fac",function(i){return new(i||t)(v(it),v(ot),v(Zt),v(ye),v(Hi),v(Z),v(At),v(tn),v(Ee),v(Ht))}),A(t,"\u0275cmp",Ce({type:t,selectors:[["sd-ebook-view"]],viewQuery:function(i,r){if(i&1&&Ue(Qh,7),i&2){let l;Re(l=Ie())&&(r.containerWrapperRef=l.first)}},inputs:{documentId:"documentId"},standalone:!1,features:[be([Z]),qi],decls:3,vars:4,consts:[["containerWrapperRef",""],[1,"container-wrapper",3,"mousedown","ngStyle"],["id","ebook","class","animated",3,"visibility","ngStyle",4,"ngIf"],["id","ebook",1,"animated",3,"ngStyle"],["class","pdf-page",4,"ngFor","ngForOf"],[1,"pdf-page"],[4,"ngIf"],[3,"pdfPage","documentId","ngStyle","imgStyle","rendered",4,"ngIf"],[3,"rendered","pdfPage","documentId","ngStyle","imgStyle"]],template:function(i,r){if(i&1){let l=_e();R(0,"div",1,0),ce("mousedown",function(S){return W(l),z(r.onWrapperMousedown(S))}),se(2,Jh,2,4,"div",2),N()}i&2&&(Ye("dragging",r.isDragging),O("ngStyle",r.containerWrapperStyle),x(2),O("ngIf",(r.pdfPages==null?null:r.pdfPages.length)>0))},styles:[".container-wrapper[_ngcontent-%COMP%]{cursor:grab;overflow:hidden}.container-wrapper.dragging[_ngcontent-%COMP%]{cursor:grabbing}#ebook[_ngcontent-%COMP%]{width:100%;height:100%;z-index:0;overflow:initial!important}.animated[_ngcontent-%COMP%]{transition:margin-left .2s ease-in-out}.pdf-page[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;justify-content:center;width:100%;height:100%;background-color:#fff}.pdf-page[_ngcontent-%COMP%]   sd-image[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%}[_nghost-%COMP%]  .page.p-temporal{background-color:#fff}"],changeDetection:0}));let a=t;return a})();function eu(a,t){a&1&&X(0,"sd-bottom-right-indicator")}function tu(a,t){a&1&&X(0,"sd-scale-indicator")}var Oa=(()=>{let t=class t{changeDetectorRef;subscriptionService;store$;hidableMenus={};get RuntimeEnvKey(){return ne}get runtimeEnv(){return K}viewMode;get isEbookMode(){return this.viewMode===4}get HidableView(){return V}constructor(e,i,r){this.changeDetectorRef=e,this.subscriptionService=i,this.store$=r}ngOnInit(){this.subscriptionService.push(this.store$.pipe(H("viewMode")).subscribe({next:e=>{this.viewMode=e,this.changeDetectorRef.markForCheck()}}),this.store$.pipe(bi([V.INDICATOR,V.INDICATOR_SCALE,V.INDICATOR_MEASURE,V.INDICATOR_PAGE])).subscribe({next:e=>{Object.assign(this.hidableMenus,e),this.changeDetectorRef.markForCheck()}}))}};A(t,"\u0275fac",function(i){return new(i||t)(v(ye),v(Z),v(Ee))}),A(t,"\u0275cmp",Ce({type:t,selectors:[["sd-indicator"]],standalone:!1,features:[be([Z])],decls:2,vars:2,consts:[[4,"ngIf"]],template:function(i,r){i&1&&se(0,eu,1,0,"sd-bottom-right-indicator",0)(1,tu,1,0,"sd-scale-indicator",0),i&2&&(O("ngIf",!r.isEbookMode&&(!r.hidableMenus[r.HidableView.INDICATOR_MEASURE]||!r.hidableMenus[r.HidableView.INDICATOR_PAGE])),x(),O("ngIf",r.runtimeEnv.get(r.RuntimeEnvKey.SCALE_INDICATOR)&&!r.hidableMenus[r.HidableView.INDICATOR_SCALE]))},styles:["[_nghost-%COMP%]{pointer-events:none}"],changeDetection:0}));let a=t;return a})();var nu=["viewComp"];function ou(a,t){if(a&1&&X(0,"sd-measure-body",3,0),a&2){let n=w();O("model",n.model)}}var Ma=(()=>{let t=class t{contentService;annotSelectedService;changeDetectorRef;subscriptionService;indicatorState="off";indicatorStyle={};model=null;viewComp;constructor(e,i,r,l){this.contentService=e,this.annotSelectedService=i,this.changeDetectorRef=r,this.subscriptionService=l}ngOnInit(){this.subscriptionService.push(at(at(this.contentService.annotListEvent$,this.contentService.annotEvent$).pipe(L(F.isDefined),L(e=>e?.sdEventType===en.SELECTED)),this.contentService.measureIndicatorEvent$.pipe(L(F.isDefined),L(e=>e.action==="create"))).subscribe({next:e=>this.toggleIndicator(e)}),this.annotSelectedService.selectionInfoChange$.subscribe({next:()=>this.toggleIndicator()}),this.contentService.measureIndicatorEvent$.pipe(L(e=>e?.action==="edit")).subscribe({next:()=>this.detectChanges()}))}detectChanges(){this.changeDetectorRef.destroyed||(this.changeDetectorRef.markForCheck(),this.viewComp?.detectChanges&&this.viewComp.detectChanges())}indicatorChanged(e,i){F.animDispChange(e,i,"block",null,()=>{this.indicatorState==="off"&&(this.model=null)})}turnOnIndicator(){this.indicatorState="on"}turnOffIndicator(){this.indicatorState="off"}toggleIndicator(e){let i=e;if(this.annotSelectedService.selectedComponents.length===0){this.turnOffIndicator(),this.detectChanges();return}F.isDefined(i)||(i={annot:this.annotSelectedService.selectedComponents[0].data}),go.hasDefinedProp(i,"annot")&&(Bt.isLineDimension(i.annot)||Bt.isPolyLineDimension(i.annot)||Bt.isPolygonDimension(i.annot))?(this.model=i.annot,this.turnOnIndicator()):this.turnOffIndicator(),this.detectChanges()}};A(t,"\u0275fac",function(i){return new(i||t)(v(it),v(Pi),v(ye),v(Z))}),A(t,"\u0275cmp",Ce({type:t,selectors:[["sd-measure-indicator"]],viewQuery:function(i,r){if(i&1&&Ue(nu,5),i&2){let l;Re(l=Ie())&&(r.viewComp=l.first)}},standalone:!1,features:[be([Z])],decls:2,vars:3,consts:[["viewComp",""],[1,"container",3,"ngStyle"],[3,"model",4,"ngIf"],[3,"model"]],template:function(i,r){i&1&&(R(0,"div",1),ce("@indicatorState.done",function(g){return r.indicatorChanged(g,r.indicatorStyle)})("@indicatorState.start",function(g){return r.indicatorChanged(g,r.indicatorStyle)}),se(1,ou,2,1,"sd-measure-body",2),N()),i&2&&(O("@indicatorState",r.indicatorState)("ngStyle",r.indicatorStyle),x(),O("ngIf",r.model))},styles:[".container[_ngcontent-%COMP%]{box-shadow:0 4px 32px #6c6c6c1f;box-sizing:border-box;min-width:192px;min-height:144px;position:relative;float:right;border:1px solid var(--mono-30);border-radius:2px;background-color:var(--mono-10);opacity:0;display:none;margin-right:35px;padding:16px;pointer-events:none}"],data:{animation:[jn("indicatorState",[vn("off",Di({opacity:0})),vn("on",Di({opacity:1})),_n("off <=> on",mn("250ms linear"))])]},changeDetection:0}));let a=t;return a})();function su(a,t){a&1&&(R(0,"div"),me(1),G(2,"translate"),N()),a&2&&(x(),xe(Y(2,1,"RATIO")))}function au(a,t){a&1&&(R(0,"div"),me(1),G(2,"translate"),N()),a&2&&(x(),xe(Y(2,1,"PRECISION")))}function cu(a,t){a&1&&(R(0,"div"),me(1),G(2,"translate"),N()),a&2&&(x(),xe(Y(2,1,"ROTATION")))}function lu(a,t){if(a&1&&(R(0,"div"),me(1),N()),a&2){let n=w();x(),xe(n.model.attributes.Measure.R)}}function pu(a,t){if(a&1&&(R(0,"div"),me(1),N()),a&2){let n=w();x(),xe(1/n.precision)}}function du(a,t){if(a&1&&(R(0,"div"),me(1),N()),a&2){let n=w();x(),xe(n.lineDegree)}}var ac=(()=>{let t=class t{changeDetectorRef;translatePipe;model;get precision(){return this.model.attributes.Measure?this.model.attributes.Measure.X[0].D:2}get lineDegree(){if(!this.isLineDimension())return null;let{sp:e,ep:i}=this.model.attributes.coordinates;return Zs.getTheta2(e.x,e.y,i.x,i.y).toFixed(Math.log10(this.precision))}get toolName(){return this.isLineDimension()?this.translatePipe.transform("DISTANCE"):this.isPolyLineDimension()?this.translatePipe.transform("PERIMETER"):this.isPolygonDimension()?this.translatePipe.transform("AREA"):this.translatePipe.transform("UNKNOWN")}get toolValue(){let e=ql.calcMeasurement(this.model);return e.length===0?"0":(Bt.isPolygonDimension(this.model)&&(e+=this.translatePipe.transform("SQUARE_OF")),e)}constructor(e,i){this.changeDetectorRef=e,this.translatePipe=i}isLineDimension(){return Bt.isLineDimension(this.model)}isPolyLineDimension(){return Bt.isPolyLineDimension(this.model)}isPolygonDimension(){return Bt.isPolygonDimension(this.model)}detectChanges(){this.changeDetectorRef.markForCheck()}};A(t,"\u0275fac",function(i){return new(i||t)(v(ye),v(Ve))}),A(t,"\u0275cmp",Ce({type:t,selectors:[["sd-measure-body"]],inputs:{model:"model"},standalone:!1,features:[be([Z])],decls:16,vars:12,consts:[[1,"title"],[1,"property"],[1,"keys"],[4,"ngIf"],[1,"values"]],template:function(i,r){i&1&&(R(0,"div",0),me(1),G(2,"translate"),N(),R(3,"div",1)(4,"div",2)(5,"div"),me(6),N(),se(7,su,3,3,"div",3)(8,au,3,3,"div",3)(9,cu,3,3,"div",3),N(),R(10,"div",4)(11,"div"),me(12),N(),se(13,lu,2,1,"div",3)(14,pu,2,1,"div",3)(15,du,2,1,"div",3),N()()),i&2&&(x(),Hs("",r.toolName," ",Y(2,10,"TOOL"),""),x(5),xe(r.toolName),x(),O("ngIf",r.model.attributes.Measure),x(),O("ngIf",r.model.attributes.Measure),x(),O("ngIf",r.isLineDimension()),x(3),xe(r.toolValue),x(),O("ngIf",r.model.attributes.Measure),x(),O("ngIf",r.model.attributes.Measure),x(),O("ngIf",r.isLineDimension()))},styles:[".title[_ngcontent-%COMP%]{font-size:14px;line-height:24px;font-family:NotoSans-Medium,sans-serif;color:var(--mono-99);margin-bottom:14px}.property[_ngcontent-%COMP%]{display:flex}.property[_ngcontent-%COMP%]   div.keys[_ngcontent-%COMP%]{font-size:13px;line-height:22px;font-family:NotoSans-Medium,sans-serif;color:var(--mono-99);margin-right:16px}.property[_ngcontent-%COMP%]   div.keys[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:not(:first-child){margin-top:2px}.property[_ngcontent-%COMP%]   div.values[_ngcontent-%COMP%]{font-size:13px;line-height:22px;font-family:NotoSans-Regular,sans-serif;color:var(--mono-70);flex-grow:1}.property[_ngcontent-%COMP%]   div.values[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:not(:first-child){margin-top:2px}"],changeDetection:0}));let a=t;return a})();var ed=(()=>{let t=class t{};A(t,"\u0275fac",function(i){return new(i||t)}),A(t,"\u0275mod",Jt({type:t})),A(t,"\u0275inj",Xt({imports:[Ui,Cn]}));let a=t;return a})();ti(ac,[lt],[Ve]);ti(Ma,[lt,Gt,ac],[]);function hu(a,t){a&1&&X(0,"sd-measure-indicator")}function uu(a,t){a&1&&X(0,"sd-page-indicator")}var cc=(()=>{let t=class t{subscriptionService;store$;changeDetectorRef;hidableMenus={};get RuntimeEnvKey(){return ne}get runtimeEnv(){return K}get WindowUtil(){return Q}get HidableView(){return V}constructor(e,i,r){this.subscriptionService=e,this.store$=i,this.changeDetectorRef=r}ngOnInit(){this.subscriptionService.push(this.store$.pipe(bi([V.INDICATOR_MEASURE,V.INDICATOR_PAGE])).subscribe({next:e=>{Object.assign(this.hidableMenus,e),this.changeDetectorRef.markForCheck()}}))}};A(t,"\u0275fac",function(i){return new(i||t)(v(Z),v(Ee),v(ye))}),A(t,"\u0275cmp",Ce({type:t,selectors:[["sd-bottom-right-indicator"]],standalone:!1,features:[be([Z])],decls:2,vars:2,consts:[[4,"ngIf"]],template:function(i,r){i&1&&se(0,hu,1,0,"sd-measure-indicator",0)(1,uu,1,0,"sd-page-indicator",0),i&2&&(O("ngIf",r.runtimeEnv.get(r.RuntimeEnvKey.MEASURE_INDICATOR)&&!r.hidableMenus[r.HidableView.INDICATOR_MEASURE]),x(),O("ngIf",!r.WindowUtil.isMobile()&&r.runtimeEnv.get(r.RuntimeEnvKey.PAGE_INDICATOR)&&!r.hidableMenus[r.HidableView.INDICATOR_PAGE]))},styles:["[_nghost-%COMP%]{position:absolute;display:flex;bottom:0;right:0;padding-bottom:40px;flex-direction:column}@media screen and (max-width: 709px){[_nghost-%COMP%]{padding-bottom:82px}}"],changeDetection:0}));let a=t;return a})();var gu=["img"];function fu(a,t){a&1&&X(0,"sd-loader")}var vo=function(a){return a.VISIBLE="visible",a.INVISIBLE="invisible",a}(vo||{}),pc=(()=>{let t=class t{pageService;changeDetectorRef;scrollController;renderer;documentService;contentService;subscriptionService;renderingService;store$;muPDFService;imgEl;MAX_WIDTH=200;MAX_HEIGHT=200;MARGIN=12;pdfPages;containerStyles={};imgStyles={};imgData;imgWidth;imgHeight;doc;changesSrc=new Bi;currentViewRect;currentPageNo;thumbnailRatio;currentRotation=0;cachedImageData;renderedPageNo;renderingMode=Ci.SERVER;get imgLoaded(){return this.imgEl?.nativeElement.style.visibility==="inherit"}get pageIndicatorVisible(){return this.pdfPages?.length&&this._pageIndicatorVisible||vo.INVISIBLE}set pageIndicatorVisible(e){this._pageIndicatorVisible=e}_pageIndicatorVisible=vo.INVISIBLE;constructor(e,i,r,l,g,S,y,I,B,ee){this.pageService=e,this.changeDetectorRef=i,this.scrollController=r,this.renderer=l,this.documentService=g,this.contentService=S,this.subscriptionService=y,this.renderingService=I,this.store$=B,this.muPDFService=ee}ngOnInit(){this.initSubscription()}initSubscription(){this.subscriptionService.push(this.store$.pipe(H("currentPageNo")).pipe(Fn(),L(e=>this.currentPageNo!==e)).subscribe({next:e=>{this.currentPageNo=e,this.imgEl&&J.setVisibility(this.imgEl.nativeElement,!1,this.renderer,!0),this.changesSrc.next()}}),this.pageService.pdfPages$.subscribe({next:e=>{this.pdfPages=e,this.changesSrc.next()}}),this.documentService.openedDocument$.pipe(L(F.isDefined)).subscribe({next:e=>{this.doc=e,this.changesSrc.next()}}),this.store$.pipe(H("degree")).subscribe({next:e=>{this.currentRotation=e,this.changesSrc.next()}}),this.pageService.pageArrangeEvt$.pipe(L(e=>this.pageService.arrangeAffectedChecker(this.pageNo-1,e))).subscribe({next:()=>{J.setVisibility(this.imgEl.nativeElement,!1,this.renderer,!0),this.renderedPageNo=-1,this.cachedImageData=null,this.changesSrc.next()}}),this.store$.pipe(H("renderingMode"),ct(e=>this.renderingMode=e),L(e=>e===Ci.HYBRID),ut(()=>this.muPDFService.document$.pipe(L(e=>e.status==="OPENED")))).subscribe({next:()=>{this.renderedPageNo=-1,this.cachedImageData=null,this.fetch(),this.updatePage()}}),this.scrollController.currentViewRect$.pipe(L(F.isDefined),ct(e=>{this.currentViewRect=e.rect,this.updatePage()})).subscribe({next:()=>this.changesSrc.next()}),this.changesSrc.pipe(ct(()=>{this.detectChanges(),this.pageIndicatorVisible=vo.VISIBLE}),ri(50)).subscribe({next:()=>this.fetch()}),this.changesSrc.pipe(ri(2e3)).subscribe({next:()=>{this.pageIndicatorVisible=vo.INVISIBLE,this.renderedPageNo=-1,this.detectChanges()}}),this.contentService.reload$.pipe(ze(e=>e.pageInfo),L(F.isDefined),L(e=>e[this.pageNo-1]),ut(()=>Oo(()=>this.renderingMode!==Ci.CLIENT?xt(void 0):this.muPDFService.document$.pipe(L(e=>e.status==="OPENED"))))).subscribe({next:()=>{this.renderedPageNo=-1,this.cachedImageData=null,this.fetch()}}))}get pageNo(){return this.currentPageNo}get highlightRect(){return this.currentViewRect&&this.thumbnailRatio?{x:this.MARGIN+this.currentViewRect.x*this.thumbnailRatio,y:this.MARGIN+this.currentViewRect.y*this.thumbnailRatio,w:this.currentViewRect.w*this.thumbnailRatio,h:this.currentViewRect.h*this.thumbnailRatio}:{x:this.MARGIN,y:this.MARGIN,w:Number(this.imgStyles.width)||0,h:Number(this.imgStyles.height)||0}}updatePage(){if(!this.pageNo||!this.pdfPages||!this.pdfPages.length)return;let{bbox:e,r:i}=this.pdfPages[this.pageNo-1],r=this.MAX_WIDTH-this.MARGIN*2,l=this.MAX_HEIGHT-this.MARGIN*2,g=e.w,S=e.h,y=(i+this.currentRotation)/90%2===1;y&&([g,S]=[S,g]),g<S?(this.thumbnailRatio=l/S,r=g*this.thumbnailRatio):(this.thumbnailRatio=r/g,l=S*this.thumbnailRatio),this.imgWidth=r,this.imgHeight=l,this.imgStyles.display="block",this.imgStyles.width=`${y?l:r}px`,this.imgStyles.height=`${y?r:l}px`,this.imgStyles.transform=`rotate(${i+this.currentRotation}deg)`,this.containerStyles.width=`${r+this.MARGIN*2}px`,this.containerStyles.height=`${l+this.MARGIN*2}px`,this.detectChanges()}fetch(){let e=this.pageNo,i=this.cachedImageData;if(!(!this.doc||this.renderedPageNo===e||!this.pdfPages?.length)){if(i&&i.pageNo===e){if(!this.pageIndicatorVisible)return;setTimeout(()=>{this.renderedPageNo=e,this.imgData=vi({},i.imageData),J.setVisibility(this.imgEl.nativeElement,!0,this.renderer,!0),this.detectChanges()});return}this.subscriptionService.set("httpSubscription",dn([this.renderingService.fetchThumbnail(this.doc.streamdocsId,this.pdfPages[e-1].ref),this.store$.pipe(ko("ALL"),ze(r=>Rn.filterChanges(r,l=>l.allowView?l.range==="all"?!0:!!uo.parse(l.range,{min:0,max:this.pageService.pdfPages.length-1})?.includes(e-1):!1)),ze(r=>Rn.flattenWatermarks(r))),this.pageService.pageArrangeEvt$.pipe(L(r=>r.page===this.pdfPages[e-1]&&r.action==="rotate"),Mo(void 0))]).pipe(ut(([r,l,g])=>{if(r.data===void 0)return this.fetch(),Fs;if(l.length===0)return xt(r);let S;switch(r.type){case"BLOB":S=URL.createObjectURL(r.data);break;case"BASE64":S=r.data;break;default:throw new Tt("Cannot handle image data")}return new Nr({imgSrc:S,width:this.pdfPages[e-1].bbox.w,height:this.pdfPages[e-1].bbox.h,rotation:this.pdfPages[e-1].r},l).draw()})).subscribe({next:r=>{this.pageIndicatorVisible&&(this.cachedImageData={pageNo:e,imageData:vi({},r)},this.renderedPageNo=e,this.imgData=r,J.setVisibility(this.imgEl.nativeElement,!0,this.renderer,!0),this.detectChanges())}}))}}detectChanges(){this.changeDetectorRef.destroyed||this.changeDetectorRef.markForCheck()}};A(t,"\u0275fac",function(i){return new(i||t)(v(Ht),v(ye),v(tn),v(At),v(ot),v(it),v(Z),v(Io),v(Ee),v(Ro))}),A(t,"\u0275cmp",Ce({type:t,selectors:[["sd-page-indicator"]],viewQuery:function(i,r){if(i&1&&Ue(gu,5),i&2){let l;Re(l=Ie())&&(r.imgEl=l.first)}},standalone:!1,features:[be([Z])],decls:12,vars:22,consts:[["img",""],[3,"ngStyle"],["id","img-container",3,"ngStyle"],[4,"ngIf"],[3,"sdImage"],["id","page-ind-mask"],["fill","white"],["fill","black"],["fill","black","stroke","none","opacity","0.1","mask","url(#page-ind-mask)"],["fill","none","stroke","#ff2635","stroke-width","3"]],template:function(i,r){i&1&&(R(0,"div",1)(1,"div",2),se(2,fu,1,0,"sd-loader",3),X(3,"img",4,0),N(),_i(),R(5,"svg",1)(6,"defs")(7,"mask",5),X(8,"rect",6)(9,"rect",7),N()(),X(10,"rect",8)(11,"rect",9),N()()),i&2&&(O("@showState",r.pageIndicatorVisible)("ngStyle",r.containerStyles),x(),O("ngStyle",r.imgStyles),x(),O("ngIf",!r.imgLoaded),x(),O("sdImage",r.imgData),x(2),O("ngStyle",r.containerStyles),x(3),ue("x",r.MARGIN)("y",r.MARGIN)("width",r.imgWidth)("height",r.imgHeight),x(),ue("x",r.highlightRect.x)("y",r.highlightRect.y)("width",r.highlightRect.w)("height",r.highlightRect.h),x(),ue("x",r.MARGIN)("y",r.MARGIN)("width",r.imgWidth)("height",r.imgHeight),x(),ue("x",r.highlightRect.x)("y",r.highlightRect.y)("width",r.highlightRect.w)("height",r.highlightRect.h))},styles:["i.papycon-chevron3-down[_ngcontent-%COMP%]{transform:scale(.5);font-size:18px;line-height:48px;margin:-12px -7.5px;padding:0 6px;transform-origin:50% 50%}i[_ngcontent-%COMP%] + i.papycon-chevron3-down[_ngcontent-%COMP%]{margin:-12px -8.5px;padding:0 8px}i.papycon-chevron3-down.expanded[_ngcontent-%COMP%]{transform:scale(.5) rotate(-180deg)}*[_ngcontent-%COMP%]{pointer-events:none}[_nghost-%COMP%] > div[_ngcontent-%COMP%]{position:relative;background:var(--mono-50);border-radius:2px;display:flex;float:right;align-items:center;justify-content:center;flex-direction:column;margin:12px 35px 0 0;z-index:5}div#img-container[_ngcontent-%COMP%]{display:none;background:#fff;position:relative}div#img-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{position:relative;top:0;left:0;z-index:2}img[_ngcontent-%COMP%]{width:100%;height:auto;visibility:hidden}svg[_ngcontent-%COMP%]{position:absolute;left:0;top:0}"],data:{animation:[jn("showState",[vn(vo.INVISIBLE,Di({opacity:0,display:"none"})),vn(vo.VISIBLE,Di({opacity:1,display:"flex"})),_n(`${vo.VISIBLE} => ${vo.INVISIBLE}`,mn("400ms linear"))])]},changeDetection:0}));let a=t;return a})();var Nn=function(a){return a.VISIBLE="visible",a.INVISIBLE="invisible",a}(Nn||{}),td=(()=>{let t=class t{changeDetectorRef;subscriptionService;translatePipe;store$;labelMap=void 0;showScale=Nn.INVISIBLE;showLayout=Nn.INVISIBLE;scale;viewMode;visibilitySrc=new Bi;constructor(e,i,r,l){this.changeDetectorRef=e,this.subscriptionService=i,this.translatePipe=r,this.store$=l,this.labelMap={0:{icon:"papycon papycon-one-page3",label:this.translatePipe.transform("SINGLE_PAGE_VIEW")},1:{icon:"papycon papycon-one-page-continuous3",label:this.translatePipe.transform("SINGLE_PAGE_CONTINUOUS")},2:{icon:"papycon papycon-two-page3",label:this.translatePipe.transform("TWO_PAGE_VIEW")},3:{icon:"papycon papycon-two-page-continuous3",label:this.translatePipe.transform("TWO_PAGE_CONTINUOUS")},4:{icon:"papycon papycon-one-page",label:this.translatePipe.transform("LAYOUT_INDICATOR_EBOOK")}}}ngOnInit(){this.subscriptionService.push(this.visibilitySrc.pipe(ri(800)).subscribe({next:e=>{this.showScale=e,this.showLayout=e,this.changeDetectorRef.markForCheck()}}),this.store$.pipe(H("scale"),Fn()).subscribe({next:e=>{this.scale=Number(e.toFixed(0)),this.showScale=Nn.VISIBLE,this.changeDetectorRef.markForCheck(),this.visibilitySrc.next(Nn.INVISIBLE)}}),this.store$.pipe(H("viewMode")).subscribe({next:e=>{this.viewMode=e,this.showLayout=Nn.VISIBLE,this.changeDetectorRef.markForCheck(),this.visibilitySrc.next(Nn.INVISIBLE)}}))}};A(t,"\u0275fac",function(i){return new(i||t)(v(ye),v(Z),v(Ve),v(Ee))}),A(t,"\u0275cmp",Ce({type:t,selectors:[["sd-scale-indicator"]],standalone:!1,features:[be([Z])],decls:7,vars:6,consts:[[1,"page-layout"],[1,"page-scale"]],template:function(i,r){i&1&&(R(0,"div",0),X(1,"i"),R(2,"span"),me(3),N()(),R(4,"div",1)(5,"span"),me(6),N()()),i&2&&(O("@showState",r.showLayout),x(),gs(r.labelMap[r.viewMode]==null?null:r.labelMap[r.viewMode].icon),x(2),xe(r.labelMap[r.viewMode]==null?null:r.labelMap[r.viewMode].label),x(),O("@showState",r.showScale),x(2),Tr("",r.scale,"%"))},styles:["[_nghost-%COMP%]{position:absolute;display:flex;left:50%;top:50%;flex-direction:column;align-items:center;transform:translate(-50%,-50%);pointer-events:none}div[_ngcontent-%COMP%]{font-size:20px;line-height:28px;font-family:NotoSans-Medium,sans-serif;box-shadow:0 4px 8px #6c6c6c1f;color:var(--mono-99);display:flex;box-sizing:border-box;align-items:center;justify-content:center;background:var(--mono-10);border:1px solid var(--mono-30);border-radius:4px;text-align:center;cursor:default;z-index:1}div.page-layout[_ngcontent-%COMP%]{width:168px;height:168px;flex-direction:column;margin-bottom:20px}div.page-layout[_ngcontent-%COMP%]   .papycon[_ngcontent-%COMP%]{width:80px;height:80px;font-size:80px;margin-bottom:19px}div.page-scale[_ngcontent-%COMP%]{width:100px;height:50px}"],data:{animation:[jn("showState",[vn(Nn.INVISIBLE,Di({opacity:0,display:"none"})),vn(Nn.VISIBLE,Di({opacity:1,display:"flex"})),_n(`${Nn.VISIBLE} => ${Nn.INVISIBLE}`,mn("400ms linear"))])]},changeDetection:0}));let a=t;return a})();var id=(()=>{let t=class t{};A(t,"\u0275fac",function(i){return new(i||t)}),A(t,"\u0275mod",Jt({type:t})),A(t,"\u0275inj",Xt({imports:[Ui,ca,ed,ta]}));let a=t;return a})();ti(cc,[lt,Ma,pc],[]);ti(Oa,[lt,cc,td],[]);ti(pc,[lt,Gt,_s,ea],[]);var _u=["searchComp"],Su=()=>({standalone:!0}),Ts=a=>({content:a});function Cu(a,t){a&1&&X(0,"div",21)}function bu(a,t){if(a&1){let n=_e();R(0,"button",22),G(1,"translate"),G(2,"translate"),ce("click",function(){W(n);let i=w();return z(i.onClickDetail())}),X(3,"i",23),N()}if(a&2){let n=w();Ye("dark",n.isDarkMode),O("tooltip",_t(9,Ts,Y(1,5,"TEXT_SEARCH_VIEW_TITLE"))),ue("color",n.isDarkMode?"white":"dark")("aria-label",Y(2,7,"TEXT_SEARCH_VIEW_TITLE"))}}function xu(a,t){if(a&1){let n=_e();R(0,"button",14),G(1,"translate"),G(2,"translate"),ce("click",function(){W(n);let i=w();return z(i.useRegex=!i.useRegex)}),X(3,"i",15)(4,"i",24),N()}if(a&2){let n=w();Ye("dark",n.isDarkMode),O("tooltip",_t(17,Ts,Y(1,13,"REGEX"))),ue("aria-label",Y(2,15,"REGEX"))("aria-checked",n.useRegex),x(3),Ye("papycon-rounded-square",!n.useRegex)("papycon-check-mark4-filled",n.useRegex)("active",n.useRegex),x(),Ye("active",n.useRegex)}}var zr=class zr{contentService;pageService;searchService;modalService;changeDetectorRef;subscriptionService;store$;apiEventBridgeService;translatePipe;selectTextService;redactionSerivce;get RuntimeEnvKey(){return ne}get runtimeEnv(){return K}pdfDoc;searchComp;get environment(){return Je}searchedPage=new Set;pageCount;currentPageNo;searchCaseSensitive=!1;useRegex=!1;keyword=F.EMPTY_STRING;currentSelectedWord=0;totalSearchedWord=0;indicatorVisibility=!1;isSearching;searchResult=[];bundleState;pagesLength;pages;isDestroying=!1;isAfterInit=!1;findSearchWordSrc=new Bi;countTotalSearchWordSrc=new Bi;keepSearchState=!1;checkWordCounting=!1;screenTheme;get isDarkMode(){return this.screenTheme==="light"?!1:this.screenTheme==="dark"||window.matchMedia("(prefers-color-scheme: dark)")?.matches}get isMobile(){return Q.isMobile()}get searchIndicatorText(){return this.indicatorVisibility&&this.currentSelectedWord>0?`${this.currentSelectedWord} / ${this.totalSearchedWord}`:""}constructor(t,n,e,i,r,l,g,S,y,I,B){this.contentService=t,this.pageService=n,this.searchService=e,this.modalService=i,this.changeDetectorRef=r,this.subscriptionService=l,this.store$=g,this.apiEventBridgeService=S,this.translatePipe=y,this.selectTextService=I,this.redactionSerivce=B}ngOnInit(){this.subscriptionService.push(this.store$.pipe(ii("screenTheme")).subscribe({next:t=>{this.screenTheme=t,this.changeDetectorRef.markForCheck()}}),this.store$.pipe(H("pageCount")).subscribe({next:t=>this.pageCount=t}),this.store$.pipe(H("currentPageNo")).subscribe({next:t=>this.currentPageNo=t}),this.pageService.pdfPages$.subscribe({next:t=>{this.pages=t,this.pagesLength=t?.length??0}}),this.findSearchWordSrc.pipe(ri(10)).subscribe({next:t=>this.initSearch(t)}),this.selectTextService.publishSelectedText$.pipe(L(()=>!this.isAfterInit),L(F.isDefined),ao(1)).subscribe({next:t=>this.keyword=t.text}),this.redactionSerivce.redactionReloadTextSearchResult$.subscribe({next:()=>{this.resubscribeSearchEvent(),this.searchStart(!0)}})),this.searchService.searchState.keyword&&(this.keyword=this.searchService.searchState.keyword,this.searchCaseSensitive=this.searchService.searchState.searchCaseSensitive,this.useRegex=this.searchService.searchState.useRegex,this.searchService.searchState.startPageIndex===-1&&(this.searchService.searchState.startPageIndex=this.searchService.searchState.pageIndex),(this.searchService.searchState.wordIndex===-1||this.searchService.searchState.pageIndex!==this.currentPageNo-1)&&(this.searchService.initSearchState(),this.searchService.bundle.bundle.splice(0))),this.apiEventBridgeService.searchToolVisibilityChangedSrc.next({ok:!0,data:void 0})}resubscribeSearchEvent(){let t=5,n=10,e=Math.max(Math.min(Math.ceil(this.pagesLength/10),100),10),i=0;this.subscriptionService.set("searchSub",this.countTotalSearchWordSrc.pipe(Mo({keyword:F.EMPTY_STRING,caseSensitive:this.searchCaseSensitive,regex:this.useRegex,streamdocsId:this.pdfDoc.streamdocsId,isForwardSearch:!0}),ri(100),Fn((r,l)=>r.keyword===l.keyword&&r.caseSensitive===l.caseSensitive&&r.regex===l.regex&&r.streamdocsId===l.streamdocsId?(this.bundleState.bundle[0].numOfItem&&this.findSearchWordSrc.next(l.isForwardSearch),!0):(t=5,i=0,!1)),L(r=>r.keyword!==F.EMPTY_STRING),ct(r=>{this.bundleState||(this.bundleState={bundle:[],activeIndex:0},this.searchService.bundle=this.bundleState),this.searchService.searchState.keyword!==r.keyword&&(this.contentService.clearSearchHighlight(),this.searchService.initSearchState(),this.searchService.searchState.keyword=r.keyword),this.indicatorVisibility=!0,this.checkWordCounting=!1,this.totalSearchedWord=0,this.currentSelectedWord=0,this.searchService.searchState.streamdocsId=r.streamdocsId,this.searchService.searchState.searchCaseSensitive=r.caseSensitive,this.searchService.searchState.useRegex=r.regex,this.bundleState.bundle=[],this.bundleState.activeIndex=0,this.pushNewBundle(),this.changeDetectorRef.markForCheck()}),ut(r=>this.searchService.getSearchResult(r.streamdocsId,r.keyword,r.caseSensitive,r.regex,this.getPageIndexes(0,n)).pipe(ul((l,g)=>{let S=--t>0?n:e,y=t>0?(g+1)*S:i;return y>=this.pagesLength?xt(null):(this.isSearching=!0,i=y+S,this.searchService.getSearchResult(r.streamdocsId,r.keyword,r.caseSensitive,r.regex,this.getPageIndexes(y,S)))}),ct(l=>{l===null&&(this.checkWordCounting=!0)}),gl(F.isDefined),tr(()=>{!this.totalSearchedWord&&this.checkWordCounting&&(this.indicatorVisibility=!0),this.isSearching=!1,this.searchComp.onFocus(),this.changeDetectorRef.markForCheck()})))).subscribe({next:r=>{let l=this.bundleState.bundle[this.bundleState.bundle.length-1],g=r.length;for(let S=0;S<g;S++)l.numOfItem>100&&(l=this.pushNewBundle()),l.results.push(r[S]),l.numOfItem+=r[S].words.length,this.currentSelectedWord===0&&(this.currentSelectedWord=1,this.indicatorVisibility=!0),this.totalSearchedWord+=r[S].words.length;this.bundleState.bundle[this.bundleState.bundle.length-1]=vi({},l),this.changeDetectorRef.markForCheck()},error:()=>{this.clear(),this.modalService.createCommonModal({type:Ut.ERROR,title:this.translatePipe.transform("SERVER_ERROR_TITLE"),content:this.translatePipe.transform("SERVER_ERROR_MESSAGE"),confirmButton:!0,confirmLabel:this.translatePipe.transform("CLOSE")})}}))}onKeyDown(t){if(t.key==="Enter"&&t.shiftKey){this.searchStart(!1);return}t.key==="Enter"&&this.searchStart(!0)}clear(){this.resubscribeSearchEvent(),this.bundleState&&(this.bundleState.bundle=[],this.bundleState.activeIndex=0),this.keyword=F.EMPTY_STRING,this.contentService.clearSearchHighlight()}getPageIndexes(t,n){let e=[],i=Math.min(t+n,this.pages.length);for(let r=t;r<i;++r)e.push(r);return e}pushNewBundle(){return this.bundleState.bundle[this.bundleState.bundle.push({numOfItem:0,results:[]})-1]}ngOnDestroy(){this.isDestroying=!0,this.keepSearchState||(this.contentService.clearSearchHighlight(),this.searchService.initSearchState()),this.searchResult.splice(0),this.apiEventBridgeService.searchToolVisibilityChangedSrc.next({ok:!0,data:void 0})}ngAfterViewInit(){this.isAfterInit=!0,this.resubscribeSearchEvent(),this.keyword!==F.EMPTY_STRING&&this.searchStart(!0),this.searchComp.onFocus()}searchStart(t){(!this.searchService.searchState.keyword||this.searchService.searchState.keyword!==this.keyword)&&this.findSearchWordSrc.next(t),this.publishCountTotalSearchWord(this.pdfDoc.streamdocsId,this.keyword,this.searchCaseSensitive,this.useRegex,t)}onClearWord(){this.indicatorVisibility=!1,this.isSearching=!1,this.currentSelectedWord=0,this.totalSearchedWord=0,this.searchService.searchState.keyword="",this.searchComp.onFocus(),this.clear()}onClickDetail(){this.keyword===""&&(this.searchService.bundle=null),this.keepSearchState=!0,this.close(),this.store$.dispatch(he.set({key:"rightSideViewMode",value:Nt.TextSearch})),this.store$.dispatch(he.set({key:"rightSideViewVisible",value:!0}))}initSearch(t){if(this.pdfDoc){if(this.changeDetectorRef.markForCheck(),this.keyword.length===0){this.isSearching=!1,this.changeDetectorRef.markForCheck();return}else if(this.keyword===this.searchService.searchState.keyword&&this.searchCaseSensitive===this.searchService.searchState.searchCaseSensitive&&this.useRegex===this.searchService.searchState.useRegex&&this.pdfDoc.streamdocsId===this.searchService.searchState.streamdocsId&&this.searchResult[this.searchService.searchState.pageIndex]){this.gotoNextWord(t);return}this.searchResult.splice(0),this.searchService.searchState.searchCaseSensitive=this.searchCaseSensitive,this.searchService.searchState.useRegex=this.useRegex,this.searchService.searchState.keyword=this.keyword,this.searchService.searchState.pageIndex=this.currentPageNo-1,this.searchService.searchState.wordIndex=-1,this.searchService.searchState.streamdocsId=this.pdfDoc.streamdocsId,this.searchService.searchState.startPageIndex=this.searchService.searchState.pageIndex,this.findWord(t)}}close(){this.store$.dispatch(he.set({key:"searchToolActive",value:!1}))}gotoNextWord(t){let n=this.searchResult[this.searchService.searchState.pageIndex].length;if(t){if(this.currentSelectedWord++,this.currentSelectedWord>this.totalSearchedWord&&(this.currentSelectedWord=1),this.searchService.searchState.wordIndex+1===n){this.gotoNextPage(t);return}this.searchService.searchState.wordIndex++}else{if(this.currentSelectedWord--,this.currentSelectedWord===0&&(this.currentSelectedWord=this.totalSearchedWord),this.searchService.searchState.wordIndex-1<0){this.gotoNextPage(t);return}this.searchService.searchState.wordIndex--}this.activateWord()}gotoNextPage(t){if(this.searchedPage.add(this.searchService.searchState.pageIndex),t?(this.searchService.searchState.pageIndex++,this.searchService.searchState.pageIndex%=this.pageCount):(this.searchService.searchState.pageIndex--,this.searchService.searchState.pageIndex===-1&&(this.searchService.searchState.pageIndex=this.pageCount-1)),this.searchedPage.size===this.pageCount){this.isSearching=!1,this.searchService.searchState.wordIndex=-1,this.searchService.searchState.startPageIndex!==this.searchService.searchState.pageIndex-1&&this.findWord(t),this.searchedPage.clear(),this.changeDetectorRef.markForCheck();return}this.searchService.searchState.wordIndex=-1,this.findWord(t)}findWord(t){if(!this.isDestroying){if(this.searchResult[this.searchService.searchState.pageIndex]){this.validateWord(t);return}this.subscriptionService.set("dataSub",this.searchService.getSearchResult(this.pdfDoc.streamdocsId,this.searchService.searchState.keyword,this.searchService.searchState.searchCaseSensitive,this.searchService.searchState.useRegex,[this.searchService.searchState.pageIndex]).subscribe({next:n=>{this.isDestroying||(this.searchResult[this.searchService.searchState.pageIndex]=n.length?n[0].words:[],this.validateWord(t))},error:()=>{this.searchService.searchState.keyword=F.EMPTY_STRING,this.isSearching=!1,this.modalService.createCommonModal({type:Ut.ERROR,title:this.translatePipe.transform("SERVER_ERROR_TITLE"),content:this.translatePipe.transform("SERVER_ERROR_MESSAGE"),confirmButton:!0})}}))}}validateWord(t){if(this.searchResult[this.searchService.searchState.pageIndex].length>0){if(this.searchService.searchState.wordIndex===-1)this.searchService.searchState.wordIndex=t?0:this.searchResult[this.searchService.searchState.pageIndex].length-1;else{this.gotoNextWord(t);return}this.activateWord()}else this.gotoNextPage(t)}activateWord(){let t=this.searchService.searchState.pageIndex;this.searchService.activateWord(this.searchResult[t][this.searchService.searchState.wordIndex],this.pages[t]),this.changeDetectorRef.markForCheck()}publishCountTotalSearchWord(t,n,e,i,r){this.countTotalSearchWordSrc.next({keyword:n,caseSensitive:e,regex:i,streamdocsId:t,isForwardSearch:r})}};A(zr,"\u0275fac",function(n){return new(n||zr)(v(it),v(Ht),v(Ur),v(Ki),v(ye),v(Z),v(Ee),v(Ei),v(Ve),v(Fo),v(kr))}),A(zr,"\u0275cmp",Ce({type:zr,selectors:[["sd-search-tool"]],viewQuery:function(n,e){if(n&1&&Ue(_u,7),n&2){let i;Re(i=Ie())&&(e.searchComp=i.first)}},inputs:{pdfDoc:"pdfDoc"},standalone:!1,features:[be([Z,{provide:Bn,useValue:new Yt(300)}])],decls:37,vars:74,consts:[["searchComp",""],[1,"header"],["tabindex","0"],["class","spin-loader",4,"ngIf"],[1,"right"],["class","ep-text-button",3,"dark","tooltip","click",4,"ngIf"],[1,"ep-text-button",3,"click"],[1,"papycon","papycon-cross"],[1,"input-row"],["size","small",3,"ngModelChange","keydown","clear","maxLength","placeholder","ngModelOptions","ariaLabel","useClearButton","subtext","ngModel"],["size","small","color","primary",1,"ep-button","search",3,"click"],[1,"papycon","papycon-search"],[1,"buttons"],[1,"left"],["role","switch","size","tiny","color","white",1,"ep-button",3,"click","tooltip"],[1,"papycon","checkbox"],[1,"papycon","papycon-case-sensitive"],["class","ep-button","role","switch","size","tiny","color","white",3,"dark","tooltip","click",4,"ngIf"],["size","tiny","color","white",1,"ep-button",3,"click","title","tooltip","disabled"],[1,"papycon","papycon-previous-symbol2"],[1,"papycon","papycon-next-symbol2"],[1,"spin-loader"],[1,"ep-text-button",3,"click","tooltip"],[1,"papycon","papycon-extend"],[1,"papycon","papycon-regular-expression"]],template:function(n,e){if(n&1){let i=_e();R(0,"nav",1)(1,"span",2),me(2),G(3,"translate"),N(),se(4,Cu,1,0,"div",3),R(5,"section",4),se(6,bu,4,11,"button",5),R(7,"button",6),G(8,"translate"),ce("click",function(){return W(i),z(e.close())}),X(9,"i",7),N()()(),R(10,"nav",8)(11,"pu-input",9,0),G(13,"translate"),G(14,"translate"),yi("ngModelChange",function(l){return W(i),wi(e.keyword,l)||(e.keyword=l),z(l)}),ce("keydown",function(l){return W(i),z(e.onKeyDown(l))})("clear",function(){return W(i),z(e.onClearWord())}),N(),R(15,"button",10),G(16,"translate"),ce("click",function(){return W(i),z(e.searchStart(!0))}),X(17,"i",11),N()(),R(18,"nav",12)(19,"section",13)(20,"button",14),G(21,"translate"),G(22,"translate"),ce("click",function(){return W(i),z(e.searchCaseSensitive=!e.searchCaseSensitive)}),X(23,"i",15)(24,"i",16),N(),se(25,xu,5,19,"button",17),N(),R(26,"section",4)(27,"button",18),G(28,"translate"),G(29,"translate"),G(30,"translate"),ce("click",function(){return W(i),z(e.searchStart(!1))}),X(31,"i",19),N(),R(32,"button",18),G(33,"translate"),G(34,"translate"),G(35,"translate"),ce("click",function(){return W(i),z(e.searchStart(!0))}),X(36,"i",20),N()()()}n&2&&(x(2),xe(Y(3,41,"QUICK_SEARCH")),x(2),O("ngIf",e.isSearching),x(2),O("ngIf",e.runtimeEnv.get(e.RuntimeEnvKey.FULL_SEARCH_BUTTON)),x(),Ye("dark",e.isDarkMode),ue("color",e.isDarkMode?"white":"dark")("aria-label",Y(8,43,"CLOSE")),x(4),O("maxLength",e.environment.textSearchLengthLimit)("placeholder",Y(13,45,"SEARCH"))("ngModelOptions",Or(67,Su))("ariaLabel",Y(14,47,"SEARCH_TEXT"))("useClearButton",!0)("subtext",e.searchIndicatorText),Mi("ngModel",e.keyword),x(4),ue("aria-label",Y(16,49,"SEARCH")),x(5),Ye("dark",e.isDarkMode),O("tooltip",_t(68,Ts,Y(21,51,"CASE_SENSITIVE"))),ue("aria-label",Y(22,53,"CASE_SENSITIVE"))("aria-checked",e.searchCaseSensitive),x(3),Ye("papycon-rounded-square",!e.searchCaseSensitive)("papycon-check-mark4-filled",e.searchCaseSensitive)("active",e.searchCaseSensitive),x(),Ye("active",e.searchCaseSensitive),x(),O("ngIf",e.runtimeEnv.get(e.RuntimeEnvKey.TEXT_SEARCH_VIEW_REGEX)),x(2),Ye("disabled",!e.totalSearchedWord||!e.keyword),O("title",e.isMobile?"":Y(28,55,"BACKWARD_SEARCH"))("tooltip",_t(70,Ts,Y(29,57,"BACKWARD_SEARCH")))("disabled",!e.totalSearchedWord||!e.keyword),ue("aria-label",Y(30,59,"BACKWARD_SEARCH")),x(5),Ye("disabled",!e.totalSearchedWord||!e.keyword),O("title",e.isMobile?"":Y(33,61,"FORWARD_SEARCH"))("tooltip",_t(72,Ts,Y(34,63,"FORWARD_SEARCH")))("disabled",!e.totalSearchedWord||!e.keyword),ue("aria-label",Y(35,65,"FORWARD_SEARCH")))},styles:["i.papycon-chevron3-down[_ngcontent-%COMP%]{transform:scale(.5);font-size:18px;line-height:48px;margin:-12px -7.5px;padding:0 6px;transform-origin:50% 50%}i[_ngcontent-%COMP%] + i.papycon-chevron3-down[_ngcontent-%COMP%]{margin:-12px -8.5px;padding:0 8px}i.papycon-chevron3-down.expanded[_ngcontent-%COMP%]{transform:scale(.5) rotate(-180deg)}[_nghost-%COMP%]{box-shadow:0 4px 32px #6c6c6c1f;position:absolute;display:flex;bottom:8px;left:50%;transform:translate(-50%,-50%);width:300px;height:auto;flex-direction:column;box-sizing:border-box;padding:16px;border-radius:2px;background:var(--mono-00);z-index:5}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.header[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:14px;line-height:24px;font-family:NotoSans-Medium,sans-serif;color:var(--mono-99)}.header[_ngcontent-%COMP%]   .spin-loader[_ngcontent-%COMP%]{margin-right:auto;margin-left:10px;width:22px;height:22px;pointer-events:none}.header[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]{display:flex}.header[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:24px;height:24px;border-width:0;outline-offset:-2px}.header[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]{color:var(--mono-90)}.header[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]:not(:disabled):hover{color:#d7d7d7}.header[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]   button[_ngcontent-%COMP%] + button[_ngcontent-%COMP%]{margin-left:12px}.input-row[_ngcontent-%COMP%]{position:relative;display:flex;width:100%;margin-top:8px}.input-row[_ngcontent-%COMP%]   pu-input[_ngcontent-%COMP%]{width:calc(100% - 44px)}.input-row[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]{position:absolute;top:50%;right:0;transform:translateY(-50%);display:flex;justify-content:center;width:46px;height:40px}.input-row[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:var(--mono-00)}.buttons[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-top:12px}.buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:4px 8px}.buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   .papycon[_ngcontent-%COMP%]{font-size:22px}.buttons[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:var(--button-background);border:1px solid var(--button-border);color:var(--mono-70)}.buttons[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%]   button[_ngcontent-%COMP%] + button[_ngcontent-%COMP%]{margin-left:8px}.buttons[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   .active[_ngcontent-%COMP%]{color:var(--primary-50)}.buttons[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   .checkbox[_ngcontent-%COMP%]{font-size:20px}.buttons[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   .papycon[_ngcontent-%COMP%] + .papycon[_ngcontent-%COMP%]{margin-left:6px}.buttons[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:var(--button-background);border:1px solid var(--button-border)}.buttons[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:not(.disabled){color:var(--mono-70)}.buttons[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]   button[_ngcontent-%COMP%] + button[_ngcontent-%COMP%]{margin-left:8px}"],changeDetection:0}));var Gr=zr;Qe([st(nt.searchToolComp.search),st(nt.searchToolComp.searchWithRegex),st(nt.searchToolComp.searchWithCaseSensitive)],Gr.prototype,"publishCountTotalSearchWord",null);function Tu(a,t){if(a&1&&(_i(),X(0,"path")),a&2){let n=t.$implicit;ue("d",n.path)("fill",n.color)}}var od=(()=>{let t=class t{apiHighlightService;changeDetectorRef;subscriptionService;pdfPage;renderingInfo=[];constructor(e,i,r){this.apiHighlightService=e,this.changeDetectorRef=i,this.subscriptionService=r}ngOnInit(){this.subscriptionService.push(this.apiHighlightService.highlightInfoMapChange$.pipe(L(e=>e.pageIndex===this.pdfPage.i)).subscribe({next:e=>this.updatePath()})),this.updatePath()}updatePath(){let e=this.apiHighlightService.highlightInfoMap[this.pdfPage.i];if(!e)return;let i={};e.forEach(r=>{i[r.color]?i[r.color]+=` ${r.path}`:i[r.color]=r.path}),this.renderingInfo.splice(0),Object.keys(i).forEach(r=>{this.renderingInfo.push({color:r,path:i[r]})}),this.changeDetectorRef.markForCheck()}};A(t,"\u0275fac",function(i){return new(i||t)(v(Uo),v(ye),v(Z))}),A(t,"\u0275cmp",Ce({type:t,selectors:[["sd-api-highlight"]],inputs:{pdfPage:"pdfPage"},standalone:!1,features:[be([Z])],decls:2,vars:1,consts:[[4,"ngFor","ngForOf"]],template:function(i,r){i&1&&(_i(),R(0,"svg"),se(1,Tu,1,2,"path",0),N()),i&2&&(x(),O("ngForOf",r.renderingInfo))},dependencies:[Si],styles:["svg[_ngcontent-%COMP%]{mix-blend-mode:multiply;position:absolute;width:100%;height:100%;top:0;left:0}"],changeDetection:0}));let a=t;return a})();var Qt=function(a){return a[a.CREATING=0]="CREATING",a[a.EDITING=1]="EDITING",a[a.READY=2]="READY",a[a.NONE=3]="NONE",a}(Qt||{}),_o=function(a){return a[a.DOWNLOAD=0]="DOWNLOAD",a[a.COPY=1]="COPY",a}(_o||{}),Gn=function(a){return a.LEFT="left",a.CENTER="center",a.RIGHT="right",a}(Gn||{}),Yn=function(a){return a.TOP="top",a.MIDDLE="middle",a.BOTTOM="bottom",a}(Yn||{}),dc=function(a){return a.PNG="png",a.JPEG="jpeg",a.WEBP="webp",a}(dc||{});var on=(()=>{let t=class t{store$;MIN_BBOX_SIZE=20;INITIAL_CAPTURED_AREA={bbox:{x:0,y:0,w:0,h:0},pageIndex:-1,status:Qt.NONE};lastestMousePositionSrc=new Bi;lastestMousePosition$=this.lastestMousePositionSrc.asObservable();capturedAreaSrc=new Yt(this.INITIAL_CAPTURED_AREA);capturedArea$=this.capturedAreaSrc.asObservable();get capturedArea(){return this.capturedAreaSrc.getValue()}captureActionSrc=new Bi;captureAction$=this.captureActionSrc.asObservable();constructor(e){this.store$=e}publishCapture(e){this.capturedAreaSrc.next(e)}updateCaptureBBox(e){this.capturedAreaSrc.next(Cr(vi({},this.capturedArea),{bbox:e}))}updateCaptureStatus(e){this.capturedAreaSrc.next(Cr(vi({},this.capturedArea),{status:e}))}publishLastestMousePosition(e){this.lastestMousePositionSrc.next(e)}fireCaptureAction(e){this.captureActionSrc.next(e)}exitCaptureMode(){this.capturedAreaSrc.next(this.INITIAL_CAPTURED_AREA),this.store$.dispatch(he.set({key:"isCaptureMode",value:!1}))}};A(t,"\u0275fac",function(i){return new(i||t)(Ze(Ee))}),A(t,"\u0275prov",Oi({token:t,factory:t.\u0275fac}));let a=t;return a})();function Mu(a,t){a&1&&Pn(0)}function wu(a,t){if(a&1){let n=_e();R(0,"div",4),ce("mousedown",function(i){return W(n),z(i.stopPropagation())}),se(1,Mu,1,0,"ng-container",5),X(2,"div",6),R(3,"i",7),ce("click",function(){W(n);let i=w();return z(i.exitCaptureMode())}),N()()}if(a&2){let n=w(),e=ei(3),i=ei(5);x(),O("ngIf",n.showButton)("ngIfThen",i)("ngIfElse",e)}}function yu(a,t){a&1&&(R(0,"div",8)(1,"span"),me(2),G(3,"translate"),N()()),a&2&&(x(2),xe(Y(3,1,"DRAG_CAPTURE_AREA")))}function Eu(a,t){if(a&1){let n=_e();R(0,"button",11),ce("click",function(){W(n);let i=w(2);return z(i.onClickCopy())}),X(1,"i",13),R(2,"span"),me(3),N()()}if(a&2){let n=w(2);x(3),xe(n.copyToClipboardText)}}function Pu(a,t){if(a&1){let n=_e();R(0,"div",9),se(1,Eu,4,1,"button",10),R(2,"button",11),ce("click",function(){W(n);let i=w();return z(i.onClickDownload())}),X(3,"i",12),R(4,"span"),me(5),G(6,"translate"),N()()()}if(a&2){let n=w();x(),O("ngIf",n.isSecureContext),x(4),xe(Y(6,2,"DOWNLOAD"))}}var wa=(()=>{let t=class t{captureSerivce;subscriptionService;shortcutService;changeDetectorRef;translatePipe;showFloating=!0;showButton=!1;get isSecureContext(){return Q.nativeWindow.isSecureContext}get copyToClipboardText(){return Q.isSmallWidth()?this.translatePipe.transform("CAPTURE_EXPORT_TO_CLIPBOARD"):`${this.translatePipe.transform("CAPTURE_EXPORT_TO_CLIPBOARD")}
      (${li.getShortcutString({ctrlKey:!0,shiftKey:!1,altKey:!1,key:"c"})})`}constructor(e,i,r,l,g){this.captureSerivce=e,this.subscriptionService=i,this.shortcutService=r,this.changeDetectorRef=l,this.translatePipe=g}ngOnInit(){this.subscriptionService.push(this.captureSerivce.capturedArea$.subscribe({next:e=>{this.showFloating=e.status===Qt.READY||e.status===Qt.NONE,this.showButton=e.status===Qt.READY,this.changeDetectorRef.markForCheck()}}),this.shortcutService.getShortcutEvent(Ae.ESCAPE).subscribe({next:()=>this.exitCaptureMode()}),Q.windowResize$.subscribe({next:()=>this.changeDetectorRef.markForCheck()}))}exitCaptureMode(){this.captureSerivce.exitCaptureMode()}onClickCopy(){this.captureSerivce.fireCaptureAction(_o.COPY)}onClickDownload(){this.captureSerivce.fireCaptureAction(_o.DOWNLOAD)}};A(t,"\u0275fac",function(i){return new(i||t)(v(on),v(Z),v(Hi),v(ye),v(Ve))}),A(t,"\u0275cmp",Ce({type:t,selectors:[["sd-capture-backdrop"]],standalone:!1,features:[be([Z])],decls:6,vars:1,consts:[["close",""],["buttons",""],[1,"capture-backdrop"],["class","capture-floating",3,"mousedown",4,"ngIf"],[1,"capture-floating",3,"mousedown"],[4,"ngIf","ngIfThen","ngIfElse"],[1,"divider"],[1,"papycon","papycon-cross",3,"click"],[1,"text"],[1,"buttons"],["class","ep-button","size","tiny",3,"click",4,"ngIf"],["size","tiny",1,"ep-button",3,"click"],[1,"papycon","papycon-download"],[1,"papycon","papycon-copy"]],template:function(i,r){i&1&&(X(0,"div",2),se(1,wu,4,3,"div",3)(2,yu,4,3,"ng-template",null,0,ci)(4,Pu,7,4,"ng-template",null,1,ci)),i&2&&(x(),O("ngIf",r.showFloating))},styles:["i.papycon-chevron3-down[_ngcontent-%COMP%]{transform:scale(.5);font-size:18px;line-height:48px;margin:-12px -7.5px;padding:0 6px;transform-origin:50% 50%}i[_ngcontent-%COMP%] + i.papycon-chevron3-down[_ngcontent-%COMP%]{margin:-12px -8.5px;padding:0 8px}i.papycon-chevron3-down.expanded[_ngcontent-%COMP%]{transform:scale(.5) rotate(-180deg)}.capture-backdrop[_ngcontent-%COMP%]{position:fixed;top:0;left:0;right:0;bottom:0;width:100%;height:100%;z-index:4;background-color:#1e1e1e40}.capture-floating[_ngcontent-%COMP%]{padding:14px 20px;display:flex;gap:12px;height:44px;align-items:center;position:fixed;top:54px;left:50%;background-color:var(--mono-00);border:1px solid var(--mono-30);border-radius:21px;box-sizing:border-box;transform:translate(-50%);z-index:5;cursor:default}.capture-floating[_ngcontent-%COMP%]   .divider[_ngcontent-%COMP%]{width:1px;height:24px;background-color:var(--mono-30)}.capture-floating[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:24px;cursor:pointer}.capture-floating[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:var(--mono-70);font-size:15px;font-weight:500;white-space:pre}.capture-floating[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]{display:flex;align-items:center}.capture-floating[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]   .ep-button[_ngcontent-%COMP%]{padding:4px 8px;display:flex;gap:4px;color:var(--mono-99);background-color:var(--mono-00)}.capture-floating[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]   .ep-button[_ngcontent-%COMP%]:hover{background-color:var(--mono-30)}"],changeDetection:0}));let a=t;return a})();function Iu(a,t){if(a&1&&X(0,"sd-capture-edit",0),a&2){let n=w();O("pdfPage",n.pdfPage)}}function Au(a,t){if(a&1&&X(0,"sd-capture-create",0),a&2){let n=w();O("pdfPage",n.pdfPage)}}var ya=(()=>{let t=class t{subscriptionService;captureService;renderingService;documentService;renderer;toastService;translatePipe;changeDetectorRef;store$;loggingService;annotService;acroFormService;pageService;EXPORT_IMAGE_TYPE=dc.PNG;pdfPage;annot;pdfInfo=null;degree;isCreated=!1;capturedArea=null;drawTool={sdImage:null,imgEl:null,annots:[]};readyPdfImageSrc=new Yt(!1);readyPdfImage$=this.readyPdfImageSrc.asObservable();get readyPdfImage(){return this.readyPdfImageSrc.getValue()}constructor(e,i,r,l,g,S,y,I,B,ee,ge,le,Te){this.subscriptionService=e,this.captureService=i,this.renderingService=r,this.documentService=l,this.renderer=g,this.toastService=S,this.translatePipe=y,this.changeDetectorRef=I,this.store$=B,this.loggingService=ee,this.annotService=ge,this.acroFormService=le,this.pageService=Te}ngOnInit(){this.subscriptionService.push(this.store$.pipe(H("degree")).subscribe({next:e=>this.degree=e}),this.captureService.capturedArea$.pipe(ct(e=>{this.isCreated=e.status!==Qt.CREATING&&e.status!==Qt.NONE}),L(e=>e.pageIndex===this.pdfPage.i)).subscribe({next:e=>{this.capturedArea=e,this.changeDetectorRef.markForCheck()}}),Bs([this.renderingService.fetchImage(this.documentService.openedDocument.streamdocsId,this.pdfPage.ref,{jpegQuality:op.HIGH,increasePrint:!1,renderAnnots:!1,zoom:Je.captureImageScale}).pipe(ze(e=>{switch(e.type){case"BLOB":return URL.createObjectURL(e.data);case"BASE64":return e.data;default:throw new Tt("Cannot handle image data")}})),this.store$.pipe(ko("ALL"),ze(e=>Rn.filterChanges(e,i=>i.allowView?i.range==="all"?!0:!!uo.parse(i.range,{min:0,max:this.pageService.pdfPages.length-1})?.includes(this.pdfPage.i):!1)),ze(e=>Rn.flattenWatermarks(e)))]).pipe(ut(([e,i])=>new Nr({imgSrc:e,width:this.pdfPage.bbox.w,height:this.pdfPage.bbox.h,rotation:this.pdfPage.r},i).draw())).subscribe({next:e=>{this.drawTool.imgEl=document.createElement("img"),this.drawTool.sdImage=new np(this.drawTool.imgEl,this.renderer,e,!0),this.drawTool.imgEl.addEventListener("load",()=>this.readyPdfImageSrc.next(!0)),this.drawTool.sdImage.render()}}),this.captureService.captureAction$.pipe(L(()=>F.isDefined(this.capturedArea)&&this.readyPdfImage),ut(e=>this.exportCapture(e))).subscribe({next:e=>{e&&this.captureService.exitCaptureMode()},error:()=>this.captureService.exitCaptureMode()}),this.documentService.pdfInfo$.subscribe({next:e=>this.pdfInfo=e}),this.readyPdfImage$.pipe(L(e=>e)).subscribe({next:()=>this.annotCompToImage(this.annot.editableComps.filter(e=>F.isDefined(e.data)))}))}ngOnDestroy(){F.isDefined(this.drawTool.sdImage)&&(this.drawTool.sdImage.destroy(!0),this.drawTool.sdImage=null)}exportCapture(e){return new Kt(i=>{let r=this.getCapturedImage();if(!F.isDefined(r)){this.toastService.create({toastStyle:jt.NOTIFICATION,header:this.translatePipe.transform("CAPTURE_FAILURE"),content:this.translatePipe.transform("CAPTURE_IMAGE_LOADING")}),i.next(!1);return}switch(e){case _o.COPY:let l=Xl.base64ToBlob(r),g=()=>{this.toastService.create({toastStyle:jt.FAILURE,header:this.translatePipe.transform("CAPTURE_FAILURE"),content:this.translatePipe.transform("NO_CLIPBOARD_AUTHORITY")}),i.next(!1),i.complete()},S=()=>{this.toastService.create({toastStyle:jt.SUCCESS,header:this.translatePipe.transform("CAPTURE_SUCCESS"),content:this.translatePipe.transform("CAPTURE_EXPORT_SUCCESS_CLIPBOARD")}),i.next(!0),i.complete()};Q.copyToClipboard("",void 0,{blob:l,type:`image/${this.EXPORT_IMAGE_TYPE}`},S,g);break;case _o.DOWNLOAD:let y=document.createElement("a");y.href=r,y.download=`${this.pdfInfo.FileName}_${this.pdfPage.i+1}.${this.EXPORT_IMAGE_TYPE}`,y.click(),this.toastService.create({toastStyle:jt.SUCCESS,header:this.translatePipe.transform("CAPTURE_SUCCESS"),content:this.translatePipe.transform("CAPTURE_EXPORT_SUCCESS_FILE")}),i.next(!0),i.complete();break}})}getCapturedImage(){if(!F.isDefined(this.capturedArea))return null;let e=document.createElement("canvas"),i=e.getContext("2d");return F.isDefined(i)?(this.drawImage(e),this.drawAnnots(e),e.toDataURL(`image/${this.EXPORT_IMAGE_TYPE}`)):(this.loggingService.common("debug",pi.NOT_EXIST,"Failed to get CanvasRenderingContext2D"),null)}drawImage(e){let i=e.getContext("2d"),r=this.drawTool.imgEl.naturalWidth/this.pdfPage.bbox.w,l=this.drawTool.imgEl.naturalHeight/this.pdfPage.bbox.h,g=(this.degree+this.pdfPage.r)%360,S=g/90%2===1,y=this.capturedArea.bbox.w*r,I=this.capturedArea.bbox.h*l;e.width=S?I:y,e.height=S?y:I,i.save(),i.translate(e.width/2,e.height/2),i.rotate(g*Math.PI/180),i.drawImage(this.drawTool.imgEl,this.capturedArea.bbox.x*r,this.capturedArea.bbox.y*l,this.capturedArea.bbox.w*r,this.capturedArea.bbox.h*l,-y/2,-I/2,y,I),i.restore()}drawAnnots(e){let i=e.getContext("2d"),r=this.drawTool.imgEl.naturalWidth/this.pdfPage.bbox.w,l=this.drawTool.imgEl.naturalHeight/this.pdfPage.bbox.h;this.drawTool.annots.sort((y,I)=>{let B=this.annot.oidToZIndexMap;return Number(B[y.oid])-Number(B[I.oid])});let g=(this.degree+this.pdfPage.r)%360,S=g/90%2===1;i.save(),i.translate(e.width/2,e.height/2),i.rotate(g*Math.PI/180),i.translate(S?-e.height/2:-e.width/2,S?-e.width/2:-e.height/2),this.drawTool.annots.forEach(y=>{let{canvas:I,point:B}=y,ee=(B.x-this.capturedArea.bbox.x)*r,ge=(B.y-this.capturedArea.bbox.y)*l;i.drawImage(I,0,0,I.width,I.height,ee,ge,I.width,I.height)}),i.restore()}annotCompToImage(e){this.drawTool.annots.splice(0),e.forEach(i=>{if(!F.isDefined(i.data))return;if(Bt.isWidget(i.data)&&!(Bt.isRadioWidgetComponent(i)||Bt.isCheckBoxComponent(i))?F.isDefined(i.data.attributes.appearance)&&!this.isWidgetEdited(i):F.isDefined(i.data.attributes.appearance)){this.createAnnotImageUsingAP(i);return}this.createAnnotImageUsingAttribute(i)})}createAnnotImageUsingAttribute(e){switch(e.data.type){case"Ink":case"Circle":case"Highlight":case"Underline":case"StrikeOut":case"Line":case"Link":case"Polygon":case"PolyLine":case"Redact":case"Square":case"FreeText":this.createAnnotImageUsingSVG(e);break;case"Widget":this.createAnnotImageUsingAcroForm(e);break;case"Text":this.createAnnotImageUsingIcon(e);break}}createAnnotImageUsingSVG(e){let i=document.createElement("canvas"),r=i.getContext("2d"),l=this.drawTool.imgEl.naturalWidth/this.pdfPage.bbox.w,g=this.drawTool.imgEl.naturalHeight/this.pdfPage.bbox.h,{rect:S}=e.data.attributes;i.width=Math.abs(S.left-S.right)*l,i.height=Math.abs(S.top-S.bottom)*g,r.scale(l,g),(Bt.isFreeText(e.data)||Bt.isFreeTextCallout(e.data))&&this.drawFreeTextContent(i,e.data),e.elementRef.nativeElement.querySelectorAll("svg").forEach(y=>{let B=new XMLSerializer().serializeToString(y).replace(/url\([^\#]*\#([^\)]+)\)/g,"url(#$1)").replace(/xlink:href="[^#]*#([^"]+)"/,'xlink:href="#$1"'),ee=new Image,ge=new Blob([B],{type:"image/svg+xml"}),le=URL.createObjectURL(ge);ee.addEventListener("load",()=>{r.drawImage(ee,0,0);let Te=this.drawTool.annots.findIndex(p=>p.oid===e.data.oid),$e={canvas:i,oid:e.data.oid,point:{x:S.left,y:this.pdfPage.bbox.y+this.pdfPage.bbox.h-S.top}};if(Te<0){this.drawTool.annots.push($e);return}this.drawTool.annots.splice(Te,1,$e)}),ee.src=le})}createAnnotImageUsingAcroForm(e){if(!F.isDefined(e.acroField))return;let i=document.createElement("canvas"),r=i.getContext("2d"),{rect:l}=e.data.attributes,g={x:0,y:0,w:0,h:0,border:0,margin:0,ratio:{width:1,height:1}},S=0,y=!1;if(g.ratio.width=this.drawTool.imgEl.naturalWidth/this.pdfPage.bbox.w,g.ratio.height=this.drawTool.imgEl.naturalHeight/this.pdfPage.bbox.h,g.w=Math.abs(l.left-l.right),g.h=Math.abs(l.top-l.bottom),i.width=g.w*g.ratio.width,i.height=g.h*g.ratio.height,r.scale(g.ratio.width,g.ratio.height),F.isDefined(e.data.attributes.MK)){let{backgroundColor:I,borderColor:B,R:ee}=e.data.attributes.MK,{width:ge}=e.data.attributes;if(F.isDefined(ee)&&(S=-ee,y=ee/90%2===1),F.isDefined(I)&&(r.save(),r.fillStyle=I,r.fillRect(0,0,i.width,i.height),r.fill(),r.restore()),F.isDefined(B)){let le=ge??1;g.border=le,r.save(),r.strokeStyle=B,r.lineWidth=le,r.moveTo(0,le/2),r.lineTo(i.width-le/2,le/2),r.lineTo(i.width-le/2,i.height-le/2),r.lineTo(le/2,i.height-le/2),r.lineTo(le/2,le/2),r.stroke(),r.restore()}}if(y&&([g.x,g.y,g.w,g.h]=[g.y,g.x,g.h,g.w]),Bt.isTextFieldComponent(e)){let{V:I,Ff:B}=e.acroField;if(F.isDefined(I)){let{alignment:ee,fontSize:ge,fontName:le,fontColor:Te}=e.data.attributes,$e=F.isDefined(B)?rr.get(B,12):!1;this.drawText(i,I,g,{alignment:this.isAlignment(ee)?ee:Gn.LEFT,baseline:$e?Yn.TOP:Yn.MIDDLE,font:{color:Te,name:le,size:ge},isMultiLine:$e,rotate:S})}}else if(Bt.isComboBoxComponent(e)){let{I,Opt:B}=e.acroField;if(Array.isArray(I)&&Array.isArray(B)){let ge=(B[I[0]]??[])[1];if(F.isDefined(ge)){let{fontSize:le,fontColor:Te,fontName:$e}=e.data.attributes;this.drawText(i,ge,g,{alignment:Gn.LEFT,baseline:Yn.MIDDLE,font:{color:Te,name:$e,size:le},isMultiLine:!1,rotate:S})}}}else if(Bt.isListBoxComponent(e)){let{I,Opt:B}=e.acroField,{fontSize:ee,fontName:ge,fontColor:le}=e.data.attributes;Array.isArray(I)&&Array.isArray(B)&&(g.h=ee+5,g.border=0,g.margin=5/2,B.forEach(([$e,p],vt)=>{let gt=vt===I[0];F.isDefined(p)&&(g.y=(5+ee)*vt,this.drawText(i,p,g,{alignment:Gn.LEFT,baseline:Yn.MIDDLE,font:{color:gt?"#fff":le,name:ge,size:ee},isMultiLine:!1,backgroundColor:gt?"#4D90FE":void 0,rotate:S}))}))}this.drawTool.annots.push({canvas:i,oid:e.data.oid,point:{x:l.left,y:this.pdfPage.bbox.y+this.pdfPage.bbox.h-l.top}})}createAnnotImageUsingIcon(e){let i=e.elementRef.nativeElement.querySelector(".papycon"),r=1.5;if(!F.isDefined(i)){this.loggingService.common("debug",pi.NOT_EXIST,"Not Exist Icon HTMLElement.");return}let l=document.createElement("canvas"),g=l.getContext("2d"),{rect:S}=e.data.attributes,y=this.drawTool.imgEl.naturalWidth/this.pdfPage.bbox.w,I=this.drawTool.imgEl.naturalHeight/this.pdfPage.bbox.h;l.width=(Math.abs(S.left-S.right)+r*2)*y,l.height=(Math.abs(S.top-S.bottom)+r*2)*I,g.scale(y,I);let{fontFamily:B,fontSize:ee,content:ge,color:le,textShadow:Te}=window.getComputedStyle(i,"::before"),$e=ge.replaceAll('"',""),p=r,vt=Math.floor(r)+Number(ee.replace("px",""));if(g.font=`${ee} ${B}`,g.textBaseline="bottom",F.isDefined(Te)){let gt=/rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)\s*(-?\d+(?:\.\d+)?)px\s*(-?\d+(?:\.\d+)?)px\s*(-?\d+(?:\.\d+)?)px/g,ft=Array.from(Te.matchAll(gt),Et=>({color:`rgb(${Et[1]}, ${Et[2]}, ${Et[3]})`,offsetX:Number.parseFloat(Et[4]),offsetY:Number.parseFloat(Et[5]),blur:Number.parseFloat(Et[6])}));g.save(),ft.forEach(Et=>{g.shadowOffsetX=Et.offsetX,g.shadowOffsetY=Et.offsetY,g.shadowBlur=Et.blur,g.shadowColor=Et.color,g.fillText($e,p,vt)}),g.restore()}g.fillStyle=le,g.fillText($e,p,vt),this.drawTool.annots.push({canvas:l,oid:e.data.oid,point:{x:S.left,y:this.pdfPage.bbox.y+this.pdfPage.bbox.h-S.top}})}createAnnotImageUsingAP(e){let{appearance:i,rect:r}=e.data.attributes,l={data:null,format:null};if(Array.isArray(i)){let y=i.find(I=>I.state===e.acroField.V)??i.find(I=>I.state==="Off");if(!F.isDefined(y))return;l.data=y.data,l.format=y.format}else l.data=i.data,l.format=i.format;if(!F.isDefined(l.data)){console.error("Annotation detected, but no data available for rendering.");return}let g=`data:image/${l.format};base64,${l.data}`,S=new Image;S.addEventListener("load",()=>{let y=document.createElement("canvas"),I=y.getContext("2d"),B=this.drawTool.imgEl.naturalWidth/this.pdfPage.bbox.w,ee=this.drawTool.imgEl.naturalHeight/this.pdfPage.bbox.h,ge=Math.abs(r.left-r.right),le=Math.abs(r.top-r.bottom);y.width=ge*B,y.height=le*ee,I.scale(B,ee),I.globalAlpha=e.data.attributes.opacity??Ip[e.data.type.toLowerCase()]??1,I.drawImage(S,0,0,ge,le),this.drawTool.annots.push({canvas:y,oid:e.data.oid,point:{x:r.left,y:this.pdfPage.bbox.y+this.pdfPage.bbox.h-r.top}})}),S.src=g}drawFreeTextContent(e,i){let{textRect:r,contentsRichtext:l,width:g,color:S,rect:y,Rotate:I}=i.attributes,B={x:0,y:0,w:0,h:0,border:g,margin:0,ratio:{width:1,height:1}},ee=I/90%2===1;F.isDefined(r)?(B.x=Math.max(Math.abs(r.left-y.left),Math.abs(r.right-y.right)),B.y=Math.max(Math.abs(r.top-y.top),Math.abs(r.bottom-y.bottom)),B.w=Math.abs(r.right-r.left),B.h=Math.abs(r.bottom-r.top)):(B.w=Math.abs(y.right-y.left),B.h=Math.abs(y.bottom-y.top)),ee&&([B.x,B.y,B.w,B.h]=[B.y,B.x,B.h,B.w]);let ge=l.fontSize/10;B.margin=Math.min(g*4,Math.min(B.w,B.h))/2/ge,B.ratio.width=this.drawTool.imgEl.naturalWidth/this.pdfPage.bbox.w,B.ratio.height=this.drawTool.imgEl.naturalHeight/this.pdfPage.bbox.h,this.drawText(e,l.text,B,{baseline:Yn.TOP,alignment:Gn.LEFT,backgroundColor:S,isMultiLine:!0,rotate:-I,font:{size:l.fontSize,color:l.fontColor,name:l.fontName}})}drawText(e,i,r,l){let g=Te=>!li.isEnglish(Te)&&!li.isNumber(Te)&&!li.isSpecialCharacters(Te,["s","-","?"]),S=e.getContext("2d"),y=new Path2D,I=[],B=Math.abs(l.rotate)/90%2===1,ee={word:"",line:[]};if(S.save(),S.fillStyle=l.font.color,S.font=`${l.font.size}px ${l.font.name}`,S.textAlign=l.alignment,S.textBaseline=l.baseline,l.isMultiLine){for(let Te of i){if(Te===`
`){ee.word.length>0&&(ee.line.push(ee.word),ee.word=""),I.push(ee.line),ee.line=[];continue}else ee.word+=Te;let $e=ee.line.reduce((p,vt)=>p+vt,"").concat(ee.word);if(S.measureText($e).width+r.margin*2+r.border*2>=r.w){if(ee.line.length===0){I.push([ee.word.slice(0,-1)]),ee.word=Te;continue}I.push(ee.line),ee.line=[],S.measureText(ee.word).width+r.margin*2+r.border*2>=r.w&&(I.push([ee.word.slice(0,-1)]),ee.word=Te)}g(Te)&&(ee.line.push(ee.word),ee.word="")}ee.word.length>0&&ee.line.push(ee.word),ee.line.length>0&&I.push(ee.line)}else I.push([i]);let ge=e.width/r.ratio.width,le=e.height/r.ratio.height;S.translate(ge/2,le/2),S.rotate(l.rotate*Math.PI/180),S.translate(B?-le/2:-ge/2,B?-ge/2:-le/2),y.rect(r.x,r.y,r.w,r.h),S.clip(y),F.isDefined(l.backgroundColor)&&(S.save(),S.fillStyle=l.backgroundColor,S.rect(r.x,r.y,r.w,r.h),S.fill(),S.restore()),I.forEach((Te,$e)=>{let p=Te.reduce((ft,Et)=>ft+Et,""),vt=this.getTextDeltaX(l.alignment,r.border+r.margin,r.w),gt=this.getTextDeltaY(l.baseline,r.border+r.margin,r.h,I.length,l.font.size,$e);S.fillText(p,r.x+vt,r.y+gt)}),S.restore()}getTextDeltaX(e,i,r){switch(e){case Gn.LEFT:return i;case Gn.CENTER:return r/2;case Gn.RIGHT:return r}}getTextDeltaY(e,i,r,l,g,S){let y=S+1;switch(e){case Yn.TOP:return i+S*g;case Yn.MIDDLE:let I=r/2,B=(l+1)/2,ee=(y-B)*g;if(l%2===0){let ge=Math.abs(y-B)<1,le=y<B;return ge?I+(le?-g/2:g/2):I+ee}return I+ee;case Yn.BOTTOM:return r-i-(l-y)*g}}isAlignment(e){return Object.values(Gn).some(i=>i===e)}isWidgetEdited(e){if(e.data.attributes.Parent<0)return!0;let r=this.annotService.getActionLogAnnots(e.data.attributes.pageIdx).findIndex(y=>y.oid===e.data.oid)>-1,l=e.acroField?.V??e.data.attributes.V,g=this.acroFormService.lastFetchedAcroFields?.get(e.data.attributes.Parent)?.V,S=JSON.stringify(l)!==JSON.stringify(g);return r||S}};A(t,"\u0275fac",function(i){return new(i||t)(v(Z),v(on),v(Io),v(ot),v(At),v(Zi),v(Ve),v(ye),v(Ee),v(ji),v(ni),v(bn),v(Ht))}),A(t,"\u0275cmp",Ce({type:t,selectors:[["sd-capture-tool"]],inputs:{pdfPage:"pdfPage",annot:"annot"},standalone:!1,features:[be([Z])],decls:3,vars:2,consts:[[3,"pdfPage"],[3,"pageIndex"]],template:function(i,r){i&1&&(se(0,Iu,1,1,"sd-capture-edit",0)(1,Au,1,1,"sd-capture-create",0),X(2,"sd-capture-overlay",1)),i&2&&(fn(r.isCreated?0:1),x(2),O("pageIndex",r.pdfPage.i))},encapsulation:2,changeDetection:0}));let a=t;return a})();var Du=["dragArea"],rd=(()=>{let t=class t{subscriptionSerivce;captureService;store$;dragAreaRef;pdfPage;scale;degree;mainSub=[];point=null;layout={};constructor(e,i,r){this.subscriptionSerivce=e,this.captureService=i,this.store$=r}ngOnInit(){this.subscriptionSerivce.push(this.store$.pipe(H("scale")).subscribe({next:e=>this.scale=e}),this.store$.pipe(H("degree")).subscribe({next:e=>this.degree=e}),at(Ge(this.dragAreaRef.nativeElement,"mousemove").pipe(ze(e=>({point:{x:e.offsetX,y:e.offsetY},pageIndex:this.pdfPage.i}))),Ge(this.dragAreaRef.nativeElement,"mouseenter").pipe(ze(e=>({point:{x:e.offsetX,y:e.offsetY},pageIndex:this.pdfPage.i}))),Ge(this.dragAreaRef.nativeElement,"mouseleave").pipe(ze(()=>null))).subscribe({next:e=>this.captureService.publishLastestMousePosition(e)})),J.bindLayoutOrder(this.layout,J.LayoutOrder.Capture)}ngOnDestroy(){this.captureService.publishLastestMousePosition(null),this.point=null}createMover(e){e.preventDefault(),e.stopPropagation();let i=e.type.startsWith("touch"),r=this.ensureMouseEvent(e);this.point={start:{x:r.offsetX,y:r.offsetY},end:{x:r.offsetX,y:r.offsetY}};let l={bbox:{x:Math.min(this.point.start.x,this.point.end.x),y:Math.min(this.point.start.y,this.point.end.y),w:Math.abs(this.point.start.x-this.point.end.x),h:Math.abs(this.point.start.y-this.point.end.y)},pageIndex:this.pdfPage.i,status:Qt.CREATING};if(this.captureService.publishCapture(l),i){this.captureService.publishLastestMousePosition({point:{x:r.offsetX,y:r.offsetY},pageIndex:this.pdfPage.i}),this.mainSub.push(Ge(this.dragAreaRef.nativeElement,"touchmove").subscribe({next:g=>{let S=this.ensureMouseEvent(g);this.captureService.publishLastestMousePosition({point:{x:S.offsetX,y:S.offsetY},pageIndex:this.pdfPage.i}),this.onMouseMove(S)}}),Ge(this.dragAreaRef.nativeElement,"touchend").subscribe({next:g=>{let S=this.ensureMouseEvent(g);this.captureService.publishLastestMousePosition({point:{x:S.offsetX,y:S.offsetY},pageIndex:this.pdfPage.i}),this.onMouseUp(this.ensureMouseEvent(g))}}));return}this.mainSub.push(Ge(this.dragAreaRef.nativeElement,"mousemove").subscribe({next:g=>this.onMouseMove(g)}),Ge(this.dragAreaRef.nativeElement,"mouseup").subscribe({next:g=>this.onMouseUp(g)}))}onMouseMove(e){e.stopPropagation(),this.point.end.x=Math.max(0,Math.min(e.offsetX,this.pdfPage.bbox.x+this.pdfPage.bbox.w)),this.point.end.y=Math.max(0,Math.min(e.offsetY,this.pdfPage.bbox.y+this.pdfPage.bbox.h)),this.captureService.updateCaptureBBox({x:Math.min(this.point.start.x,this.point.end.x),y:Math.min(this.point.start.y,this.point.end.y),w:Math.abs(this.point.start.x-this.point.end.x),h:Math.abs(this.point.start.y-this.point.end.y)})}onMouseUp(e){e.stopPropagation(),this.point.end.x=e.offsetX,this.point.end.y=e.offsetY;let i=this.captureService.MIN_BBOX_SIZE,r=Math.abs(this.point.start.x-this.point.end.x)<i||Math.abs(this.point.start.y-this.point.end.y)<i;this.captureService.updateCaptureStatus(r?Qt.NONE:Qt.READY),this.mainSub.forEach(l=>l.unsubscribe()),this.mainSub.splice(0)}onMouseLeave(e){this.mainSub.length!==0&&this.onMouseUp(e)}ensureMouseEvent(e){return F.ensureMouseEvent(e,this.degree,this.scale,this.pdfPage,this.dragAreaRef.nativeElement)}};A(t,"\u0275fac",function(i){return new(i||t)(v(Z),v(on),v(Ee))}),A(t,"\u0275cmp",Ce({type:t,selectors:[["sd-capture-create"]],viewQuery:function(i,r){if(i&1&&Ue(Du,7),i&2){let l;Re(l=Ie())&&(r.dragAreaRef=l.first)}},inputs:{pdfPage:"pdfPage"},standalone:!1,features:[be([Z])],decls:2,vars:1,consts:[["dragArea",""],[1,"capture-drag-area",3,"mousedown","mouseleave","touchstart","ngStyle"]],template:function(i,r){if(i&1){let l=_e();R(0,"div",1,0),ce("mousedown",function(S){return W(l),z(r.createMover(S))})("mouseleave",function(S){return W(l),z(r.onMouseLeave(S))})("touchstart",function(S){return W(l),z(r.createMover(S))}),N()}i&2&&O("ngStyle",r.layout)},dependencies:[Gt],styles:[".capture-drag-area[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;bottom:0;width:100%;height:100%;z-index:2;cursor:none}"],changeDetection:0}));let a=t;return a})();var ku=["captureEdit"];function Vu(a,t){if(a&1){let n=_e();_i(),R(0,"rect",5),ce("mousedown",function(i){let r=W(n).index,l=w(2);return z(l.createMover(i,r))})("touchstart",function(i){let r=W(n).index,l=w(2);return z(l.createMover(i,r))}),N()}if(a&2){let n=t.$implicit,e=t.index,i=w(2);Gi("cursor",i.cursorStyle(e)),ue("x",n.x)("y",n.y)("rx",i.vertex.style.width/2)("ry",i.vertex.style.height/2)("width",i.vertex.style.width)("height",i.vertex.style.height)("stroke-width",i.vertex.stroke)}}function Lu(a,t){if(a&1){let n=_e();_i(),R(0,"g")(1,"rect",3),ce("mousedown",function(i){W(n);let r=w();return z(r.createMover(i))})("touchstart",function(i){W(n);let r=w();return z(r.createMover(i))}),N(),se(2,Vu,1,9,"rect",4),N()}if(a&2){let n=w();x(),ue("stroke-width",n.vertex.stroke)("x",n.capturedArea.bbox.x)("y",n.capturedArea.bbox.y)("width",n.capturedArea.bbox.w)("height",n.capturedArea.bbox.h),x(),O("ngForOf",n.vertex.coords)}}var sd=(()=>{let t=class t{subscriptionService;captureService;changeDetectorRef;store$;DEFAULT_VERTEX_SIZE=9;DEFAULT_STROKE_WIDTH=2;captureEditRef;pdfPage;degree;scale;style={layout:{width:null,height:null}};vertex={size:this.DEFAULT_VERTEX_SIZE,style:{width:this.DEFAULT_VERTEX_SIZE,height:this.DEFAULT_VERTEX_SIZE},stroke:this.DEFAULT_STROKE_WIDTH,coords:[]};moverSub=[];capturedArea=null;constructor(e,i,r,l){this.subscriptionService=e,this.captureService=i,this.changeDetectorRef=r,this.store$=l}ngOnInit(){this.style.layout.width=`${this.pdfPage.bbox.w+this.pdfPage.bbox.x}px`,this.style.layout.height=`${this.pdfPage.bbox.h+this.pdfPage.bbox.y}px`,this.subscriptionService.push(this.store$.pipe(H("scale")).subscribe({next:e=>{this.scale=e,this.render()}}),this.store$.pipe(H("degree")).subscribe({next:e=>this.degree=e}),this.captureService.capturedArea$.pipe(L(e=>this.pdfPage.i===e.pageIndex)).subscribe({next:e=>{this.capturedArea=e,this.render(),this.changeDetectorRef.markForCheck()}}),Ge(Q.nativeWindow,"copy").pipe(L(()=>F.isDefined(this.capturedArea))).subscribe({next:e=>{e.preventDefault(),this.captureService.fireCaptureAction(_o.COPY)}})),J.bindLayoutOrder(this.style.layout,J.LayoutOrder.Capture)}ngOnDestroy(){this.moverSub.forEach(e=>e.unsubscribe())}cursorStyle(e){let i=(this.pdfPage.r+this.degree+360)%360;return Pr.resizeCursorOf(!0,e,i)}renderVertex(e){let i=this.createRectVertices(e,this.vertex.size);if(this.vertex.coords.length===0){this.vertex.coords=i;return}this.vertex.coords.forEach((r,l)=>{r.x=i[l].x,r.y=i[l].y})}createRectVertices(e,i){let r=i/2,[l,g,S]=[-r,e.h/2-r,e.w/2-r],[y,I]=[e.w-r,e.h-r];return[{x:e.x+l,y:e.y+l},{x:e.x+l,y:e.y+g},{x:e.x+l,y:e.y+I},{x:e.x+S,y:e.y+I},{x:e.x+y,y:e.y+I},{x:e.x+y,y:e.y+g},{x:e.x+y,y:e.y+l},{x:e.x+S,y:e.y+l}]}createMover(e,i){e.preventDefault(),e.stopPropagation();let r=e.type.startsWith("touch"),l=this.ensureMouseEvent(e);this.moverSub.forEach(y=>y.unsubscribe()),this.moverSub.splice(0),this.captureService.updateCaptureStatus(Qt.EDITING);let g=F.isDefined(i)?this.moveVertex(l,i):this.moveBBox(l),S=()=>{this.captureService.updateCaptureStatus(Qt.READY),this.moverSub.forEach(y=>y.unsubscribe()),this.moverSub.splice(0)};if(r){this.moverSub.push(Ge(this.captureEditRef.nativeElement,"touchmove").subscribe({next:y=>{y.preventDefault(),g(this.ensureMouseEvent(y))}}),Ge(this.captureEditRef.nativeElement,"touchend").subscribe({next:()=>S()}));return}this.moverSub.push(Ge(this.captureEditRef.nativeElement,"mousemove").subscribe({next:y=>g(y)}),at(Ge(this.captureEditRef.nativeElement,"mouseup"),Ge(this.captureEditRef.nativeElement,"mouseleave")).subscribe({next:()=>S()}))}moveVertex(e,i){let r={offsetX:e.offsetX,offsetY:e.offsetY};return l=>{if(!F.isDefined(this.capturedArea))return;let g=F.deepClone(this.capturedArea.bbox),S={x:l.offsetX-r.offsetX,y:l.offsetY-r.offsetY};switch(r.offsetX=l.offsetX,r.offsetY=l.offsetY,i){case $t.TOP_LEFT:case $t.TOP:case $t.TOP_RIGHT:g.y+S.y>=0&&(g.y+=S.y,g.h-=S.y);break;default:break}switch(i){case $t.LEFT:case $t.TOP_LEFT:case $t.BOTTOM_LEFT:g.x+S.x>=this.pdfPage.bbox.x&&(g.x+=S.x,g.w-=S.x);break;default:break}switch(i){case $t.BOTTOM:case $t.BOTTOM_LEFT:case $t.BOTTOM_RIGHT:g.y+g.h+S.y<=this.pdfPage.bbox.y+this.pdfPage.bbox.h&&(g.h+=S.y);break;default:break}switch(i){case $t.RIGHT:case $t.TOP_RIGHT:case $t.BOTTOM_RIGHT:g.x+g.w+S.x<=this.pdfPage.bbox.x+this.pdfPage.bbox.w&&(g.w+=S.x);break;default:break}this.captureService.updateCaptureBBox(this.resizeBBox(g,i)),this.changeDetectorRef.markForCheck()}}moveBBox(e){let i={offsetX:e.offsetX,offsetY:e.offsetY};return r=>{let l={x:r.offsetX-i.offsetX,y:r.offsetY-i.offsetY};i.offsetX=r.offsetX,i.offsetY=r.offsetY;let g=F.deepClone(this.capturedArea.bbox);g.x+=l.x,g.y+=l.y,this.captureService.updateCaptureBBox(this.resizeBBox(g))}}resizeBBox(e,i){let r=this.captureService.MIN_BBOX_SIZE;switch(i){case $t.TOP:case $t.TOP_LEFT:case $t.TOP_RIGHT:if(e.h<r){let l=r-e.h;e.y-=l,e.h+=l}break;default:break}switch(i){case $t.LEFT:case $t.TOP_LEFT:case $t.BOTTOM_LEFT:if(e.w<r){let l=r-e.w;e.x-=l,e.w+=l}break;default:break}switch(i){case $t.BOTTOM:case $t.BOTTOM_LEFT:case $t.BOTTOM_RIGHT:e.h<r&&(e.h=r);break;default:break}switch(i){case $t.RIGHT:case $t.TOP_RIGHT:case $t.BOTTOM_RIGHT:e.w<r&&(e.w=r);break;default:break}if(e.x+e.w>this.pdfPage.bbox.x+this.pdfPage.bbox.w){let l=this.pdfPage.bbox.x+this.pdfPage.bbox.w-e.w;e.x=l}if(e.x<this.pdfPage.bbox.x&&(e.x=this.pdfPage.bbox.x),e.y+e.h>this.pdfPage.bbox.h){let l=this.pdfPage.bbox.y+this.pdfPage.bbox.h-e.h;e.y=l}return e.y<0&&(e.y=0),e}render(){!F.isDefined(this.capturedArea)||this.capturedArea.status===Qt.CREATING||this.capturedArea.status===Qt.NONE||(this.calcScale(),this.renderVertex(this.capturedArea.bbox),this.changeDetectorRef.markForCheck())}calcScale(){let e=J.normalizeScale(this.scale);this.vertex.size=Number((this.DEFAULT_VERTEX_SIZE/e).toFixed(1)),this.vertex.style.width=this.vertex.size,this.vertex.style.height=this.vertex.size,this.vertex.stroke=Number((this.DEFAULT_STROKE_WIDTH/e).toFixed(1))}ensureMouseEvent(e){return F.ensureMouseEvent(e,this.degree,this.scale,this.pdfPage,this.captureEditRef.nativeElement)}};A(t,"\u0275fac",function(i){return new(i||t)(v(Z),v(on),v(ye),v(Ee))}),A(t,"\u0275cmp",Ce({type:t,selectors:[["sd-capture-edit"]],viewQuery:function(i,r){if(i&1&&Ue(ku,7),i&2){let l;Re(l=Ie())&&(r.captureEditRef=l.first)}},inputs:{pdfPage:"pdfPage"},standalone:!1,features:[be([Z])],decls:3,vars:2,consts:[["captureEdit",""],[3,"ngStyle"],[4,"ngIf"],[1,"bbox",3,"mousedown","touchstart"],["class","vertex",3,"cursor","mousedown","touchstart",4,"ngFor","ngForOf"],[1,"vertex",3,"mousedown","touchstart"]],template:function(i,r){i&1&&(_i(),R(0,"svg",1,0),se(2,Lu,3,6,"g",2),N()),i&2&&(O("ngStyle",r.style.layout),x(2),O("ngIf",r.capturedArea))},dependencies:[Si,lt,Gt],styles:["svg[_ngcontent-%COMP%]{position:absolute;right:0;top:0;-webkit-user-select:none;user-select:none;width:100%;height:100%;cursor:default;overflow:visible;z-index:10}svg[_ngcontent-%COMP%]   rect.bbox[_ngcontent-%COMP%]{fill:#0000;stroke:var(--primary-50);cursor:move}svg[_ngcontent-%COMP%]   rect.vertex[_ngcontent-%COMP%]{fill:#fff;stroke:var(--primary-50);-webkit-user-select:none;user-select:none;font-size:12px}"],changeDetection:0}));let a=t;return a})();var Fu=["captureOverlay"],Bu=["captureClipPath"];function Uu(a,t){if(a&1&&(_i(),R(0,"g"),X(1,"line",5)(2,"line",6),N()),a&2){let n=w();x(),ue("y1",n.lastestMousePosition.point.y)("y2",n.lastestMousePosition.point.y)("stroke-dashoffset",-(n.lastestMousePosition.point.x%8)-6)("stroke-width",n.crossHairLineWidth),x(),ue("x1",n.lastestMousePosition.point.x)("x2",n.lastestMousePosition.point.x)("stroke-dashoffset",-(n.lastestMousePosition.point.y%8)-6)("stroke-width",n.crossHairLineWidth)}}var ad=(()=>{let t=class t{subscriptionService;captureService;changeDetectorRef;store$;CROSS_HAIR_LINE_WIDTH=2;pageIndex;captureOverlayRef;captureClipPathRef;lastestMousePosition=null;isCreated=!1;crossHairLineWidth=this.CROSS_HAIR_LINE_WIDTH;get showCrossHair(){return this.lastestMousePosition&&this.lastestMousePosition.pageIndex===this.pageIndex&&!this.isCreated}get clipPathId(){return`clip-path-${this.pageIndex}`}constructor(e,i,r,l){this.subscriptionService=e,this.captureService=i,this.changeDetectorRef=r,this.store$=l}ngOnInit(){this.subscriptionService.push(this.store$.pipe(H("scale")).subscribe({next:e=>{this.crossHairLineWidth=this.CROSS_HAIR_LINE_WIDTH/J.normalizeScale(e),this.changeDetectorRef.markForCheck()}}),this.captureService.lastestMousePosition$.subscribe({next:e=>{this.lastestMousePosition=e,this.changeDetectorRef.markForCheck()}}),this.captureService.capturedArea$.pipe(L(e=>e.pageIndex===this.pageIndex),ct(e=>{this.isCreated=e.status!==Qt.CREATING&&e.status!==Qt.NONE})).subscribe({next:e=>{let i=(B,ee,ge,le)=>{let Te=document.createElementNS("http://www.w3.org/2000/svg","rect");return Te.setAttribute("x",B),Te.setAttribute("y",ee),Te.setAttribute("width",ge),Te.setAttribute("height",le),Te};if(this.captureClipPathRef.nativeElement.innerHTML="",e.status===Qt.NONE){let B=i("0","0","100%","100%");this.captureClipPathRef.nativeElement.appendChild(B),this.changeDetectorRef.markForCheck();return}let{x:r,y:l,w:g,h:S}=e.bbox,y=this.captureOverlayRef.nativeElement.clientWidth,I=this.captureOverlayRef.nativeElement.clientHeight;r>0&&this.captureClipPathRef.nativeElement.appendChild(i("0","0",`${r}`,"100%")),l>0&&this.captureClipPathRef.nativeElement.appendChild(i("0","0","100%",`${l}`)),y>r+g&&this.captureClipPathRef.nativeElement.appendChild(i(`${r+g}`,"0",`${y-(r+g)}`,"100%")),I>l+S&&this.captureClipPathRef.nativeElement.appendChild(i("0",`${l+S}`,"100%",`${I-(l+S)}`)),this.changeDetectorRef.markForCheck()}}))}};A(t,"\u0275fac",function(i){return new(i||t)(v(Z),v(on),v(ye),v(Ee))}),A(t,"\u0275cmp",Ce({type:t,selectors:[["sd-capture-overlay"]],viewQuery:function(i,r){if(i&1&&(Ue(Fu,7),Ue(Bu,7)),i&2){let l;Re(l=Ie())&&(r.captureOverlayRef=l.first),Re(l=Ie())&&(r.captureClipPathRef=l.first)}},inputs:{pageIndex:"pageIndex"},standalone:!1,features:[be([Z])],decls:8,vars:3,consts:[["captureOverlay",""],["captureClipPath",""],["id","capture-overlay"],["x","0","y","0","width","100%","height","100%"],[4,"ngIf"],["x1","0","x2","100%","stroke","#FFFFFF","stroke-dasharray","4 4"],["y1","0","y2","100%","stroke","#FFFFFF","stroke-dasharray","4 4"]],template:function(i,r){i&1&&(_i(),R(0,"svg",2,0)(2,"defs")(3,"clipPath",null,1),X(5,"rect",3),N()(),X(6,"rect",3),se(7,Uu,3,8,"g",4),N()),i&2&&(x(3),ue("id",r.clipPathId),x(3),ue("clip-path","url(#"+r.clipPathId+")"),x(),O("ngIf",r.showCrossHair))},dependencies:[lt],styles:["#capture-overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;bottom:0;width:100%;height:100%;z-index:1}#capture-overlay[_ngcontent-%COMP%]   rect[_ngcontent-%COMP%]{fill:#1e1e1e;fill-opacity:.25}"],changeDetection:0}));let a=t;return a})();var Ea=(()=>{let t=class t{};A(t,"\u0275fac",function(i){return new(i||t)}),A(t,"\u0275mod",Jt({type:t})),A(t,"\u0275inj",Xt({providers:[on],imports:[Ui,Cn]}));let a=t;return a})();ti(wa,[lt],[Ve]);ti(ya,[rd,sd,ad],[]);var Pa=class{triggerEvents=[];mainEvents=[];terminatorEvents=[];_isTriggered=!1;get isTriggered(){return this._isTriggered}listen(){this.triggerEvents.forEach(t=>{t.listening||(t.target.addEventListener(t.type,t.listener),t.listening=!0)})}unlisten(){[...this.triggerEvents,...this.mainEvents,...this.terminatorEvents].forEach(t=>{t.target.removeEventListener(t.type,t.listener),t.listening=!1}),this._isTriggered=!1}addTriggerEvent(t,n,e){this.triggerEvents.push({target:t,type:n,listener:i=>{let r=e?e(i):!0;!r&&r!==void 0||(this._isTriggered=!0,[...this.mainEvents,...this.terminatorEvents].forEach(l=>{l.listening||(l.target.addEventListener(l.type,l.listener),l.listening=!0)}))},listening:!1})}addMainEvent(t,n,e){this.mainEvents.push({target:t,type:n,listener:e,listening:!1})}addTerminatorEvent(t,n,e){this.terminatorEvents.push({target:t,type:n,listener:i=>{let r=e?e(i):!0;!r&&r!==void 0||(this._isTriggered=!1,[...this.mainEvents,...this.terminatorEvents].forEach(l=>{l.target.removeEventListener(l.type,l.listener),l.listening=!1}))},listening:!1})}};var Qr=class Qr{link;portalRef;elementRef;annotService;contentService;modalService;subscriptionService;translatePipe;store$;pageIdx="";url="";radioOption="GoTo";pageCount;constructor(t,n,e,i,r,l,g,S,y){this.link=t,this.portalRef=n,this.elementRef=e,this.annotService=i,this.contentService=r,this.modalService=l,this.subscriptionService=g,this.translatePipe=S,this.store$=y}ngOnInit(){this.subscriptionService.push(this.store$.pipe(H("pageCount")).subscribe({next:t=>this.pageCount=t}),Ge(window,"keydown",{capture:!0}).pipe(L(t=>t.key==="Escape"),L(()=>this.modalService.lastModal===this.portalRef)).subscribe({next:()=>this.close()})),this.elementRef.nativeElement.parentElement.style.minWidth="375px"}close(){this.portalRef.dispose()}createLink(){if(this.link.attributes.type=this.radioOption,this.radioOption==="GoTo"){if(this.pageIdx.length===0||isNaN(Number(this.pageIdx))){this.modalService.createCommonModal({type:Ut.WARN,title:this.translatePipe.transform("CREATE_LINK"),content:this.translatePipe.transform("ONLY_NUMBER_CAN_BE_PAGE_INDEX"),confirmButton:!0,confirmLabel:this.translatePipe.transform("CLOSE")});return}if(parseInt(this.pageIdx,10)>this.pageCount||parseInt(this.pageIdx,10)<1){this.modalService.createCommonModal({type:Ut.WARN,title:this.translatePipe.transform("CREATE_LINK"),content:this.translatePipe.transform("INVALID_PAGE_INDEX"),confirmButton:!0});return}this.link.attributes.dest=`${parseInt(this.pageIdx,10)-1}`,this.link.attributes.contents=this.translatePipe.transform("GO_TO_PAGE").replace("%s",`${parseInt(this.pageIdx,10)}`)}else{if(this.url.length===0){this.modalService.createCommonModal({type:Ut.WARN,title:this.translatePipe.transform("CREATE_LINK"),content:this.translatePipe.transform("URL_CANNOT_BE_BLANK"),confirmButton:!0,confirmLabel:this.translatePipe.transform("CLOSE")});return}this.link.attributes.dest=this.url,this.link.attributes.contents=this.translatePipe.transform("GO_TO_SITE").replace("%s",this.link.attributes.dest)}this.annotService.putModel(this.link),this.contentService.fireAnnotEvent({sdEventType:en.CREATE,annot:this.link}),this.contentService.fireAnnotListEvent({from:"AnnotComponent",sdEventType:en.CREATE,annot:this.link}),this.close()}};A(Qr,"\u0275fac",function(n){return new(n||Qr)(v(Ws),v(zs),v(Zt),v(ni),v(it),v(Ki),v(Z),v(Ve),v(Ee))}),A(Qr,"\u0275cmp",Ce({type:Qr,selectors:[["sd-link-creation-dialog"]],standalone:!1,features:[be([Z])],decls:23,vars:40,consts:[["tabindex","0"],["value","GoTo",3,"ngModelChange","label","ngModel"],["size","tiny","type","text",3,"ngModelChange","disabled","placeholder","autofocus","ariaLabel","ngModel"],["value","URI",3,"ngModelChange","label","ngModel"],["size","tiny","type","text",3,"ngModelChange","disabled","placeholder","ariaLabel","ngModel"],["color","white","size","small",1,"ep-button",3,"click"],["color","primary","size","small",1,"ep-button","create",3,"click"]],template:function(n,e){n&1&&(R(0,"h3",0),me(1),G(2,"translate"),N(),R(3,"main")(4,"pu-radio-button",1),G(5,"translate"),yi("ngModelChange",function(r){return wi(e.radioOption,r)||(e.radioOption=r),r}),N(),R(6,"pu-input",2),G(7,"translate"),G(8,"translate"),yi("ngModelChange",function(r){return wi(e.pageIdx,r)||(e.pageIdx=r),r}),N(),R(9,"pu-radio-button",3),G(10,"translate"),yi("ngModelChange",function(r){return wi(e.radioOption,r)||(e.radioOption=r),r}),N(),R(11,"pu-input",4),G(12,"translate"),G(13,"translate"),yi("ngModelChange",function(r){return wi(e.url,r)||(e.url=r),r}),N()(),R(14,"footer")(15,"button",5),G(16,"translate"),ce("click",function(){return e.close()}),me(17),G(18,"translate"),N(),R(19,"button",6),G(20,"translate"),ce("click",function(){return e.createLink()}),me(21),G(22,"translate"),N()()),n&2&&(x(),xe(Y(2,18,"CREATE_LINK")),x(3),O("label",Y(5,20,"GO_TO_SPECIFIC_PAGE")),Mi("ngModel",e.radioOption),x(2),O("disabled",e.radioOption!=="GoTo")("placeholder",Y(7,22,"PLEASE_ENTER_PAGE_NUMBER"))("autofocus",!0)("ariaLabel",Y(8,24,"PLEASE_ENTER_PAGE_NUMBER")),Mi("ngModel",e.pageIdx),x(3),O("label",Y(10,26,"OPEN_WEB_PAGE")),Mi("ngModel",e.radioOption),x(2),O("disabled",e.radioOption!=="URI")("placeholder",Y(12,28,"PLEASE_ENTER_URL"))("ariaLabel",Y(13,30,"PLEASE_ENTER_URL")),Mi("ngModel",e.url),x(4),ue("aria-label",Y(16,32,"CANCEL")),x(2),xe(Y(18,34,"CANCEL")),x(2),ue("aria-label",Y(20,36,"CREATE")),x(2),xe(Y(22,38,"CREATE")))},styles:["h3[_ngcontent-%COMP%]{font-size:20px;line-height:28px;font-family:NotoSans-Medium,sans-serif;color:var(--mono-99);margin:8px 0}main[_ngcontent-%COMP%]{font-size:13px;line-height:22px;color:var(--mono-70);white-space:pre-wrap;display:flex;flex-direction:column}main[_ngcontent-%COMP%]   pu-radio-button[_ngcontent-%COMP%], main[_ngcontent-%COMP%]   pu-input[_ngcontent-%COMP%]{margin:8px 0}footer[_ngcontent-%COMP%]{text-align:right;margin-top:32px}footer[_ngcontent-%COMP%]   button.create[_ngcontent-%COMP%]{color:var(--mono-00)}footer[_ngcontent-%COMP%]   button[_ngcontent-%COMP%] + button[_ngcontent-%COMP%]{margin-left:12px}"],changeDetection:0}));var dr=Qr;Qe([st(nt.linkCreationDialogComp.createLink)],dr.prototype,"createLink",null);var $u=["scrollContainerRef"],Wu=["scaleWrapper"],zu=["slideshowOverlay"];function Gu(a,t){a&1&&Pn(0)}function Yu(a,t){if(a&1&&X(0,"sd-popups",15),a&2){w(2);let n=ei(2);O("contentViewRoot",n)}}function Qu(a,t){a&1&&X(0,"sd-capture-backdrop")}function qu(a,t){if(a&1){let n=_e();R(0,"div",16)(1,"sd-page",17),ce("mousedown",function(){let i=W(n).$implicit,r=w(2);return z(r.onPageMouseDown(i))}),N()()}if(a&2){let n=t.$implicit,e=w(2);O("page",n),x(),Ye("hide-outline",e.isSlideshow||e.isCaptureMode)("hide-background",e.isCaptureMode),O("priority",e.renderPriorityOf(n))("page",n)("documentId",e.documentId)}}function Ku(a,t){if(a&1&&X(0,"sd-contextmenu",18),a&2){let n=w(2);O("eventInfo",n.contextMenuEventInfo)("isClickOnGrayArea",n.isClickOnGrayArea)}}function Xu(a,t){if(a&1&&(Lt(0),se(1,Yu,1,1,"sd-popups",10)(2,Qu,1,0,"sd-capture-backdrop",6),R(3,"div",11,2)(5,"div",12),se(6,qu,2,8,"div",13),N(),se(7,Ku,1,2,"sd-contextmenu",14),N(),Ft()),a&2){let n=w();x(),O("ngIf",n.pdfPages.length),x(),O("ngIf",n.isCaptureMode),x(),Ye("capture-mode",n.isCaptureMode),x(3),O("ngForOf",n.pdfPages)("ngForTrackBy",n.trackByPage),x(),O("ngIf",n.shouldShowContextMenu)}}function Zu(a,t){if(a&1&&X(0,"sd-ebook-view",19),a&2){let n=w();O("documentId",n.documentId)}}function Ju(a,t){a&1&&X(0,"div",20,3)}function eg(a,t){a&1&&Pn(0)}function tg(a,t){a&1&&X(0,"sd-quick-action")}function ig(a,t){if(a&1&&X(0,"sd-search-tool",21),a&2){let n=w();O("pdfDoc",n.pdfDoc)}}function ng(a,t){a&1&&X(0,"sd-indicator")}function og(a,t){if(a&1&&X(0,"sd-floating-nav",23),a&2){let n=w(2);O("pdfDoc",n.pdfDoc)}}function rg(a,t){if(a&1&&se(0,og,1,1,"sd-floating-nav",22),a&2){let n=w();O("ngIf",n.runtimeEnv.get(n.MergedRuntimeEnvKey.FLOATING_NAVIGATION)&&!n.hidableMenus[n.HidableView.FLOATING_NAV])}}var qr=function(a){return a[a.UP=1]="UP",a[a.DOWN=2]="DOWN",a[a.UNKNOWN=3]="UNKNOWN",a}(qr||{}),Kr=class Kr{acroFormService;annotService;changeDetectorRef;documentService;pageService;annotSelectedService;contentService;scrollController;store$;viewerService;subscriptionService;apiEventBridgeService;guideLineService;modalService;sdContextMenuService;selectTextService;renderer;toastService;translatePipe;dapService;shortcutService;loggingService;captureService;get RuntimeEnvKey(){return ne}get MergedRuntimeEnvKey(){return Ct}get runtimeEnv(){return K}get HidableView(){return V}get shouldShowContextMenu(){return this.isContextMenuOpened&&!this.hidableMenus[V.CONTEXT_MENU]}contextMenuEventInfo;pdfDoc;overWrittenZoom;centerPoint;scrollContainerRef;scaleWrapper;contentView;slideshowOverlay;scale;prevScale=null;degree;viewMode;dragMode;currentPageNo;pageCount;searchToolActive;isR2L;isContextMenuOpened=!1;clickedPage=null;isClickOnGrayArea=!1;isCaptureMode=!1;pdfPages=[];preferences=null;selectedText=null;hidableMenus={};originalViewMode;originalScale;originalPageNo;renderingMode;rulerActive;draggingListener=new Pa;bufferSize=null;get documentId(){return this.pdfDoc?this.pdfDoc.streamdocsId:null}stateHolder;get contentViewStyle(){return this.dragMode!==Ot.MOVE?null:{cursor:`grab${this.draggingListener.isTriggered?"bing":F.EMPTY_STRING}`}}get isSlideshow(){return this.stateHolder?.isSlideshow}get contentViewElement(){return this.scrollContainerRef.nativeElement}mobileZoomer;docInfo=null;pdfInfo=null;constructor(t,n,e,i,r,l,g,S,y,I,B,ee,ge,le,Te,$e,p,vt,gt,ft,Et,Li,si){this.acroFormService=t,this.annotService=n,this.changeDetectorRef=e,this.documentService=i,this.pageService=r,this.annotSelectedService=l,this.contentService=g,this.scrollController=S,this.store$=y,this.viewerService=I,this.subscriptionService=B,this.apiEventBridgeService=ee,this.guideLineService=ge,this.modalService=le,this.sdContextMenuService=Te,this.selectTextService=$e,this.renderer=p,this.toastService=vt,this.translatePipe=gt,this.dapService=ft,this.shortcutService=Et,this.loggingService=Li,this.captureService=si}ngOnChanges(){this.clearAllCache(),this.contentService.publishTSAValidation(null)}ngOnInit(){this.initDraggingListener(),this.initSubscribers(),Q.isTouchableDevice()&&this.buildMobileZoomer()}ngOnDestroy(){this.draggingListener.unlisten(),this.dapService.resetCheckbox(),this.destroyMobileZoomer(),this.finalizeSubscribers(),this.scrollController.stop(),this.clearAllCache(),this.contentService.publishTSAValidation(null),Vi.destroy(this)}onRightMouseUp(t){t.button!==2||this.dragMode===Ot.MAGNIFY||this.annotSelectedService.selectedComponents.length||this.isSlideshow||K.get(ne.CONTEXT_MENU_TOOLS_IN_USE).length===0||(this.sdContextMenuService.publishContextMenuStatus(!0),this.contextMenuEventInfo=t)}onPdfDocumentReady(t,n=null){this.pdfInfo=n,this.store$.dispatch(he.set({key:"pageCount",value:t.length}));let e=this.preferences&&this.preferences.viewerDirection===0?this.pdfInfo?.ViewerPreferences?.Direction==="R2L":this.preferences?.viewerDirection===2;this.store$.dispatch(he.set({key:"isR2L",value:e})),this.stateHolder=new Ti,this.stateHolder.pdfPages=t,this.stateHolder.degree=this.degree,this.stateHolder.isR2L=this.isR2L,this.scrollController.start(this.stateHolder,this.contentViewElement),this.subscribePageArrange(),this.subscribeMainViewResized(),this.subscribeViewChange(),this.subscribeWheelZoom();let i={fitWidth:0,fitHeight:1,fitPage:3,actualSize:4},r=this.overWrittenZoom?.length>0&&!Number.isNaN(Number(this.overWrittenZoom))?{scale:Number(this.overWrittenZoom)}:{fitMode:i[this.overWrittenZoom]??this.preferences.pageFitMode};this.centerPoint?this.contentService.requestViewChange(Cr(vi({},r),{center:this.centerPoint,pageNo:this.currentPageNo})):"scale"in r?this.contentService.requestViewChange(Cr(vi({},r),{pageNo:this.currentPageNo})):this.contentService.requestViewChange(r),Vi.runAsync(()=>this.apiEventBridgeService.documentReadySrc.next({ok:!0,data:void 0}))}trackByPage(t,n){return`${n.i}/${n.ref}`}renderPriorityOf(t){return this.currentPageNo-t.i-1}onPageMouseDown(t){return this.pageService.publishPage(t),this.annotSelectedService.unselectAll(),!0}isEbookMode(){return this.viewMode===4&&this.documentService.eBookStatus}canTextSearch(){return this.documentService.checkAuthority(Le.SEARCH_TEXT)}destroyMobileZoomer(){this.mobileZoomer&&this.mobileZoomer.destroy(),this.mobileZoomer=null}buildMobileZoomer(){this.destroyMobileZoomer(),this.mobileZoomer=new hp(this,this.contentViewElement,this.scrollController)}clearAllCache(){this.annotService.clearActionLogs(),this.acroFormService.clearActionLogs(),this.pageService.clearPageArrangeLogs()}isViewChangeRequestPosition(t){return t.position!==void 0}isViewChangeRequestViewport(t){return t.viewport!==void 0}isViewChangeRequestCenter(t){return t.center!==void 0}isViewChangeRequestReferencePoint(t){return t.referencePoint!==void 0}isPageOffsetReferencePoint(t){return t instanceof Object&&t.hasOwnProperty("pageNo")&&t.hasOwnProperty("x")&&t.hasOwnProperty("y")}subscribeViewChange(){this.subscriptionService.get("viewChange")===void 0&&this.subscriptionService.set("viewChange",this.contentService.viewChangeRequest$.subscribe({next:t=>{let n=this.currentPageNo,e,i,r,l;this.isViewChangeRequestReferencePoint(t)||(t.pageNo!==void 0&&(n=Math.min(Math.max(1,t.pageNo<0?this.pageCount-t.pageNo+1:t.pageNo),this.pageCount+1)),t.viewMode!==void 0&&(e=t.viewMode),t.degree!==void 0&&(i=J.normalizeDegree(t.degree)),this.isViewChangeRequestViewport(t)||(r=t.fitMode)),!this.isViewChangeRequestViewport(t)&&t.scale!==void 0&&(l=t.scale);let g=this.getCurrentRenderingInfo();if(this.isSlideshow?l=this.calculateScaleForFit(n,6,e??this.viewMode,i??this.degree):this.isViewChangeRequestViewport(t)?l=this.calculateScaleForRect(n,t.viewport):F.isDefined(r)?(l=this.calculateScaleForFit(n,r,e??this.viewMode,i??this.degree),this.store$.dispatch(he.set({key:"fitMode",value:r}))):F.isDefined(l)&&this.store$.dispatch(he.set({key:"fitMode",value:null})),l!==void 0){let y=this.renderingMode===Ci.SERVER?Je.maxScale:K.get(ne.CLIENT_RENDERING_MAXIMUM_SCALE).value;t.checkScale&&(l=this.checkScaleForFit(this.scale,l,n,e??this.viewMode,i??this.degree)),this.store$.dispatch(he.set({key:"scale",value:Math.min(Math.max(l,Je.minScale),y)}))}e!==void 0&&this.store$.dispatch(he.set({key:"viewMode",value:e})),i!==void 0&&(this.stateHolder.degree=i,this.store$.dispatch(he.set({key:"degree",value:i}))),n!==this.currentPageNo&&this.store$.dispatch(he.set({key:"currentPageNo",value:n})),this.bufferPages();let S=this.stateHolder.pdfPages[n-1];if(this.isViewChangeRequestPosition(t))this.scroll(S,{position:t.position});else if(this.isViewChangeRequestViewport(t)){let y=t.viewport;this.scroll(S,{x:(y.right+y.left)/2,y:(y.top+y.bottom)/2})}else if(this.isViewChangeRequestCenter(t))this.scroll(S,t.center);else if(this.isViewChangeRequestReferencePoint(t)){let y=this.isPageOffsetReferencePoint(t.referencePoint)?this.convertPageOffset2ViewOffset(g,t.referencePoint.pageNo,t.referencePoint.x,t.referencePoint.y):t.referencePoint,I=this.calculateScrollOnRescale(g,y);this.scroll(S,I)}else if(t.fitMode===void 0&&t.scale===void 0&&t.degree===void 0&&t.pageNo===void 0&&t.top===void 0&&t.left===void 0&&t.viewMode!==void 0){let y=this.calculateScrollOnViewmodeChange(g);this.scroll(S,y)}else if(t.fitMode===void 0&&t.degree===void 0&&t.pageNo===void 0&&t.top===void 0&&t.left===void 0&&t.viewMode===void 0&&t.scale!==void 0){let y=this.calculateScrollOnRescale(g,{clientX:0,clientY:0});this.scroll(S,y)}else if(t.top===void 0&&t.left===void 0){let y=this.calculateScaleForFit(n,0,t.viewMode??this.viewMode,t.degree??this.degree);this.scroll(S,{position:this.scale>y?xi.TOP_LEFT:xi.TOP_CENTER})}else this.scroll(S,{x:t.left,y:t.top,placeInTopLeft:!0});this.updateOffsetForGuideline(),this.scrollController.calcViewRectSrc.next(!0),this.apiEventBridgeService.viewModeChangeAppliedSrc.next({ok:!0,data:void 0}),this.apiEventBridgeService.scaleChangeAppliedSrc.next({ok:!0,data:void 0}),this.apiEventBridgeService.rotateChangeAppliedSrc.next({ok:!0,data:void 0}),this.apiEventBridgeService.fitModeAppliedSrc.next({ok:!0,data:void 0}),this.apiEventBridgeService.viewerSizeSrc.next({ok:!0,data:{width:this.scaleWrapper.nativeElement.offsetWidth,height:this.scaleWrapper.nativeElement.offsetHeight}})}}))}checkScaleForFit(t,n,e,i,r){let l=this.calculateScaleForFit(e,1,i,r),g=this.calculateScaleForFit(e,0,i,r),S=n;return t<n?t<g&&g<n&&t<l&&l<n?(S=Math.min(g,l),this.prevScale=n):t<g&&g<n?(S=g,this.prevScale=n):t<l&&l<n?(S=l,this.prevScale=n):typeof this.prevScale=="number"&&t<this.prevScale&&this.prevScale<n&&(S=this.prevScale,this.prevScale=null):t>n&&(t>g&&g>n&&t>l&&l>n?(S=Math.max(g,l),this.prevScale=n):t>g&&g>n?(S=g,this.prevScale=n):t>l&&l>n?(S=l,this.prevScale=n):typeof this.prevScale=="number"&&t>this.prevScale&&this.prevScale>n&&(S=this.prevScale,this.prevScale=null)),S}subscribeWheelZoom(){if(this.subscriptionService.get("wheelZoom")!==void 0)return;let t={x:0,y:0},n,e=Q.windowScrollEvent$.pipe(L(()=>!this.scrollController.stateHolder?.isSlideshow),L(i=>i!==void 0&&(i.ctrlKey||i.metaKey||i.altKey)));this.subscriptionService.push(Q.windowMouseMoveEvent$.pipe(xr(100,el,{trailing:!0})).subscribe({next:i=>{t.x=i.x,t.y=i.y}}),e.pipe(xr(500)).subscribe({next:()=>{n=this.scrollContainerRef.nativeElement.getBoundingClientRect()}})),this.subscriptionService.set("wheelZoom",e.subscribe({next:i=>{i.preventDefault(),this.changeZoomByWheel(t,n,i.deltaY)}}))}subscribePageArrange(){this.subscriptionService.get("pageArrange")===void 0&&this.subscriptionService.set("pageArrange",this.pageService.pageArrangeEvt$.pipe(L(F.isDefined),ct(t=>{this.store$.dispatch(he.set({key:"pageCount",value:this.stateHolder.pdfPages.length})),this.stateHolder.pdfPages=this.pageService.pdfPages,this.pdfPages.splice(0);let n=this.detectPageNo();if(this.bufferPages(),(t.action==="copy"||t.action==="delete")&&n>0){let e=this.stateHolder.pdfPages[n-1];this.scroll(e)}}),L(t=>!t.isTemporary),L(t=>t.action!=="rotate")).subscribe({next:t=>this.annotService.processPageArrangeEvt(t)}))}subscribeMainViewResized(){if(this.subscriptionService.get("mainViewResized")!==void 0)return;let t=()=>{this.viewMode!==4&&this.contentView.update(this.stateHolder,this.scale,this.viewMode,this.currentPageNo,this.degree),this.changeDetectorRef.markForCheck()};this.subscriptionService.set("mainViewResized",at(Q.windowResize$,this.store$.pipe(H("sideViewVisible")),this.store$.pipe(H("sideViewSize")),this.store$.pipe(H("rightSideViewVisible")),this.store$.pipe(H("rightSideViewSize")),this.store$.pipe(bi([V.SIDE_VIEW,V.SIDE_VIEW_THUMBNAIL,V.SIDE_VIEW_BOOKMARK,V.SIDE_VIEW_ANNOTATION,V.SIDE_VIEW_REDACTION,V.SIDE_VIEW_EMBEDDED_FILE,V.SIDE_VIEW_FORM,V.SIDE_VIEW_SIGNATURE,V.CONTEXT_MENU,V.FLOATING_NAV,V.INDICATOR]))).subscribe({next:n=>{Object.assign(this.hidableMenus,n),t(),this.subscriptionService.push(Vi.runAsync(()=>t()))}}))}initSubscribers(){this.subscriptionService.push(this.store$.pipe(ii("screenTheme")).subscribe({next:t=>this.setColorTheme(t)}),this.store$.pipe(H("scale")).subscribe({next:t=>this.scale=t}),this.store$.pipe(H("degree")).subscribe({next:t=>this.degree=t}),this.store$.pipe(H("viewMode")).subscribe({next:t=>this.viewMode=t}),this.store$.pipe(H("renderingMode")).subscribe({next:t=>this.renderingMode=t}),this.store$.pipe(H("rulerActive")).subscribe({next:t=>{this.rulerActive=t,this.rulerActive&&this.updateOffsetForGuideline()}}),this.store$.pipe(H("dragMode")).subscribe({next:t=>{this.dragMode=t,this.dragMode===Ot.MOVE?this.draggingListener.listen():this.draggingListener.unlisten()}}),this.store$.pipe(H("pageCount")).subscribe({next:t=>this.pageCount=t}),this.store$.pipe(H("isR2L")).subscribe({next:t=>this.isR2L=t}),this.store$.pipe(H("currentPageNo")).subscribe({next:t=>{this.currentPageNo=t,this.updateOffsetForGuideline()}}),this.store$.pipe(H("searchToolActive")).subscribe({next:t=>{if(!this.canTextSearch()){this.apiEventBridgeService.searchToolVisibilityChangedSrc.next({ok:!1,error:new nr("Unauthorized")});return}this.searchToolActive=t,this.changeDetectorRef.markForCheck()}}),this.store$.pipe(ii()).subscribe({next:t=>{this.preferences=t;let n=this.preferences&&this.preferences.viewerDirection===0?this.pdfInfo?.ViewerPreferences?.Direction==="R2L":this.preferences.viewerDirection===2;if(this.isR2L!==n){if(this.store$.dispatch(he.set({key:"isR2L",value:n})),this.pdfPages.splice(0),!this.scrollController||!this.stateHolder)return;this.stateHolder.isR2L=n,this.bufferPages()}this.changeDetectorRef.detectChanges()}}),this.store$.pipe(H("isCaptureMode")).subscribe({next:t=>{this.isCaptureMode=t,this.changeDetectorRef.markForCheck()}}),dn([this.contentService.bufferSizeChange$.pipe(L(F.isDefined)),this.store$.pipe(H("pageCount"),L(t=>t>0))]).subscribe({next:([t,n])=>{if(t>=n||t===0){this.bufferSize=n;return}this.bufferSize=t}}),dn([this.pageService.pdfPages$,this.documentService.docInfo$]).pipe(L(([t,n])=>t.length>0&&this.docInfo!==n)).subscribe({next:([t,n])=>{this.docInfo=n,this.onPdfDocumentReady(t)}}),dn([this.pageService.pdfPages$,this.documentService.pdfInfo$]).pipe(L(([t,n])=>t.length>0&&this.pdfInfo!==n)).subscribe({next:([t,n])=>{this.docInfo&&(this.scrollController.stop(),this.docInfo=null),this.onPdfDocumentReady(t,n)}}),this.contentService.enableLinkCreationDialog$.subscribe({next:t=>this.modalService.createModal(dr,t)}),this.contentService.rebufferPages$.subscribe({next:()=>{this.stateHolder.pdfPages=this.pageService.pdfPages,this.stateHolder.degree=this.degree,this.stateHolder.isR2L=this.isR2L,this.bufferPages()}}),this.sdContextMenuService.contextMenuStatus$.subscribe({next:t=>{this.isContextMenuOpened=t,this.changeDetectorRef.markForCheck()}}),Q.windowMousedown$.pipe(L(t=>this.selectedText?.textBox&&t.button===2)).subscribe({next:t=>{let n=this.selectedText.page.i,e=this.clickedPage?.i;(n!==e||t.target===this.scaleWrapper.nativeElement)&&this.selectTextService.publishSelectedText(null)}}),Q.windowMousedown$.pipe(L(()=>!this.isEbookMode())).subscribe({next:t=>this.isClickOnGrayArea=t.target===this.scaleWrapper.nativeElement}),this.pageService.clickedPage$.subscribe({next:t=>this.clickedPage=t}),this.selectTextService.publishSelectedText$.subscribe({next:t=>{t&&(Q.isMobile()||Q.isTablet()||Q.isTouchableDevice())&&this.sdContextMenuService.publishContextMenuStatus(!0),this.selectedText=t}}),this.shortcutService.getShortcutEvent(Ae.COPY_TEXT).pipe(L(()=>K.get(ne.SHORTCUT_COPY_TEXT)),L(()=>this.documentService.checkAuthority(Le.COPY_TEXT)),L(()=>F.isDefined(this.selectedText)&&this.selectedText.text.length>0),L(()=>!this.annotSelectedService.selectedComponents.length)).subscribe({next:t=>{t.preventDefault(),t.stopPropagation(),this.copyToClipboard(this.selectedText.text)}}),this.store$.pipe(H("isSlideshow"),L(t=>t),ut(t=>{if(!F.getFullscreenMethod(this.contentViewElement))return this.store$.dispatch(he.set({key:"isSlideshow",value:!1})),this.toastService.create({toastStyle:jt.NOTIFICATION,content:this.translatePipe.transform("NOT_SUPPORTED_BROWSER_SLIDESHOW")}),xt();this.stateHolder.isSlideshow=t,this.originalViewMode=this.viewMode,this.originalScale=this.scale,this.originalPageNo=this.currentPageNo;let n=F.getFullscreenMethod(this.contentViewElement);return n!=="requestFullscreen"?xt(this.contentViewElement[n]()):this.contentViewElement[n]()})).subscribe(),Ls(F.getFullscreenEventNames()).pipe(nl(t=>Ge(Q.nativeWindow,t)),L(t=>t.target===this.contentViewElement),ll(0),L(t=>t.length>0)).subscribe({next:()=>{if(F.isFullscreenMode()){this.renderer.setStyle(this.contentViewElement,"background-color","black"),this.renderer.setStyle(this.slideshowOverlay.nativeElement,"background-color","transparent"),this.subscribeSlideshowEvent(),this.contentService.requestViewChange({viewMode:0,fitMode:6,pageNo:1});return}this.unsubscribeSlideshowEvent(),this.stateHolder.isSlideshow=!1,this.scrollController.moveToPage(this.originalPageNo),this.renderer.setStyle(this.contentViewElement,"background-color",""),this.store$.dispatch(he.set({key:"isSlideshow",value:!1})),this.contentService.requestViewChange({viewMode:this.originalViewMode,scale:this.originalScale})}}),this.viewerService.backgroundColor$.subscribe({next:t=>{this.renderer.setStyle(this.contentViewElement,"background-color",`${t}`)}}),(()=>{let t=()=>this.scrollContainerRef.nativeElement.scrollTop/J.normalizeScale(this.scale),n=t();return Ge(this.scrollContainerRef.nativeElement,"scroll",{passive:!1}).pipe(L(()=>!this.isEbookMode())).subscribe({next:e=>{if(this.scrollController.publishScrollEvent(e),this.scrollController.calcViewRectSrc.next(!0),!J.isContinuousMode(this.viewMode))return;let i=t();this.publishScrollPosition();let r=this.detectPageNo(n<i?qr.DOWN:qr.UP);n=i,r!==this.currentPageNo&&(this.store$.dispatch(he.set({key:"currentPageNo",value:Math.min(Math.max(1,r),this.pageCount)})),this.bufferPages())}})})())}setColorTheme(t){switch(t){case"light":this.renderer.setAttribute(document.body,"theme","light");break;case"dark":this.renderer.setAttribute(document.body,"theme","dark");break;default:let n=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";this.renderer.setAttribute(document.body,"theme",n)}}publishScrollPosition(){this.guideLineService.publishScrollOffset({offsetX:this.scrollContainerRef.nativeElement.scrollLeft,offsetY:this.scrollContainerRef.nativeElement.scrollTop})}convertPageOffset2ViewOffset(t,n,e,i){let r=t.pageOffsets.find(I=>I.index===n-1),l=J.normalizeScale(t.scale),g=this.stateHolder.pdfPages[n-1],{scrollLeft:S,scrollTop:y}=this.convertPDFCoord2DOMCoord(g,{x:e,y:i});return{clientX:r.left*l+S-this.scrollContainerRef.nativeElement.scrollLeft,clientY:r.top*l+y-this.scrollContainerRef.nativeElement.scrollTop}}detectPageNo(t=qr.UNKNOWN){if(this.stateHolder.pdfPages.length<=1)return this.stateHolder.pdfPages.length;let n=J.normalizeScale(this.scale),e=this.scrollContainerRef.nativeElement,i=Math.min(this.currentPageNo,this.stateHolder.pdfPages.length),r=J.getPageMovement(this.viewMode),l=this.stateHolder.pdfPages[i-1],g=this.stateHolder.getPageFrameOffset(this.viewMode,l.i).offsetY*n;if(t===qr.UP)g>e.scrollTop+e.clientHeight*2/3?(l=this.stateHolder.pdfPages.slice(0,l.i+1).reverse().find(S=>this.stateHolder.getPageFrameOffset(this.viewMode,S.i).offsetY*n<=e.scrollTop+e.clientHeight*2/3),l&&(i=l.i-l.i%r+1)):i=l.i+1;else if(t===qr.DOWN)g+this.stateHolder.getPageSize(l.i).height*n<e.scrollTop+Number(e.clientHeight)/3?(l=this.stateHolder.pdfPages.slice(l.i).find(y=>n*(this.stateHolder.getPageFrameOffset(this.viewMode,y.i).offsetY+this.stateHolder.getPageSize(y.i).height)>e.scrollTop+Number(e.clientHeight)/3),l&&(i=l.i-l.i%r+1)):i=l.i+1;else{let S=e.clientHeight/2,y=this.stateHolder.pdfPages.find(I=>this.stateHolder.getPageFrameOffset(this.viewMode,I.i).offsetY*J.normalizeScale(this.scale)>e.scrollTop+S);i=y?Math.max(1,y.i):this.stateHolder.pdfPages.length}return i}bufferPages(){if(this.viewMode===4)return;let t=J.getPageMovement(this.viewMode),n=(J.isContinuousMode(this.viewMode)?Math.ceil(1/J.normalizeScale(this.scale)*t):t)+Ti.OPTIONAL_VISIBLE_PAGE,[e,i]=Zs.truncateRange(0,this.pageCount,this.currentPageNo,F.isDefined(this.bufferSize)?this.bufferSize/2:n);this.stateHolder.bufferedPages.splice(0);for(let r=e;r<i;r++)this.stateHolder.bufferedPages.push(this.stateHolder.pdfPages[r]);this.pdfPages.splice(0),this.pdfPages.push(...this.stateHolder.bufferedPages),this.changeDetectorRef.detectChanges(),this.contentView.update(this.stateHolder,this.scale,this.viewMode,this.currentPageNo,this.degree),this.contentService.bufferPage(this.stateHolder.bufferedPages)}isPDFCoordDestination(t){return t instanceof Object&&(t.hasOwnProperty("x")||t.hasOwnProperty("y"))}isDOMCoordDestination(t){return t instanceof Object&&(t.hasOwnProperty("scrollLeft")||t.hasOwnProperty("scrollTop"))}isPositionDestination(t){return t instanceof Object&&t.hasOwnProperty("position")}scroll(t,n){if(this.viewMode===4){console.warn("Scroll request was ignored during eBook mode.");return}let e=this.stateHolder.getPageFrameOffset(this.viewMode,t.i),i=J.normalizeScale(this.scale),r={};if(this.isPDFCoordDestination(n)){let{scrollLeft:l,scrollTop:g}=this.convertPDFCoord2DOMCoord(t,{x:n.x??0,y:n.y??0});n.x!==void 0&&(r.scrollLeft=e.offsetX*i+l+Ti.MARGIN*i,n.placeInTopLeft||(r.scrollLeft-=this.scrollContainerRef.nativeElement.clientWidth/2)),n.y!==void 0&&(r.scrollTop=e.offsetY*i+g+Ti.MARGIN*i,n.placeInTopLeft||(r.scrollTop-=this.scrollContainerRef.nativeElement.clientHeight/2))}else this.isDOMCoordDestination(n)?r=n:this.isPositionDestination(n)&&(r=this.convertPosition2DOMCoord(t,{clientX:e.offsetX*i,clientY:e.offsetY*i},n));r.scrollLeft!==void 0&&(this.scrollContainerRef.nativeElement.scrollLeft=r.scrollLeft),r.scrollTop!==void 0&&(this.scrollContainerRef.nativeElement.scrollTop=r.scrollTop)}convertPDFCoord2DOMCoord(t,n){let e=t.bbox,i=J.normalizeScale(this.scale),r=J.normalizeDegree(this.degree+t.r);(n.x===void 0||n.y===void 0)&&this.loggingService.common("warn",pi.NOT_EXIST,"scrollDestination");let l=0,g=0;switch(r){case 0:l=n.x-e.x,g=e.h-(n.y-e.y);break;case 90:l=n.y-e.y,g=n.x-e.x;break;case 180:l=e.w-(n.x-e.x),g=n.y-e.y;break;case 270:l=e.h-(n.y-e.y),g=e.w-(n.x-e.x);break;default:throw Error("Rotate must be a multiple of 90")}return{scrollLeft:l*i,scrollTop:g*i}}convertPosition2DOMCoord(t,n,e){let i=t.bbox,r=J.normalizeScale(this.scale),g=J.normalizeDegree(this.degree+t.r)/90%2!==0,S,y;switch(e.position){case xi.TOP_ONLY:case xi.BOTTOM_ONLY:break;case xi.TOP_LEFT:case xi.LEFT_ONLY:case xi.BOTTOM_LEFT:S=n.clientX;break;case xi.TOP_CENTER:case xi.BOTTOM_CENTER:S=n.clientX+(g?i.h:i.w)*r/2-this.scrollContainerRef.nativeElement.clientWidth/2+Ti.MARGIN*r;break;case xi.RIGHT_ONLY:S=n.clientX+(g?i.h:i.w)*r-this.scrollContainerRef.nativeElement.clientWidth+Ti.MARGIN*r;break}switch(e.position){case xi.LEFT_ONLY:case xi.RIGHT_ONLY:break;case xi.TOP_ONLY:case xi.TOP_LEFT:case xi.TOP_CENTER:y=n.clientY;break;case xi.BOTTOM_ONLY:case xi.BOTTOM_LEFT:case xi.BOTTOM_CENTER:y=(g?i.w:i.h)*r-this.scrollContainerRef.nativeElement.clientHeight+Ti.MARGIN*r;break}return{scrollLeft:S,scrollTop:y}}getCurrentRenderingInfo(){let t=this.scrollContainerRef.nativeElement,n={degree:this.degree,scale:this.scale,scrollLeft:t.scrollLeft,scrollTop:t.scrollTop,pageOffsets:[]},e=J.normalizeScale(this.scale);if(J.isContinuousMode(this.viewMode))this.pdfPages.forEach(i=>{let r=this.stateHolder.getPageFrameOffset(this.viewMode,i.i);n.pageOffsets.push({left:r.offsetX,top:r.offsetY,index:i.i})});else{let i=zn.getOffset(this.stateHolder,this.scrollContainerRef.nativeElement,this.scale,this.viewMode,this.currentPageNo);n.pageOffsets.push({left:i.offsetX/e,top:i.offsetY/e,index:this.currentPageNo-1})}return n}calculateScrollOnRescale(t,n){let e=J.normalizeScale(t.scale),i=J.normalizeScale(this.scale);return{scrollLeft:(t.scrollLeft+n.clientX)/e*i-n.clientX,scrollTop:(t.scrollTop+n.clientY)/e*i-n.clientY}}calculateScrollOnViewmodeChange(t){let n=J.normalizeScale(t.scale),e=t.pageOffsets.find(y=>y.index===this.currentPageNo-1),i=e?e.left*n-t.scrollLeft:0,r=e?e.top*n-t.scrollTop:0,l,g,S=J.normalizeScale(this.scale);if(J.isContinuousMode(this.viewMode)){let y=this.stateHolder.getPageFrameOffset(this.viewMode,this.currentPageNo-1);l=y.offsetX*S,g=y.offsetY*S}else{let y=zn.getOffset(this.stateHolder,this.scrollContainerRef.nativeElement,this.scale,this.viewMode,this.currentPageNo);l=y.offsetX,g=y.offsetY}return{scrollLeft:l-i,scrollTop:g-r}}calculateScaleForRect(t,n){let e=this.scrollContainerRef.nativeElement,i=e.clientWidth/e.clientHeight,l=J.normalizeDegree(this.stateHolder.pdfPages[t-1].r+this.degree)/90%2!==0,g=Math.abs(n.right-n.left),S=Math.abs(n.top-n.bottom),y=g/S;return i>y?e.clientHeight/(l?g:S)*100/J.SCALE_CORRECTION_CONST:e.clientWidth/(l?S:g)*100/J.SCALE_CORRECTION_CONST}calculateScaleForFit(t,n,e,i){let{pdfPages:r}=this.stateHolder,l=J.isTwoPageMode(e)?2:1,g=t-1,S=g-g%l,[y,I]=r.slice(S,S+2),[B,ee]=ec.calculateMaxArea(y,i),[ge,le]=I?ec.calculateMaxArea(I,i):[0,0],Te=this.contentViewElement.offsetWidth,$e=this.contentViewElement.offsetHeight,p=this.selectFitMode(n,B,ee,Te,$e),vt=J.isTwoPageMode(e)&&(r.length%2!==1||t!==r.length),gt,ft=0,Et=Te/$e,Li=this.stateHolder.getPageContainerSize(e,g),si=Li.width/Li.height;if(p===0)ft=Te,Et>si&&(ft-=Q.scrollbarSize.vertical),gt=B+Ti.MARGIN*2+(vt?ge+Ti.MARGIN*2:0);else if(p===1)ft=$e,Et<si&&(ft-=Q.scrollbarSize.horizontal),gt=(vt?Math.max(ee,le):ee)+Ti.MARGIN*2;else{if(p===4)return 100;if(p===6){let Oe=this.selectFitMode(3,B,ee,Te,$e);gt=Oe===0?B:ee,Q.isLandscape()&&Q.screenSize.height>Q.screenSize.width?ft=Oe===0?Q.screenSize.height:Q.screenSize.width:ft=Oe===0?Q.screenSize.width:Q.screenSize.height}else this.loggingService.common("warn",pi.INVALID,"fitMode",p)}let Ii=ft/gt*100;return(this.isSlideshow?Ii:Math.floor(Ii))/J.SCALE_CORRECTION_CONST}selectFitMode(t,n,e,i,r){switch(t){case 2:return Q.isSmallDevice()||n>e?0:1;case 3:return n/e>i/r?0:1;case 5:return n*J.SCALE_CORRECTION_CONST>i?0:4;default:return t}}subscribeSlideshowEvent(){this.subscriptionService.set("slideshowOrientationChange",Oo(()=>Q.nativeWindow.screen.orientation?Ge(Q.nativeWindow.screen.orientation,"change"):xt(void 0)).subscribe({next:()=>{this.contentService.requestViewChange({fitMode:6})}})),this.subscriptionService.set("slideshowResizeEvent",Ge(Q.nativeWindow,"resize").pipe(L(()=>document[F.getFullscreenElement()]&&this.stateHolder.isSlideshow)).subscribe({next:()=>{this.contentService.requestViewChange({fitMode:6})}})),this.subscriptionService.set("slideshowKeyboardEvent",Ge(Q.nativeWindow,"keydown").subscribe({next:t=>{if(t.key!=="Tab"&&(t.preventDefault(),t.stopPropagation()),this.slideshowOverlay.nativeElement.style.backgroundColor!=="transparent"){this.renderer.setStyle(this.slideshowOverlay.nativeElement,"background-color","transparent");return}if(t.key==="."||t.key==="B"||t.key==="b"){this.renderer.setStyle(this.slideshowOverlay.nativeElement,"background-color","#000000");return}if(t.key===","||t.key==="W"||t.key==="w"){this.renderer.setStyle(this.slideshowOverlay.nativeElement,"background-color","#FFFFFF");return}this.currentPageNo!==1&&(t.key==="ArrowLeft"||t.key==="ArrowUp"||t.key==="PageUp"||t.key==="Backspace")&&this.scrollController.moveToPrevPage(),this.currentPageNo!==this.pageCount&&(t.key==="ArrowRight"||t.key==="ArrowDown"||t.key==="PageDown"||t.key===" ")&&this.scrollController.moveToNextPage(),this.currentPageNo!==1&&t.key==="Home"&&this.scrollController.moveToPage(1),this.currentPageNo!==this.pageCount&&t.key==="End"&&this.scrollController.moveToPage(this.pageCount)}})),this.subscriptionService.set("slideshowMouseEvent",Ge(this.slideshowOverlay.nativeElement,"pointerdown").pipe(L(t=>t.pointerType==="mouse"&&t.button===0)).subscribe({next:t=>{if(t.preventDefault(),t.stopPropagation(),this.slideshowOverlay.nativeElement.style.backgroundColor!=="transparent"){this.renderer.setStyle(this.slideshowOverlay.nativeElement,"background-color","transparent");return}this.scrollController.moveToNextPage()}})),this.subscriptionService.set("slideshowTouchEvent",at(Ge(this.slideshowOverlay.nativeElement,"touchstart"),Ge(this.slideshowOverlay.nativeElement,"touchmove"),Ge(this.slideshowOverlay.nativeElement,"touchend")).pipe(L(t=>t.touches.length>1)).subscribe({next:t=>{t.preventDefault(),t.stopPropagation()}})),this.subscriptionService.set("slideshowToucheventEvent",Ge(this.slideshowOverlay.nativeElement,"touchend").pipe(L(t=>t.touches.length<1)).subscribe({next:t=>{t.preventDefault(),t.stopPropagation(),this.scrollController.moveToNextPage()}}))}unsubscribeSlideshowEvent(){this.subscriptionService.get("slideshowOrientationChange")?.unsubscribe(),this.subscriptionService.get("slideshowResizeEvent")?.unsubscribe(),this.subscriptionService.get("slideshowKeyboardEvent")?.unsubscribe(),this.subscriptionService.get("slideshowMouseEvent")?.unsubscribe(),this.subscriptionService.get("slideshowTouchEvent")?.unsubscribe(),this.subscriptionService.get("slideshowToucheventEvent")?.unsubscribe()}updateOffsetForGuideline(){if(!this.rulerActive)return;let t=J.normalizeScale(this.scale),n=zn.getOffset(this.stateHolder,this.contentViewElement,this.scale,this.viewMode,this.currentPageNo),e=vi({},this.stateHolder.getPageFrameOffset(this.viewMode,this.currentPageNo-1));e.offsetX=(e.offsetX+Ti.MARGIN)*t,e.offsetY=(e.offsetY+Ti.MARGIN)*t,this.guideLineService.publishContentViewOffset({offsetX:n.offsetX+e.offsetX,offsetY:n.offsetY+e.offsetY,width:this.contentViewElement.offsetWidth,height:this.contentViewElement.offsetHeight}),this.guideLineService.publishScrollOffset({offsetX:this.contentViewElement.scrollLeft,offsetY:this.contentViewElement.scrollTop})}initDraggingListener(){this.draggingListener.addTriggerEvent(this.contentViewElement,"mousedown",t=>t.target instanceof Element&&t.target.classList.contains("no-scroller")?!1:(document.activeElement instanceof HTMLElement&&document.activeElement.blur(),t.preventDefault(),!0)),this.draggingListener.addMainEvent(window,"mousemove",t=>this.moveScrollByDragging(t)),this.draggingListener.addTerminatorEvent(window,"mouseup",()=>this.changeDetectorRef.markForCheck()),this.draggingListener.addTerminatorEvent(window,"blur",()=>this.changeDetectorRef.markForCheck())}moveScrollByDragging(t){this.contentViewElement.scrollLeft-=t.movementX,this.contentViewElement.scrollTop-=t.movementY}finalizeSubscribers(){this.pageService.publishPages([]),this.documentService.closeEBook()}copyToClipboard(t){Q.copyToClipboard(t)}changeZoomByWheel(t,n,e){this.contentService.requestViewChange({scale:J.calculateNextScale(this.scale,e<0),checkScale:!0,referencePoint:{clientX:t.x-n.x,clientY:t.y-n.y}})}};A(Kr,"\u0275fac",function(n){return new(n||Kr)(v(bn),v(ni),v(ye),v(ot),v(Ht),v(Pi),v(it),v(tn),v(Ee),v(oi),v(Z),v(Ei),v(Dp),v(Ki),v(Bo),v(Fo),v(At),v(Zi),v(Ve),v(ra),v(Hi),v(ji),v(on))}),A(Kr,"\u0275cmp",Ce({type:Kr,selectors:[["sd-content-view"]],viewQuery:function(n,e){if(n&1&&(Ue($u,7),Ue(Wu,5),Ue(xa,7),Ue(zu,5)),n&2){let i;Re(i=Ie())&&(e.scrollContainerRef=i.first),Re(i=Ie())&&(e.scaleWrapper=i.first),Re(i=Ie())&&(e.contentView=i.first),Re(i=Ie())&&(e.slideshowOverlay=i.first)}},inputs:{pdfDoc:"pdfDoc",overWrittenZoom:"overWrittenZoom",centerPoint:"centerPoint"},standalone:!1,features:[be([Z]),qi],decls:12,vars:9,consts:[["scrollContainerRef",""],["floatingNav",""],["scaleWrapper",""],["slideshowOverlay",""],[4,"ngTemplateOutlet"],["sdContentViewLayout","",1,"pre-scrollable",3,"mouseup","ngStyle"],[4,"ngIf"],[3,"documentId",4,"ngIf"],["id","slideshow-overlay",4,"ngIf"],["id","search-tool",3,"pdfDoc",4,"ngIf"],[3,"contentViewRoot",4,"ngIf"],["id","scale-wrapper","sdScaleWrapperLayout",""],["id","scroll-expander","sdScrollExpanderLayout",""],["class","page-frame","sdPageFrameLayout","",3,"page",4,"ngFor","ngForOf","ngForTrackBy"],[3,"eventInfo","isClickOnGrayArea",4,"ngIf"],[3,"contentViewRoot"],["sdPageFrameLayout","",1,"page-frame",3,"page"],["sdCopyPaste","","sdPageContentLayout","",3,"mousedown","priority","page","documentId"],[3,"eventInfo","isClickOnGrayArea"],[3,"documentId"],["id","slideshow-overlay"],["id","search-tool",3,"pdfDoc"],[3,"pdfDoc",4,"ngIf"],[3,"pdfDoc"]],template:function(n,e){if(n&1){let i=_e();se(0,Gu,1,0,"ng-container",4),R(1,"div",5,0),ce("mouseup",function(l){return W(i),z(e.onRightMouseUp(l))}),se(3,Xu,8,7,"ng-container",6)(4,Zu,1,1,"sd-ebook-view",7)(5,Ju,2,0,"div",8)(6,eg,1,0,"ng-container",4)(7,tg,1,0,"sd-quick-action",6),N(),se(8,ig,1,1,"sd-search-tool",9)(9,ng,1,0,"sd-indicator",6)(10,rg,1,1,"ng-template",null,1,ci)}if(n&2){let i=ei(11);O("ngTemplateOutlet",!e.isSlideshow&&i),x(),O("ngStyle",e.contentViewStyle),x(2),O("ngIf",!e.isEbookMode()),x(),O("ngIf",e.isEbookMode()),x(),O("ngIf",e.isSlideshow),x(),O("ngTemplateOutlet",e.isSlideshow&&i),x(),O("ngIf",!e.isSlideshow),x(),O("ngIf",e.canTextSearch()&&e.searchToolActive),x(),O("ngIf",e.runtimeEnv.get(e.MergedRuntimeEnvKey.INDICATOR)&&!e.isSlideshow&&!e.hidableMenus[e.HidableView.INDICATOR])}},styles:["i.papycon-chevron3-down[_ngcontent-%COMP%]{transform:scale(.5);font-size:18px;line-height:48px;margin:-12px -7.5px;padding:0 6px;transform-origin:50% 50%}i[_ngcontent-%COMP%] + i.papycon-chevron3-down[_ngcontent-%COMP%]{margin:-12px -8.5px;padding:0 8px}i.papycon-chevron3-down.expanded[_ngcontent-%COMP%]{transform:scale(.5) rotate(-180deg)}#scale-wrapper[_ngcontent-%COMP%]{position:absolute;top:0}#scale-wrapper.capture-mode[_ngcontent-%COMP%]{z-index:4}#scroll-expander[_ngcontent-%COMP%]{display:table;transform-origin:0 0}.pre-scrollable[_ngcontent-%COMP%]{overflow:auto;position:relative;width:100%;height:100%;-webkit-overflow-scrolling:touch}.page-frame[_ngcontent-%COMP%]{position:absolute;display:table-cell}.hide-outline[_ngcontent-%COMP%]{outline:none}.hide-background[_ngcontent-%COMP%]{background-color:transparent}#slideshow-overlay[_ngcontent-%COMP%]{width:100%;height:100%;position:fixed;top:0;left:0;cursor:default}"],changeDetection:0}));var So=Kr;Qe([st(nt.contentViewComp.moveScrollByDragging,1e3)],So.prototype,"moveScrollByDragging",null);Qe([st(nt.contentViewComp.copyToClipboard,1e3)],So.prototype,"copyToClipboard",null);Qe([st(nt.contentViewComp.changeZoomByWheel,1e3)],So.prototype,"changeZoomByWheel",null);var cd=(()=>{let t=class t{elementRef;subscriptionService;objectClipboardService;annotSelectedService;shortcutService;store$;page;degree;currentPageNo;constructor(e,i,r,l,g,S){this.elementRef=e,this.subscriptionService=i,this.objectClipboardService=r,this.annotSelectedService=l,this.shortcutService=g,this.store$=S}ngOnInit(){this.subscriptionService.push(this.store$.pipe(H("degree")).subscribe({next:e=>this.degree=e}),this.store$.pipe(H("currentPageNo")).subscribe({next:e=>this.currentPageNo=e}),Ge(this.elementRef.nativeElement,"mouseenter").pipe(L(()=>this.page.i!==this.objectClipboardService.lastestEnteredPageIndex)).subscribe({next:()=>this.objectClipboardService.pushlishLastestEnteredPageIndex(this.page.i)}),at(Ge(window,"copy"),this.shortcutService.getShortcutEvent(Ae.COPY_ANNOTS).pipe(L(e=>this.isFakeEvent(e)))).pipe(L(()=>K.get(ne.SHORTCUT_COPY_PASTE)),L(()=>this.annotSelectedService.pageIndex===this.page.i),L(e=>!(e.target instanceof HTMLInputElement)&&!(e.target instanceof HTMLTextAreaElement))).subscribe({next:e=>{e.preventDefault(),this.objectClipboardService.copy(this.annotSelectedService.selectedComponents.map(i=>F.deepClone(i.data)),this.page.i,!(e instanceof KeyboardEvent)&&Q.nativeWindow.isSecureContext)}}),at(Ge(Q.nativeWindow,"paste").pipe(L(()=>this.page.i===this.objectClipboardService.lastestEnteredPageIndex),fl(Ge(this.elementRef.nativeElement,"mousemove",{capture:!0}))),this.shortcutService.getShortcutEvent(Ae.PASTE_ANNOTS).pipe(L(()=>this.currentPageNo-1===this.page.i),L(e=>this.isFakeEvent(e)),ze(e=>[e]))).pipe(L(()=>K.get(ne.SHORTCUT_COPY_PASTE)),L(([e])=>!(e.target instanceof HTMLInputElement)&&!(e.target instanceof HTMLTextAreaElement))).subscribe({next:([e,i])=>{let r,l,g;e instanceof KeyboardEvent||(r=e.clipboardData.getData("text/plain"),l=e.clipboardData.getData("text/html"),g=e.clipboardData.files.item(0)),this.objectClipboardService.paste({text:r,html:l,image:g},i?this.convertMouseToPagePoints(i,(this.page.r+this.degree)/90%4):null,this.page)}}))}convertMouseToPagePoints(e,i){let l=this.elementRef.nativeElement.getBoundingClientRect();switch(i){case 0:return{x:(e.clientX-l.left)*(this.page.bbox.w/l.width),y:this.page.bbox.h-(e.clientY-l.top)*(this.page.bbox.h/l.height)};case 1:return{x:(e.clientY-l.top)*(this.page.bbox.w/l.height),y:(e.clientX-l.left)*(this.page.bbox.h/l.width)};case 2:return{x:this.page.bbox.w-(e.clientX-l.left)*(this.page.bbox.w/l.width),y:(e.clientY-l.top)*(this.page.bbox.h/l.height)};case 3:return{x:this.page.bbox.w-(e.clientY-l.top)*(this.page.bbox.w/l.height),y:this.page.bbox.h-(e.clientX-l.left)*(this.page.bbox.h/l.width)};default:throw new Tt(`Unsupported rotate: ${i}`)}}isFakeEvent(e){return!e.isTrusted}};A(t,"\u0275fac",function(i){return new(i||t)(v(Zt),v(Z),v(aa),v(Pi),v(Hi),v(Ee))}),A(t,"\u0275dir",gn({type:t,selectors:[["","sdCopyPaste",""]],inputs:{page:"page"},standalone:!1,features:[be([Z])]}));let a=t;return a})();var ag=["floatingNav"],Ms=a=>({content:a});function cg(a,t){if(a&1){let n=_e();Lt(0),R(1,"div",6)(2,"pu-input",7),G(3,"translate"),ce("keydown.enter",function(){W(n);let i=w(2);return z(i.goToPage(i.pageNoFormControl.value))})("focus",function(){W(n);let i=w(2);return z(i.onNavInputFocus())})("blur",function(){W(n);let i=w(2);return z(i.onNavInputBlur())}),N(),R(4,"div",8),me(5),N()(),Ft()}if(a&2){let n=w(2);x(2),Gi("max-width",n.pageNoFormControl.value.toString().length<=3?29:null,"px"),O("readonly",n.isSlideshow)("autoResize",n.pageNoFormControl.value.toString().length>=3)("maxLength",n.pageCount.toString().length)("formControl",n.pageNoFormControl)("ariaLabel",Y(3,9,"MOVE_SPECIFYING_PAGE")),x(2),O("ngStyle",n.pdfDoc?null:n.viewerService.disableStyle),x(),Tr(" /\xA0",n.pageCount,"")}}function lg(a,t){if(a&1){let n=_e();Lt(0),R(1,"div",9)(2,"button",10),G(3,"translate"),G(4,"translate"),G(5,"translate"),ce("click",function(){W(n);let i=w(2);return z(i.goPreviousPageForStatistics(i.ViewerStatisticData.CHANGE_PAGE_BY_FLOATING_NAV_BUTTON))})("focus",function(){W(n);let i=w(2);return z(i.onNavInputFocus())})("blur",function(){W(n);let i=w(2);return z(i.onNavInputBlur())}),X(6,"i",11),N(),R(7,"button",12),G(8,"translate"),G(9,"translate"),G(10,"translate"),ce("click",function(){W(n);let i=w(2);return z(i.goNextPageForStatistics(i.ViewerStatisticData.CHANGE_PAGE_BY_FLOATING_NAV_BUTTON))})("focus",function(){W(n);let i=w(2);return z(i.onNavInputFocus())})("blur",function(){W(n);let i=w(2);return z(i.onNavInputBlur())}),X(11,"i",13),N()(),Ft()}if(a&2){let n=w(2);x(2),Ye("dark",n.isDarkMode)("disabled",n.prevButtonDisabled),O("disabled",n.prevButtonDisabled)("title",n.isMobile?"":Y(3,18,"PREVIOUS_PAGE"))("tooltip",_t(30,Ms,Y(4,20,"PREVIOUS_PAGE"))),ue("color",n.isDarkMode?"white":"dark")("aria-label",Y(5,22,"PREVIOUS_PAGE")),x(5),Ye("dark",n.isDarkMode)("disabled",n.nextButtonDisabled),O("disabled",n.nextButtonDisabled)("title",n.isMobile?"":Y(8,24,"NEXT_PAGE"))("tooltip",_t(32,Ms,Y(9,26,"NEXT_PAGE"))),ue("color",n.isDarkMode?"white":"dark")("aria-label",Y(10,28,"NEXT_PAGE"))}}function pg(a,t){if(a&1){let n=_e();Lt(0),R(1,"div",14)(2,"button",15),G(3,"translate"),G(4,"translate"),ce("click",function(){W(n);let i=w(2);return z(i.zoomOut(i.ViewerStatisticData.CHANGE_ZOOM_BY_FLOATING_NAV))})("focus",function(){W(n);let i=w(2);return z(i.onNavInputFocus())})("blur",function(){W(n);let i=w(2);return z(i.onNavInputBlur())}),X(5,"i",16),N(),R(6,"button",17),G(7,"translate"),G(8,"translate"),ce("click",function(){W(n);let i=w(2);return z(i.zoomIn(i.ViewerStatisticData.CHANGE_ZOOM_BY_FLOATING_NAV))})("focus",function(){W(n);let i=w(2);return z(i.onNavInputFocus())})("blur",function(){W(n);let i=w(2);return z(i.onNavInputBlur())}),X(9,"i",18),N()(),Ft()}if(a&2){let n=w(2);x(2),Ye("dark",n.isDarkMode)("disabled",!n.pdfDoc),O("disabled",!n.pdfDoc)("title",n.isMobile?"":Y(3,18,"ZOOM_OUT"))("tooltip",_t(26,Ms,n.zoomOutTooltipWithShortcut)),ue("color",n.isDarkMode?"white":"dark")("aria-label",Y(4,20,"ZOOM_OUT")),x(4),Ye("dark",n.isDarkMode)("disabled",!n.pdfDoc),O("disabled",!n.pdfDoc)("title",n.isMobile?"":Y(7,22,"ZOOM_IN"))("tooltip",_t(28,Ms,n.zoomInTooltipWithShortcut)),ue("color",n.isDarkMode?"white":"dark")("aria-label",Y(8,24,"ZOOM_IN"))}}function dg(a,t){a&1&&X(0,"div",4)}function hg(a,t){if(a&1){let n=_e();Lt(0),R(1,"div",19)(2,"button",20),G(3,"translate"),G(4,"translate"),ce("click",function(){W(n);let i=w(2);return z(i.onClickSearchButton())})("focus",function(){W(n);let i=w(2);return z(i.onNavInputFocus())})("blur",function(){W(n);let i=w(2);return z(i.onNavInputBlur())}),X(5,"i",21),N()(),Ft()}if(a&2){let n=w(2);x(2),Ye("dark",n.isDarkMode)("disabled",!n.pdfDoc),O("disabled",!n.pdfDoc)("title",n.isMobile?"":Y(3,10,"SEARCH"))("tooltip",_t(14,Ms,n.searchTooltipWithShortcut)),ue("color",n.isDarkMode?"white":"dark")("aria-label",Y(4,12,"SEARCH"))("aria-expanded",n.searchToolActive)}}function ug(a,t){if(a&1){let n=_e();Lt(0),R(1,"div",22)(2,"button",23),G(3,"translate"),G(4,"translate"),ce("click",function(){W(n);let i=w(2);return z(i.closeSlideshow())})("focus",function(){W(n);let i=w(2);return z(i.onNavInputFocus())})("blur",function(){W(n);let i=w(2);return z(i.onNavInputBlur())}),X(5,"i",24),N()(),Ft()}if(a&2){let n=w(2);x(2),Ye("dark",n.isDarkMode)("disabled",!n.pdfDoc),O("disabled",!n.pdfDoc)("title",n.isMobile?"":Y(3,8,"CLOSE")),ue("color",n.isDarkMode?"white":"dark")("aria-label",Y(4,10,"CLOSE"))}}function gg(a,t){if(a&1){let n=_e();R(0,"div",2,0),ce("mouseenter",function(){W(n);let i=w();return z(i.onMouseEnterNav())})("mouseleave",function(){W(n);let i=w();return z(i.onMouseLeaveNav())}),se(2,cg,6,11,"ng-container",3)(3,lg,12,34,"ng-container",3),X(4,"div",4),se(5,pg,10,30,"ng-container",3)(6,dg,1,0,"div",5)(7,hg,6,16,"ng-container",3)(8,ug,6,12,"ng-container",3),N()}if(a&2){let n=w();Gi("bottom",n.floatingPosition,"px"),O("@navFadeOut",n.shouldBeTransparent?"out":"in"),x(2),O("ngIf",n.runtimeEnv.get(n.RuntimeEnvKey.PAGE_NAVIGATION)),x(),O("ngIf",n.runtimeEnv.get(n.RuntimeEnvKey.MOVE_TO_ADJACENT_PAGE_BUTTON)),x(2),O("ngIf",!n.isSlideshow&&n.runtimeEnv.get(n.RuntimeEnvKey.ZOOM_BUTTON)),x(),O("ngIf",!n.isSlideshow&&n.runtimeEnv.get(n.MergedRuntimeEnvKey.SEARCH_BUTTON)&&!n.hidableMenus[n.HidableView.FLOATING_NAV_SEARCH]),x(),O("ngIf",!n.isSlideshow&&n.runtimeEnv.get(n.MergedRuntimeEnvKey.SEARCH_BUTTON)&&!n.hidableMenus[n.HidableView.FLOATING_NAV_SEARCH]),x(),O("ngIf",n.isSlideshow)}}var Qn=function(a){return a.TRANSPARENT="transparent",a.OPAQUE="opaque",a}(Qn||{}),fg=24,mg=73,Xr=class Xr{changeDetectorRef;translatePipe;documentService;contentService;scrollController;store$;viewerService;subscriptionService;apiEventBridgeService;shortcutService;redactionService;quickActionService;get RuntimeEnvKey(){return ne}get MergedRuntimeEnvKey(){return Ct}get runtimeEnv(){return K}get HidableView(){return V}get zoomInTooltipWithShortcut(){return`${this.translatePipe.transform("ZOOM_IN")} (${li.getShortcutString(Xi[Ae.INCREASE_ZOOM_NUMPAD])})`}get zoomOutTooltipWithShortcut(){return`${this.translatePipe.transform("ZOOM_OUT")} (${li.getShortcutString(Xi[Ae.DECREASE_ZOOM_NUMPAD])})`}get searchTooltipWithShortcut(){return`${this.translatePipe.transform("SEARCH")} (${li.getShortcutString(Xi[Ae.SEARCH])})`}get prevButtonDisabled(){return this.currentPageNo<=1}get nextButtonDisabled(){return this.viewMode===4?J.getEbookPageNo(this.pageCount)<=this.currentPageNo:this.pageCount<=this.currentPageNo}get shouldDisplayNav(){return!this.isToolSelected}get shouldBeTransparent(){return!this._isMouseOnNav&&!this._isNavInputOnFocus&&!this.searchToolActive&&this._navTransparency===Qn.TRANSPARENT&&K.get(ne.FLOATING_NAVIGATION_AUTO_HIDE)}pdfDoc;floatingnavElement;scale;viewMode;currentPageNo;pageCount;isSlideshow;isToolSelected;searchToolActive;_isMouseOnNav=!1;_isNavInputOnFocus=!1;_navTransparency=Qn.OPAQUE;rightSideViewMode;rightSideViewVisible;hidableMenus={};pageNoFormControl=new or(1);navVisibilityChanges=new Yt(Qn.OPAQUE);screenTheme;NAV_AREA_WIDTH_PC=Q.breakpoints.mobile.width;NAV_AREA_HEIGHT_PC=166;NAV_VISIBLE_DURATION_MS=3e3;get ViewerStatisticData(){return de}get floatingPosition(){return this.redactionService.isRedactingOnMobile()?mg:fg}get isDarkMode(){return this.screenTheme==="light"?!1:this.screenTheme==="dark"||window.matchMedia("(prefers-color-scheme: dark)")?.matches}get isMobile(){return Q.isMobile()}constructor(t,n,e,i,r,l,g,S,y,I,B,ee){this.changeDetectorRef=t,this.translatePipe=n,this.documentService=e,this.contentService=i,this.scrollController=r,this.store$=l,this.viewerService=g,this.subscriptionService=S,this.apiEventBridgeService=y,this.shortcutService=I,this.redactionService=B,this.quickActionService=ee}ngOnInit(){this.initSubscriptions(),this.subscribeVisiblityChange(),this.initRegisterQuickActions()}initSubscriptions(){this.subscriptionService.push(this.store$.pipe(bi([V.FLOATING_NAV_SEARCH])).subscribe({next:t=>{Object.assign(this.hidableMenus,t),this.changeDetectorRef.markForCheck()}}),this.store$.pipe(ii("screenTheme")).subscribe({next:t=>{this.screenTheme=t,this.changeDetectorRef.markForCheck()}}),this.store$.pipe(H("scale")).subscribe({next:t=>this.scale=t}),this.store$.pipe(H("pageCount")).subscribe({next:t=>{this.pageCount=t,this.changeDetectorRef.markForCheck()}}),this.store$.pipe(H("viewMode")).subscribe({next:t=>this.viewMode=t}),this.store$.pipe(H("rightSideViewMode")).subscribe({next:t=>{this.rightSideViewMode=t,this.changeDetectorRef.markForCheck()}}),this.store$.pipe(H("rightSideViewVisible")).subscribe({next:t=>{this.rightSideViewVisible=t,this.changeDetectorRef.markForCheck()}}),this.store$.pipe(H("currentPageNo")).subscribe({next:t=>{this.currentPageNo=t,this.pageNoFormControl.setValue(this.currentPageNo)}}),this.store$.pipe(H("searchToolActive")).subscribe({next:t=>{if(!this.documentService.checkAuthority(Le.SEARCH_TEXT)){this.apiEventBridgeService.searchToolVisibilityChangedSrc.next({ok:!1,error:new nr("Unauthorized")});return}this.searchToolActive=t,this.changeDetectorRef.markForCheck()}}),this.store$.pipe(H("isSlideshow")).subscribe({next:t=>this.isSlideshow=t}),this.shortcutService.getShortcutEvent(Ae.SEARCH).subscribe({next:()=>{this.documentService.checkAuthority(Le.SEARCH_TEXT)&&(K.get(ne.QUICK_SEARCH_BUTTON)||K.get(ne.FULL_SEARCH_BUTTON))&&!this.isEbookMode()&&this.pdfDoc&&this.onClickSearchButton()}}))}subscribeVisiblityChange(){this.subscriptionService.push(this.navVisibilityChanges.pipe(ut(()=>(this._navTransparency=Qn.OPAQUE,this.changeDetectorRef.markForCheck(),er(this.NAV_VISIBLE_DURATION_MS)))).subscribe({next:()=>{this._navTransparency=Qn.TRANSPARENT,this.changeDetectorRef.markForCheck()}}),Q.windowResize$.subscribe({next:()=>this.navVisibilityChanges.next(Qn.OPAQUE)}),this.scrollController.viewScroll$.subscribe({next:()=>this.navVisibilityChanges.next(Qn.OPAQUE)}),Q.windowMouseMoveEvent$.pipe(ri(10)).subscribe({next:t=>{this.floatingnavElement&&this.isMouseInsideActiveNavArea(t)&&this.navVisibilityChanges.next(Qn.OPAQUE)}}),this.store$.pipe(Ao()).subscribe({next:t=>{this.isToolSelected=t!==null,this.changeDetectorRef.markForCheck()}}),Q.windowPointerUp$.pipe(L(()=>this.isSlideshow)).subscribe({next:()=>this.navVisibilityChanges.next(Qn.OPAQUE)}))}initRegisterQuickActions(){this.quickActionService.registerActions([{id:Se.PREVIOUS_PAGE,actionFn:()=>this.goPreviousPageForStatistics(de.CHANGE_PAGE_BY_QUICK_SEARCH)},{id:Se.NEXT_PAGE,actionFn:()=>this.goNextPageForStatistics(de.CHANGE_PAGE_BY_QUICK_SEARCH)},{id:Se.ZOOM_OUT,actionFn:()=>this.zoomOut(de.CHANGE_ZOOM_BY_QUICK_SEARCH)},{id:Se.ZOOM_IN,actionFn:()=>this.zoomIn(de.CHANGE_ZOOM_BY_QUICK_SEARCH)}])}getResponsiveActiveNavArea(t){if(Q.width<=this.NAV_AREA_WIDTH_PC)return{left:0,right:Q.width,top:Q.height-this.NAV_AREA_HEIGHT_PC,bottom:Q.height};let n=t.left+t.width/2;return{left:n-this.NAV_AREA_WIDTH_PC/2,right:n+this.NAV_AREA_WIDTH_PC/2,top:Q.height-this.NAV_AREA_HEIGHT_PC,bottom:Q.height}}isMouseInsideActiveNavArea(t){let n=this.floatingnavElement?.nativeElement.getBoundingClientRect(),e=this.getResponsiveActiveNavArea(n);return t.x>=e.left&&t.x<=e.right&&t.y>=e.top&&t.y<=e.bottom}onNavInputFocus(){this._isNavInputOnFocus=!0}onNavInputBlur(){this.pageNoFormControl.value||this.pageNoFormControl.setValue(this.currentPageNo),this.pageNoFormControl.value!==this.currentPageNo&&this.goToPage(this.pageNoFormControl.value),this._isNavInputOnFocus=!1}onMouseEnterNav(){this._isMouseOnNav=!0}onMouseLeaveNav(){this._isMouseOnNav=!1}onClickSearchButton(){this.documentService.waitForConvPDF(this.toggleSearchTool.bind(this))}forceMouseLeaveNavInSlideShow(){this.isSlideshow&&this.onMouseLeaveNav()}isEbookMode(){return this.viewMode===4&&this.documentService.eBookStatus}goToPage(t){let n=Number(t);isNaN(n)||this.scrollController.moveToPage(n)}goPreviousPage(){this.forceMouseLeaveNavInSlideShow(),this.scrollController.moveToPrevPage()}goPreviousPageForStatistics(t){this.goPreviousPage()}goNextPage(){this.forceMouseLeaveNavInSlideShow(),this.scrollController.moveToNextPage()}goNextPageForStatistics(t){this.goNextPage()}publishScale(t,n){this.contentService.requestViewChange({scale:t,checkScale:n})}zoomIn(t){this.setScale(J.calculateNextScale(this.scale,!0),!0)}zoomOut(t){this.setScale(J.calculateNextScale(this.scale,!1),!0)}setScale(t,n=!1){typeof t!="number"||!isFinite(t)||isNaN(t)||this.publishScale(t,n)}toggleSearchTool(){if(!(!this.documentService.checkAuthority(Le.SEARCH_TEXT)||!this.pdfDoc)){if(K.get(ne.QUICK_SEARCH_BUTTON)){this.store$.dispatch(he.set({key:"searchToolActive",value:!this.searchToolActive}));return}this.rightSideViewVisible&&this.rightSideViewMode===Nt.TextSearch?this.store$.dispatch(he.set({key:"rightSideViewVisible",value:!1})):(this.store$.dispatch(he.set({key:"rightSideViewVisible",value:!0})),this.store$.dispatch(he.set({key:"rightSideViewMode",value:Nt.TextSearch})))}}closeSlideshow(){Q.exitFullScreen()}};A(Xr,"\u0275fac",function(n){return new(n||Xr)(v(ye),v(Ve),v(ot),v(it),v(tn),v(Ee),v(oi),v(Z),v(Ei),v(Hi),v(kr),v(Tn))}),A(Xr,"\u0275cmp",Ce({type:Xr,selectors:[["sd-floating-nav"]],viewQuery:function(n,e){if(n&1&&Ue(ag,5),n&2){let i;Re(i=Ie())&&(e.floatingnavElement=i.first)}},inputs:{pdfDoc:"pdfDoc"},standalone:!1,features:[be([Z,{provide:Bn,useValue:new Yt(300)}])],decls:1,vars:1,consts:[["floatingNav",""],["class","floating-page-nav",3,"bottom","mouseenter","mouseleave",4,"ngIf"],[1,"floating-page-nav",3,"mouseenter","mouseleave"],[4,"ngIf"],[1,"divider"],["class","divider",4,"ngIf"],[1,"page-input"],["size","tiny","align","left",1,"current-page-index","left-child",3,"keydown.enter","focus","blur","readonly","autoResize","maxLength","formControl","ariaLabel"],[1,"page-label",3,"ngStyle"],[1,"page-move"],[1,"ep-text-button","previous-page","left-child",3,"click","focus","blur","disabled","title","tooltip"],[1,"papycon","papycon-previous-symbol2"],[1,"ep-text-button","next-page",3,"click","focus","blur","disabled","title","tooltip"],[1,"papycon","papycon-next-symbol2"],[1,"zoom"],[1,"ep-text-button","zoom-out","left-child",3,"click","focus","blur","disabled","title","tooltip"],[1,"papycon","papycon-minus"],[1,"ep-text-button","zoom-in",3,"click","focus","blur","disabled","title","tooltip"],[1,"papycon","papycon-plus"],[1,"search"],["aria-controls","search-tool",1,"ep-text-button","search-button",3,"click","focus","blur","disabled","title","tooltip"],[1,"papycon","papycon-search"],[1,"close"],[1,"ep-text-button","close-button",3,"click","focus","blur","disabled","title"],[1,"papycon","papycon-cross"]],template:function(n,e){n&1&&se(0,gg,9,9,"div",1),n&2&&O("ngIf",e.shouldDisplayNav)},styles:["i.papycon-chevron3-down[_ngcontent-%COMP%]{transform:scale(.5);font-size:18px;line-height:48px;margin:-12px -7.5px;padding:0 6px;transform-origin:50% 50%}i[_ngcontent-%COMP%] + i.papycon-chevron3-down[_ngcontent-%COMP%]{margin:-12px -8.5px;padding:0 8px}i.papycon-chevron3-down.expanded[_ngcontent-%COMP%]{transform:scale(.5) rotate(-180deg)}.floating-page-nav[_ngcontent-%COMP%]{box-shadow:0 4px 32px #6c6c6c1f;z-index:5;background-color:var(--mono-00);display:flex;align-items:center;position:absolute;left:50%;transform:translate(-50%);border:1px solid var(--mono-30);border-radius:90px;height:42px}.floating-page-nav[_ngcontent-%COMP%]   button.disabled[_ngcontent-%COMP%]{opacity:.4}.floating-page-nav[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:not(.divider){flex:1 1 auto;display:flex;justify-content:center;align-items:center;margin:0 12px}.floating-page-nav[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]   .left-child[_ngcontent-%COMP%]{margin-right:12px}.floating-page-nav[_ngcontent-%COMP%]   div.page-input[_ngcontent-%COMP%]{margin-left:20px;margin-right:0}.floating-page-nav[_ngcontent-%COMP%]   div.page-input[_ngcontent-%COMP%]   .left-child[_ngcontent-%COMP%]{margin-right:4px}.floating-page-nav[_ngcontent-%COMP%]   pu-input.current-page-index[_ngcontent-%COMP%]{font-size:13px;line-height:22px;font-family:NotoSans-Regular,sans-serif;color:var(--input);min-width:29px;border-radius:2px}.floating-page-nav[_ngcontent-%COMP%]   div.page-label[_ngcontent-%COMP%]{font-size:14px;line-height:24px;font-family:NotoSans-Medium,sans-serif;color:var(--mono-99);white-space:pre}.floating-page-nav[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:flex;align-items:center;border-width:0;outline-offset:-2px}.floating-page-nav[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]{color:var(--mono-90)}.floating-page-nav[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]:not(:disabled):hover{color:#d7d7d7}.floating-page-nav[_ngcontent-%COMP%]   div.divider[_ngcontent-%COMP%]{height:24px;width:1px;background-color:var(--mono-30)}.floating-page-nav[_ngcontent-%COMP%]   div.search[_ngcontent-%COMP%]{margin-right:16px}.floating-page-nav[_ngcontent-%COMP%]   div.close[_ngcontent-%COMP%]{margin-right:16px;width:24px;height:24px}"],data:{animation:[jn("navFadeOut",[vn("in",Di({opacity:1})),vn("out",Di({opacity:0})),_n("in => out",[mn("400ms linear")]),_n("out => in",[mn("0s")])])]},changeDetection:0}));var qn=Xr;Qe([st(nt.floatingNavComp.goToPage)],qn.prototype,"goToPage",null);Qe([st(nt.floatingNavComp.changePage)],qn.prototype,"goPreviousPageForStatistics",null);Qe([st(nt.floatingNavComp.changePage)],qn.prototype,"goNextPageForStatistics",null);Qe([st(nt.floatingNavComp.changeZoom,1e3)],qn.prototype,"zoomIn",null);Qe([st(nt.floatingNavComp.changeZoom,1e3)],qn.prototype,"zoomOut",null);var vg=["imgEl"],ld=function(a){return a.Pixelated="pixelated",a}(ld||{}),Ra=(()=>{let t=class t{contentService;pageService;changeDetectorRef;renderer;apiEventBridgeService;documentService;subscriptionService;renderingService;store$;muPDFService;pdfPage;documentId;imgStyle={};resetted=new wo;rendered=new wo;failed=new wo;imgElementRef;imgData;quality;normalizedScale;fetchFailCount;retryHandler=null;renderingMode=Ci.SERVER;ngOnChange$=new Yt(!1);isRendered=!1;renderedDevicePixelRatio;constructor(e,i,r,l,g,S,y,I,B,ee){this.contentService=e,this.pageService=i,this.changeDetectorRef=r,this.renderer=l,this.apiEventBridgeService=g,this.documentService=S,this.subscriptionService=y,this.renderingService=I,this.store$=B,this.muPDFService=ee}ngOnInit(){this.renderedDevicePixelRatio=devicePixelRatio,this.subscriptionService.push(at(dn([this.store$.pipe(ii("renderingOption")),this.store$.pipe(ii("hidpiRendering")),this.store$.pipe(H("scale"),L(F.isDefined),ri(200),ze(e=>rp(e,this.renderingService.renderingMode!==Ci.SERVER)),L(e=>e!==this.normalizedScale),ct(e=>this.normalizedScale=e)),this.ngOnChange$.pipe(L(e=>e))]),this.contentService.reload$.pipe(L(e=>Do.typeAndPage(e,this.pdfPage.i,No.Image)),ut(()=>this.renderingMode!==Ci.CLIENT?xt(void 0):this.muPDFService.document$.pipe(L(e=>e.status==="OPENED")))),Ge(Q.nativeWindow,"resize").pipe(L(()=>this.renderedDevicePixelRatio!==devicePixelRatio),ct(()=>this.renderedDevicePixelRatio=devicePixelRatio))).subscribe({next:()=>this.startFetch()}),this.store$.pipe(H("quality")).subscribe({next:e=>this.quality=e}),this.store$.pipe(H("renderingMode"),ct(e=>this.renderingMode=e),L(e=>e===Ci.HYBRID),ut(()=>this.muPDFService.document$),L(e=>e.status==="OPENED")).subscribe({next:()=>this.startFetch()})),this.subscribePageArrangeEvent()}ngOnDestroy(){this.imgData=void 0,F.isDefined(this.imgElementRef.nativeElement.parentElement)&&this.imgElementRef.nativeElement.parentElement.removeChild(this.imgElementRef.nativeElement),Vi.destroy(this)}ngOnChanges(){this.renderer.setStyle(this.imgElementRef.nativeElement,J.SK_Z_INDEX,`${J.LayoutOrder.Image}${F.EMPTY_STRING}`),this.ngOnChange$.next(!0)}fetch(){if(!this.pdfPage)return;let e=this.renderingService.renderingMode!==Ci.SERVER;this.subscriptionService.set("dataSub",this.drawWatermark(this.renderingService.fetchImage(this.documentId,this.pdfPage.ref,{zoom:this.normalizedScale,jpegQuality:this.quality,renderAnnots:!1,increasePrint:!1})).subscribe({next:i=>{e&&Q.isChromium()&&K.get(ne.CLIENT_RENDERING_PIXELATED)&&(this.imgStyle.imageRendering=ld.Pixelated),this.render(i),this.apiEventBridgeService.watermarkCreatedSrc.next({ok:!0,data:void 0})},error:i=>this.onFetchFailed(i)}))}preloadFetch(){this.isRendered||!this.pdfPage||this.subscriptionService.set("preloadDataSub",this.drawWatermark(this.renderingService.fetchPreload(this.documentId,this.pdfPage.ref).pipe(L(()=>!this.imgData&&(!this.documentService.isConvPDFReady||Math.max(this.pdfPage.bbox.w,this.pdfPage.bbox.h)>1e3)),L(F.isDefined))).subscribe({next:e=>this.render(e)}))}startFetch(){this.clearRetryHandler(),this.fetchFailCount=0,this.preloadFetch(),this.documentService.isConvPDFReady&&this.fetch()}onFetchFailed(e){this.clearRetryHandler(),++this.fetchFailCount>Je.retryCount?this.failed.emit(e):this.retryHandler=Q.nativeWindow.setTimeout(()=>this.fetch(),Je.retryInterval)}clearRetryHandler(){this.retryHandler!==null&&(clearTimeout(this.retryHandler),this.retryHandler=null)}render(e){e&&(this.imgData=e,this.isRendered=!0),J.setVisibility(this.imgElementRef.nativeElement,!0,this.renderer,!0),this.changeDetectorRef.markForCheck(),this.rendered.emit()}reset(){J.setVisibility(this.imgElementRef.nativeElement,!1,this.renderer),this.resetted.emit()}subscribePageArrangeEvent(){this.subscriptionService.push(this.pageService.pageArrangeEvt$.pipe(L(e=>this.pageService.arrangeAffectedChecker(this.pdfPage.originalIndex,e))).subscribe({next:()=>{this.reset(),this.ngOnChanges()}}))}drawWatermark(e){return dn([e,this.store$.pipe(ko("ALL"),ze(i=>Rn.filterChanges(i,r=>r.allowView?r.range==="all"?!0:!!uo.parse(r.range,{min:0,max:this.pageService.pdfPages.length-1})?.includes(this.pdfPage.i):!1)),ze(i=>Rn.flattenWatermarks(i))),this.pageService.pageArrangeEvt$.pipe(L(i=>i.page===this.pdfPage&&i.action==="rotate"),ct(()=>this.reset()),Mo(void 0))]).pipe(ut(([i,r,l])=>{if(i.data===void 0)return this.startFetch(),Fs;if(r.length===0)return xt(i);let g;switch(i.type){case"BLOB":g=URL.createObjectURL(i.data);break;case"BASE64":g=i.data;break;default:throw new Tt("Cannot handle image data")}return new Nr({imgSrc:g,width:this.pdfPage.bbox.w,height:this.pdfPage.bbox.h,rotation:this.pdfPage.r},r).draw()}))}};A(t,"\u0275fac",function(i){return new(i||t)(v(it),v(Ht),v(ye),v(At),v(Ei),v(ot),v(Z),v(Io),v(Ee),v(Ro))}),A(t,"\u0275cmp",Ce({type:t,selectors:[["sd-image"]],viewQuery:function(i,r){if(i&1&&Ue(vg,7),i&2){let l;Re(l=Ie())&&(r.imgElementRef=l.first)}},inputs:{pdfPage:"pdfPage",documentId:"documentId",imgStyle:"imgStyle"},outputs:{resetted:"resetted",rendered:"rendered",failed:"failed"},standalone:!1,features:[be([Z]),qi],decls:2,vars:2,consts:[["imgEl",""],[1,"image",3,"sdImage","ngStyle"]],template:function(i,r){i&1&&X(0,"img",1,0),i&2&&O("sdImage",r.imgData)("ngStyle",r.imgStyle)},styles:["img.image[_ngcontent-%COMP%]{width:100%;height:100%;visibility:hidden;-webkit-user-select:none;user-select:none;pointer-events:none}"],changeDetection:0}));let a=t;return a})();var pd=(()=>{let t=class t{store$;subscriptionService;changeDetectorRef;invisibleTracerService;styles={};rendered=new wo;constructor(e,i,r,l){this.store$=e,this.subscriptionService=i,this.changeDetectorRef=r,this.invisibleTracerService=l}ngOnInit(){this.subscriptionService.push(dn([this.store$.pipe(H("scale")),Q.windowResize$.pipe(Mo({}))]).subscribe({next:([e,i])=>{let r=window.devicePixelRatio,g=(Q.isMobile()?4:screen.width*screen.height*Math.pow(r,2)<1920*1080?1:2)/r,S=(Je.viewInvisibleTracerSize/J.normalizeScale(e)).toFixed(1);this.styles["background-size"]=`${S}px ${S}px`,this.styles.transform=`scale(${g.toFixed(8)})`,this.styles.width=`${(1/g*100).toFixed(6)}%`,this.styles.height=`${(1/g*100).toFixed(6)}%`,this.changeDetectorRef.markForCheck()}}),this.invisibleTracerService.viewBinary$.subscribe(e=>{this.styles["background-image"]=`url(${e.url})`,this.styles.opacity=this.invisibleTracerService.getOpacity().toString(),this.rendered.emit(),this.changeDetectorRef.markForCheck()}))}};A(t,"\u0275fac",function(i){return new(i||t)(v(Ee),v(Z),v(ye),v(oa))}),A(t,"\u0275cmp",Ce({type:t,selectors:[["sd-invisible-tracer-view"]],outputs:{rendered:"rendered"},standalone:!1,features:[be([Z])],decls:1,vars:1,consts:[[3,"ngStyle"]],template:function(i,r){i&1&&X(0,"div",0),i&2&&O("ngStyle",r.styles)},dependencies:[Gt],styles:["[_nghost-%COMP%]{position:absolute;display:block;width:100%;height:100%;top:0;left:0;overflow:hidden}div[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;top:0;left:0;image-rendering:pixelated;transform-origin:top left}"],changeDetection:0}));let a=t;return a})();var Sg=["magnifySvg"];function Cg(a,t){if(a&1&&(_i(),X(0,"rect",3)),a&2){let n=w();ue("height",n.rectRender.h)("width",n.rectRender.w)("x",n.rectRender.x)("y",n.rectRender.y)}}var Zr=class Zr{changeDetectorRef;contentService;renderer;subscriptionService;store$;pdfPage;magnifySvgElementRef;scale;created=!1;startPoint={x:0,y:0};rectRender={x:0,y:0,w:0,h:0};prevEvent;onMouseMoveListener=null;onMouseUpListener=null;constructor(t,n,e,i,r){this.changeDetectorRef=t,this.contentService=n,this.renderer=e,this.subscriptionService=i,this.store$=r}ngOnInit(){this.subscriptionService.push(this.store$.pipe(H("scale")).subscribe({next:t=>this.scale=t}))}ngOnDestroy(){this.destroyMouseListeners()}onDown(t){return this.rectRender.x=t.offsetX,this.startPoint.x=this.rectRender.x,this.rectRender.y=t.offsetY,this.startPoint.y=this.rectRender.y,this.rectRender.h=0,this.rectRender.w=this.rectRender.h,this.onMouseUpListener=this.renderer.listen(this.magnifySvgElementRef.nativeElement,"mouseup",n=>this.onUp(n)),t.button!==0?!0:(t.preventDefault(),t.stopPropagation(),this.prevEvent=t,this.changeDetectorRef.markForCheck(),this.created=!0,this.onMouseMoveListener=this.renderer.listen(this.magnifySvgElementRef.nativeElement,"mousemove",n=>this.onMove(n)),!1)}onMove(t){return this.created?(t.preventDefault(),t.stopPropagation(),this.prevEvent.offsetX===t.offsetX&&this.prevEvent.offsetY===t.offsetY||(this.rectRender.x=Math.min(this.startPoint.x,t.offsetX),this.rectRender.y=Math.min(this.startPoint.y,t.offsetY),this.rectRender.w=Math.abs(t.offsetX-this.startPoint.x),this.rectRender.h=Math.abs(t.offsetY-this.startPoint.y),this.prevEvent=t,this.changeDetectorRef.markForCheck()),!1):!0}onUp(t){t.preventDefault(),t.stopPropagation(),this.destroyMouseListeners(),this.created=!1,this.changeDetectorRef.markForCheck();let n=this.pdfPage.bbox,e=n.y+n.h-this.rectRender.y,i={left:this.rectRender.x,top:e,right:this.rectRender.x+this.rectRender.w,bottom:e-this.rectRender.h};if(this.rectRender.w<10&&this.rectRender.h<10){if(t.button!==0&&t.button!==2)return!1;this.contentService.requestViewChange({scale:this.scale+(t.button===0?10:-10),checkScale:!1,referencePoint:{pageNo:this.pdfPage.i+1,x:(i.left+i.right)/2,y:(i.top+i.bottom)/2}})}else this.contentService.requestViewChange({pageNo:this.pdfPage.i+1,checkScale:!1,viewport:i});return!1}onMouseleave(){this.destroyMouseListeners(),this.created=!1,this.changeDetectorRef.markForCheck()}destroyMouseListeners(){F.isDefined(this.onMouseMoveListener)&&this.onMouseMoveListener(),this.onMouseMoveListener=null,F.isDefined(this.onMouseUpListener)&&this.onMouseUpListener(),this.onMouseUpListener=null}};A(Zr,"\u0275fac",function(n){return new(n||Zr)(v(ye),v(it),v(At),v(Z),v(Ee))}),A(Zr,"\u0275cmp",Ce({type:Zr,selectors:[["sd-magnify-tool"]],viewQuery:function(n,e){if(n&1&&Ue(Sg,7),n&2){let i;Re(i=Ie())&&(e.magnifySvgElementRef=i.first)}},inputs:{pdfPage:"pdfPage"},standalone:!1,features:[be([Z])],decls:3,vars:1,consts:[["magnifySvg",""],["id","magnify-svg",3,"mousedown","mouseleave"],["fill","transparent","stroke-dasharray","8 8","stroke-width","1",4,"ngIf"],["fill","transparent","stroke-dasharray","8 8","stroke-width","1"]],template:function(n,e){if(n&1){let i=_e();_i(),R(0,"svg",1,0),ce("mousedown",function(l){return W(i),z(e.onDown(l))})("mouseleave",function(){return W(i),z(e.onMouseleave())}),se(2,Cg,1,4,"rect",2),N()}n&2&&(x(2),O("ngIf",e.created))},dependencies:[lt],styles:["#magnify-svg[_ngcontent-%COMP%]{z-index:999;position:absolute;right:0;top:0;-webkit-user-select:none;user-select:none;cursor:crosshair;width:100%;height:100%;background-color:#fff0;stroke:var(--primary-50)}"],changeDetection:0}));var ws=Zr;Qe([st(nt.magnifyToolComp.onUp)],ws.prototype,"onUp",null);function xg(a,t){if(a&1&&(Lt(0),R(1,"p",1),me(2),N(),Ft()),a&2){let n=t.$implicit,e=w();x(),O("ngStyle",e.setPositionOfScript(n)),x(),xe(e.getFilteredScript(n.text))}}var dd=function(a){return a.FULL="full",a.LINE="line",a}(dd||{}),hd=(()=>{let t=class t{page;fetchedText;scripts=[];get isMergedScript(){return Je.pageScriptInsertionType===dd.FULL}ngOnInit(){if(this.fetchedText=this.fetchedText.filter(e=>e.text.trim().length>0),!this.isMergedScript){this.scripts=this.fetchedText;return}this.scripts[0]={text:this.fetchedText.filter(e=>e.text.trim().length>0).map(e=>e.text).join(`
`),rect:[{top:this.page.bbox.h,bottom:0,left:0,right:this.page.bbox.w}],rotate:0,isVertical:!1}}setPositionOfScript(e){let i=e.rect.length;return{top:`${this.page.bbox.h-e.rect[0].top-4}px`,left:`${e.rect[0].left}px`,width:`${e.rect[i-1].right-e.rect[0].left}px`,height:`${Math.abs(e.rect[0].top-e.rect[0].bottom)+6}px`}}getFilteredScript(e){return e.trim().replace(/[^가-힣a-zA-Z0-9\u4E00-\u9FFF\u3400-\u4DBF~!@#$%^&*()\-_=+\[{\]};:'".<,>\/? ]/gu,"")}};A(t,"\u0275fac",function(i){return new(i||t)}),A(t,"\u0275cmp",Ce({type:t,selectors:[["sd-page-script"]],inputs:{page:"page",fetchedText:"fetchedText"},standalone:!1,decls:1,vars:1,consts:[[4,"ngFor","ngForOf"],["tabindex","0",1,"script",3,"ngStyle"]],template:function(i,r){i&1&&se(0,xg,3,2,"ng-container",0),i&2&&O("ngForOf",r.scripts)},dependencies:[Si,Gt],styles:[".script[_ngcontent-%COMP%]{position:absolute;pointer-events:none}"]}));let a=t;return a})();var Og=["normal"],Mg=["blackmark"],ud=(()=>{let t=class t{contentService;subscriptionService;pdfPage;result;redactionMarks;normalElementRef;blackmarkElementRef;isViewInit=!1;normalPainter;blackmarkPainter;constructor(e,i){this.contentService=e,this.subscriptionService=i}ngOnInit(){this.normalPainter=new Ia(this.normalElementRef,this.pdfPage.bbox),this.blackmarkPainter=new Ia(this.blackmarkElementRef,this.pdfPage.bbox),this.subscriptionService.push(this.contentService.reload$.pipe(L(e=>Do.typeAndPage(e,this.pdfPage.i,No.TextSearch))).subscribe({next:()=>this.clearRect()}))}ngOnChanges(){this.mark(this.isViewInit)}ngAfterViewInit(){this.mark(this.isViewInit=!0)}ngOnDestroy(){this.normalElementRef=null,this.blackmarkElementRef=null,this.normalPainter=null,this.blackmarkPainter=null,Vi.destroy(this)}clearRect(){this.normalPainter.clear(),this.blackmarkPainter.clear()}mark(e){e&&(this.clearRect(),this.result&&this.normalPainter.render(this.result.words.map(i=>i.rects)),this.redactionMarks&&this.blackmarkPainter.render(this.redactionMarks.words.map(i=>i.rects)))}};A(t,"\u0275fac",function(i){return new(i||t)(v(it),v(Z))}),A(t,"\u0275cmp",Ce({type:t,selectors:[["sd-search-highlight"]],viewQuery:function(i,r){if(i&1&&(Ue(Og,7),Ue(Mg,7)),i&2){let l;Re(l=Ie())&&(r.normalElementRef=l.first),Re(l=Ie())&&(r.blackmarkElementRef=l.first)}},inputs:{pdfPage:"pdfPage",result:"result",redactionMarks:"redactionMarks"},standalone:!1,features:[be([Z]),qi],decls:5,vars:2,consts:[["normal",""],["blackmark",""],[1,"normal"],[1,"redaction"]],template:function(i,r){i&1&&(_i(),R(0,"svg"),X(1,"path",2,0)(3,"path",3,1),N()),i&2&&ue("width",r.pdfPage.bbox.w+r.pdfPage.bbox.x)("height",r.pdfPage.bbox.h+r.pdfPage.bbox.y)},styles:["svg[_ngcontent-%COMP%]{mix-blend-mode:multiply;position:absolute;right:0;top:0;-webkit-user-select:none;user-select:none}path.normal[_ngcontent-%COMP%]{fill:#00af0080}path.redaction[_ngcontent-%COMP%]{fill:#00000080}"],changeDetection:0}));let a=t;return a})(),Ia=class{elementRef;bbox;d=[];constructor(t,n){this.elementRef=t,this.bbox=n}clear(){this.d.splice(0),this.bindPath()}render(t){for(let n of t){let e,i=n[0];n.forEach((r,l)=>{e=r,i.top!==e.top&&(this.d[this.d.length]=this.mergeRects(i,n[l-1]),i=e)}),this.d[this.d.length]=this.mergeRects(i,e)}this.bindPath()}bindPath(){this.elementRef.nativeElement.setAttribute("d",this.generatePath())}generatePath(){return this.d.reduce((t,n)=>`${t}M ${n.x} ${n.y} L ${n.x+n.w} ${n.y} L ${n.x+n.w} ${n.y+n.h} L ${n.x} ${n.y+n.h} Z `,F.EMPTY_STRING)}mergeRects(t,n){return{x:t.left,y:this.bbox.h+this.bbox.y-t.top,w:n.right-t.left,h:t.top-t.bottom}}};var gd=(()=>{let t=class t{sanitizer;contentService;changeDetectorRef;textService;documentId;pdfPage;get innerHTML(){let e=this.sanitizer.sanitize(vl.HTML,this._innerHTML);if(!F.isDefined(e))throw new Tt("Possible unsafe HTML content");return e}get pageHeight(){return`${this.pdfPage.bbox.h}px`}_innerHTML;constructor(e,i,r,l){this.sanitizer=e,this.contentService=i,this.changeDetectorRef=r,this.textService=l}ngOnInit(){this.contentService.publishSomePageLoaded(!0),this.textService.fetchPdfPageScript(this.documentId,this.pdfPage.i).subscribe({next:e=>{this._innerHTML=e.scriptText,this.changeDetectorRef.markForCheck()}})}};A(t,"\u0275fac",function(i){return new(i||t)(v(wl),v(it),v(ye),v(Dr))}),A(t,"\u0275cmp",Ce({type:t,selectors:[["sd-tts-script"]],hostVars:3,hostBindings:function(i,r){i&2&&(bl("innerHTML",r.innerHTML,_l),Gi("height",r.pageHeight))},inputs:{documentId:"documentId",pdfPage:"pdfPage"},standalone:!1,features:[be([Z])],decls:0,vars:0,template:function(i,r){},styles:["[_nghost-%COMP%]{padding-top:30px;margin-left:50px;display:block;overflow:auto;font-size:8px}"],changeDetection:0}));let a=t;return a})();var Eg=["selectText"],Pg=["annot"],Rg=()=>[Ap,ya,lt,Np,Vp,od,ws,hd,ud,gd];function Ig(a,t){if(a&1&&(R(0,"div",6),X(1,"sd-loader"),N()),a&2){let n=w();O("ngStyle",n.getIndicatorStyle(!0))}}function Ag(a,t){if(a&1&&(R(0,"div",7),X(1,"div",8),R(2,"span"),me(3),G(4,"translate"),N()()),a&2){let n=w();O("ngStyle",n.getIndicatorStyle(!1)),x(3),xe(Y(4,2,"FAILED_TO_LOAD_PAGE"))}}function Ng(a,t){if(a&1){let n=_e();R(0,"sd-image",9),ce("resetted",function(){W(n);let i=w();return z(i.imgResetted())})("rendered",function(){W(n);let i=w();return z(i.imgRenderDone())})("failed",function(i){W(n);let r=w();return z(r.imgFetchFailed(i))}),N()}if(a&2){let n=w();O("pdfPage",n.page)("documentId",n.documentId),ue("aria-hidden",!0)}}function Dg(a,t){if(a&1){let n=_e();R(0,"sd-invisible-tracer-view",10),ce("rendered",function(){W(n);let i=w();return z(i.invisibleTracerRendered())}),N()}}function kg(a,t){if(a&1&&X(0,"sd-annot",19,0),a&2){let n=w(2);O("pdfPage",n.page)("documentId",n.documentId)("selectText",n.selectText)}}function Vg(a,t){if(a&1&&X(0,"sd-api-highlight",20),a&2){let n=w(2);O("pdfPage",n.page)}}function Lg(a,t){if(a&1&&X(0,"sd-search-highlight",21),a&2){let n=w(2);O("pdfPage",n.page)("result",n.searchResult)("redactionMarks",n.redactionMarks)}}function Fg(a,t){if(a&1){let n=_e();R(0,"sd-select-text",22,1),ce("textFetched",function(i){W(n);let r=w(2);return z(r.fetchedText=i)}),N()}if(a&2){let n=w(2);O("pdfPage",n.page)("documentId",n.documentId)("isScreenReaderActive",n.isScreenReaderActive)}}function Bg(a,t){if(a&1&&X(0,"sd-page-script",23),a&2){let n=w(2);O("page",n.page)("fetchedText",n.fetchedText)}}function Ug(a,t){if(a&1&&X(0,"sd-magnify-tool",20),a&2){let n=w(2);O("pdfPage",n.page)}}function jg(a,t){if(a&1&&X(0,"sd-capture-tool",24),a&2){let n=w(2);O("pdfPage",n.page)("annot",n.annot)}}function Hg(a,t){if(a&1&&X(0,"sd-tts-script",25),a&2){let n=w(2);O("documentId",n.documentId)("pdfPage",n.page)}}function $g(a,t){if(a&1&&X(0,"sd-guide-line",26),a&2){let n=w(2);O("pdfPage",n.page)}}function Wg(a,t){if(a&1&&se(0,kg,2,3,"sd-annot",11)(1,Vg,1,1,"sd-api-highlight",12)(2,Lg,1,3,"sd-search-highlight",13)(3,Fg,2,3,"sd-select-text",14)(4,Bg,1,2,"sd-page-script",15)(5,Ug,1,1,"sd-magnify-tool",12)(6,jg,1,2,"sd-capture-tool",16)(7,Hg,1,2,"sd-tts-script",17)(8,$g,1,1,"sd-guide-line",18),a&2){let n=w();O("ngIf",!n.supportTTS&&n.isEnabledAnnotation),x(),O("ngIf",n.apiHighlighted),x(),O("ngIf",(n.searchResult||n.redactionMarks)&&!n.supportTTS),x(),O("ngIf",n.isVisibleSelectText()&&!n.supportTTS),x(),O("ngIf",n.isScreenReaderActive&&n.fetchedText),x(),O("ngIf",n.isVisibleMagnifyTool()&&!n.supportTTS),x(),O("ngIf",n.isVisibleCaptureTool()&&!n.supportTTS),x(),O("ngIf",n.supportTTS),x(),O("ngIf",n.rulerActive)}}var hc=(()=>{let t=class t{elementRef;changeDetectorRef;contentService;accessibilityService;subscriptionService;apiEventBridgeService;apiHighlightService;textService;translatePipe;documentService;store$;viewerService;renderer;priority;page;documentId;selectText;annot;supportTTS;scale;degree;dragMode;rulerActive;annotTool=null;isCaptureMode=!1;isReady=!1;isImgLoaded=!1;isImgFailed=!1;isInvisibleTracerRendered=!1;searchResult=null;redactionMarks;apiHighlighted=!1;fetchedText;isScreenReaderActive=!1;pageScript="";pageAriaLabels=[];get isEnabledAnnotation(){return this.documentService.checkAuthority(Le.ANNOTATION)||this.documentService.checkAuthority(Le.FORM)}get invisibleTracerEnabled(){return Je.activateInvisibleTracer&&K.get(ne.INVISIBLE_TRACER).enable}changesSrc=new Yt(null);constructor(e,i,r,l,g,S,y,I,B,ee,ge,le,Te){this.elementRef=e,this.changeDetectorRef=i,this.contentService=r,this.accessibilityService=l,this.subscriptionService=g,this.apiEventBridgeService=S,this.apiHighlightService=y,this.textService=I,this.translatePipe=B,this.documentService=ee,this.store$=ge,this.viewerService=le,this.renderer=Te}ngOnChanges(e){this.changesSrc.next(e)}ngOnInit(){this.priority===0&&(this.isReady=!0),this.subscriptionService.push(this.store$.pipe(H("isScreenReaderActive")).subscribe({next:e=>this.isScreenReaderActive=e}),this.store$.pipe(H("isCaptureMode")).subscribe({next:e=>{this.isCaptureMode=e,this.changeDetectorRef.markForCheck()}}),at(this.store$.pipe(H("supportTTS")).pipe(ct(e=>this.supportTTS=e))).subscribe({next:()=>this.changeDetectorRef.markForCheck()}),this.store$.pipe(H("dragMode")).pipe(ct(e=>this.dragMode=e),js(1)).subscribe({next:()=>{this.changeDetectorRef.markForCheck(),this.apiEventBridgeService.dragToolChangeAppliedSrc.next({ok:!0,data:void 0})}}),at(this.store$.pipe(H("degree")).pipe(ct(e=>this.degree=e)),this.store$.pipe(H("scale")).pipe(ct(e=>this.scale=e))).subscribe({next:()=>{this.changeDetectorRef.destroyed||this.changeDetectorRef.detectChanges()}}),this.contentService.searchResult$.pipe(Us(0)).subscribe({next:e=>this.bindSearchResult(e)}),this.contentService.searchRedactionMark$.subscribe({next:e=>{this.bindRedactionMarks(e)}}),this.changesSrc.pipe(L(F.isDefined),L(e=>!!e.page||!!e.documentId)).subscribe({next:()=>{this.render(),this.documentService.isConvPDFReady&&this.isScreenReaderActive&&this.dragMode!==Ot.SELECT_TEXT&&this.delayFetchTextData()}}),this.store$.pipe(H("rulerActive")).subscribe({next:e=>{this.rulerActive=e,this.changeDetectorRef.markForCheck()}}),at(xt(null),this.apiHighlightService.highlightInfoMapChange$).subscribe({next:()=>{this.apiHighlighted=this.apiHighlightService.highlightInfoMap[this.page.i]&&this.apiHighlightService.highlightInfoMap[this.page.i].length>0,this.changeDetectorRef.markForCheck()}}),this.store$.pipe(Ao()).subscribe({next:e=>{this.annotTool=e,this.changeDetectorRef.markForCheck()}}),this.accessibilityService.pageAriaLabel$.subscribe({next:e=>{this.pageAriaLabels=e,this.changeDetectorRef.markForCheck()}}),this.viewerService.pageBorderColor$.subscribe({next:e=>{this.renderer.setStyle(this.elementRef.nativeElement,"outline-color",`${e}`)}}))}ngAfterViewInit(){this.subscriptionService.push(Ge(this.elementRef.nativeElement,"mousemove").subscribe({next:e=>this.selectText.publishIsTextHover(e)}))}ngOnDestroy(){F.removeElement(this.elementRef.nativeElement),Vi.destroy(this)}onClick(e){e.target.nodeName==="SD-PAGE"&&e.stopPropagation()}get hostTabIndex(){return this.isVisibleSelectText()&&!this.supportTTS?null:this.pageAriaLabels[this.page.i]?this.pageAriaLabels[this.page.i]:this.isScreenReaderActive&&this.pageScript.trim().length===0?this.translatePipe.transform("NO_CONTENT"):`${this.page.i+1} ${this.translatePipe.transform("PAGE")}`}delayFetchTextData(){this.subscriptionService.set("delayedTextDataFetchSub",er(J.TaskPriority.TEXT).subscribe({next:()=>this.fetchTextData()}))}fetchTextData(){this.subscriptionService.set("textDataSub",this.textService.fetchPdfPageText(this.documentId,this.page.ref).subscribe({next:e=>{this.extractPageScript(e),this.fetchedText=e}}))}extractPageScript(e){e.forEach(i=>{this.pageScript+=i.text})}imgResetted(){this.isImgFailed=!1,this.isImgLoaded=this.isImgFailed}imgRenderDone(){this.isImgLoaded=!0,this.contentService.publishSomePageLoaded(!0)}imgFetchFailed(e){this.isImgFailed=!0,F.isDefined(e)&&(console.warn(e.message),this.apiEventBridgeService.watermarkCreatedSrc.next({ok:!1,error:e}))}invisibleTracerRendered(){this.isInvisibleTracerRendered=!0,this.changeDetectorRef.markForCheck()}isVisibleSelectText(){return this.isReady&&(this.dragMode===Ot.SELECT_TEXT||this.dragMode===Ot.AUTO||Q.isMobile())&&!F.isDefined(this.annotTool)}isVisibleMagnifyTool(){return this.isReady&&this.dragMode===Ot.MAGNIFY&&!F.isDefined(this.annotTool)}isVisibleCaptureTool(){return this.isReady&&this.isCaptureMode&&!F.isDefined(this.annotTool)}getIndicatorStyle(e){let i={transform:J.rotationNote(-(this.page.r+this.degree))};return e&&(i.transform+=` scale(${100/this.scale})`),i}render(){if(this.isReady)return;let e=Math.abs(this.priority)*100+this.priority*10;this.subscriptionService.set("delayedFetchSub",er(e).subscribe({next:()=>{this.isReady=!0,this.changeDetectorRef.markForCheck()}}))}bindSearchResult(e){this.searchResult=e?.pageIdx===this.page.i?e:null,this.changeDetectorRef.markForCheck()}bindRedactionMarks(e){let i=e&&e[this.page.i];i?.length>0?this.redactionMarks={words:[...i]}:this.redactionMarks=null,this.changeDetectorRef.markForCheck()}};A(t,"\u0275fac",function(i){return new(i||t)(v(Zt),v(ye),v(it),v(sa),v(Z),v(Ei),v(Uo),v(Dr),v(Ve),v(ot),v(Ee),v(oi),v(At))}),A(t,"\u0275cmp",Ce({type:t,selectors:[["sd-page"]],viewQuery:function(i,r){if(i&1&&(Ue(Eg,5),Ue(Pg,5)),i&2){let l;Re(l=Ie())&&(r.selectText=l.first),Re(l=Ie())&&(r.annot=l.first)}},hostVars:1,hostBindings:function(i,r){i&1&&ce("click",function(g){return r.onClick(g)}),i&2&&ue("aria-label",r.hostTabIndex)},inputs:{priority:"priority",page:"page",documentId:"documentId"},standalone:!1,features:[be([Z]),qi],decls:7,vars:4,consts:[["annot",""],["selectText",""],["class","indicator loader",3,"ngStyle",4,"ngIf"],["class","indicator fail",3,"ngStyle",4,"ngIf"],["role","img",3,"pdfPage","documentId","resetted","rendered","failed",4,"ngIf"],["aria-hidden","true",3,"rendered",4,"ngIf"],[1,"indicator","loader",3,"ngStyle"],[1,"indicator","fail",3,"ngStyle"],[1,"image"],["role","img",3,"resetted","rendered","failed","pdfPage","documentId"],["aria-hidden","true",3,"rendered"],["aria-hidden","true",3,"pdfPage","documentId","selectText",4,"ngIf"],["aria-hidden","true",3,"pdfPage",4,"ngIf"],["aria-hidden","true",3,"pdfPage","result","redactionMarks",4,"ngIf"],["aria-hidden","true",3,"pdfPage","documentId","isScreenReaderActive","textFetched",4,"ngIf"],[3,"page","fetchedText",4,"ngIf"],["aria-hidden","true",3,"pdfPage","annot",4,"ngIf"],["aria-hidden","true",3,"documentId","pdfPage",4,"ngIf"],[3,"pdfPage",4,"ngIf"],["aria-hidden","true",3,"pdfPage","documentId","selectText"],["aria-hidden","true",3,"pdfPage"],["aria-hidden","true",3,"pdfPage","result","redactionMarks"],["aria-hidden","true",3,"textFetched","pdfPage","documentId","isScreenReaderActive"],[3,"page","fetchedText"],["aria-hidden","true",3,"pdfPage","annot"],["aria-hidden","true",3,"documentId","pdfPage"],[3,"pdfPage"]],template:function(i,r){i&1&&(se(0,Ig,2,1,"div",2)(1,Ag,5,4,"div",3)(2,Ng,1,3,"sd-image",4)(3,Dg,1,0,"sd-invisible-tracer-view",5)(4,Wg,9,9),Sl(5,4,Rg),Cl(10)),i&2&&(O("ngIf",!r.isImgLoaded&&!r.isImgFailed&&!r.supportTTS),x(),O("ngIf",!r.isImgLoaded&&r.isImgFailed),x(),O("ngIf",r.isReady&&(!r.invisibleTracerEnabled||r.isInvisibleTracerRendered)&&!r.supportTTS),x(),O("ngIf",r.invisibleTracerEnabled))},styles:["[_nghost-%COMP%]{display:block;background-color:#fff;outline:1px solid #E8E8E8}.indicator[_ngcontent-%COMP%]{width:100%;height:100%;position:absolute;z-index:-1}.indicator.fail[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center}.indicator.fail[_ngcontent-%COMP%]   .image[_ngcontent-%COMP%]{width:163px;height:140px;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNjMiIGhlaWdodD0iMTQwIiB2aWV3Qm94PSIwIDAgMTYzIDE0MCI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48ZyBzdHJva2U9IiMxRTFFMUUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSIyLjQyMyI+PHBhdGggc3Ryb2tlLWRhc2hhcnJheT0iNy42ODksNy42ODkiIGQ9Ik0xMTEuNjQ2IDEzOC43OTdINy44NDQiLz48cGF0aCBkPSJNMy45OTkgMTM4Ljc5NkguMjEydi0zLjc4NyIvPjxwYXRoIHN0cm9rZS1kYXNoYXJyYXk9IjcuNTUzLDcuNTUzIiBkPSJNLjIxMiAxMjcuNDU2VjM2Ljg0N2E0Ljg2NiA0Ljg2NiAwIDAgMSA0Ljg2NS00Ljg2NWgxMTMuMTc5YTQuODY3IDQuODY3IDAgMCAxIDQuODY2IDQuODY1djk0LjM4NiIvPjxwYXRoIGQ9Ik0xMjMuMTIyIDEzNS4wMXYzLjc4NmgtMy43ODgiLz48L2c+PHBhdGggZmlsbD0iI0Y0RjRGNCIgZD0iTTE2Mi42NzggMTA2LjgxNUgzOS43NjhWNC44NjVBNC44NjYgNC44NjYgMCAwIDEgNDQuNjM1IDBoMTEzLjE3OWE0Ljg2NiA0Ljg2NiAwIDAgMSA0Ljg2NSA0Ljg2NnYxMDEuOTQ5eiIvPjxwYXRoIGZpbGw9IiNGRkYiIGQ9Ik0xMzguMjcgMTIzLjY0N0gxNS4zNjFWMjEuNjk3YTQuODY1IDQuODY1IDAgMCAxIDQuODY2LTQuODY0aDExMy4xNzhhNC44NjUgNC44NjUgMCAwIDEgNC44NjUgNC44NjV2MTAxLjk0OXoiLz48cGF0aCBzdHJva2U9IiMxRTFFMUUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSIyLjQyMyIgZD0iTTEzOC4yNyAxMjMuNjQ3SDE1LjM2MVYyMS42OTdhNC44NjUgNC44NjUgMCAwIDEgNC44NjYtNC44NjRoMTEzLjE3OGE0Ljg2NSA0Ljg2NSAwIDAgMSA0Ljg2NSA0Ljg2NXYxMDEuOTQ5eiIvPjxwYXRoIGZpbGw9IiNEQURBREEiIGQ9Ik0xMzguMjcgMzcuNTYySDE1LjM2MVYyMS42OTlhNC44NjYgNC44NjYgMCAwIDEgNC44NjYtNC44NjdoMTEzLjE3OGE0Ljg2NiA0Ljg2NiAwIDAgMSA0Ljg2NSA0Ljg2NnYxNS44NjR6Ii8+PHBhdGggc3Ryb2tlPSIjMUUxRTFFIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHN0cm9rZS13aWR0aD0iMi40MjMiIGQ9Ik0xMzguMjcgMzcuNTYySDE1LjM2MVYyMS42OTlhNC44NjYgNC44NjYgMCAwIDEgNC44NjYtNC44NjdoMTEzLjE3OGE0Ljg2NiA0Ljg2NiAwIDAgMSA0Ljg2NSA0Ljg2NnYxNS44NjR6Ii8+PGcgc3Ryb2tlPSIjMUUxRTFFIj48cGF0aCBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHN0cm9rZS13aWR0aD0iMi40MjMiIGQ9Ik01OC42MDMgOTIuMDhsNS40MiAxNC44NTVNNjQuMzU4IDkxLjAzM2w1LjA4IDEzLjkyNk02OS44MjcgOTIuODA3bC0xMy45MjYgNS4wOE03MS44MDMgOTguMjIybC0xMi45OTcgNC43NDIiLz48cGF0aCBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS13aWR0aD0iMi43MDQiIGQ9Ik04MC44ODYgNzAuODhsMTEuMTYyIDEwLjkwM004MS4wMTUgODEuOTEyTDkxLjkxOCA3MC43NU0xMDguNDI0IDcwLjU1OGwxMS4xNjEgMTAuOTAzTTEwOC41NTIgODEuNTlsMTAuOTAzLTExLjE2MSIvPjxwYXRoIGZpbGw9IiNGNEY0RjQiIGQ9Ik04MC44MDcgMTE2Ljg4M2wzOS44MDYtLjQ2N2MtLjM5LTEwLjc2LTkuMzAyLTE5LjMwMi0yMC4xMy0xOS4xNzUtMTAuODI5LjEyNi0xOS41MzcgOC44NzUtMTkuNjc2IDE5LjY0MnoiLz48L2c+PHBhdGggc3Ryb2tlPSIjMDAwIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHN0cm9rZS13aWR0aD0iMi40MjMiIGQ9Ik04MC4zMDcgMTE3LjM5Yy0uMTMyLTExLjI3MiA4Ljg5OC0yMC41MTggMjAuMTctMjAuNjQ5IDExLjI3LS4xMzIgMjAuNTE3IDguODk4IDIwLjY0OCAyMC4xN2wtNDAuODE4LjQ3OHoiLz48cGF0aCBmaWxsPSIjRkY2MTAwIiBkPSJNMjkuNzQ5IDI4LjA1YTIuNjgzIDIuNjgzIDAgMSAxLTUuMzY1IDAgMi42ODMgMi42ODMgMCAwIDEgNS4zNjUgMCIvPjxwYXRoIGZpbGw9IiNGNzlGMUEiIGQ9Ik00Mi45MTggMjguMDVhMi42ODMgMi42ODMgMCAxIDEtNS4zNjUgMCAyLjY4MyAyLjY4MyAwIDAgMSA1LjM2NSAwIi8+PHBhdGggZmlsbD0iIzBDNzQ4OSIgZD0iTTU2LjA4NyAyOC4wNWEyLjY4MyAyLjY4MyAwIDEgMS01LjM2NiAwIDIuNjgzIDIuNjgzIDAgMCAxIDUuMzY2IDAiLz48cGF0aCBmaWxsPSIjMUUxRTFFIiBkPSJNMjcuMDY2IDI0LjEwNWEzLjk0OSAzLjk0OSAwIDAgMC0zLjk0NCAzLjk0NSAzLjk0OSAzLjk0OSAwIDAgMCAzLjk0NCAzLjk0NSAzLjk1IDMuOTUgMCAwIDAgMy45NDUtMy45NDUgMy45NSAzLjk1IDAgMCAwLTMuOTQ1LTMuOTQ1bTAgMS4yNjNhMi42ODIgMi42ODIgMCAxIDEgMCA1LjM2NCAyLjY4MyAyLjY4MyAwIDEgMSAwLTUuMzY0TTQwLjIzNSAyNC4xMDVhMy45NDkgMy45NDkgMCAwIDAtMy45NDQgMy45NDUgMy45NDkgMy45NDkgMCAwIDAgMy45NDQgMy45NDUgMy45NSAzLjk1IDAgMCAwIDMuOTQ1LTMuOTQ1IDMuOTUgMy45NSAwIDAgMC0zLjk0NS0zLjk0NW0wIDEuMjYzYTIuNjgzIDIuNjgzIDAgMSAxIC4wMDEgNS4zNjUgMi42ODMgMi42ODMgMCAwIDEgMC01LjM2NU01My40MDQgMjQuMTA1YTMuOTUgMy45NSAwIDAgMC0zLjk0NSAzLjk0NSAzLjk1IDMuOTUgMCAwIDAgMy45NDUgMy45NDUgMy45NSAzLjk1IDAgMCAwIDMuOTQ1LTMuOTQ1IDMuOTUgMy45NSAwIDAgMC0zLjk0NS0zLjk0NW0wIDEuMjYzYTIuNjgzIDIuNjgzIDAgMSAxIC4wMDEgNS4zNjUgMi42ODMgMi42ODMgMCAwIDEgMC01LjM2NSIvPjwvZz48L3N2Zz4=);background-size:contain;background-repeat:no-repeat}.indicator.fail[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:20px;line-height:28px;font-family:NotoSans-Medium,sans-serif;color:var(--mono-99);margin-top:32px}.indicator.loader[_ngcontent-%COMP%]{display:none;align-items:center;justify-content:center}.indicator.loader[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:56px;height:56px}sd-watermark[_ngcontent-%COMP%]{position:absolute;top:0;left:0;overflow:hidden}"],changeDetection:0}));let a=t;return a})();var zg=["svg"],Gg=["popup"],fd=a=>({content:a});function Yg(a,t){if(a&1&&(R(0,"span",18),me(1),N()),a&2){let n=w();x(),xe(n.title)}}function Qg(a,t){if(a&1){let n=_e();R(0,"pu-input",19),G(1,"translate"),G(2,"translate"),ce("blur",function(){W(n);let i=w();return z(i.finishEditTitle())})("keydown.enter",function(){W(n);let i=w();return z(i.finishEditTitle())}),N()}if(a&2){let n=w();O("placeholder",Y(1,4,"ENTER_THE_AUTHOR_NAME"))("autofocus",!0)("formControl",n.titleFormControl)("ariaLabel",Y(2,6,"ENTER_THE_AUTHOR_NAME"))}}function qg(a,t){if(a&1){let n=_e();R(0,"div",20)(1,"div",21),ce("click",function(){W(n);let i=w();return z(i.onColorPaletteClick())}),N()()}if(a&2){let n=w();Ye("disabled",n.isLockedAnnot())("selected",n.isColorTabClicked),x(),Gi("background",n.textAnnotColor)}}function Kg(a,t){if(a&1){let n=_e();R(0,"pu-color-palette",22),G(1,"translate"),G(2,"translate"),yi("ngModelChange",function(i){W(n);let r=w();return wi(r.textAnnotColor,i)||(r.textAnnotColor=i),z(i)}),N()}if(a&2){let n=w();O("nullable",!1)("customColorLabel",Y(1,5,"CUSTOM_COLOR"))("defaultColorLabel",Y(2,7,"DEFAULT_COLOR"))("defaultColorPanelExpandedd",!0),Mi("ngModel",n.textAnnotColor)}}function Xg(a,t){if(a&1&&X(0,"sd-popup-resizer",23),a&2){let n=t.$implicit;O("anchor",n)}}var uc=a=>({process:(...t)=>{if(F.isDefined(t[a]))return t[a]()}}),Zg=a=>{if(!a)return a;let t=a.substring(1);return t.length!==3?t:t[0]+t[0]+t[1]+t[1]+t[2]+t[2]},Kn=class Kn{annotService;contentService;documentService;renderer;changeDetectorRef;scrollController;elementRef;subscriptionService;store$;loggingService;translatePipe;get environment(){return Je}popupInfo;popupOrder;contentViewRoot;svgElementRef;popupElementRef;get zoom(){return J.normalizeScale(this.scale)}popupSize={width:0,height:0};preferences={};isEditingTitle;titleFormControl=new or;degree;scale;currentPageNo;viewMode;_popupStyles;linkStyles={};_containerStyle={};drag_startCursorPos={x:0,y:0};drag_startPopupPos={top:0,left:0,right:0,bottom:0};boundingTranslate={x:0,y:0};memoColor=null;popupViewCoords={x:0,y:0};onMouseMoveListener=null;onMouseUpListener=null;onTouchMoveListener=null;onTouchEndListener=null;txtTotalDelta={x:0,y:0};_containerPos;isColorTabClicked=!1;get anchorList(){return Kn.AnchorList}get data(){return this.popupInfo.src}get isTextAnnot(){return Bt.isText(this.data)}get textAnnotColor(){return Bt.isText(this.data)?this.data.attributes.color:(this.loggingService.common("warn",pi.INVALID,`${this.translatePipe.transform("ANNOTATION")} type`),null)}set textAnnotColor(t){if(!Bt.isText(this.data)){this.loggingService.common("warn",pi.INVALID,`${this.translatePipe.transform("ANNOTATION")} type`);return}this.data.attributes.color=t,this.annotService.putModel(this.data,"modify"),this.contentService.fireAnnotEvent({from:"PopupComponent",sdEventType:en.UPDATE,pageIdx:this.data.attributes.pageIdx,annot:this.data})}get popup(){return this.popupInfo.popup}get pdfPage(){return this.popupInfo.pdfPage}get direction(){return J.rotate2Direction(this.pdfPage.r+this.degree)}get points(){return this.svg.firstElementChild.points}get svg(){return this.svgElementRef.nativeElement}get textCoords(){return this.data.attributes.rect}get popupCoords(){return this.popup.attributes.rect}get popupLinkBoxStyles(){return Kn.linkBoxStyle}get contents(){return this.data?.attributes?.contents||F.EMPTY_STRING}set contents(t){this.data.attributes.contents=t,this.contentService.publishAnnotContentsChange({annotOid:this.data.oid})}get title(){let t=this.data?.attributes?.T;return!F.isDefined(t)||t===""?this.translatePipe.transform("ENTER_THE_AUTHOR_NAME"):t}get popupStyles(){Object.assign(this.popupViewCoords,this.convertPDFCoord(this.popup.attributes.rect.left,this.popup.attributes.rect.top)),this.drawPopupLink(this.txtTotalDelta);let t=Pr.elementStyleOf(this.popup);t.bottom=null,t.right=t.bottom,t.top=t.right,t.left=t.top,t.transform=`translate(${this.popupViewCoords.x+this.boundingTranslate.x}px,${this.popupViewCoords.y+this.boundingTranslate.y}px)`;let n=null,e=Zg(this.data.attributes.color);return e&&(this.memoColor={r:parseInt(`0x${e.substring(0,2)}`,16),g:parseInt(`0x${e.substring(2,4)}`,16),b:parseInt(`0x${e.substring(4,6)}`,16)},n={r:230+Math.floor(this.memoColor.r/10),g:230+Math.floor(this.memoColor.g/10),b:230+Math.floor(this.memoColor.b/10)}),t.background=n?`rgb(${n.r}, ${n.g}, ${n.b})`:"#ffeb98",this._popupStyles=vi(vi({},this._popupStyles||{color:null,background:null}),J.bindLayoutOrder(t,J.LayoutOrder.Popup+this.popupOrder.indexOf(this.data.Popup)))}get popupLinkStyles(){return this.memoColor?(this.linkStyles.stroke=`rgb(${this.memoColor.r}, ${this.memoColor.g}, ${this.memoColor.b})`,this.linkStyles.fill=`rgba(${this.memoColor.r}, ${this.memoColor.g}, ${this.memoColor.b}, 0.1)`):(this.linkStyles.stroke="transparent",this.linkStyles.fill="transparent"),this.linkStyles}get popupContainerStyles(){let t=this.direction,n=J.isVisible(this.pdfPage.i,this.currentPageNo-1,this.viewMode);return this._containerStyle.visibility=n?null:"hidden",this._containerPos&&(this._containerStyle.left=`${this._containerPos.left[t]*this.zoom}px`,this._containerStyle.top=`${this._containerPos.top[t]*this.zoom}px`),this._containerStyle}constructor(t,n,e,i,r,l,g,S,y,I,B){this.annotService=t,this.contentService=n,this.documentService=e,this.renderer=i,this.changeDetectorRef=r,this.scrollController=l,this.elementRef=g,this.subscriptionService=S,this.store$=y,this.loggingService=I,this.translatePipe=B}ngOnChanges(t){t.popupInfo&&(this._containerPos={left:[-this.pdfPage.bbox.x,-this.pdfPage.bbox.y,this.pdfPage.bbox.x,this.pdfPage.bbox.y],top:[this.pdfPage.bbox.y,-this.pdfPage.bbox.x,-this.pdfPage.bbox.y,this.pdfPage.bbox.x]})}ngOnInit(){this.subscriptionService.push(this.store$.pipe(ii("popupFontSize")).subscribe({next:n=>{this.preferences.popupFontSize=n,setTimeout(()=>this.changeDetectorRef.markForCheck())}}),this.store$.pipe(ii("language")).subscribe({next:n=>{this.preferences.language=n,setTimeout(()=>this.changeDetectorRef.markForCheck())}}),this.annotService.text$.pipe(L(n=>this.data.oid===n.model.oid)).subscribe({next:n=>{this.txtTotalDelta=n.totalDelta,this.changeDetectorRef.markForCheck()}}),this.contentService.annotEvent$.pipe(L(n=>n&&(n.sdEventType===en.SELECTED&&n.to==="popups"&&n.annot.oid!==this.popup.oid||n.sdEventType===en.UPDATE&&n.annot.Popup===this.popup.oid))).subscribe({next:()=>this.changeDetectorRef.markForCheck()}),at(this.store$.pipe(H("currentPageNo")),this.store$.pipe(H("viewMode")).pipe(ct(n=>this.viewMode=n)),this.store$.pipe(H("scale")).pipe(ct(n=>this.scale=n),Us(0)),this.store$.pipe(H("degree")).pipe(ct(n=>this.degree=n))).subscribe({next:()=>this.changeDetectorRef.markForCheck()}),this.contentService.postAnnotEdit$.pipe(L(n=>n.annotOid===this.data.oid)).subscribe({next:()=>this.changeDetectorRef.markForCheck()}),this.store$.pipe(H("currentPageNo")).subscribe({next:n=>this.currentPageNo=n}),this.annotService.annotVisibleEvent$.subscribe({next:n=>{n.includes(this.data.oid)||this.togglePopup()}})),this.subscribeMainViewResized();let t=this.svg;!t||!t.firstElementChild||this.fixPoints(t,this.points,3)}ngOnDestroy(){this.destroyMouseListeners()}ngAfterViewInit(){let{width:t,height:n}=Pr.elementStyleOf(this.popup);this.popupSize.width=parseFloat(t),this.popupSize.height=parseFloat(n);let e=this.popupElementRef.nativeElement;this.locate(e),(this.data.attributes.contents||F.EMPTY_STRING).length||setTimeout(()=>{let i=e.getElementsByTagName("textarea")[0];F.isDefined(i)&&i.focus()})}isReadonly(){return!this.documentService.checkAuthority(Le.EDIT_ANNOTATION)||rr.get(this.data.attributes.F,7)}isLockedAnnot(){return rr.get(this.data.attributes.F,7)}onMouseDown(t){if(t.target!==t.currentTarget)return;t.stopPropagation(),t.preventDefault();let n=this.popupOrder.indexOf(this.data.Popup);n>-1&&(this.popupOrder.splice(n,1),this.popupOrder.push(this.data.Popup)),this.contentService.fireAnnotEvent({sdEventType:en.SELECTED,annot:this.popup,to:"popups"}),this.applyTranslateToReal(),this.drag_startCursorPos.x=t.clientX,this.drag_startCursorPos.y=t.clientY,Object.assign(this.drag_startPopupPos,this.popupCoords),this.destroyMouseListeners(),this.onMouseMoveListener=this.renderer.listen("document","mousemove",e=>this.onMouseMove(e)),this.onMouseUpListener=this.renderer.listen("document","mouseup",e=>this.onMouseUp(e)),this.onTouchMoveListener=this.renderer.listen("document","touchmove",e=>this.onMouseMove(this.touchToMouse(e))),this.onTouchEndListener=this.renderer.listen("document","touchend",e=>this.onMouseUp(this.touchToMouse(e)))}touchToMouse(t){return F.touchToMouseEvt(t,this.degree,this.scale,this.pdfPage)}startEditTitle(){this.isLockedAnnot()||(this.titleFormControl.setValue(this.data?.attributes?.T??""),this.isEditingTitle=!0)}finishEditTitle(){this.data.attributes.T=this.titleFormControl.value,this.onPopupValueChanged(),this.isEditingTitle=!1}applyTranslateToReal(){let t=this.direction;if(this.boundingTranslate.x){let n=this.boundingTranslate.x/this.zoom;(t===2||t===3)&&(n*=-1),t===1||t===3?(this.popupCoords.top+=n,this.popupCoords.bottom+=n):(this.popupCoords.left+=n,this.popupCoords.right+=n),this.boundingTranslate.x=0}if(this.boundingTranslate.y){let n=this.boundingTranslate.y/this.zoom;(t===0||t===3)&&(n*=-1),t===1||t===3?(this.popupCoords.left+=n,this.popupCoords.right+=n):(this.popupCoords.top+=n,this.popupCoords.bottom+=n),this.boundingTranslate.y=0}}togglePopup(){this.annotService.togglePopup(this.data)}onMouseClickDelete(){this.contents="";let t={from:"PopupComponent",sdEventType:en.DELETE,annot:Bt.isText(this.data)?this.data:this.popup};this.contentService.fireAnnotEvent(t),this.contentService.fireAnnotListEvent(t)}onColorPaletteClick(){this.isColorTabClicked=!this.isColorTabClicked}onPopupValueChanged(){this.annotService.putModel(this.data,"modify"),this.contentService.fireAnnotListEvent({from:"PopupComponent",sdEventType:en.UPDATE,annot:this.data})}onMouseMove(t){t.stopPropagation(),t.preventDefault();let n=this.direction,e={x:t.clientX-this.drag_startCursorPos.x,y:this.drag_startCursorPos.y-t.clientY};return(n===1||n===3)&&([e.x,e.y]=[e.y,e.x]),uc(n).process(null,()=>{e.x*=-1},()=>{e.x*=-1,e.y*=-1},()=>{e.y*=-1}),e.x/=this.zoom,e.y/=this.zoom,this.popupCoords.top=this.drag_startPopupPos.top+e.y,this.popupCoords.left=this.drag_startPopupPos.left+e.x,this.popupCoords.right=this.drag_startPopupPos.right+e.x,this.popupCoords.bottom=this.drag_startPopupPos.bottom+e.y,this.changeDetectorRef.markForCheck(),!1}onMouseUp(t){let n=this.elementRef.nativeElement.parentElement.getBoundingClientRect(),e=this.popupElementRef.nativeElement.getBoundingClientRect(),i=Math.max(n.left-e.left,0)/this.zoom,r=Math.min(e.top-n.top,0)/this.zoom;this.popupCoords.top+=r,this.popupCoords.left+=i,this.popupCoords.bottom+=r,this.popupCoords.right+=i,t.stopPropagation(),t.preventDefault(),this.destroyMouseListeners(),this.annotService.putModel(this.popup,"modify"),this.changeDetectorRef.markForCheck()}destroyMouseListeners(){F.isDefined(this.onMouseMoveListener)&&this.onMouseMoveListener(),this.onMouseMoveListener=null,F.isDefined(this.onMouseUpListener)&&this.onMouseUpListener(),this.onMouseUpListener=null,F.isDefined(this.onTouchMoveListener)&&this.onTouchMoveListener(),this.onTouchMoveListener=null,F.isDefined(this.onTouchEndListener)&&this.onTouchEndListener(),this.onTouchEndListener=null}convertPDFCoord(t,n){let e=this.scrollController.stateHolder.getPageSize(this.pdfPage.i),i=this.scrollController.stateHolder.getPageFrameOffset(this.viewMode,this.pdfPage.i),r={x:0,y:0},l=zn.getOffset(this.scrollController.stateHolder,this.contentViewRoot,this.scale,this.viewMode,this.currentPageNo),g=this.direction,S=t,y=n;return(g===1||g===3)&&([S,y]=[y,S]),uc(g).process(()=>{r.x=i.offsetX,r.y=i.offsetY+e.height},()=>{r.x=i.offsetX,r.y=i.offsetY,y*=-1},()=>{r.x=i.offsetX+e.width,r.y=i.offsetY,S*=-1,y*=-1},()=>{r.x=i.offsetX+e.width,r.y=i.offsetY+e.height,S*=-1}),{x:(r.x+Ti.MARGIN+S)*this.zoom+l.offsetX,y:(r.y+Ti.MARGIN-y)*this.zoom+l.offsetY}}locate(t){if(!t)return;let n=this.contentViewRoot.getBoundingClientRect(),e=t.getBoundingClientRect();e.top<n.top?this.boundingTranslate.y=n.top-e.top:n.bottom<e.bottom&&(this.boundingTranslate.y=n.bottom-e.bottom),e.left<n.left?this.boundingTranslate.x=n.left-e.left:n.right<e.right&&(this.boundingTranslate.x=n.right-e.right)}fixPoints(t,n,e){let i=e-n.numberOfItems;for(let r=0;r<i;r++)n.appendItem(t.createSVGPoint());for(let r=i-1;r>=e;r++)n.removeItem(r);return n}centerPointOfPopup(){return{x:this.popupViewCoords.x+(this.popupCoords.right-this.popupCoords.left)/2+this.boundingTranslate.x,y:this.popupViewCoords.y+(this.popupCoords.top-this.popupCoords.bottom)/2+this.boundingTranslate.y}}drawPopupLink(t={x:0,y:0}){let n=Pr.centerPointOf(this.textCoords);n=this.convertPDFCoord(n.x,n.y);let e=vi({},t),i=this.direction;(i===1||i===3)&&([e.x,e.y]=[e.y,e.x]),uc(i).process(null,()=>{e.x*=-1},()=>{e.x*=-1,e.y*=-1},()=>{e.y*=-1}),n.x+=e.x*this.zoom,n.y+=e.y*this.zoom;let r=this.centerPointOfPopup(),l=[n,{x:r.x-10,y:r.y-10},{x:r.x+10,y:r.y+10}],g=this.points;l.length===g.numberOfItems&&l.forEach((S,y)=>Object.assign(g.getItem(y),S))}subscribeMainViewResized(){this.subscriptionService.push(at(Q.windowResize$,this.store$.pipe(H("sideViewVisible")),this.store$.pipe(H("sideViewSize")),this.store$.pipe(H("rightSideViewVisible")),this.store$.pipe(H("rightSideViewSize"))).pipe(ri(0)).subscribe({next:()=>this.changeDetectorRef.markForCheck()}))}};A(Kn,"linkBoxStyle",J.bindLayoutOrder({width:"initial",height:"initial","pointer-events":"none"},J.LayoutOrder.PopupLinker)),A(Kn,"AnchorList",["nw","ne","sw","se","n","s","w","e"]),A(Kn,"\u0275fac",function(n){return new(n||Kn)(v(ni),v(it),v(ot),v(At),v(ye),v(tn),v(Zt),v(Z),v(Ee),v(ji),v(Ve))}),A(Kn,"\u0275cmp",Ce({type:Kn,selectors:[["sd-popup"]],viewQuery:function(n,e){if(n&1&&(Ue(zg,7),Ue(Gg,7)),n&2){let i;Re(i=Ie())&&(e.svgElementRef=i.first),Re(i=Ie())&&(e.popupElementRef=i.first)}},inputs:{popupInfo:"popupInfo",popupOrder:"popupOrder",contentViewRoot:"contentViewRoot"},standalone:!1,features:[be([Z,{provide:Bn,useValue:new Yt(300)}]),qi],decls:27,vars:42,consts:[["popup",""],["inputTitleRef",""],["svg",""],[1,"popup-container",3,"ngStyle"],[1,"popup","no-scroller",3,"mousedown","touchstart","pointerdown","pointermove","pointerup","ngStyle"],[1,"nav"],[1,"label",3,"dblclick"],["class","title",4,"ngIf","ngIfElse"],[1,"btns"],["class","color-picker-container",3,"disabled","selected",4,"ngIf"],["size","tiny",3,"nullable","customColorLabel","defaultColorLabel","defaultColorPanelExpandedd","ngModel","ngModelChange",4,"ngIf"],["color","dark",1,"ep-text-button",3,"click","title","tooltip"],[1,"papycon","papycon-exit-fullscreen"],["color","dark",1,"ep-text-button",3,"click","title","tooltip","disabled"],[1,"papycon","papycon-trash-can"],[3,"anchor",4,"ngFor","ngForOf"],[1,"no-scroller",3,"ngModelChange","change","keyup.esc","keydown","touchstart","pointerdown","pointermove","pointerup","placeholder","maxlength","readonly","ngModel"],[3,"ngStyle"],[1,"title"],[3,"blur","keydown.enter","placeholder","autofocus","formControl","ariaLabel"],[1,"color-picker-container"],[1,"color-rect",3,"click"],["size","tiny",3,"ngModelChange","nullable","customColorLabel","defaultColorLabel","defaultColorPanelExpandedd","ngModel"],[3,"anchor"]],template:function(n,e){if(n&1){let i=_e();R(0,"div",3)(1,"div",4,0),ce("mousedown",function(l){return W(i),z(e.onMouseDown(l))})("touchstart",function(l){return W(i),z(e.onMouseDown(e.touchToMouse(l)))})("pointerdown",function(l){return W(i),z(l.stopPropagation())})("pointermove",function(l){return W(i),z(l.stopPropagation())})("pointerup",function(l){return W(i),z(l.stopPropagation())}),R(3,"div",5)(4,"div",6),ce("dblclick",function(){return W(i),z(e.startEditTitle())}),se(5,Yg,2,1,"span",7)(6,Qg,3,8,"ng-template",null,1,ci),N(),R(8,"div",8),se(9,qg,2,6,"div",9)(10,Kg,3,9,"pu-color-palette",10),R(11,"button",11),G(12,"translate"),G(13,"translate"),G(14,"translate"),ce("click",function(){return W(i),z(e.togglePopup())}),X(15,"i",12),N(),R(16,"button",13),G(17,"translate"),G(18,"translate"),G(19,"translate"),ce("click",function(){return W(i),z(e.onMouseClickDelete())}),X(20,"i",14),N()()(),se(21,Xg,1,1,"sd-popup-resizer",15),R(22,"textarea",16),G(23,"translate"),yi("ngModelChange",function(l){return W(i),wi(e.contents,l)||(e.contents=l),z(l)}),ce("change",function(){return W(i),z(e.onPopupValueChanged())})("keyup.esc",function(){return W(i),z(e.togglePopup())})("keydown",function(l){return W(i),z(l.stopPropagation())})("touchstart",function(l){return W(i),z(l.stopPropagation())})("pointerdown",function(l){return W(i),z(l.stopPropagation())})("pointermove",function(l){return W(i),z(l.stopPropagation())})("pointerup",function(l){return W(i),z(l.stopPropagation())}),N()(),_i(),R(24,"svg",17,2),X(26,"polygon",17),N()()}if(n&2){let i=ei(7);O("ngStyle",e.popupContainerStyles),x(),O("ngStyle",e.popupStyles),x(4),O("ngIf",!e.isEditingTitle)("ngIfElse",i),x(4),O("ngIf",e.isTextAnnot),x(),O("ngIf",e.isColorTabClicked),x(),O("title",Y(12,24,"CLOSE"))("tooltip",_t(38,fd,Y(13,26,"CLOSE"))),ue("aria-label",Y(14,28,"CLOSE")),x(5),O("title",Y(17,30,"DELETE"))("tooltip",_t(40,fd,Y(18,32,"DELETE")))("disabled",e.isLockedAnnot()),ue("aria-label",Y(19,34,"DELETE")),x(5),O("ngForOf",e.anchorList),x(),Gi("font-size",e.preferences.popupFontSize+"px")("background",e.popupStyles.background),O("placeholder",Y(23,36,"COMMENTS"))("maxlength",e.environment==null||e.environment.annotation==null?null:e.environment.annotation.contentsLengthLimit)("readonly",e.isReadonly()),Mi("ngModel",e.contents),x(2),O("ngStyle",e.popupLinkBoxStyles),x(2),O("ngStyle",e.popupLinkStyles)}},styles:["[_nghost-%COMP%]{display:block;height:100%}.popup[_ngcontent-%COMP%]{position:absolute;top:0;left:0;box-shadow:0 4px 9px #0000003d}.nav[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;width:100%;height:40px;box-sizing:border-box;padding:0 16px;-webkit-user-select:none;user-select:none;pointer-events:none;white-space:nowrap}.nav[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;cursor:text;pointer-events:auto}.nav[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-size:13px;line-height:22px;font-family:NotoSans-Medium,sans-serif;color:#6c6c6c}.nav[_ngcontent-%COMP%]   .btns[_ngcontent-%COMP%]{display:flex}.nav[_ngcontent-%COMP%]   .btns[_ngcontent-%COMP%]   .color-picker-container[_ngcontent-%COMP%]{border:1px solid #DADADA;border-radius:2px;box-sizing:border-box;padding:3px;width:24px;height:24px;pointer-events:initial;cursor:pointer}.nav[_ngcontent-%COMP%]   .btns[_ngcontent-%COMP%]   .color-picker-container.disabled[_ngcontent-%COMP%]{opacity:.5;pointer-events:none;-webkit-user-select:none;user-select:none}.nav[_ngcontent-%COMP%]   .btns[_ngcontent-%COMP%]   .color-picker-container.selected[_ngcontent-%COMP%]{background-color:rgba(var(--primary-50),.08);border:1px solid var(--primary-50);box-shadow:0 0 6px 0 var(--primary-50)}.nav[_ngcontent-%COMP%]   .btns[_ngcontent-%COMP%]   .color-picker-container[_ngcontent-%COMP%]   .color-rect[_ngcontent-%COMP%]{width:16px;height:16px;border-radius:2px;background-size:cover}.nav[_ngcontent-%COMP%]   .btns[_ngcontent-%COMP%]   pu-color-palette[_ngcontent-%COMP%]{background:var(--mono-00);border:1.2px solid var(--mono-30);border-radius:2px;box-sizing:border-box;position:absolute;margin-top:33.2px;pointer-events:initial;padding:10px;width:216px;overflow:hidden;z-index:10000}.nav[_ngcontent-%COMP%]   .btns[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border-width:0;outline-offset:-2px;width:24px;height:24px;margin-left:8px;opacity:.8;pointer-events:initial}.popup-container[_ngcontent-%COMP%]{position:absolute;top:0;left:0}textarea[_ngcontent-%COMP%]{font-size:14px;line-height:24px;font-family:NotoSans-Regular,sans-serif;color:#1e1e1e;box-sizing:border-box;width:100%;max-width:100%;height:calc(100% - 40px);max-height:calc(100% - 20px);padding:16px;background-color:inherit;border:none;overflow:auto;resize:none}textarea[_ngcontent-%COMP%]:focus{outline:none}svg[_ngcontent-%COMP%]{position:absolute;left:0;cursor:auto;overflow:visible}polygon[_ngcontent-%COMP%]{stroke-width:1}"],changeDetection:0}));var Wo=Kn;Qe([pp(nt.popupComp.contents,1e3)],Wo.prototype,"contents",null);var md=(()=>{let t=class t{annotService;renderer;changeDetectorRef;popup;anchor;MIN_WIDTH=95;MIN_HEIGHT=50;_resizerStyles={};onMouseMoveListener=null;onMouseUpListener=null;onTouchMoveListener=null;onTouchEndListener=null;drag_startCursorPos={x:0,y:0};drag_startPopupPos={top:0,left:0,right:0,bottom:0};popup_prevSize={width:0,height:0};constructor(e,i,r,l){this.annotService=e,this.renderer=i,this.changeDetectorRef=r,this.popup=l}ngAfterViewInit(){Object.assign(this._resizerStyles,this.positionCalc(this.anchor,4)),Object.assign(this._resizerStyles,this.sizeCalc(this.anchor,10)),this._resizerStyles.cursor=`${this.anchor}-resize`,this._resizerStyles.position="absolute",this.detectChange()}ngOnDestroy(){this.destroyMouseListeners()}onMouseDown(e){e.target===e.currentTarget&&(e.stopPropagation(),e.preventDefault(),this.popup.applyTranslateToReal(),this.popup_prevSize.width=this.popup.popupSize.width,this.popup_prevSize.height=this.popup.popupSize.height,this.drag_startCursorPos.x=e.clientX,this.drag_startCursorPos.y=e.clientY,Object.assign(this.drag_startPopupPos,this.popup.popupCoords),this.onMouseMoveListener=this.renderer.listen("document","mousemove",i=>this.onMouseMove(i)),this.onMouseUpListener=this.renderer.listen("document","mouseup",i=>this.onMouseUp(i)),this.onTouchMoveListener=this.renderer.listen("document","touchmove",i=>this.onMouseMove(this.touchToMouse(i))),this.onTouchEndListener=this.renderer.listen("document","touchend",i=>this.onMouseUp(this.touchToMouse(i))))}onMouseMove(e){let i=this.popup.direction,r={left:0,top:0,right:0,bottom:0};return e.stopPropagation(),e.preventDefault(),this.anchor.includes("n")&&(r.top=this.drag_startCursorPos.y-e.clientY,this.popup_prevSize.height+r.top<this.MIN_HEIGHT&&(r.top=this.MIN_HEIGHT-Math.floor(this.popup_prevSize.height)),this.popup.popupSize.height=this.popup_prevSize.height+r.top,(i===1||i===2)&&(r.top*=-1),i===1||i===3?this.popup.popupCoords.left=this.drag_startPopupPos.left+r.top/this.popup.zoom:this.popup.popupCoords.top=this.drag_startPopupPos.top+r.top/this.popup.zoom),this.anchor.includes("w")&&(r.left=e.clientX-this.drag_startCursorPos.x,this.popup_prevSize.width-r.left<this.MIN_WIDTH&&(r.left=Math.floor(this.popup_prevSize.width)-this.MIN_WIDTH),this.popup.popupSize.width=this.popup_prevSize.width-r.left,(i===2||i===3)&&(r.left*=-1),i===1||i===3?this.popup.popupCoords.top=this.drag_startPopupPos.top+r.left/this.popup.zoom:this.popup.popupCoords.left=this.drag_startPopupPos.left+r.left/this.popup.zoom),this.anchor.includes("e")&&(r.right=e.clientX-this.drag_startCursorPos.x,this.popup_prevSize.width+r.right<this.MIN_WIDTH&&(r.right=this.MIN_WIDTH-Math.floor(this.popup_prevSize.width)),this.popup.popupSize.width=this.popup_prevSize.width+r.right,this.popup.popupCoords.right=this.drag_startPopupPos.right+r.right/this.popup.zoom),this.anchor.includes("s")&&(r.bottom=this.drag_startCursorPos.y-e.clientY,this.popup_prevSize.height-r.bottom<this.MIN_HEIGHT&&(r.bottom=Math.floor(this.popup_prevSize.height)-this.MIN_HEIGHT),this.popup.popupSize.height=this.popup_prevSize.height-r.bottom,this.popup.popupCoords.bottom=this.drag_startPopupPos.bottom+r.bottom/this.popup.zoom),this.popup.popupCoords.right=this.popup.popupCoords.left+this.popup.popupSize.width,this.popup.popupCoords.bottom=this.popup.popupCoords.top-this.popup.popupSize.height,this.detectChange(),!1}onMouseUp(e){e.stopPropagation(),e.preventDefault(),this.destroyMouseListeners(),this.annotService.putModel(this.popup.popup,"modify"),this.detectChange()}destroyMouseListeners(){F.isDefined(this.onMouseMoveListener)&&this.onMouseMoveListener(),this.onMouseMoveListener=null,F.isDefined(this.onMouseUpListener)&&this.onMouseUpListener(),this.onMouseUpListener=null,F.isDefined(this.onTouchMoveListener)&&this.onTouchMoveListener(),this.onTouchMoveListener=null,F.isDefined(this.onTouchEndListener)&&this.onTouchEndListener(),this.onTouchEndListener=null}get resizerStyles(){return this._resizerStyles}positionCalc(e,i){let r={};switch(e.includes("n")&&(r.top=`${-i}px`),e.includes("w")&&(r.left=`${-i}px`),e.includes("e")&&(r.right=`${-i}px`),e.includes("s")&&(r.bottom=`${-i}px`),e){case"n":case"s":r.left=`${i}px`;break;case"w":case"e":r.top=`${i}px`;break}return r}sizeCalc(e,i){let r={};if(e.length===2)return r.height=`${i}px`,r.width=r.height,r;switch(e){case"n":case"s":r.width=`calc(100% - ${i}px)`,r.height=`${i}px`;break;case"w":case"e":r.height=`calc(100% - ${i}px)`,r.width=`${i}px`;break}return r}touchToMouse(e){return this.popup.touchToMouse(e)}detectChange(){this.changeDetectorRef.destroyed||(this.changeDetectorRef.markForCheck(),this.changeDetectorRef.detectChanges())}};A(t,"\u0275fac",function(i){return new(i||t)(v(ni),v(At),v(ye),v(Wo,1))}),A(t,"\u0275cmp",Ce({type:t,selectors:[["sd-popup-resizer"]],inputs:{anchor:"anchor"},standalone:!1,features:[be([Z])],decls:1,vars:1,consts:[[1,"no-scroller",3,"mousedown","pointerdown","pointermove","pointerup","touchstart","ngStyle"]],template:function(i,r){i&1&&(R(0,"div",0),ce("mousedown",function(g){return r.onMouseDown(g)})("pointerdown",function(g){return g.stopPropagation()})("pointermove",function(g){return g.stopPropagation()})("pointerup",function(g){return g.stopPropagation()})("touchstart",function(g){return r.onMouseDown(r.touchToMouse(g))}),N()),i&2&&O("ngStyle",r.resizerStyles)},dependencies:[Gt],encapsulation:2,changeDetection:0}));let a=t;return a})();function ef(a,t){if(a&1&&X(0,"sd-popup",1),a&2){let n=t.$implicit,e=w();O("contentViewRoot",e.contentViewRoot)("popupInfo",n)("popupOrder",e.popupOrder)}}var gc=(()=>{let t=class t{contentService;popupService;changeDetectorRef;subscriptionService;store$;contentViewRoot;popups=[];popupOrder=[];isSelectedInAnnotView=!1;annotTool;constructor(e,i,r,l,g){this.contentService=e,this.popupService=i,this.changeDetectorRef=r,this.subscriptionService=l,this.store$=g}ngOnInit(){this.subscriptionService.push(this.store$.pipe(Ao()).subscribe({next:e=>this.annotTool=e}),this.contentService.annotEvent$.subscribe({next:e=>this.isSelectedInAnnotView=e?.from==="AnnotationViewComponent"}),this.popupService.popupHolder$.subscribe({next:e=>{this.toggle(e),this.popupService.publishOpenedPopupNumber(this.popups.length)}}),at(this.contentService.reload$.pipe(L(e=>Do.type(e,No.Annot))),this.popupService.closeAllPopup$).subscribe({next:()=>{this.clearPopups(),this.popupService.publishOpenedPopupNumber(0),this.changeDetectorRef.markForCheck()}}))}ngOnDestroy(){this.clearPopups()}clearPopups(){this.popups.splice(0),this.popupOrder.splice(0)}toggle({src:e,popup:i,pdfPage:r,open:l}){let g=this.popups.findIndex(S=>i.oid===S.popup.oid);if(g>=0&&(l===void 0||!l)){this.popups.splice(g,1),g=this.popupOrder.indexOf(i.oid),g>-1&&this.popupOrder.splice(g,1),this.changeDetectorRef.markForCheck();return}this.annotTool!==qe.ERASER&&(l===void 0||l)&&(this.popupOrder.push(i.oid),this.isSelectedInAnnotView||this.popups.push({src:e,popup:i,pdfPage:r}),this.changeDetectorRef.markForCheck())}};A(t,"\u0275fac",function(i){return new(i||t)(v(it),v(na),v(ye),v(Z),v(Ee))}),A(t,"\u0275cmp",Ce({type:t,selectors:[["sd-popups"]],inputs:{contentViewRoot:"contentViewRoot"},standalone:!1,features:[be([Z])],decls:1,vars:1,consts:[[3,"contentViewRoot","popupInfo","popupOrder",4,"ngFor","ngForOf"],[3,"contentViewRoot","popupInfo","popupOrder"]],template:function(i,r){i&1&&se(0,ef,1,3,"sd-popup",0),i&2&&O("ngForOf",r.popups)},encapsulation:2,changeDetection:0}));let a=t;return a})();var nf=["quickActionRef"],of=["actionsContainerRef"],rf=["actionItemRef"],sf=()=>({"background-color":"var(--mono-10)","padding-left":"30px"}),vd=(a,t)=>({focused:a,disabled:t});function af(a,t){if(a&1){let n=_e();Lt(0),R(1,"button",14,2),G(3,"translate"),ce("click",function(){let i=W(n).$implicit,r=w(3);return z(r.onActionClick(i))})("mouseenter",function(){let i=W(n).index,r=w(3);return z(r.onMouseEnterAction(i))}),R(4,"div",15)(5,"div",16),X(6,"i"),N(),R(7,"span"),me(8),G(9,"translate"),N()()(),Ft()}if(a&2){let n=t.$implicit,e=t.index,i=w(3);x(),O("ngClass",Za(9,vd,e===i.focusedActionIndex,i.shouldDisableAction(n))),ue("aria-label",Y(3,5,n.name)),x(5),gs(n.icon),x(2),xe(Y(9,7,n.name))}}function cf(a,t){if(a&1&&(R(0,"div")(1,"h4"),me(2),G(3,"translate"),N(),se(4,af,10,12,"ng-container",13),N()),a&2){let n=w(2);x(2),xe(Y(3,3,"RECENT_ACTION")),x(2),O("ngForOf",n.recentActions)("ngForTrackBy",n.trackByAction)}}function lf(a,t){a&1&&(R(0,"h4"),me(1),G(2,"translate"),N()),a&2&&(x(),xe(Y(2,1,"SHORTCUT")))}function pf(a,t){if(a&1){let n=_e();Lt(0),R(1,"button",14,2),G(3,"translate"),ce("click",function(){let i=W(n).$implicit,r=w(2);return z(r.onActionClick(i))})("mouseenter",function(){let i=W(n).index,r=w(2);return z(r.onMouseEnterAction(i+r.recentActions.length))}),R(4,"div",15)(5,"div",16),X(6,"i"),N(),R(7,"span"),me(8),G(9,"translate"),N()(),R(10,"span",17),me(11),N()(),Ft()}if(a&2){let n=t.$implicit,e=t.index,i=w(2);x(),O("ngClass",Za(10,vd,e+i.recentActions.length===i.focusedActionIndex,i.shouldDisableAction(n))),ue("aria-label",Y(3,6,n.name)),x(5),gs(n.icon),x(2),xe(Y(9,8,n.name)),x(3),xe(n.shortcut)}}function df(a,t){if(a&1){let n=_e();R(0,"nav",4,0),ce("mousedown",function(i){return W(n),z(i.stopPropagation())}),R(2,"div",5)(3,"div",6),X(4,"i",7),R(5,"pu-input",8),G(6,"translate"),yi("ngModelChange",function(i){W(n);let r=w();return wi(r.actionkeyword,i)||(r.actionkeyword=i),z(i)}),ce("ngModelChange",function(i){W(n);let r=w();return z(r.onSearchChange(i))}),N()(),R(7,"button",9),ce("click",function(){W(n);let i=w();return z(i.onCloseClick())}),X(8,"i",10),N()(),R(9,"div",11,1),ce("wheel",function(i){return W(n),z(i.stopPropagation())}),se(11,cf,5,5,"div",12),R(12,"div"),se(13,lf,3,3,"h4",12)(14,pf,12,13,"ng-container",13),N()()()}if(a&2){let n=w();x(5),O("placeholder",Y(6,8,"SEARCH_FEATURE"))("autofocus",!0)("inputStyle",Or(10,sf)),Mi("ngModel",n.actionkeyword),x(6),O("ngIf",n.recentActions.length>0),x(2),O("ngIf",n.actionkeyword.length===0),x(),O("ngForOf",n.displayedActions)("ngForTrackBy",n.trackByAction)}}var fc=(()=>{let t=class t{changeDetectorRef;store$;viewerService;subscriptionService;shortcutService;localstorageService;quickActionService;actionHistoryService;annotSelectedService;pageService;documentService;objectClipboardService;DEFAULT_FOCUSED_ACTION_INDEX=0;actionkeyword=F.EMPTY_STRING;focusedActionIndex=this.DEFAULT_FOCUSED_ACTION_INDEX;shouldDisplayPalette=!1;viewMode;currentPageNo;pageCount;canUndo=!1;canRedo=!1;isNavigatingByKeyboard=!1;quickActionRef;actionsContainerRef;actionItemRefs;constructor(e,i,r,l,g,S,y,I,B,ee,ge,le){this.changeDetectorRef=e,this.store$=i,this.viewerService=r,this.subscriptionService=l,this.shortcutService=g,this.localstorageService=S,this.quickActionService=y,this.actionHistoryService=I,this.annotSelectedService=B,this.pageService=ee,this.documentService=ge,this.objectClipboardService=le}get displayedActions(){return this.actionkeyword.length>0?this.quickActionService.filterActionsByKeyword(this.actionkeyword.trim()):this.quickActionService.getActionsByIds(bp)}get recentActions(){let e=this.getRecentActionsFromLocalStorage();return e.length===0||this.actionkeyword.length>0?[]:e}get combinedActions(){return this.actionkeyword.length>0?this.displayedActions:[...this.recentActions,...this.displayedActions]}ngOnInit(){this.initSubscriptions()}initSubscriptions(){this.subscriptionService.push(Q.windowMousedown$.pipe(L(()=>this.shouldDisplayPalette&&F.isDefined(this.quickActionRef))).subscribe({next:e=>{let i=e.clientX,r=e.clientY,l=this.quickActionRef.nativeElement.getBoundingClientRect();i>=l.left&&i<=l.right&&r>=l.top&&r<=l.bottom||(this.quickActionService.setPaletteVisibility(!1),this.changeDetectorRef.markForCheck())}}),this.quickActionService.paletteVisibility$.subscribe({next:e=>{this.shouldDisplayPalette=e,this.focusedActionIndex=this.DEFAULT_FOCUSED_ACTION_INDEX,this.actionkeyword=F.EMPTY_STRING,this.changeDetectorRef.markForCheck()}}),this.shortcutService.getShortcutEvent(Ae.QUICK_ACTION).pipe(L(()=>K.get(ne.SHORTCUT_QUICK_ACTION)),L(()=>!Q.isSmallWidth())).subscribe({next:()=>{this.quickActionService.togglePaletteVisibility(),this.changeDetectorRef.markForCheck()}}),this.shortcutService.getShortcutEvent(Ae.ESCAPE).pipe(L(()=>this.shouldDisplayPalette)).subscribe({next:()=>{this.quickActionService.setPaletteVisibility(!1),this.changeDetectorRef.markForCheck()}}),this.shortcutService.getShortcutEvent(Ae.MOVE_BOTTOM).pipe(L(()=>this.shouldDisplayPalette)).subscribe({next:e=>this.navigateToActionByKeyboard(Ae.MOVE_BOTTOM,e)}),this.shortcutService.getShortcutEvent(Ae.MOVE_TOP).pipe(L(()=>this.shouldDisplayPalette)).subscribe({next:e=>this.navigateToActionByKeyboard(Ae.MOVE_TOP,e)}),this.shortcutService.getShortcutEvent(Ae.ENTER).pipe(L(()=>this.shouldDisplayPalette)).subscribe({next:()=>{let e=this.combinedActions[this.focusedActionIndex];this.onActionClick(e)}}),this.store$.pipe(H("viewMode")).subscribe({next:e=>this.viewMode=e}),this.store$.pipe(H("currentPageNo")).subscribe({next:e=>this.currentPageNo=e}),this.store$.pipe(H("pageCount")).subscribe({next:e=>this.pageCount=e}),this.actionHistoryService.availableUndoCount$.subscribe({next:e=>this.canUndo=e>0}),this.actionHistoryService.availableRedoCount$.subscribe({next:e=>this.canRedo=e>0}))}shouldDisableAction(e){let i=this.pageService.pdfPages[this.currentPageNo-1];switch(e.id){case Se.UNDO:return!this.canUndo;case Se.REDO:return!this.canRedo;case Se.COPY:return this.annotSelectedService.pageIndex!==i.ref&&(this.annotSelectedService.selectedComponents.length===0||!this.annotSelectedService.selectedComponents.every(g=>g.data.oid!==null));case Se.PASTE:return!this.objectClipboardService.hasAnnotsInLegacyClipboard;case Se.CHANGE_TO_EBOOK_MODE:return this.quickActionService.isEbookMode;case Se.CHANGE_TO_THE_READING_MODE:return!this.quickActionService.isEbookMode;case Se.ROTATE_CCW:return this.quickActionService.isEbookMode;case Se.ROTATE_CW:return this.quickActionService.isEbookMode;case Se.REDACT_AREA:return!this.documentService.checkAuthority(Le.DRAW_REDACTION);case Se.REDACT_PAGE:return!this.documentService.checkAuthority(Le.DRAW_REDACTION);case Se.REDACT_SEARCH:return!this.documentService.checkAuthority(Le.SEARCH_TEXT);case Se.PREVIOUS_PAGE:return this.currentPageNo<=1;case Se.NEXT_PAGE:return this.viewMode===4?J.getEbookPageNo(this.pageCount)<=this.currentPageNo:this.pageCount<=this.currentPageNo;case Se.DELETE:let r=this.annotSelectedService.selectedComponents.every(g=>Bt.isWidget(g.data)&&K.get(ne.DELETE_FORM)||!Bt.isWidget(g.data)&&K.get(ne.DELETE_ANNOTATION)),l=this.annotSelectedService.selectedComponents.every(g=>!rr.get(g.data.attributes.F,7));return!(r&&l&&this.annotSelectedService.selectedComponents.every(g=>g.data.oid!==null)&&this.annotSelectedService.selectedComponents.length>0);default:return!1}}trackByAction(e,i){return`${i.id}/${i.name}`}onSearchChange(e){this.actionkeyword=e,this.focusedActionIndex=this.DEFAULT_FOCUSED_ACTION_INDEX}onCloseClick(){this.quickActionService.setPaletteVisibility(!1)}navigateToActionByKeyboard(e,i){i.preventDefault(),i.stopPropagation(),this.isNavigatingByKeyboard=!0,e===Ae.MOVE_BOTTOM?this.focusedActionIndex=Math.min(this.combinedActions.length-1,this.focusedActionIndex+1):this.focusedActionIndex=Math.max(0,this.focusedActionIndex-1),this.scrollToFocusedAction(),this.changeDetectorRef.markForCheck()}scrollToFocusedAction(){let i=this.actionItemRefs.toArray()[this.focusedActionIndex];if(!i)return;let l=this.actionsContainerRef.nativeElement.getBoundingClientRect(),g=i.nativeElement.getBoundingClientRect(),S=g.top<l.top,y=g.bottom>l.bottom;(S||y)&&i.nativeElement.scrollIntoView({behavior:"instant",block:"nearest",inline:"nearest"})}onMouseEnterAction(e){if(this.isNavigatingByKeyboard){this.isNavigatingByKeyboard=!1;return}this.focusedActionIndex=e,this.changeDetectorRef.markForCheck()}onActionClick(e){this.shouldDisableAction(e)||(this.saveRecentAction(e),e.actionFn(),this.quickActionService.setPaletteVisibility(!1),this.changeDetectorRef.markForCheck())}getRecentActionsFromLocalStorage(){if(!this.localstorageService?.isEnabledLocalStorage)return[];let e=JSON.parse(this.localstorageService.get("SD_RecentActions")||"[]");return this.quickActionService.getActionsByIds(e)}saveRecentAction(e){if(!this.localstorageService?.isEnabledLocalStorage)return;let i=JSON.parse(this.localstorageService.get("SD_RecentActions")||"[]");i=i.filter(r=>r!==e.id),i.unshift(e.id),i=i.slice(0,2),this.localstorageService.set("SD_RecentActions",JSON.stringify(i))}};A(t,"\u0275fac",function(i){return new(i||t)(v(ye),v(Ee),v(oi),v(Z),v(Hi),v(Js),v(Tn),v(Wn),v(Pi),v(Ht),v(ot),v(aa))}),A(t,"\u0275cmp",Ce({type:t,selectors:[["sd-quick-action"]],viewQuery:function(i,r){if(i&1&&(Ue(nf,5),Ue(of,5),Ue(rf,5)),i&2){let l;Re(l=Ie())&&(r.quickActionRef=l.first),Re(l=Ie())&&(r.actionsContainerRef=l.first),Re(l=Ie())&&(r.actionItemRefs=l)}},standalone:!1,features:[be([Z])],decls:1,vars:1,consts:[["quickActionRef",""],["actionsContainerRef",""],["actionItemRef",""],["aria-label","Quick actions","class","quick-action-palette",3,"mousedown",4,"ngIf"],["aria-label","Quick actions",1,"quick-action-palette",3,"mousedown"],[1,"navigation"],["role","search",1,"search-bar"],[1,"papycon","papycon-search"],["size","small",3,"ngModelChange","placeholder","autofocus","inputStyle","ngModel"],["aria-label","Close quick action palette",1,"ep-button","close",3,"click"],["aria-hidden","true",1,"papycon","papycon-cross"],["role","menu","aria-label","Available actions",1,"actions-container",3,"wheel"],[4,"ngIf"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"action",3,"click","mouseenter","ngClass"],[1,"action-info"],[1,"icon-container"],[1,"shortcut"]],template:function(i,r){i&1&&se(0,df,15,11,"nav",3),i&2&&O("ngIf",r.shouldDisplayPalette)},styles:[".quick-action-palette[_ngcontent-%COMP%]{font-size:13px;line-height:22px;color:#1e1e1e;font-family:NotoSans-Regular,sans-serif;display:flex;flex-direction:column;row-gap:8px;box-sizing:border-box;width:344px;height:322px;border-radius:8px;z-index:5;position:fixed;left:50%;transform:translate(-50%);top:212px;background-color:var(--mono-00);box-shadow:0 4px 8px #6c6c6c1f;border:1px solid var(--mono-30);padding:12px;cursor:default}.quick-action-palette[_ngcontent-%COMP%]   .navigation[_ngcontent-%COMP%]{display:flex;flex-direction:row;column-gap:12px;align-items:center;width:100%;flex-shrink:0}.quick-action-palette[_ngcontent-%COMP%]   .navigation[_ngcontent-%COMP%]   .search-bar[_ngcontent-%COMP%]{box-sizing:border-box;width:100%;height:40px;display:flex;flex-direction:row;column-gap:8px;align-items:center;border-radius:4px;background-color:var(--mono-10)}.quick-action-palette[_ngcontent-%COMP%]   .navigation[_ngcontent-%COMP%]   .search-bar[_ngcontent-%COMP%]   pu-input[_ngcontent-%COMP%]{position:relative;flex:1}.quick-action-palette[_ngcontent-%COMP%]   .navigation[_ngcontent-%COMP%]   .search-bar[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{position:absolute;z-index:1;left:20px;font-size:24px;color:var(--mono-50)}.quick-action-palette[_ngcontent-%COMP%]   .navigation[_ngcontent-%COMP%]   .ep-button.close[_ngcontent-%COMP%]{display:none;height:30px;background-color:var(--mono-00);border:1px solid var(--mono-30)}.quick-action-palette[_ngcontent-%COMP%]   .actions-container[_ngcontent-%COMP%]{overflow:auto;width:100%;flex:1;display:flex;flex-direction:column;row-gap:8px}.quick-action-palette[_ngcontent-%COMP%]   .actions-container[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:12px;line-height:20px;color:#6c6c6c;font-family:NotoSans-Regular,sans-serif;margin:0}.quick-action-palette[_ngcontent-%COMP%]   .actions-container[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]{box-sizing:border-box;width:calc(100% - 4px);height:38px;padding:8px;border-radius:4px;display:flex;align-items:center;justify-content:space-between;flex-direction:row;background:none;border:none}.quick-action-palette[_ngcontent-%COMP%]   .actions-container[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]   .action-info[_ngcontent-%COMP%]{display:flex;align-items:center;flex-direction:row;column-gap:8px}.quick-action-palette[_ngcontent-%COMP%]   .actions-container[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]   .action-info[_ngcontent-%COMP%]   .icon-container[_ngcontent-%COMP%]{width:22px;height:22px}.quick-action-palette[_ngcontent-%COMP%]   .actions-container[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]   .action-info[_ngcontent-%COMP%]   .icon-container[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:22px;color:var(--mono-90)}.quick-action-palette[_ngcontent-%COMP%]   .actions-container[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]   .action-info[_ngcontent-%COMP%]   .icon-container[_ngcontent-%COMP%]   i.reverse[_ngcontent-%COMP%]{transform:scaleX(-1)}.quick-action-palette[_ngcontent-%COMP%]   .actions-container[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]   .action-info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:var(--mono-99)}.quick-action-palette[_ngcontent-%COMP%]   .actions-container[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]   .shortcut[_ngcontent-%COMP%]{font-size:12px;line-height:20px;color:var(--mono-70)}.quick-action-palette[_ngcontent-%COMP%]   .actions-container[_ngcontent-%COMP%]   .action.focused[_ngcontent-%COMP%]{background-color:var(--mono-10)}.quick-action-palette[_ngcontent-%COMP%]   .actions-container[_ngcontent-%COMP%]   .disabled[_ngcontent-%COMP%]   .action-info[_ngcontent-%COMP%]   .icon-container[_ngcontent-%COMP%]   i[_ngcontent-%COMP%], .quick-action-palette[_ngcontent-%COMP%]   .actions-container[_ngcontent-%COMP%]   .disabled[_ngcontent-%COMP%]   .action-info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:var(--button-pressed)}@media screen and (max-width: 577px){.quick-action-palette[_ngcontent-%COMP%]   .navigation[_ngcontent-%COMP%]   .ep-button.close[_ngcontent-%COMP%]{display:flex}}@media screen and (max-width: 397px){.quick-action-palette[_ngcontent-%COMP%]{width:100%;height:100%;border-radius:0;top:0}}"],changeDetection:0}));let a=t;return a})();var _d=(()=>{let t=class t{};A(t,"\u0275fac",function(i){return new(i||t)}),A(t,"\u0275mod",Jt({type:t})),A(t,"\u0275inj",Xt({providers:[tn],imports:[Fp,Ea,Ui,Rp,wr,da,Cn,id,Sp,ca,Bl,qs,Er,Xs,yr,ta,Lp,gp]}));let a=t;return a})();ti(So,[wa,Si,lt,$s,Gt,Pp,Oa,xa,cd,sc,qn,hc,Sa,Ca,gc,fc,zn,ba,Gr],[]);ti(sc,[Si,lt,Gt,_s,Ra],[]);ti(qn,[lt,Gt,Sn,Hn,vs,lo],[Ve]);ti(Ra,[Gt,ea],[]);ti(dr,[Sn,po,Hn,Ks],[Ve]);ti(hc,[lt,Gt,_s,Ra,pd],[Ve]);ti(Wo,[Si,lt,Gt,Gs,Sn,Ys,po,Fl,Hn,vs,lo,md],[Ve]);ti(gc,[Si,Wo],[]);ti(fc,[co,Si,lt,Sn,po,Hn],[Ve]);ti(Gr,[lt,Sn,po,Hn,lo],[Ve]);ti(Tp,[co,Si,lt,Gt,Ll,kl,Vl,lo],[Ve]);var hr=class hr{documentService;translatePipe;productService;store$;customUIService;annotSelectedService;actionHistoryService;modalService;dialogService;changeService;downloadService;viewerService;preferencesService;quickActionService;loggingService;hidableMenus={};leftSectionFirstCustomUI=[];leftSectionLastCustomUI=[];isSpreadsheets=!1;constructor(t,n,e,i,r,l,g,S,y,I,B,ee,ge,le,Te){this.documentService=t,this.translatePipe=n,this.productService=e,this.store$=i,this.customUIService=r,this.annotSelectedService=l,this.actionHistoryService=g,this.modalService=S,this.dialogService=y,this.changeService=I,this.downloadService=B,this.viewerService=ee,this.preferencesService=ge,this.quickActionService=le,this.loggingService=Te,this.store$.pipe(bi([V.TOOLBAR_EBOOK,V.TOOLBAR_PREFERENCES,V.TOOLBAR_DOCUMENT_INFO,V.TOOLBAR_SD_INFO,V.TOOLBAR_SAVE,V.TOOLBAR_PRINT,V.TOOLBAR_DOWNLOAD,V.TOOLBAR_SLIDESHOW,V.TOOLBAR_SCREEN_THEME])).subscribe({next:$e=>{this.hidableMenus=vi(vi({},this.hidableMenus),$e)}}),this.customUIService.customButtonUI$.subscribe({next:$e=>{this.leftSectionFirstCustomUI=$e.filter(p=>p.position==="TOOLBAR.LEFT_SECTION.FIRST"),this.leftSectionLastCustomUI=$e.filter(p=>p.position==="TOOLBAR.LEFT_SECTION.LAST")}}),this.store$.pipe(Ar("isSpreadsheets")).subscribe({next:$e=>this.isSpreadsheets=$e}),this.initRegisterQuickActions()}get isLessThanMobileWidth(){return Q.width<=Q.breakpoints.mobile.width}get isLessThanTabletWidth(){return Q.width<Q.breakpoints.tablet.width}get shouldAddSaveButton(){return this.documentService.checkAuthority(Le.SAVE_DOCUMENT)&&K.get(ne.SAVE_BUTTON)&&!K.get(ne.AUTO_SAVE)&&!this.hidableMenus[V.TOOLBAR_SAVE]&&(K.get(ne.HIDE_SAVE_DOWNLOAD_PRINT_IN_MENU)||this.isLessThanMobileWidth)}get shouldAddOriginalDownloadButton(){return this.productService.isStreamDocsVu&&this.documentService.checkAuthority(Le.DOWNLOAD_DOCUMENT)&&K.get(ne.ORIGINAL_DOWNLOAD_BUTTON)&&!this.hidableMenus[V.TOOLBAR_DOWNLOAD]&&this.documentService.hasOriginalFile}get shouldAddPdfDownloadButton(){return this.documentService.checkAuthority(Le.DOWNLOAD_DOCUMENT)&&K.get(ne.PDF_DOWNLOAD_BUTTON)&&!this.hidableMenus[V.TOOLBAR_DOWNLOAD]&&(K.get(ne.HIDE_SAVE_DOWNLOAD_PRINT_IN_MENU)||this.isLessThanTabletWidth)}get shouldAddDocInfoButton(){return K.get(ne.DOCUMENT_INFO_BUTTON)&&K.get(Ct.DOCUMENT_INFO_DIALOG)&&!this.hidableMenus[V.TOOLBAR_DOCUMENT_INFO]}get shouldAddPrintButton(){return this.documentService.checkAuthority(Le.PRINT_DOCUMENT)&&K.get(ne.PRINT_BUTTON)&&K.get(Ct.PRINT_DIALOG)&&!this.hidableMenus[V.TOOLBAR_PRINT]&&(K.get(ne.HIDE_SAVE_DOWNLOAD_PRINT_IN_MENU)||this.isLessThanTabletWidth)}buildMainMenu(t){let n=[],e={items:[]};if(this.isLessThanMobileWidth){let i=this.buildFirstCustomMenu();i.items.length>0&&n.push(i)}if([this.isLessThanMobileWidth?this.buildActionMenu(t):[],this.buildFileMenu(),this.buildViewMenu(t),this.buildSettingMenu(),this.buildInfoMenu()].forEach(i=>{i.length!==0&&(e.items.length>0&&e.items.push({type:Hl.LINE,label:"DIVISION_LINE"}),e.items.push(...i))}),e.items.length>0&&n.push(e),this.isLessThanMobileWidth){let i=this.buildLastCustomMenu();i.items.length>0&&n.push(i)}return n}buildActionMenu(t){if(!t.runtimeEnv.get(Ct.UNDO_REDO_BUTTONS)||this.isSpreadsheets)return[];let n=[];return n.push({label:this.translatePipe.transform("UNDO"),subLabel:li.getShortcutString(Xi[Ae.UNDO_ACTION]),command:()=>{this.annotSelectedService.unselectAll(),this.actionHistoryService.undo()},disabled:!t.canUndo}),n.push({label:this.translatePipe.transform("REDO"),subLabel:li.getShortcutString(Xi[Ae.REDO_ACTION]),command:()=>{this.annotSelectedService.unselectAll(),this.actionHistoryService.redo()},disabled:!t.canRedo}),n}buildFileMenu(){let t=[];return this.shouldAddSaveButton&&t.push({label:this.translatePipe.transform("SAVE"),command:()=>this.documentService.waitForConvPDF(this.changeService.saveDocumentForStatistics.bind(this.changeService,de.SAVE_DOCUMENT_BY_BUTTON,void 0,void 0,void 0))}),this.shouldAddOriginalDownloadButton&&t.push({label:this.translatePipe.transform("ORIGINAL_DOWNLOAD"),command:()=>this.downloadService.downloadOriginalDocument()}),this.shouldAddPdfDownloadButton&&t.push({label:this.translatePipe.transform(this.productService.isStreamDocsVu?"PDF_DOWNLOAD":"DOWNLOAD_DOC"),command:()=>{this.documentService.waitForConvPDF(this.downloadService.downloadDocument.bind(this.downloadService))}}),this.shouldAddDocInfoButton&&t.push({label:this.translatePipe.transform("DOC_PROPERTY_MENU"),command:()=>this.dialogService.toggleDialogVisibilityForStatistics(de.DOCUMENT_INFO_BY_BUTTON,$i.DOCUMENT_INFO,!0)}),this.shouldAddPrintButton&&t.push({label:this.translatePipe.transform("PRINT_MENU"),subLabel:li.getShortcutString(Xi[Ae.PRINT]),command:()=>{this.documentService.waitForConvPDF(this.dialogService.toggleDialogVisibility.bind(this.dialogService,$i.PRINT))}}),t}buildViewMenu(t){if(this.isSpreadsheets)return[];let n=[];return K.get(ne.SLIDESHOW_BUTTON)&&!this.hidableMenus[V.TOOLBAR_SLIDESHOW]&&n.push({label:this.translatePipe.transform("SLIDESHOW"),command:()=>this.viewerService.setSlideshow()}),K.get(ne.CAPTURE_MODE_BUTTON)&&!this.hidableMenus[V.TOOLBAR_CAPTURE_MODE]&&Q.isSmallWidth()&&n.push({label:this.translatePipe.transform("CAPTURE"),command:()=>this.store$.dispatch(he.set({key:"isCaptureMode",value:!0}))}),K.get(ne.EBOOK_BUTTON)&&!this.hidableMenus[V.TOOLBAR_EBOOK]&&n.push({label:t.isEbookMode()?this.translatePipe.transform("CHANGE_TO_THE_READING_MODE"):this.translatePipe.transform("CHANGE_TO_EBOOK_MODE"),command:()=>{this.documentService.waitForConvPDF(this.viewerService.toggleEbookModeForStatistics.bind(this.viewerService,de.CHANGE_TO_EBOOK))}}),n}buildChildrenOfScreenThemeMenu(t){let n=[],e=this.viewerService.screenTheme;n.push({label:this.translatePipe.transform("LIGHT_MODE"),icon:e==="light"?"papycon papycon-check-mark5":"",command:()=>this.changeScreenThemeForStatistics(de.LIGHT_THEME_BY_BUTTON,"light")}),n.push({label:this.translatePipe.transform("DARK_MODE"),icon:e==="dark"?"papycon papycon-check-mark5":"",command:()=>this.changeScreenThemeForStatistics(de.DARK_THEME_BY_BUTTON,"dark")}),n.push({label:this.translatePipe.transform("SYSTEM_SYNCHRONIZATION"),icon:e==="System synchronization"?"papycon papycon-check-mark5":"",command:()=>this.changeScreenThemeForStatistics(de.SYSTEM_THEME_BY_BUTTON,"System synchronization")}),t.push({items:n})}buildSettingMenu(){let t=[],n=[];return K.get(ne.SCREEN_THEME_MENU)&&!this.hidableMenus[V.TOOLBAR_SCREEN_THEME]&&!this.isSpreadsheets&&(this.buildChildrenOfScreenThemeMenu(n),t.push({label:this.translatePipe.transform("SCREEN_THEME"),children:n})),K.get(ne.PREFERENCES_BUTTON)&&K.get(Ct.PREFERENCES_DIALOG)&&!this.hidableMenus[V.TOOLBAR_PREFERENCES]&&t.push({label:this.translatePipe.transform("PREFERENCE_MENU"),command:()=>this.dialogService.toggleDialogVisibility($i.PREFERENCES,!0)}),t}buildInfoMenu(){let t=[];return K.get(ne.SD_INFO_BUTTON)&&!this.hidableMenus[V.TOOLBAR_SD_INFO]&&t.push({label:this.translatePipe.transform("SD_INFO"),command:()=>this.showProductInfoForStatistics(de.OPEN_SD_INFO_BY_BUTTON)}),t}showProductInfo(){this.productService.getProductLicenseInfo().subscribe({next:t=>{this.modalService.createCommonModal({type:Ut.PRODUCT,logo:this.productService.logo,description:this.productService.copyRight,content:t,accordionTitle:this.translatePipe.transform("OPEN_SOURCE_LICENSE_NOTICE"),confirmButton:!0,confirmLabel:this.translatePipe.transform("CLOSE")})},error:()=>{this.modalService.createCommonModal({type:Ut.PRODUCT,logo:this.productService.logo,description:this.productService.copyRight,content:this.translatePipe.transform("NO_PRODUCT_INFO"),accordionTitle:this.translatePipe.transform("OPEN_SOURCE_LICENSE_NOTICE"),confirmButton:!0,confirmLabel:this.translatePipe.transform("CLOSE")})}})}showProductInfoForStatistics(t){this.showProductInfo()}buildRightMenu(){let t=[];return this.shouldAddPrintButton&&t.push({label:this.translatePipe.transform("PRINT"),icon:"papycon papycon-print",command:()=>{this.dialogService.toggleDialogVisibility($i.PRINT)}}),this.shouldAddPdfDownloadButton&&t.push({label:this.translatePipe.transform("DOWNLOAD"),icon:"papycon papycon-download",command:()=>{this.downloadService.downloadDocument()}}),t}buildFirstCustomMenu(){let t={items:[]};return this.leftSectionFirstCustomUI.forEach(n=>{t.items.push({label:n.label,command:e=>{if(!F.isDefined(e)){this.loggingService.common("warn",pi.NOT_EXIST,"event");return}n.onclick($n.simplifyMouseEvent(e))}})}),t}buildLastCustomMenu(){let t={items:[]};return this.leftSectionLastCustomUI.forEach(n=>{t.items.push({label:n.label,command:e=>{if(!F.isDefined(e)){this.loggingService.common("warn",pi.NOT_EXIST,"event");return}n.onclick($n.simplifyMouseEvent(e))}})}),t}changeScreenThemeForStatistics(t,n){this.preferencesService.updatePreferences(["screenTheme"],n)}initRegisterQuickActions(){this.quickActionService.registerActions([{id:Se.SD_INFO,actionFn:()=>this.showProductInfoForStatistics(de.OPEN_SD_INFO_BY_QUICK_SEARCH)},{id:Se.LIGHT_THEME,actionFn:()=>this.changeScreenThemeForStatistics(de.LIGHT_THEME_BY_QUICK_SEARCH,"light")},{id:Se.DARK_THEME,actionFn:()=>this.changeScreenThemeForStatistics(de.DARK_THEME_BY_QUICK_SEARCH,"dark")},{id:Se.SYSTEM_THEME,actionFn:()=>this.changeScreenThemeForStatistics(de.SYSTEM_THEME_BY_QUICK_SEARCH,"System synchronization")}])}};A(hr,"\u0275fac",function(n){return new(n||hr)(Ze(ot),Ze(Ve),Ze(Ir),Ze(Ee),Ze(Lr),Ze(Pi),Ze(Wn),Ze(Ki),Ze(xn),Ze(Vo),Ze(Lo),Ze(oi),Ze(Eo),Ze(Tn),Ze(ji))}),A(hr,"\u0275prov",Oi({token:hr,factory:hr.\u0275fac}));var zo=hr;Qe([st(nt.menuService.showProductInfoForStatistics)],zo.prototype,"showProductInfoForStatistics",null);Qe([st(nt.menuService.changeScreenThemeForStatistics)],zo.prototype,"changeScreenThemeForStatistics",null);function uf(a,t){if(a&1&&(R(0,"div",1),X(1,"img",2),N()),a&2){let n=w();x(),O("src",n.logoDataURL,un)}}var Sd=(()=>{let t=class t{logoService;subscriptionService;changeDetectorRef;logoDataURL=null;constructor(e,i,r){this.logoService=e,this.subscriptionService=i,this.changeDetectorRef=r}ngAfterViewInit(){this.subscriptionService.push(this.logoService.logoDataURL$.pipe(L(e=>this.logoDataURL!==e)).subscribe({next:e=>{this.logoDataURL=e,this.changeDetectorRef.markForCheck()}}))}};A(t,"\u0275fac",function(i){return new(i||t)(v($r),v(Z),v(ye))}),A(t,"\u0275cmp",Ce({type:t,selectors:[["sd-logo"]],standalone:!1,features:[be([Z])],decls:1,vars:1,consts:[["class","logo-container",4,"ngIf"],[1,"logo-container"],[3,"src"]],template:function(i,r){i&1&&se(0,uf,2,1,"div",0),i&2&&O("ngIf",r.logoDataURL)},dependencies:[lt],styles:[".logo-container[_ngcontent-%COMP%]{height:100%;display:flex;align-items:center}.logo-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:24px;max-height:24px;max-width:100px;object-fit:fill;-webkit-user-select:none;user-select:none;pointer-events:none}"],changeDetection:0}));let a=t;return a})();var ff=["mainMenuRef"],mf=["subToolbarRef"],vf=["sideViewMenuRef"],_f=["iconMenuRef"],Sf=["dragToolMenuRef"],Cf=["rightMenuRef"],bf=["toolbarCenterRef"],xf=["scaleMenuRef"],Go=a=>({content:a});function Tf(a,t){if(a&1){let n=_e();Lt(0),R(1,"button",16),G(2,"translate"),G(3,"translate"),ce("click",function(){W(n);let i=w(2);return z(i.toggleThumbnailView())})("mousedown",function(i){W(n);let r=w(2);return z(r.stopPropagation(i))})("touchstart",function(i){W(n);let r=w(2);return z(r.stopPropagation(i))}),X(4,"i",17),N(),Ft()}if(a&2){let n=w(2);x(),Ye("dark",n.isDarkMode&&!n.sideViewVisible),O("tooltip",_t(9,Go,Y(2,5,"DOCUMENT_PANEL"))),ue("color",n.isDarkMode&&!n.sideViewVisible?"white":n.sideViewVisible?"primary":"dark")("aria-label",Y(3,7,"DOCUMENT_PANEL"))}}function Of(a,t){if(a&1&&(R(0,"div",14),se(1,Tf,5,11,"ng-container",15),N()),a&2){let n=w();x(),O("ngIf",n.isSideViewButtonVisible)}}function Mf(a,t){a&1&&X(0,"div",18)}function wf(a,t){if(a&1){let n=_e();R(0,"button",19),ce("click",function(i){let r=W(n).$implicit,l=w();return z(l.onClickCustomUI(r,i))}),X(1,"i",20),N()}if(a&2){let n=t.$implicit,e=w();Ye("dark",e.isDarkMode),O("title",e.isMobile?"":n.label)("tooltip",_t(7,Go,n.label)),ue("color",e.isDarkMode?"white":"dark")("aria-label",n.label),x(),O("ngClass",n.icon)}}function yf(a,t){if(a&1){let n=_e();R(0,"button",22),ce("click",function(){W(n);let i=w(2);return z(i.onToolbarMenuClick(i.SubToolbar.ANNOTATE))})("mousedown",function(i){W(n);let r=w(2);return z(r.stopPropagation(i))})("touchstart",function(i){W(n);let r=w(2);return z(r.stopPropagation(i))}),me(1),G(2,"translate"),N()}if(a&2){let n=w(2);Ye("active",n.isSubToolbarType(n.SubToolbar.ANNOTATE)),ue("color",n.isSubToolbarType(n.SubToolbar.ANNOTATE)?"primary-70":n.isDarkMode?"white":"dark"),x(),xe(Y(2,4,"ANNOTATE"))}}function Ef(a,t){if(a&1){let n=_e();se(0,yf,3,6,"button",21),R(1,"button",22),ce("click",function(){W(n);let i=w();return z(i.onToolbarMenuClick(i.SubToolbar.REDACT))})("mousedown",function(i){W(n);let r=w();return z(r.stopPropagation(i))})("touchstart",function(i){W(n);let r=w();return z(r.stopPropagation(i))}),me(2),G(3,"translate"),N()}if(a&2){let n=w();fn(n.canShowAnnotToolbar?0:-1),x(),Ye("active",n.isSubToolbarType(n.SubToolbar.REDACT)),ue("color",n.isSubToolbarType(n.SubToolbar.REDACT)?"primary-70":n.isDarkMode?"white":"dark"),x(),xe(Y(3,5,"TOOLBAR_REDACT"))}}function Pf(a,t){if(a&1){let n=_e();R(0,"div",10)(1,"button",23),ce("click",function(){W(n);let i=w();return z(i.onSubToolbarMenuClick())})("mousedown",function(i){W(n);let r=w();return z(r.stopPropagation(i))})("touchstart",function(i){W(n);let r=w();return z(r.stopPropagation(i))}),R(2,"span"),me(3),N(),X(4,"i",24),N(),X(5,"pu-menu",25,0),N()}if(a&2){let n=w();x(3),xe(n.subToolbarMenuTitle),x(2),O("menus",n.subToolbarMenus)}}function Rf(a,t){if(a&1){let n=_e();R(0,"button",19),ce("click",function(i){let r=W(n).$implicit,l=w();return z(l.onClickCustomUI(r,i))}),X(1,"i",20),N()}if(a&2){let n=t.$implicit,e=w();Ye("dark",e.isDarkMode),O("title",e.isMobile?"":n.label)("tooltip",_t(7,Go,n.label)),ue("color",e.isDarkMode?"white":"dark")("aria-label",n.label),x(),O("ngClass",n.icon)}}function If(a,t){a&1&&X(0,"section",26,1)}function Af(a,t){if(a&1){let n=_e();R(0,"div",29)(1,"input",32),G(2,"translate"),ce("keyup.enter",function(){W(n);let i=w(2);return z(i.onConfirmScaleInput())})("blur",function(){W(n);let i=w(2);return z(i.onConfirmScaleInput())}),N(),R(3,"button",33),G(4,"translate"),ce("click",function(){W(n);let i=w(2);return z(i.onScaleMenuClick())}),X(5,"i",24),N(),X(6,"pu-menu",25,2),N()}if(a&2){let n=w(2);x(),O("disabled",!n.doc)("formControl",n.scaleFormControl),ue("aria-label",Y(2,5,"EDIT_MAGNIFICATION")),x(2),ue("aria-label",Y(4,7,"EXPAND")),x(3),O("menus",n.scaleMenus)}}function Nf(a,t){if(a&1){let n=_e();R(0,"div",34)(1,"button",35),G(2,"translate"),ce("click",function(){W(n);let i=w(2);return z(i.onMoreMenuButtonClick())})("mousedown",function(i){W(n);let r=w(2);return z(r.stopPropagation(i))})("touchstart",function(i){W(n);let r=w(2);return z(r.stopPropagation(i))}),X(3,"i",20)(4,"i",36),N(),X(5,"pu-icon-menu",37,3),N()}if(a&2){let n=w(2);x(),Ye("dark",n.isDarkMode),O("title",n.isMobile?"":n.activeMoreMenu==null?null:n.activeMoreMenu.label)("tooltip",_t(12,Go,n.activeMoreMenu==null?null:n.activeMoreMenu.label)),ue("color",n.isDarkMode?"white":"dark")("aria-label",Y(2,10,"DEFAULT_VIEW_MODE")),x(2),O("ngClass",n.activeMoreMenu==null?null:n.activeMoreMenu.icon),x(2),O("iconMenus",n.iconMenus)("isMobile",n.isMobile)("isDarkMode",n.isDarkMode)}}function Df(a,t){a&1&&X(0,"div",18)}function kf(a,t){if(a&1){let n=_e();R(0,"button",41),G(1,"translate"),G(2,"translate"),ce("click",function(){W(n);let i=w(4);return z(i.printDoc())}),X(3,"i",42),N()}if(a&2){let n=w(4);Ye("dark",n.isDarkMode),O("disabled",!n.doc)("title",Y(1,7,"PRINT"))("tooltip",_t(11,Go,n.printTooltipWithShortcut)),ue("color",n.isDarkMode?"white":"dark")("aria-label",Y(2,9,"PRINT"))}}function Vf(a,t){if(a&1){let n=_e();R(0,"button",43),G(1,"translate"),G(2,"translate"),G(3,"translate"),ce("click",function(){W(n);let i=w(4);return z(i.downloadDoc())}),X(4,"i",44),N()}if(a&2){let n=w(4);Ye("dark",n.isDarkMode),O("disabled",!n.doc)("title",Y(1,7,"PDF_DOWNLOAD"))("tooltip",_t(13,Go,Y(2,9,"PDF_DOWNLOAD"))),ue("color",n.isDarkMode?"white":"dark")("aria-label",Y(3,11,"PDF_DOWNLOAD"))}}function Lf(a,t){if(a&1&&se(0,kf,4,13,"button",39)(1,Vf,5,15,"button",40),a&2){let n=w(3);O("ngIf",n.runtimeEnv.get(n.RuntimeEnvKey.PRINT_BUTTON)&&n.runtimeEnv.get(n.MergedRuntimeEnvKey.PRINT_DIALOG)&&n.hasPrintPermission&&!n.hidableMenus[n.HidableView.TOOLBAR_PRINT]),x(),O("ngIf",n.runtimeEnv.get(n.RuntimeEnvKey.PDF_DOWNLOAD_BUTTON)&&n.hasDownloadPermission&&!n.hidableMenus[n.HidableView.TOOLBAR_DOWNLOAD])}}function Ff(a,t){if(a&1){let n=_e();R(0,"button",45),G(1,"translate"),G(2,"translate"),G(3,"translate"),ce("click",function(){W(n);let i=w(3);return z(i.onRightMenuClick())})("mousedown",function(i){W(n);let r=w(3);return z(r.stopPropagation(i))})("touchstart",function(i){W(n);let r=w(3);return z(r.stopPropagation(i))}),X(4,"i",46),N(),X(5,"pu-menu",47,4)}if(a&2){let n=w(3);Ye("dark",n.isDarkMode),O("title",n.isMobile?"":Y(1,8,"MORE_MENU"))("tooltip",_t(14,Go,Y(2,10,"MORE_MENU"))),ue("color",n.isDarkMode?"white":"dark")("aria-label",Y(3,12,"MORE_MENU")),x(5),O("size",n.SizeType.SMALL)("menus",n.rightMenus)}}function Bf(a,t){if(a&1&&(se(0,Df,1,0,"div",7),R(1,"div",38),se(2,Lf,2,2)(3,Ff,7,16),N()),a&2){let n=w(2);O("ngIf",!n.isLessThanMobileWidth),x(2),fn(n.isLessThanTabletWidth?3:2)}}function Uf(a,t){if(a&1){let n=_e();R(0,"button",48),G(1,"translate"),G(2,"translate"),ce("click",function(i){W(n);let r=w(2);return z(r.dapMenuItem.command(i,r.dapMenuItem))})("mousedown",function(i){W(n);let r=w(2);return z(r.stopPropagation(i))})("touchstart",function(i){W(n);let r=w(2);return z(r.stopPropagation(i))}),X(3,"i",49),N()}if(a&2){let n=w(2);Ye("dark",n.isDarkMode),O("tooltip",_t(9,Go,Y(1,5,"DAP_DOCUMENT"))),ue("color",n.isDarkMode&&!(n.rightSideViewVisible&&n.rightSideViewMode===n.RightSideViewMode.DAP)?"white":n.rightSideViewVisible&&n.rightSideViewMode===n.RightSideViewMode.DAP?"primary":"dark")("aria-label",Y(2,7,"DAP_DOCUMENT"))}}function jf(a,t){if(a&1&&(R(0,"section",27)(1,"div",28),se(2,Af,8,9,"div",29)(3,Nf,7,14,"div",30),N(),se(4,Bf,4,2)(5,Uf,4,11,"button",31),N()),a&2){let n=w();x(2),fn(n.runtimeEnv.get(n.RuntimeEnvKey.SCALE_DROPDOWN)&&!n.hidableMenus[n.HidableView.TOOLBAR_ZOOM]&&!n.isLessThanDesktopWidth?2:-1),x(),O("ngIf",n.isViewModeVisible),x(),fn(n.runtimeEnv.get(n.RuntimeEnvKey.HIDE_SAVE_DOWNLOAD_PRINT_IN_MENU)?-1:4),x(),O("ngIf",n.isDapButtonVisible)}}var Jr=class Jr{contentService;annotService;autoSaveService;dialogService;changeDetectorRef;menuService;documentService;downloadService;toastService;shortcutService;subscriptionService;actionHistoryService;annotSelectedService;store$;translatePipe;acroFormService;changeService;customUIService;selectTextService;toolbarService;productService;renderer;pageService;viewerService;quickActionService;popupService;subToolbarToTitleMap={[ht.ANNOTATE]:"ANNOTATE",[ht.INSERT]:"INSERT",[ht.REDACT]:"TOOLBAR_REDACT",[ht.SIGN]:"TOOLBAR_SIGN",[ht.FORM]:"FORM"};get RuntimeEnvKey(){return ne}get MergedRuntimeEnvKey(){return Ct}get runtimeEnv(){return K}get SizeType(){return $l}get ViewerStatisticData(){return de}doc;mainMenuRef;subToolbarRef;sideViewMenuRef;iconMenuRef;dragToolMenuRef;rightMenuRef;toolbarCenterRef;scaleMenuRef;scalePreset=[400,200,150,100,75,50].map(t=>this.convertToScalePreset(t));scaleMenus=[];currentPageNo;dragMode;previousDragMode;viewMode;rightSideViewMode;rightSideViewVisible;degree;canUndo=!1;canRedo=!1;sideViewVisible=!1;quickActionPaletteVisible=!1;sideViewMode;isSpreadsheets=!1;subToolbar=null;moreMenuIconArrayMap=[];dragModeTooltipMap=new Map([]);get activeDragModeLabel(){return this.dragModeTooltipMap.get(this.dragMode)??""}mainMenus=[];subToolbarMenus=[];sideViewMenus=[];iconMenus=[];dragToolMenus=[];rightMenus=[];activeFitMode;activeMoreMenu;isOpenedSideView=!1;get leftSideViewButton(){let t=this.sideViewMenus.length>0&&this.sideViewMenus[0].items.length===1,n={icon:fo.MENU,label:this.translatePipe.transform("DOCUMENT_PANEL"),onClick:()=>this.onSideViewMenuClick()};if(t){let[e]=this.sideViewMenus[0].items;n.icon=typeof e.icon=="string"?e.icon:e.icon(),n.label=typeof e.label=="string"?e.label:e.label(),n.onClick=()=>e.command()}return n}get isFormSideViewAvailable(){return K.get(ne.FORM_VIEW_BUTTON)&&this.documentService.checkAuthority(Le.FORM)}get isAnnotSideViewAvailable(){return K.get(ne.ANNOTATION_VIEW_BUTTON)&&this.documentService.checkAuthority(Le.ANNOTATION)}get isRedactSideViewAvailable(){return K.get(ne.REDACTION_VIEW_BUTTON)&&this.documentService.checkAuthority(Le.ANNOTATION)}get isActionMenuVisible(){return this.leftSectionFirstCustomUI.length>0||this.leftSectionLastCustomUI.length>0}get RightSideViewMode(){return Nt}get SubToolbar(){return ht}get subToolbarMenuTitle(){return F.isDefined(this.subToolbar)?this.translatePipe.transform(this.subToolbarToTitleMap[this.subToolbar]):this.translatePipe.transform("MENU")}hasSignedSignature=!1;pageNoFormControl=new or(1,{nonNullable:!0});scaleFormControl=new or;mainMenuStyle={left:"0",top:"100%"};get scale(){return this._scale}set scale(t){this._scale=t,this.scaleFormControl.setValue(`${Math.round(this._scale)}%`,{emitEvent:!1})}_scale;dapMenuItem;get hasSavePermission(){return this.documentService.checkAuthority(Le.SAVE_DOCUMENT)}get hasDownloadPermission(){return this.documentService.checkAuthority(Le.DOWNLOAD_DOCUMENT)}get hasPrintPermission(){return this.documentService.checkAuthority(Le.PRINT_DOCUMENT)}get isLessThanMobileWidth(){return Q.width<Q.breakpoints.mobile.width}get isLessThanTabletWidth(){return Q.width<Q.breakpoints.tablet.width}get isLessThanDesktopWidth(){return Q.width<Q.breakpoints.desktop.width}get isMobile(){return Q.isMobile()}get hidableSideView(){return!this.hidableMenus[V.TOOLBAR_LEFT]&&!this.hidableMenus[V.SIDE_VIEW]&&(!this.hidableMenus[V.SIDE_VIEW_THUMBNAIL]||!this.hidableMenus[V.SIDE_VIEW_BOOKMARK]||!this.hidableMenus[V.SIDE_VIEW_ANNOTATION]||!this.hidableMenus[V.SIDE_VIEW_REDACTION]||!this.hidableMenus[V.SIDE_VIEW_EMBEDDED_FILE]||!this.hidableMenus[V.SIDE_VIEW_FORM]||!this.hidableMenus[V.SIDE_VIEW_SIGNATURE])}get hidableDragMode(){return!this.hidableMenus[V.TOOLBAR_DRAG_MODE_SELECT_ANNOTATION]||!this.hidableMenus[V.TOOLBAR_DRAG_MODE_SELECT_TEXT]||!this.hidableMenus[V.TOOLBAR_DRAG_MODE_MOVE]||!this.hidableMenus[V.TOOLBAR_DRAG_MODE_ZOOM]}get HidableView(){return V}hidableMenus={};leftSectionFirstCustomUI=[];leftSectionLastCustomUI=[];screenTheme;get isDarkMode(){return this.screenTheme==="light"?!1:this.screenTheme==="dark"||window.matchMedia("(prefers-color-scheme: dark)")?.matches}get hasDragTools(){return this.dragToolMenus[0]?.menus.length>0}constructor(t,n,e,i,r,l,g,S,y,I,B,ee,ge,le,Te,$e,p,vt,gt,ft,Et,Li,si,Ii,Oe,De){this.contentService=t,this.annotService=n,this.autoSaveService=e,this.dialogService=i,this.changeDetectorRef=r,this.menuService=l,this.documentService=g,this.downloadService=S,this.toastService=y,this.shortcutService=I,this.subscriptionService=B,this.actionHistoryService=ee,this.annotSelectedService=ge,this.store$=le,this.translatePipe=Te,this.acroFormService=$e,this.changeService=p,this.customUIService=vt,this.selectTextService=gt,this.toolbarService=ft,this.productService=Et,this.renderer=Li,this.pageService=si,this.viewerService=Ii,this.quickActionService=Oe,this.popupService=De,this.moreMenuIconArrayMap=[{label:this.translatePipe.transform("SINGLE_PAGE_VIEW"),icon:"papycon papycon-one-page3"},{label:this.translatePipe.transform("SINGLE_PAGE_CONTINUOUS"),icon:"papycon papycon-one-page-continuous3"},{label:this.translatePipe.transform("TWO_PAGE_VIEW"),icon:"papycon papycon-two-page3"},{label:this.translatePipe.transform("TWO_PAGE_CONTINUOUS"),icon:"papycon papycon-two-page-continuous3"}],this.scaleMenus=[{items:this.scalePreset},{items:[{label:this.translatePipe.transform("FIT_TO_HEIGHT_2"),icon:"fit-height3",command:()=>this.fitToHeightForStatistics(de.CHANGE_ZOOM_DROPDOWN_FIT)},{label:this.translatePipe.transform("FIT_TO_WIDTH_2"),icon:"papycon papycon-fit-width3",command:()=>this.fitToWidthForStatistics(de.CHANGE_ZOOM_DROPDOWN_FIT)}]}],this.dragModeTooltipMap=new Map([[Ot.MOVE,this.translatePipe.transform("SCROLL_MODE")],[Ot.SELECT_TEXT,this.translatePipe.transform("SELECT_TEXT")],[Ot.SELECT_ANNOT,this.translatePipe.transform("SELECT_ANNOT_TOOL")],[Ot.MAGNIFY,this.translatePipe.transform("MAGNIFY_TOOL")]]),this.dapMenuItem={label:this.translatePipe.transform("DAP_DOCUMENT"),command:()=>{this.toggleDapView(),this.changeDetectorRef.markForCheck()},icon:"papycon papycon-composite-document"}}ngOnInit(){if(this.subscriptionService.push(this.store$.pipe(ii("screenTheme")).subscribe({next:t=>{this.screenTheme=t,this.mainMenus=this.menuService.buildMainMenu(this),this.changeDetectorRef.markForCheck()}}),this.store$.pipe(H("currentPageNo")).subscribe({next:t=>{this.currentPageNo=t,this.pageNoFormControl.setValue(this.currentPageNo)}}),this.quickActionService.paletteVisibility$.subscribe({next:t=>{this.quickActionPaletteVisible=t,this.changeDetectorRef.markForCheck()}}),this.store$.pipe(H("rightSideViewMode")).subscribe({next:t=>{this.rightSideViewMode=t,this.changeDetectorRef.detectChanges()}}),this.store$.pipe(H("rightSideViewVisible")).subscribe({next:t=>{this.rightSideViewVisible=t,this.changeDetectorRef.markForCheck()}}),this.store$.pipe(H("degree")).subscribe({next:t=>{this.degree=t,K.get(ne.VIEW_MODE_BUTTON)||(this.activeMoreMenu={label:this.translatePipe.transform("ROTATE_CW"),icon:"papycon papycon-rotate"})}}),this.store$.pipe(H("scale")).subscribe({next:t=>{this.scale=t,this.changeDetectorRef.detectChanges()}}),this.store$.pipe(H("dragMode")).subscribe({next:t=>{this.previousDragMode=t,t!==Ot.SELECT_ANNOT&&(this.dragMode=t,this.changeDetectorRef.markForCheck())}}),this.store$.pipe(H("viewMode")).subscribe({next:t=>{this.viewMode=t,K.get(ne.VIEW_MODE_BUTTON)&&this.viewMode!==4&&(this.activeMoreMenu=this.moreMenuIconArrayMap[t]),this.iconMenus=this.buildIconMenu(),this.changeDetectorRef.markForCheck()}}),Q.windowResize$.subscribe({next:()=>this.resize()}),this.documentService.authorityUpdate$.subscribe({next:()=>{this.render(!0)}}),this.store$.pipe(H("rightSideViewVisible")).pipe(L(F.isDefined)).subscribe({next:()=>this.changeDetectorRef.markForCheck()}),this.store$.pipe(H("sideViewVisible")).subscribe({next:t=>{this.subToolbar===ht.REDACT&&!t&&(this.sideViewMode===we.Redaction||this.sideViewMode===we.SearchingRedaction)&&this.viewerService.openSubToolbar(null),this.sideViewVisible=t,Vi.runAsync(()=>this.changeDetectorRef.markForCheck())}}),this.store$.pipe(H("sideViewMode")).subscribe({next:t=>{this.subToolbar===ht.REDACT&&t!==we.Redaction&&t!==we.SearchingRedaction&&this.viewerService.openSubToolbar(null),this.sideViewMode=t,this.changeDetectorRef.markForCheck()}}),this.store$.pipe(Ar("isSpreadsheets")).subscribe({next:t=>this.isSpreadsheets=t}),this.acroFormService.hasSignedSignature$.subscribe({next:t=>{this.hasSignedSignature=t,this.changeDetectorRef.markForCheck()}}),this.store$.pipe(bi([V.TOOLBAR,V.TOOLBAR_LEFT,V.TOOLBAR_CENTER,V.TOOLBAR_RIGHT])).subscribe({next:t=>{Object.assign(this.hidableMenus,t),!Object.keys(t).every(n=>!this.hidableMenus[n])&&(this.viewerService.closeSubToolbar(),this.changeDetectorRef.markForCheck())}}),this.store$.pipe(bi([V.TOOLBAR_EBOOK,V.TOOLBAR_PREFERENCES,V.TOOLBAR_DOCUMENT_INFO,V.TOOLBAR_SAVE,V.TOOLBAR_PRINT,V.TOOLBAR_DOWNLOAD,V.TOOLBAR_SLIDESHOW,V.TOOLBAR_QUICK_ACTION,V.TOOLBAR_CAPTURE_MODE,V.TOOLBAR_VIEW_MODE,V.TOOLBAR_ROTATE,V.TOOLBAR_ZOOM,V.TOOLBAR_DRAG_MODE_SELECT_TEXT,V.TOOLBAR_DRAG_MODE_MOVE,V.TOOLBAR_DRAG_MODE_ZOOM,V.TOOLBAR_ANNOTATION,V.TOOLBAR_FORM,V.TOOLBAR_SLIDESHOW,V.TOOLBAR_SD_INFO,V.TOOLBAR_SCREEN_THEME,V.TOOLBAR_SCREEN_FIT])).subscribe({next:t=>{Object.assign(this.hidableMenus,t),this.buildMenu(),this.hidableMenus[V.TOOLBAR_VIEW_MODE]&&this.hidableMenus[V.TOOLBAR_ROTATE]&&this.hidableMenus[V.TOOLBAR_ZOOM]&&this.iconMenuRef?.closeMenu(),this.changeDetectorRef.markForCheck()}}),this.store$.pipe(bi([V.TOOLBAR_ANNOTATION,V.TOOLBAR_FORM])).subscribe({next:t=>{Object.assign(this.hidableMenus,t),(this.hidableMenus[V.TOOLBAR_ANNOTATION]&&this.viewerService.isSubToolbarType(ht.ANNOTATE)||this.hidableMenus[V.TOOLBAR_FORM]&&this.viewerService.isSubToolbarType(ht.FORM))&&this.viewerService.closeSubToolbar(),this.changeDetectorRef.markForCheck()}}),this.store$.pipe(bi([V.SIDE_VIEW,V.SIDE_VIEW_THUMBNAIL,V.SIDE_VIEW_BOOKMARK,V.SIDE_VIEW_ANNOTATION,V.SIDE_VIEW_REDACTION,V.SIDE_VIEW_EMBEDDED_FILE,V.SIDE_VIEW_FORM,V.SIDE_VIEW_SIGNATURE])).subscribe({next:t=>{Object.assign(this.hidableMenus,t),this.sideViewMenus=this.buildSideViewMenu(),this.sideViewVisible&&J.isOpenedHiddenView(t,this.sideViewMode)&&this.store$.dispatch(he.set({key:"sideViewVisible",value:!1})),this.changeDetectorRef.markForCheck()}}),this.documentService.openedDocument$.subscribe({next:t=>{t?this.enableFormControl():(this.viewerService.closeSubToolbar(),this.disableFormControl())}}),this.toolbarService.toggleMainToolbar$.subscribe({next:t=>{t?this.mainMenuRef?.openMenu():this.mainMenuRef?.closeMenu(),this.changeDetectorRef.markForCheck()}}),this.toolbarService.toggleSideViewToolbar$.subscribe({next:t=>{if(this.isLessThanMobileWidth){this.isOpenedSideView=!0;return}t?this.sideViewMenuRef?.openMenu():this.sideViewMenuRef?.closeMenu(),this.changeDetectorRef.markForCheck()}}),this.toolbarService.toggleAnnotToolbar$.subscribe({next:t=>{t&&!this.viewerService.isSubToolbarType(ht.ANNOTATE)&&(this.viewerService.openSubToolbar(ht.ANNOTATE),this.changeDetectorRef.markForCheck()),!t&&this.viewerService.isSubToolbarType(ht.ANNOTATE)&&(this.viewerService.closeSubToolbar(),this.changeDetectorRef.markForCheck())}}),this.toolbarService.toggleFormToolbar$.subscribe({next:t=>{t&&!this.viewerService.isSubToolbarType(ht.FORM)&&(this.viewerService.openSubToolbar(ht.FORM),this.changeDetectorRef.markForCheck()),!t&&this.viewerService.isSubToolbarType(ht.FORM)&&(this.viewerService.closeSubToolbar(),this.changeDetectorRef.markForCheck())}}),this.toolbarService.toggleSignatureToolbar$.subscribe({next:t=>{t&&!this.viewerService.isSubToolbarType(ht.SIGN)&&(this.viewerService.openSubToolbar(ht.SIGN),this.changeDetectorRef.markForCheck()),!t&&this.viewerService.isSubToolbarType(ht.SIGN)&&(this.viewerService.closeSubToolbar(),this.changeDetectorRef.markForCheck())}}),this.toolbarService.toggleQuickActionPalette$.subscribe({next:t=>this.quickActionService.setPaletteVisibility(t)}),this.toolbarService.toggleCaptureMode$.subscribe({next:t=>this.changeCaptureMode(t)}),this.customUIService.customButtonUI$.subscribe({next:t=>{this.leftSectionFirstCustomUI=t.filter(n=>n.position==="TOOLBAR.LEFT_SECTION.FIRST"),this.leftSectionLastCustomUI=t.filter(n=>n.position==="TOOLBAR.LEFT_SECTION.LAST"),this.render(!0)}}),this.shortcutService.getShortcutEvent(Ae.ESCAPE).subscribe({next:t=>{t.preventDefault(),this.undoDragMode()}}),this.viewerService.subToolbar$.pipe(L(t=>this.subToolbar!==t)).subscribe({next:t=>{t===ht.REDACT&&(this.sideViewVisible||this.store$.dispatch(he.set({key:"sideViewVisible",value:!0})),this.sideViewMode!==we.Redaction&&this.sideViewMode!==we.SearchingRedaction&&this.store$.dispatch(he.set({key:"sideViewMode",value:we.Redaction}))),this.subToolbar=t,this.changeDetectorRef.markForCheck()}})),this.render(!1),this.subscribeZoomHotkey(),this.subscribeUndoRedo(),this.subscribePrint(),this.pageNoFormControl.reset(this.currentPageNo),K.get(ne.USE_CLIENT_RENDERING)&&K.get(ne.CLIENT_RENDERING_MAXIMUM_SCALE).value!==Je.maxScale){let t=K.get(ne.CLIENT_RENDERING_MAXIMUM_SCALE);this.scalePreset.unshift(this.convertToScalePreset(t.value))}this.initRegisterQuickActions()}ngOnChanges(){this.render(!0)}ngAfterViewInit(){this.changeCenterToolbarPosition()}stopPropagation(t){F.stopPropagation(t)}isSubToolbarType(t){return this.viewerService.isSubToolbarType(t)}get printTooltipWithShortcut(){return`${this.translatePipe.transform("PRINT")} (${li.getShortcutString(Xi[Ae.PRINT])})`}get quickActionTooltipWithShortcut(){return`${this.translatePipe.transform("QUICK_ACTION")} (${li.getShortcutString(Xi[Ae.QUICK_ACTION])})`}isEbookMode(){return this.viewMode===4}get isDAP(){return this.documentService.isDAP}get isEditable(){return!this.hasSignedSignature||this.documentService.checkAuthority(Le.EDIT_ANNOTATION)}get canDrawAnnot(){return this.documentService.checkAuthority(Le.DRAW_ANNOTATION)&&this.documentService.checkAuthority(Le.ANNOTATION)}get canShowAnnotToolbar(){return this.canDrawAnnot&&K.get(Ct.ANNOT_TOOLBAR)&&!this.isEbookMode()&&!this.hidableMenus[V.TOOLBAR_ANNOTATION]}onMenuImageClick(){this.mainMenuRef?.toggleMenu()}onSideViewMenuClick(){if(this.mainMenuRef?.closeMenu(),this.isLessThanMobileWidth){this.isOpenedSideView=!0;return}this.sideViewMenuRef?.toggleMenu()}onQuickActionButtonClick(){this.quickActionService.togglePaletteVisibility()}changeCaptureMode(t){if(t){this.store$.dispatch(Ji.unselectTool()),this.annotSelectedService.unselectAll(),this.popupService.closeAllPopup(),this.store$.dispatch(he.set({key:"isCaptureMode",value:!0}));return}this.store$.dispatch(he.set({key:"isCaptureMode",value:!1}))}onScaleMenuClick(){this.scaleMenuRef?.toggleMenu()}onConfirmScaleInput(){this.changeScaleDropdown(this.scaleFormControl.value)}convertToScalePreset(t){return{label:`${t}%`,command:()=>this.changeScaleDropdown(t)}}onMoreMenuButtonClick(){this.iconMenuRef&&this.iconMenuRef.toggleMenu()}onDragToolMenuExpandClick(){this.dragToolMenuRef?.toggleMenu()}onRightMenuClick(){this.rightMenuRef?.toggleMenu()}onToolbarMenuClick(t){this.mainMenuRef?.closeMenu(),this.iconMenuRef?.closeMenu(),this.dragToolMenuRef?.closeMenu(),this.sideViewMenuRef?.closeMenu(),this.rightMenuRef?.closeMenu(),this.viewerService.toggleSubToolbar(t)}onSideViewMenuSelect(t){this.sideViewMode===t?this.store$.dispatch(he.set({key:"sideViewVisible",value:!this.sideViewVisible})):(this.store$.dispatch(he.set({key:"sideViewMode",value:t})),this.store$.dispatch(he.set({key:"sideViewVisible",value:!0})))}onSideViewMenuSelectForStatistics(t,n){this.onSideViewMenuSelect(n)}zoom(t){this.setZoom(this.scale+t)}setZoom(t,n=!1){typeof t!="number"||!isFinite(t)||isNaN(t)||this.publishScale(t,n)}fitToWidth(){this.contentService.requestViewChange({fitMode:0}),this.activeFitMode=0,this.changeDetectorRef.markForCheck()}fitToWidthForStatistics(t){this.fitToWidth()}fitToHeight(){this.contentService.requestViewChange({fitMode:1}),this.activeFitMode=1,this.changeDetectorRef.markForCheck()}fitToHeightForStatistics(t){this.fitToHeight()}rotate(t){this.contentService.requestViewChange({degree:this.degree+t})}rotateForStatistics(t,n){this.rotate(n)}saveDoc(t,n){this.documentService.waitForConvPDF(this.changeService.saveDocumentForStatistics.bind(this.changeService,de.SAVE_DOCUMENT_BY_BUTTON,void 0,t,n))}downloadDoc(){this.documentService.waitForConvPDF(this.downloadService.downloadDocument.bind(this.downloadService))}printDoc(){this.documentService.waitForConvPDF(this.dialogService.toggleDialogVisibility.bind(this.dialogService,$i.PRINT,!0))}changeViewMode(t){this.viewMode!==t&&this.contentService.requestViewChange({viewMode:t})}changeViewModeForStatistics(t,n){this.changeViewMode(n)}dragModeClicked(t){t&&(this.store$.dispatch(he.set({key:"dragMode",value:t})),this.store$.dispatch(Ji.unselectTool()),this.selectTextService.publishSelectedText(null),this.annotService.closeEditor())}dragModeClickedForStatistics(t,n){this.dragModeClicked(n)}getSelectedDragMode(){let t=this.dragToolMenus[0]?.menus?.find(n=>n.mode===this.dragMode);return F.isDefined(t)?t:this.dragToolMenus[0].menus[0]}toggleDapView(){this.rightSideViewMode===Nt.DAP?this.rightSideViewVisible?this.store$.dispatch(he.set({key:"rightSideViewVisible",value:!1})):this.store$.dispatch(he.set({key:"rightSideViewVisible",value:!0})):(this.store$.dispatch(he.set({key:"rightSideViewVisible",value:!0})),this.store$.dispatch(he.set({key:"rightSideViewMode",value:Nt.DAP})))}onClickCustomUI(t,n){t.onclick($n.simplifyMouseEvent(n))}resize(){this.mainMenuRef!==void 0&&this.mainMenuRef.closeMenu(),this.render(),this.changeCenterToolbarPosition()}render(t=!0){this.buildMenu(),t&&this.changeDetectorRef.markForCheck()}buildMenu(){this.mainMenus=this.menuService.buildMainMenu(this),this.subToolbarMenus=this.buildSubToolbarMenu(),this.sideViewMenus=this.buildSideViewMenu(),this.iconMenus=this.buildIconMenu(),this.dragToolMenus=this.buildDragToolMenu(),this.rightMenus=[{items:this.menuService.buildRightMenu()}],this.disableMenuWhenNoDoc(),this.changeDetectorRef.markForCheck()}disableMenuWhenNoDoc(){this.doc||[...this.mainMenus].forEach(t=>{t.items.forEach(n=>{["PREFERENCES","SLIDESHOW"].map(i=>this.translatePipe.transform(i)).includes(n.label)||(n.disabled=!0)})})}buildSideViewMenu(){let t={items:[]};return K.get(ne.THUMBNAIL_VIEW_BUTTON)&&!this.hidableMenus[V.SIDE_VIEW_THUMBNAIL]&&t.items.push({label:this.translatePipe.transform("THUMBNAIL"),icon:fo.THUMBNAIL,command:()=>this.onSideViewMenuSelectForStatistics(de.THUMBNAIL_VIEW,we.Thumbnail),data:we.Thumbnail,disabled:!this.doc}),K.get(ne.OUTLINE_VIEW_BUTTON)&&!this.isDAP&&!this.hidableMenus[V.SIDE_VIEW_BOOKMARK]&&t.items.push({label:this.translatePipe.transform("OUTLINE"),icon:fo.OUTLINE,command:()=>this.onSideViewMenuSelectForStatistics(de.OUTLINE_VIEW,we.Outline),data:we.Outline,disabled:!this.doc}),(!this.doc||this.productService.isStreamDocs&&!this.isDAP&&!this.isEbookMode()&&this.isAnnotSideViewAvailable&&!this.hidableMenus[V.SIDE_VIEW_ANNOTATION])&&t.items.push({label:this.translatePipe.transform("ANNOTATION_LIST"),icon:fo.ANNOTATION,command:()=>this.onSideViewMenuSelectForStatistics(de.ANNOTATION_VIEW,we.Annotation),data:we.Annotation,disabled:!this.doc}),(!this.doc||this.productService.isStreamDocs&&!this.isDAP&&!this.isEbookMode()&&this.isRedactSideViewAvailable&&!this.hidableMenus[V.SIDE_VIEW_REDACTION])&&t.items.push({label:this.translatePipe.transform("REDACT"),icon:fo.REDACTION,command:()=>this.onSideViewMenuSelectForStatistics(de.REDACTION_VIEW,we.Redaction),data:we.Redaction,disabled:!this.doc}),K.get(ne.EMBEDDED_FILE_VIEW_BUTTON)&&this.productService.isStreamDocs&&!this.isDAP&&!this.hidableMenus[V.SIDE_VIEW_EMBEDDED_FILE]&&t.items.push({label:this.translatePipe.transform("EMBEDDED_FILE"),icon:fo.EMBEDDED_FILE,command:()=>this.onSideViewMenuSelectForStatistics(de.EMBEDDEDFILE_VIEW,we.EmbeddedFile),data:we.EmbeddedFile,disabled:!this.doc}),(!this.doc||!this.isDAP&&!this.isEbookMode()&&this.isFormSideViewAvailable&&!this.hidableMenus[V.SIDE_VIEW_FORM])&&t.items.push({label:this.translatePipe.transform("FORM_TOOL"),icon:fo.FORM,command:()=>this.onSideViewMenuSelectForStatistics(de.FORM_VIEW,we.Form),data:we.Form,disabled:!this.doc}),K.get(ne.SIGNATURE_VIEW_BUTTON)&&!this.isDAP&&!this.isEbookMode()&&!this.hidableMenus[V.SIDE_VIEW_SIGNATURE]&&t.items.push({label:this.translatePipe.transform("SIGNATURE_LIST"),icon:fo.SIGNATURE,command:()=>this.onSideViewMenuSelectForStatistics(de.SIGNATURE_VIEW,we.Signature),data:we.Signature,disabled:!this.doc}),[t]}buildDragToolMenu(){let t=[];return K.get(ne.DRAG_MODE_MOVE_BUTTON)&&!this.hidableMenus[V.TOOLBAR_DRAG_MODE_MOVE]&&t.push({mode:Ot.MOVE,icon:ho.HAND,action:()=>this.dragModeClickedForStatistics(de.CHANGE_DRAGMODE_TO_SCROLL_MODE_BY_BUTTON,Ot.MOVE),isActive:()=>this.dragMode===Ot.MOVE,tooltip:this.translatePipe.transform("SCROLL_MODE")}),K.get(ne.DRAG_MODE_SELECT_TEXT_BUTTON)&&!this.hidableMenus[V.TOOLBAR_DRAG_MODE_SELECT_TEXT]&&t.push({mode:Ot.SELECT_TEXT,icon:ho.SELECTION_ANNOTATION_TEXT,action:()=>this.documentService.waitForConvPDF(this.dragModeClickedForStatistics.bind(this,de.CHANGE_DRAGMODE_TO_SELECT_TEXT_BY_BUTTON,Ot.SELECT_TEXT)),isActive:()=>this.dragMode===Ot.SELECT_TEXT,tooltip:this.translatePipe.transform("SELECT_TEXT"),disabled:!this.doc}),K.get(ne.DRAG_MODE_MAGNIFY_BUTTON)&&!this.hidableMenus[V.TOOLBAR_DRAG_MODE_ZOOM]&&!Q.isTouchableDevice()&&t.push({mode:Ot.MAGNIFY,icon:ho.AREA_ZOOM2,action:()=>this.dragModeClickedForStatistics(de.CHANGE_DRAGMODE_TO_MAGNIFY_TOOL_BY_BUTTON,Ot.MAGNIFY),isActive:()=>this.dragMode===Ot.MAGNIFY,tooltip:this.translatePipe.transform("MAGNIFY_TOOL")}),[{menus:t,align:"center"}]}buildIconMenu(){let t=[];return K.get(ne.VIEW_MODE_BUTTON)&&!this.hidableMenus[V.TOOLBAR_VIEW_MODE]&&t.push({label:this.translatePipe.transform("PAGE_DISPLAY"),align:Q.isSmallWidth()?"justify":"left",wrap:Q.isSmallWidth()?"wrap":"nowrap",menus:[{icon:"one-page3",action:()=>(this.changeViewModeForStatistics(de.VIEW_MODE_ONE,0),this.iconMenuRef.closeMenu(),!0),isActive:()=>this.viewMode===0,tooltip:this.translatePipe.transform("SINGLE_PAGE_VIEW"),disabled:!1},{icon:ho.ONE_PAGE_CONTINUOUS3,action:()=>(this.changeViewModeForStatistics(de.VIEW_MODE_ONE_C,1),this.iconMenuRef.closeMenu(),!0),isActive:()=>this.viewMode===1,tooltip:this.translatePipe.transform("SINGLE_PAGE_CONTINUOUS"),disabled:!1},{icon:ho.TWO_PAGE3,action:()=>(this.changeViewModeForStatistics(de.VIEW_MODE_TWO,2),this.iconMenuRef.closeMenu(),!0),isActive:()=>this.viewMode===2,tooltip:this.translatePipe.transform("TWO_PAGE_VIEW"),disabled:!1},{icon:ho.TWO_PAGE_CONTINUOUS3,action:()=>(this.changeViewModeForStatistics(de.VIEW_MODE_TWO_C,3),this.iconMenuRef.closeMenu(),!0),isActive:()=>this.viewMode===3,tooltip:this.translatePipe.transform("TWO_PAGE_CONTINUOUS"),disabled:!1}]}),K.get(ne.ROTATION_BUTTON)&&!this.hidableMenus[V.TOOLBAR_ROTATE]&&t.push({label:this.translatePipe.transform("ROTATE"),align:Q.isSmallWidth()?"justify":"left",menus:[{icon:ho.REVERSE,action:()=>(this.rotateForStatistics(de.ROTATE_DOCUMENT_BY_BUTTON,-90),!0),tooltip:this.translatePipe.transform("ROTATE_CCW"),disabled:this.isEbookMode()},{icon:ho.ROTATE,action:()=>(this.rotateForStatistics(de.ROTATE_DOCUMENT_BY_BUTTON,90),!0),tooltip:this.translatePipe.transform("ROTATE_CW"),disabled:this.isEbookMode()}]}),this.doc||t.forEach(n=>{["PAGE_DISPLAY"].map(i=>this.translatePipe.transform(i)).includes(n.label)||n.menus.forEach(i=>i.disabled=!0)}),t}buildSubToolbarMenu(){let t={items:[]};return this.canShowAnnotToolbar&&t.items.push({label:this.translatePipe.transform("ANNOTATE"),command:()=>this.onToolbarMenuClick(ht.ANNOTATE),data:ht.ANNOTATE}),t.items.push({label:this.translatePipe.transform("TOOLBAR_REDACT"),command:()=>this.onToolbarMenuClick(ht.REDACT),data:ht.REDACT}),[t]}publishScale(t,n){this.contentService.requestViewChange({scale:t,checkScale:n})}subscribeZoomHotkey(){this.subscriptionService.push(at(this.shortcutService.getShortcutEvent(Ae.INCREASE_ZOOM),this.shortcutService.getShortcutEvent(Ae.INCREASE_ZOOM_NUMPAD)).subscribe({next:t=>{t.preventDefault(),t.stopPropagation(),this.changeZoomByShortcut(Ae.INCREASE_ZOOM)}}),at(this.shortcutService.getShortcutEvent(Ae.DECREASE_ZOOM),this.shortcutService.getShortcutEvent(Ae.DECREASE_ZOOM_NUMPAD)).subscribe({next:t=>{t.preventDefault(),t.stopPropagation(),this.changeZoomByShortcut(Ae.DECREASE_ZOOM)}}),at(this.shortcutService.getShortcutEvent(Ae.RESTORE_ZOOM),this.shortcutService.getShortcutEvent(Ae.RESTORE_ZOOM_NUMPAD)).subscribe({next:t=>{t.preventDefault(),t.stopPropagation(),this.changeZoomByShortcut(Ae.RESTORE_ZOOM)}}))}subscribeUndoRedo(){this.subscriptionService.push(this.actionHistoryService.availableUndoCount$.pipe(L(()=>K.get(Ct.UNDO_REDO_BUTTONS))).subscribe({next:t=>{this.canUndo=t>0;let n=this.mainMenus[0]?.items.find(e=>e.label===this.translatePipe.transform("UNDO"));this.mainMenus.length&&Q.width<640&&F.isDefined(n)&&(n.disabled=!this.canUndo)}}),this.actionHistoryService.availableRedoCount$.pipe(L(()=>K.get(Ct.UNDO_REDO_BUTTONS))).subscribe({next:t=>{this.canRedo=t>0;let n=this.mainMenus[0]?.items.find(e=>e.label===this.translatePipe.transform("REDO"));this.mainMenus.length&&Q.width<640&&F.isDefined(n)&&(n.disabled=!this.canRedo)}}),this.shortcutService.getShortcutEvent(Ae.UNDO_ACTION).pipe(L(()=>K.get(ne.SHORTCUT_UNDO_REDO))).subscribe({next:t=>{if(t.preventDefault(),this.autoSaveService.isAutoSaving||this.pageService.hasAnnotationAffectedLog()){this.toastService.create({toastStyle:jt.NOTIFICATION,header:this.translatePipe.transform("NOTIFICATION"),content:this.autoSaveService.isAutoSaving?this.translatePipe.transform("AUTO_SAVE_DETECTED"):this.translatePipe.transform("PAGE_CHANGELOG_DETECTED")});return}this.annotSelectedService.unselectAll(),this.actionHistoryService.undo()}}),at(this.shortcutService.getShortcutEvent(Ae.REDO_ACTION),this.shortcutService.getShortcutEvent(Ae.REDO_ACTION2)).pipe(L(()=>K.get(ne.SHORTCUT_UNDO_REDO))).subscribe({next:t=>{if(t.preventDefault(),this.autoSaveService.isAutoSaving||this.pageService.hasAnnotationAffectedLog()){this.toastService.create({toastStyle:jt.NOTIFICATION,header:this.translatePipe.transform("NOTIFICATION"),content:this.autoSaveService.isAutoSaving?this.translatePipe.transform("AUTO_SAVE_DETECTED"):this.translatePipe.transform("PAGE_CHANGELOG_DETECTED")});return}this.annotSelectedService.unselectAll(),this.actionHistoryService.redo()}}))}subscribePrint(){this.subscriptionService.push(this.shortcutService.getShortcutEvent(Ae.PRINT).subscribe({next:t=>{if(t.preventDefault(),K.get(ne.SHORTCUT_PRINT)&&K.get(Ct.PRINT_DIALOG)&&this.hasPrintPermission&&!this.hidableMenus[V.TOOLBAR_PRINT]){this.dialogService.toggleDialogVisibility($i.PRINT,!0);return}this.toastService.create({toastStyle:jt.FAILURE,header:this.translatePipe.transform("INFO"),content:this.translatePipe.transform("NO_PRINT_PERMISSION")})}}))}get isMainMenuVisible(){return!this.hidableMenus[V.TOOLBAR_LEFT]&&this.mainMenus.length>0}get isSideMenuVisible(){return this.isSideViewButtonVisible||this.isQuickActionButtonVisible||this.isCaptureModeButtonVisible}get isSideViewButtonVisible(){return(this.isDAP?K.get(ne.THUMBNAIL_VIEW_BUTTON):K.get(Ct.LEFT_SIDE_VIEW_BUTTON))&&this.hidableSideView&&!this.isSpreadsheets&&this.sideViewMenus[0]?.items.length>0}get isQuickActionButtonVisible(){return K.get(ne.QUICK_ACTION_BUTTON)&&!this.hidableMenus[V.TOOLBAR_QUICK_ACTION]&&!this.isSpreadsheets&&!Q.isSmallWidth()}get isCaptureModeButtonVisible(){return K.get(ne.CAPTURE_MODE_BUTTON)&&!this.hidableMenus[V.TOOLBAR_CAPTURE_MODE]&&!this.isSpreadsheets&&!Q.isSmallWidth()}get isFitMenuVisible(){return K.get(ne.FIT_BUTTON)&&!this.hidableMenus[V.TOOLBAR_SCREEN_FIT]&&!this.isEbookMode()&&!this.isSpreadsheets}get isViewModeVisible(){return K.get(Ct.VIEW_MODE_BUTTON)&&this.iconMenus.length>0&&!this.isSpreadsheets}get isDragModeMenuVisible(){return K.get(Ct.DRAG_MODE_BUTTONS)&&this.hasDragTools&&this.hidableDragMode&&!this.isEbookMode()&&!this.isSpreadsheets}get isDapButtonVisible(){return K.get(Ct.DAP_VIEW)&&K.get(ne.DAP_VIEW_BUTTON)&&this.isDAP&&!this.isLessThanMobileWidth&&!this.isSpreadsheets}initRegisterQuickActions(){this.quickActionService.registerActions([{id:Se.FIT_TO_WIDTH,actionFn:()=>this.fitToWidthForStatistics(de.CHANGE_ZOOM_TO_FIT_BY_QUICK_SEARCH)},{id:Se.FIT_TO_HEIGHT,actionFn:()=>this.fitToHeightForStatistics(de.CHANGE_ZOOM_TO_FIT_BY_QUICK_SEARCH)},{id:Se.SINGLE_PAGE_VIEW,actionFn:()=>this.changeViewModeForStatistics(de.CHANGE_VIEWMODE_TO_SINGLE_PAGE_VIEW_BY_QUICK_SEARCH,0)},{id:Se.SINGLE_PAGE_CONTINUOUS,actionFn:()=>this.changeViewModeForStatistics(de.CHANGE_VIEWMODE_TO_SINGLE_PAGE_CONTINUOUS_BY_QUICK_SEARCH,1)},{id:Se.TWO_PAGE_VIEW,actionFn:()=>this.changeViewModeForStatistics(de.CHANGE_VIEWMODE_TO_TWO_PAGE_VIEW_BY_QUICK_SEARCH,2)},{id:Se.TWO_PAGE_CONTINUOUS,actionFn:()=>this.changeViewModeForStatistics(de.CHANGE_VIEWMODE_TO_TWO_PAGE_CONTINUOUS_BY_QUICK_SEARCH,3)},{id:Se.ROTATE_CCW,actionFn:()=>this.rotateForStatistics(de.ROTATE_DOCUMENT_BY_QUICK_SEARCH,-90)},{id:Se.ROTATE_CW,actionFn:()=>this.rotateForStatistics(de.ROTATE_DOCUMENT_BY_QUICK_SEARCH,90)},{id:Se.SCROLL_MODE,actionFn:()=>this.dragModeClickedForStatistics(de.CHANGE_DRAGMODE_TO_SCROLL_MODE_BY_QUICK_SEARCH,Ot.MOVE)},{id:Se.SELECT_TEXT,actionFn:()=>this.documentService.waitForConvPDF(this.dragModeClickedForStatistics.bind(this,de.CHANGE_DRAGMODE_TO_SELECT_TEXT_BY_QUICK_SEARCH,Ot.SELECT_TEXT))},{id:Se.MAGNIFY_TOOL,actionFn:()=>this.dragModeClickedForStatistics(de.CHANGE_DRAGMODE_TO_MAGNIFY_TOOL_BY_QUICK_SEARCH,Ot.MAGNIFY)},{id:Se.SELECT_ANNOT_TOOL,actionFn:()=>this.dragModeClickedForStatistics(de.CHANGE_DRAGMODE_TO_SELECT_ANNOT_TOOL_BY_QUICK_SEARCH,Ot.SELECT_ANNOT)},{id:Se.THUMBNAIL,actionFn:()=>this.onSideViewMenuSelectForStatistics(de.OPEN_THUMBNAIL_BY_QUICK_SEARCH,we.Thumbnail)},{id:Se.OUTLINE,actionFn:()=>this.onSideViewMenuSelectForStatistics(de.OPEN_OUTLINE_BY_QUICK_SEARCH,we.Outline)},{id:Se.ANNOTATION_LIST,actionFn:()=>this.onSideViewMenuSelectForStatistics(de.OPEN_ANNOTBYION_LIST_BY_QUICK_SEARCH,we.Annotation)},{id:Se.REDACT,actionFn:()=>this.onSideViewMenuSelectForStatistics(de.OPEN_REDACT_BY_QUICK_SEARCH,we.Redaction)},{id:Se.EMBEDDED_FILE,actionFn:()=>this.onSideViewMenuSelectForStatistics(de.OPEN_EMBEDDED_FILE_BY_QUICK_SEARCH,we.EmbeddedFile)},{id:Se.FORM_TOOL,actionFn:()=>this.onSideViewMenuSelectForStatistics(de.OPEN_FORM_TOOL_BY_QUICK_SEARCH,we.Form)},{id:Se.SIGNATURE_LIST,actionFn:()=>this.onSideViewMenuSelectForStatistics(de.OPEN_SIGNATURE_LIST_BY_QUICK_SEARCH,we.Signature)}])}enableFormControl(){this.pageNoFormControl.enable(),this.scaleFormControl.enable({emitEvent:!1})}disableFormControl(){this.pageNoFormControl.disable(),this.scaleFormControl.disable({emitEvent:!1})}closeSideViewToolbar(){this.store$.dispatch(he.set({key:"sideViewVisible",value:!1})),this.isOpenedSideView=!1}isActiveSideView(t){return this.isSideViewMode(t)?this.sideViewVisible&&this.sideViewMode===t:!1}isSideViewMode(t){return t}undoDragMode(){this.store$.dispatch(he.set({key:"dragMode",value:this.previousDragMode})),this.store$.dispatch(Ji.unselectTool()),this.selectTextService.publishSelectedText(null),this.annotService.closeEditor()}changeCenterToolbarPosition(){let t=Q.width>=Q.breakpoints.mobile.width?`calc(50% - ${this.toolbarCenterRef.nativeElement.offsetWidth/2}px)`:"0";this.renderer.setStyle(this.toolbarCenterRef.nativeElement,"left",t)}changeScaleDropdown(t){let n=typeof t=="string"?Number.parseFloat(t):t;this.setZoom(Number.isNaN(n)?this.scale:n)}changeZoomByShortcut(t){switch(t){case Ae.INCREASE_ZOOM:case Ae.INCREASE_ZOOM_NUMPAD:this.setZoom(J.calculateNextScale(this.scale,!0),!0);break;case Ae.DECREASE_ZOOM:case Ae.DECREASE_ZOOM_NUMPAD:this.setZoom(J.calculateNextScale(this.scale,!1),!0);break;case Ae.RESTORE_ZOOM:case Ae.RESTORE_ZOOM_NUMPAD:this.zoom(100-this.scale);break}}toggleThumbnailView(){if(this.sideViewVisible){this.store$.dispatch(he.set({key:"sideViewVisible",value:!1}));return}this.store$.dispatch(he.set({key:"sideViewMode",value:we.Thumbnail})),this.store$.dispatch(he.set({key:"sideViewVisible",value:!0}))}onSubToolbarMenuClick(){this.subToolbarRef?.toggleMenu()}};A(Jr,"\u0275fac",function(n){return new(n||Jr)(v(it),v(ni),v(Vr),v(xn),v(ye),v(zo),v(ot),v(Lo),v(Zi),v(Hi),v(Z),v(Wn),v(Pi),v(Ee),v(Ve),v(bn),v(Vo),v(Lr),v(Fo),v(Op),v(Ir),v(At),v(Ht),v(oi),v(Tn),v(na))}),A(Jr,"\u0275cmp",Ce({type:Jr,selectors:[["sd-toolbar"]],viewQuery:function(n,e){if(n&1&&(Ue(ff,5),Ue(mf,5),Ue(vf,5),Ue(_f,5),Ue(Sf,5),Ue(Cf,5),Ue(bf,5),Ue(xf,5)),n&2){let i;Re(i=Ie())&&(e.mainMenuRef=i.first),Re(i=Ie())&&(e.subToolbarRef=i.first),Re(i=Ie())&&(e.sideViewMenuRef=i.first),Re(i=Ie())&&(e.iconMenuRef=i.first),Re(i=Ie())&&(e.dragToolMenuRef=i.first),Re(i=Ie())&&(e.rightMenuRef=i.first),Re(i=Ie())&&(e.toolbarCenterRef=i.first),Re(i=Ie())&&(e.scaleMenuRef=i.first)}},inputs:{doc:"doc"},standalone:!1,features:[be([zo,Z,{provide:Bn,useValue:new Yt(300)}]),qi],decls:12,vars:7,consts:[["subToolbarRef",""],["toolbarCenterRef",""],["scaleMenuRef",""],["iconMenuRef",""],["rightMenuRef",""],[1,"left"],["class","side-menu-container",4,"ngIf"],["class","divider",4,"ngIf"],[1,"toolbar-menu-container"],["class","ep-text-button custom-ui",3,"dark","title","tooltip","click",4,"ngFor","ngForOf"],[1,"sub-toolbar-container"],["class","center",4,"ngIf"],["class","right",4,"ngIf"],[1,"logo"],[1,"side-menu-container"],[4,"ngIf"],[1,"ep-text-button","side-view-menu",3,"click","mousedown","touchstart","tooltip"],[1,"papycon","papycon-show-panel2"],[1,"divider"],[1,"ep-text-button","custom-ui",3,"click","title","tooltip"],[3,"ngClass"],[1,"ep-text-button","tool-button",3,"active"],[1,"ep-text-button","tool-button",3,"click","mousedown","touchstart"],["color","dark",1,"ep-text-button","subtoolbar-menu-button",3,"click","mousedown","touchstart"],[1,"papycon","papycon-chevron3-down"],[3,"menus"],[1,"center"],[1,"right"],[1,"scale-menus"],[1,"scale-dropdown"],["class","more-menu-container",4,"ngIf"],["class","ep-text-button dap-button",3,"dark","tooltip","click","mousedown","touchstart",4,"ngIf"],["type","text","maxlength","4",3,"keyup.enter","blur","disabled","formControl"],[1,"ep-text-button",3,"click"],[1,"more-menu-container"],[1,"ep-text-button","more-button",3,"click","mousedown","touchstart","title","tooltip"],[1,"papycon","papycon-chevron3-down","expand-icon"],[1,"more-menu",3,"iconMenus","isMobile","isDarkMode"],[1,"file-menus"],["class","ep-text-button print",3,"dark","disabled","title","tooltip","click",4,"ngIf"],["class","ep-text-button download",3,"dark","disabled","title","tooltip","click",4,"ngIf"],[1,"ep-text-button","print",3,"click","disabled","title","tooltip"],[1,"papycon","papycon-print"],[1,"ep-text-button","download",3,"click","disabled","title","tooltip"],[1,"papycon","papycon-download"],[1,"ep-text-button",3,"click","mousedown","touchstart","title","tooltip"],[1,"papycon","papycon-more-symbol3"],[3,"size","menus"],[1,"ep-text-button","dap-button",3,"click","mousedown","touchstart","tooltip"],[1,"papycon","papycon-composite-document"]],template:function(n,e){n&1&&(R(0,"section",5),se(1,Of,2,1,"div",6)(2,Mf,1,0,"div",7),R(3,"section",8),se(4,wf,2,9,"button",9)(5,Ef,4,7)(6,Pf,7,2,"div",10)(7,Rf,2,9,"button",9),N()(),se(8,If,2,0,"section",11)(9,jf,6,4,"section",12),R(10,"section",13),X(11,"sd-logo"),N()),n&2&&(x(),O("ngIf",e.isSideMenuVisible),x(),O("ngIf",!e.hidableMenus[e.HidableView.TOOLBAR_LEFT]&&!e.isLessThanMobileWidth),x(2),O("ngForOf",e.leftSectionFirstCustomUI),x(),fn(e.isLessThanDesktopWidth?6:5),x(2),O("ngForOf",e.leftSectionLastCustomUI),x(),O("ngIf",!e.hidableMenus[e.HidableView.TOOLBAR_CENTER]),x(),O("ngIf",!e.hidableMenus[e.HidableView.TOOLBAR_RIGHT]))},dependencies:[co,Si,lt,Gs,Sn,Ys,Sd,jl,Wl,vs,lo,Ve],styles:["i.papycon-chevron3-down[_ngcontent-%COMP%]{transform:scale(.5);font-size:18px;line-height:48px;margin:-12px -7.5px;padding:0 6px;transform-origin:50% 50%}i[_ngcontent-%COMP%] + i.papycon-chevron3-down[_ngcontent-%COMP%]{margin:-12px -8.5px;padding:0 8px}i.papycon-chevron3-down.expanded[_ngcontent-%COMP%]{transform:scale(.5) rotate(-180deg)}[_nghost-%COMP%]{position:relative;display:flex;justify-content:space-between;box-sizing:border-box;background:var(--mono-00);border-bottom:1px solid var(--mono-30);z-index:3}.ep-text-button[_ngcontent-%COMP%]:has(i.papycon){border-width:0;outline-offset:-2px;padding:2px}.ep-text-button[_ngcontent-%COMP%]:has(i.papycon)   i.papycon-chevron3-down[_ngcontent-%COMP%]{font-size:12px}.ep-text-button[_ngcontent-%COMP%]:has(i.papycon)   i.papycon[_ngcontent-%COMP%]:not(.papycon-chevron3-down){font-size:20px}section[_ngcontent-%COMP%]{display:flex}section[_ngcontent-%COMP%] > .divider[_ngcontent-%COMP%]{width:1px;background-color:var(--mono-30);margin:8px 0}section.left[_ngcontent-%COMP%]{height:100%}section.left[_ngcontent-%COMP%]   div.main-menu-container[_ngcontent-%COMP%], section.left[_ngcontent-%COMP%]   div.side-menu-container[_ngcontent-%COMP%]{position:relative;display:flex}section.left[_ngcontent-%COMP%]   div.main-menu-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], section.left[_ngcontent-%COMP%]   div.side-menu-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:auto 16px}section.left[_ngcontent-%COMP%]   div.main-menu-container[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%], section.left[_ngcontent-%COMP%]   div.side-menu-container[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]{color:var(--mono-90)}section.left[_ngcontent-%COMP%]   div.main-menu-container[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]:hover, section.left[_ngcontent-%COMP%]   div.side-menu-container[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]:hover{color:#d7d7d7}section.left[_ngcontent-%COMP%]   div.main-menu-container[_ngcontent-%COMP%]   pu-menu[_ngcontent-%COMP%], section.left[_ngcontent-%COMP%]   div.side-menu-container[_ngcontent-%COMP%]   pu-menu[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;min-width:148px}section.left[_ngcontent-%COMP%]   div.main-menu-container[_ngcontent-%COMP%]   pu-menu[_ngcontent-%COMP%]     .menu .division-line .line, section.left[_ngcontent-%COMP%]   div.side-menu-container[_ngcontent-%COMP%]   pu-menu[_ngcontent-%COMP%]     .menu .division-line .line{background-color:var(--mono-30)}section.left[_ngcontent-%COMP%]   div.main-menu-container.main-menu[_ngcontent-%COMP%]     pu-menu .menu-item, section.left[_ngcontent-%COMP%]   div.side-menu-container.main-menu[_ngcontent-%COMP%]     pu-menu .menu-item{padding-right:24px}section.left[_ngcontent-%COMP%]   div.side-menu-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-right:0}section.left[_ngcontent-%COMP%]   div.side-menu-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:last-of-type{margin-right:16px}section.left[_ngcontent-%COMP%]   i.papycon-chevron3-down[_ngcontent-%COMP%]{color:var(--mono-70)}section.left[_ngcontent-%COMP%]   section.toolbar-menu-container[_ngcontent-%COMP%]{margin:0 16px}section.left[_ngcontent-%COMP%]   section.toolbar-menu-container[_ngcontent-%COMP%]   div.sub-toolbar-container[_ngcontent-%COMP%]{display:flex;align-items:center;position:relative}section.left[_ngcontent-%COMP%]   section.toolbar-menu-container[_ngcontent-%COMP%]   div.sub-toolbar-container[_ngcontent-%COMP%]   .subtoolbar-menu-button[_ngcontent-%COMP%]{padding:8px;height:29px;display:flex;gap:4px;align-items:center;border-radius:6px}section.left[_ngcontent-%COMP%]   section.toolbar-menu-container[_ngcontent-%COMP%]   div.sub-toolbar-container[_ngcontent-%COMP%]   pu-menu[_ngcontent-%COMP%]{top:100%;left:0}section.left[_ngcontent-%COMP%]   section.toolbar-menu-container[_ngcontent-%COMP%]   button.ep-text-button[_ngcontent-%COMP%]{padding:8px 12px;outline-offset:-2px;border-width:0}section.left[_ngcontent-%COMP%]   section.toolbar-menu-container[_ngcontent-%COMP%]   button.ep-text-button.tool-button[_ngcontent-%COMP%]{margin:6.5px 0;border-radius:6px;font-size:13px;line-height:1}section.left[_ngcontent-%COMP%]   section.toolbar-menu-container[_ngcontent-%COMP%]   button.ep-text-button.custom-ui[_ngcontent-%COMP%]{margin:auto 16px;padding:2px}section.left[_ngcontent-%COMP%]   section.toolbar-menu-container[_ngcontent-%COMP%]   button.ep-text-button.active[_ngcontent-%COMP%]{background-color:#f166251a}section.left[_ngcontent-%COMP%]   section.toolbar-menu-container[_ngcontent-%COMP%]   .file-menus[_ngcontent-%COMP%]{display:flex;align-items:center}section.left[_ngcontent-%COMP%]   section.toolbar-menu-container[_ngcontent-%COMP%]   .file-menus[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]{color:var(--mono-90)}section.left[_ngcontent-%COMP%]   section.toolbar-menu-container[_ngcontent-%COMP%]   .file-menus[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]:hover{color:#d7d7d7}section.left[_ngcontent-%COMP%]   section.toolbar-menu-container[_ngcontent-%COMP%]   .file-menus[_ngcontent-%COMP%]   button[_ngcontent-%COMP%] + button[_ngcontent-%COMP%]{margin-left:14px}section.right[_ngcontent-%COMP%]{position:relative;margin-right:16px;height:100%}section.right[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]{color:var(--mono-90)}section.right[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]:hover{color:#d7d7d7}section.right[_ngcontent-%COMP%]   i.papycon-chevron3-down[_ngcontent-%COMP%]{color:var(--mono-70)}section.right[_ngcontent-%COMP%]   div.toolbar-menu-container[_ngcontent-%COMP%]{height:100%;display:flex;align-items:center}section.right[_ngcontent-%COMP%]   div.toolbar-menu-container[_ngcontent-%COMP%]   button.toolbar-menu-button[_ngcontent-%COMP%]{position:relative}section.right[_ngcontent-%COMP%]   div.toolbar-menu-container[_ngcontent-%COMP%]   pu-menu.toolbar-menu[_ngcontent-%COMP%]{position:absolute;top:100%;right:calc(100% - 51px);min-width:120px}section.right[_ngcontent-%COMP%]   .scale-menus[_ngcontent-%COMP%]{display:flex;align-items:center;height:100%;margin-right:24px}section.right[_ngcontent-%COMP%]   .scale-menus[_ngcontent-%COMP%]   div.scale-dropdown[_ngcontent-%COMP%]{display:flex;position:relative;box-sizing:border-box;padding:4px 4px 4px 10px;width:70px;border:1px solid transparent;border-radius:4px}section.right[_ngcontent-%COMP%]   .scale-menus[_ngcontent-%COMP%]   div.scale-dropdown[_ngcontent-%COMP%]:hover{border-color:var(--mono-30)}section.right[_ngcontent-%COMP%]   .scale-menus[_ngcontent-%COMP%]   div.scale-dropdown[_ngcontent-%COMP%]:has(input:focus){border-color:var(--primary-50)}section.right[_ngcontent-%COMP%]   .scale-menus[_ngcontent-%COMP%]   div.scale-dropdown[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{font-family:NotoSans-Regular,sans-serif;font-size:14px;line-height:24px;padding:0;width:100%;border:0;-webkit-appearance:none;appearance:none;caret-color:var(--primary-50)}section.right[_ngcontent-%COMP%]   .scale-menus[_ngcontent-%COMP%]   div.scale-dropdown[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:0}section.right[_ngcontent-%COMP%]   .scale-menus[_ngcontent-%COMP%]   div.scale-dropdown[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:disabled{background-color:transparent}section.right[_ngcontent-%COMP%]   .scale-menus[_ngcontent-%COMP%]   div.scale-dropdown[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:0}section.right[_ngcontent-%COMP%]   .scale-menus[_ngcontent-%COMP%]   pu-menu[_ngcontent-%COMP%]{position:absolute;top:100%;left:0}section.right[_ngcontent-%COMP%]   .scale-menus[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]{color:var(--mono-90)}section.right[_ngcontent-%COMP%]   .scale-menus[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]:hover{color:#d7d7d7}section.right[_ngcontent-%COMP%]   .scale-menus[_ngcontent-%COMP%]   div.more-menu-container[_ngcontent-%COMP%], section.right[_ngcontent-%COMP%]   .scale-menus[_ngcontent-%COMP%]   div.integrated-drag-container[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;height:100%}section.right[_ngcontent-%COMP%]   .scale-menus[_ngcontent-%COMP%]   div.more-menu-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], section.right[_ngcontent-%COMP%]   .scale-menus[_ngcontent-%COMP%]   div.integrated-drag-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:flex;align-items:center;height:34px}section.right[_ngcontent-%COMP%]   .scale-menus[_ngcontent-%COMP%]   div.more-menu-container[_ngcontent-%COMP%]   pu-icon-menu[_ngcontent-%COMP%], section.right[_ngcontent-%COMP%]   .scale-menus[_ngcontent-%COMP%]   div.integrated-drag-container[_ngcontent-%COMP%]   pu-icon-menu[_ngcontent-%COMP%]{position:absolute;top:100%;right:0}section.right[_ngcontent-%COMP%]   .scale-menus[_ngcontent-%COMP%]   div[_ngcontent-%COMP%] + div[_ngcontent-%COMP%], section.right[_ngcontent-%COMP%]   .scale-menus[_ngcontent-%COMP%]   button[_ngcontent-%COMP%] + button[_ngcontent-%COMP%]{margin-left:12px}section.right[_ngcontent-%COMP%]   .scale-menus[_ngcontent-%COMP%]   .scale-dropdown[_ngcontent-%COMP%] + button.fit[_ngcontent-%COMP%], section.right[_ngcontent-%COMP%]   .scale-menus[_ngcontent-%COMP%]   .scale-dropdown[_ngcontent-%COMP%] + div[_ngcontent-%COMP%], section.right[_ngcontent-%COMP%]   .scale-menus[_ngcontent-%COMP%]   button.fit[_ngcontent-%COMP%] + div[_ngcontent-%COMP%]{margin-left:20px}section.right[_ngcontent-%COMP%]   .scale-menus[_ngcontent-%COMP%]   div.spreadsheets-zoom-container[_ngcontent-%COMP%]   button.ep-text-button[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:20px}section.right[_ngcontent-%COMP%]   .file-menus[_ngcontent-%COMP%]{display:flex;align-items:center;position:relative;margin-left:24px}section.right[_ngcontent-%COMP%]   .file-menus[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]{color:var(--mono-90)}section.right[_ngcontent-%COMP%]   .file-menus[_ngcontent-%COMP%]   button.dark[_ngcontent-%COMP%]:hover{color:#d7d7d7}section.right[_ngcontent-%COMP%]   .file-menus[_ngcontent-%COMP%]   button[_ngcontent-%COMP%] + button[_ngcontent-%COMP%]{margin-left:12px}section.logo[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}@media screen and (max-width: 767px){section.right[_ngcontent-%COMP%]{margin-left:0;margin-right:0}section.right[_ngcontent-%COMP%]   .file-menus[_ngcontent-%COMP%]{margin:auto 12px;height:100%}section.right[_ngcontent-%COMP%]   .file-menus[_ngcontent-%COMP%]   pu-menu[_ngcontent-%COMP%]{top:100%;right:0}}@media screen and (max-width: 575px){section.left[_ngcontent-%COMP%]   section.toolbar-menu-container[_ngcontent-%COMP%]{margin:0}section.left[_ngcontent-%COMP%]   div.side-menu-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:auto 8px}section.left[_ngcontent-%COMP%]   div.side-menu-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:last-of-type{margin-right:8px}section.center[_ngcontent-%COMP%]{left:0;position:relative;margin-right:6px}section.center[_ngcontent-%COMP%]   button.fit[_ngcontent-%COMP%]{display:none}section.center[_ngcontent-%COMP%]   div[_ngcontent-%COMP%] + div[_ngcontent-%COMP%]{margin-left:20px}section.center[_ngcontent-%COMP%]   div.spreadsheets-zoom-container[_ngcontent-%COMP%]   button.ep-text-button[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:24px}section.right[_ngcontent-%COMP%]   .scale-menus[_ngcontent-%COMP%]{margin-right:0}section.side-view-toolbar[_ngcontent-%COMP%]{background:var(--mono-00);position:absolute;width:100%;height:100%}section.side-view-toolbar[_ngcontent-%COMP%]   .close-button[_ngcontent-%COMP%]{margin:auto 12px}section.side-view-toolbar-menu-container[_ngcontent-%COMP%]{position:relative;display:flex;overflow-x:scroll;overflow-y:hidden;-ms-overflow-style:none;scrollbar-width:none}section.side-view-toolbar-menu-container[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}section.side-view-toolbar-menu-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:auto 12px}section.side-view-toolbar-menu-container[_ngcontent-%COMP%]   button.ep-text-button[_ngcontent-%COMP%]{width:24px;height:24px}section.side-view-toolbar-menu-container[_ngcontent-%COMP%]   button.expandable[_ngcontent-%COMP%]{margin-right:0}}"],changeDetection:0}));var On=Jr;Qe([st(nt.mainToolbarComp.onSideViewMenuSelectForStatistics)],On.prototype,"onSideViewMenuSelectForStatistics",null);Qe([st(nt.mainToolbarComp.changeZoomToFit,1e3)],On.prototype,"fitToWidthForStatistics",null);Qe([st(nt.mainToolbarComp.changeZoomToFit,1e3)],On.prototype,"fitToHeightForStatistics",null);Qe([st(nt.mainToolbarComp.rotateForStatistics,1e3)],On.prototype,"rotateForStatistics",null);Qe([st(nt.mainToolbarComp.changeViewModeForStatistics)],On.prototype,"changeViewModeForStatistics",null);Qe([st(nt.mainToolbarComp.dragModeClickedForStatistics)],On.prototype,"dragModeClickedForStatistics",null);Qe([st(nt.mainToolbarComp.changeScaleDropdown)],On.prototype,"changeScaleDropdown",null);Qe([st(nt.mainToolbarComp.changeZoomByShortcut,1e3)],On.prototype,"changeZoomByShortcut",null);var Cd=(()=>{let t=class t{};A(t,"\u0275fac",function(i){return new(i||t)}),A(t,"\u0275mod",Jt({type:t})),A(t,"\u0275inj",Xt({providers:[$r],imports:[Ui]}));let a=t;return a})();var bd=(()=>{let t=class t{};A(t,"\u0275fac",function(i){return new(i||t)}),A(t,"\u0275mod",Jt({type:t})),A(t,"\u0275inj",Xt({imports:[Ui,wr,Cn,Cd,Ul,Er,zl,yr,la]}));let a=t;return a})();var es=(()=>{let t=class t{baseHref;http;downloadService;latestVersion=Je.sdPluginVersion;sdAgentEnableHTTPS=Je.sdAgentEnableHTTPS;sdAgentURLScheme=this.sdAgentEnableHTTPS?"https://":"http://";sdAgentURLPrefix=`${this.sdAgentURLScheme}127.0.0.1:`;sdAgentHeaders;sdAgentHttpPorts=[13980,23980,33980];sdAgentHttpsPorts=[13981,23981,33981];constructor(e,i,r){this.baseHref=e,this.http=i,this.downloadService=r,this.sdAgentHeaders={"Papyrus-Module":Je.sdAgentModule,"Content-Type":"application/x-www-form-urlencoded"}}reqAgent(e,i){let r=this.sdAgentEnableHTTPS?this.sdAgentHttpsPorts:this.sdAgentHttpPorts,l=r.length;return new Kt(g=>{let S=()=>{l||g.error();let y=`${this.sdAgentURLPrefix}${r[r.length-l]}${e}`;this.http.post(y,i,{observe:"response",responseType:"text",headers:this.sdAgentHeaders}).subscribe({next:I=>{g.next(I),g.complete()},error:I=>{--l>0?setTimeout(S,100):g.error(I)}})};S()})}checkVersion(){return this.reqAgent("/version/info",F.EMPTY_STRING)}print(e,i,r,l,g,S,y){let I=new Ol().set("host",e).set("path",i).set("port",r).set("protocol",l).set("hide-timestamp",String(!Je.printTimestampInPlugin)).set("current-page-index",S).set("withoutDialog",String(Je.printWithoutDialogInPlugin)).set("open-without-memory",String(Je.openWithoutMemory));return Number.isNaN(Je.defaultPluginPrintScale)||(I=I.set("print-scale",Je.defaultPluginPrintScale)),F.isDefined(y)&&(I=I.set("pageRange",y)),Rr.token?.accessToken&&(document.cookie=`accessToken=${Rr.token.accessToken}`,I=I.set("cookie",document.cookie)),g&&(I=I.set("timestamp-status",g)),this.reqAgent("/print/execute",I.toString())}isLatestVersion(e){let i=e.match(/(\d+)\.(\d+)\.(\d+).*/)?.slice(1,4),r=this.latestVersion.split(".");if(i===void 0||!i.every(this.isValidPart)||!r.every(this.isValidPart)||i.length!==r.length)return!1;let l=i.map(Number),g=r.map(Number);for(let S=0;S<l.length;++S){if(g.length===S)return!0;if(l[S]!==g[S])return l[S]>g[S]}return!0}isValidPart(e){return/^\d+$/.test(e)}downloadSDAgent(){let e=`${this.baseHref}v4/resources/sdagent-modern`;this.downloadService.executeFileDownloader(e)}};A(t,"\u0275fac",function(i){return new(i||t)(Ze(xl),Ze(Ml),Ze(Lo))}),A(t,"\u0275prov",Oi({token:t,factory:t.\u0275fac}));let a=t;return a})();var KM=(()=>{let t=class t{static forRoot(){return{ngModule:t,providers:[es]}}};A(t,"\u0275fac",function(i){return new(i||t)}),A(t,"\u0275mod",Jt({type:t})),A(t,"\u0275inj",Xt({}));let a=t;return a})();var _c=(()=>{let t=class t{modalParam;modalService;agentService;portalRef;subscriptionService;get status(){return this.modalParam.status}constructor(e,i,r,l,g){this.modalParam=e,this.modalService=i,this.agentService=r,this.portalRef=l,this.subscriptionService=g}ngOnInit(){this.subscriptionService.push(Ge(window,"keydown",{capture:!0}).pipe(L(e=>e.key==="Escape"),L(()=>this.modalService.lastModal===this.portalRef)).subscribe({next:()=>this.onButtonClick(!1)}))}onButtonClick(e){e&&this.agentService.downloadSDAgent(),this.portalRef.dispose()}};A(t,"\u0275fac",function(i){return new(i||t)(v(Ws),v(Ki),v(es),v(zs),v(Z))}),A(t,"\u0275cmp",Ce({type:t,selectors:[["sd-module-download"]],standalone:!1,features:[be([Z])],decls:16,vars:18,consts:[["color","grey","size","tiny",1,"ep-button",3,"click"],["color","primary","size","small",1,"ep-button",3,"click"]],template:function(i,r){i&1&&(R(0,"h3"),me(1),G(2,"translate"),N(),R(3,"main")(4,"div"),me(5),G(6,"translate"),N(),R(7,"button",0),G(8,"translate"),ce("click",function(){return r.onButtonClick(!0)}),me(9),G(10,"translate"),N()(),R(11,"footer")(12,"button",1),G(13,"translate"),ce("click",function(){return r.onButtonClick(!1)}),me(14),G(15,"translate"),N()()),i&2&&(x(),xe(Y(2,6,r.status==="notInstall"?"INSTALL_PLUGIN":"UPDATE_PLUGIN")),x(4),xe(Y(6,8,r.status==="notInstall"?"NO_PRINT_PLUGIN":"NEW_VERSION_AVAILABLE")),x(2),ue("aria-label",Y(8,10,"DOWNLOAD")),x(2),xe(Y(10,12,"DOWNLOAD")),x(3),ue("aria-label",Y(13,14,"OK")),x(2),xe(Y(15,16,"OK")))},dependencies:[Ve],styles:["h3[_ngcontent-%COMP%]{font-size:20px;line-height:28px;font-family:NotoSans-Medium,sans-serif;color:var(--mono-99);margin:8px 0}main[_ngcontent-%COMP%]{font-size:13px;line-height:22px;color:var(--mono-70);white-space:pre-wrap}main[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:20px}footer[_ngcontent-%COMP%]{text-align:right;margin-top:32px}footer[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{color:var(--mono-00)}"],changeDetection:0}));let a=t;return a})();function Wf(a,t){if(a&1){let n=_e();Lt(0),X(1,"div",15),R(2,"span",16),me(3),G(4,"translate"),N(),R(5,"span",17),me(6),G(7,"translate"),N(),R(8,"nav")(9,"button",18),G(10,"translate"),ce("click",function(){W(n);let i=w(4);return z(i.onConfirm(!1))}),me(11),G(12,"translate"),N()(),Ft()}a&2&&(x(3),xe(Y(4,4,"PLUGIN")),x(3),xe(Y(7,6,"DESC_PRINT_PLUGIN")),x(3),ue("aria-label",Y(10,8,"PRINT_USING_PLUGIN")),x(2),xe(Y(12,10,"PRINT_USING_PLUGIN")))}function zf(a,t){if(a&1){let n=_e();R(0,"section",9)(1,"pu-radio-group"),G(2,"translate"),R(3,"pu-radio-button",10),G(4,"translate"),yi("ngModelChange",function(i){W(n);let r=w(3);return wi(r.pageOption,i)||(r.pageOption=i),z(i)}),N(),R(5,"pu-radio-button",11),G(6,"translate"),yi("ngModelChange",function(i){W(n);let r=w(3);return wi(r.pageOption,i)||(r.pageOption=i),z(i)}),N()(),R(7,"span",12),me(8),G(9,"translate"),N(),R(10,"pu-input",13),G(11,"translate"),yi("ngModelChange",function(i){W(n);let r=w(3);return wi(r.pageRange,i)||(r.pageRange=i),z(i)}),N(),se(12,Wf,13,12,"ng-container",14),N()}if(a&2){let n=w(3);x(),ue("aria-label",Y(2,13,"SELECT_PRINT_RANGE")),x(2),O("label",Y(4,15,"ALL")),Mi("ngModel",n.pageOption),x(2),O("label",Y(6,17,"SPECIFY_PRINT_RANGE")),Mi("ngModel",n.pageOption),x(2),Ye("disabled",n.pageOption!=="partial"),x(),xe(Y(9,19,"RANGE")),x(2),O("ariaLabel",Y(11,21,"RANGE"))("disabled",n.pageOption!=="partial")("placeholder",n.pageRangePlaceholder),Mi("ngModel",n.pageRange),x(2),O("ngIf",n.runtimeEnv.get(n.RuntimeEnvKey.PLUGIN_PRINT)||n.openedDialogByApi)}}function Gf(a,t){if(a&1&&(se(0,zf,13,23,"section",8),G(1,"async")),a&2){let n=w(2);O("ngIf",!Y(1,1,n.donePrint))}}function Yf(a,t){a&1&&(R(0,"section",9)(1,"span",19),me(2),G(3,"translate"),N()()),a&2&&(x(2),xe(Y(3,1,"DONE_PRINT_MODAL")))}function Qf(a,t){if(a&1){let n=_e();R(0,"button",20),ce("click",function(){W(n);let i=w(2);return z(i.onClose())}),me(1),G(2,"translate"),N(),R(3,"button",21),G(4,"translate"),ce("click",function(){W(n);let i=w(2);return z(i.onConfirm(!0))}),me(5),G(6,"translate"),N()}if(a&2){let n=w(2);Ye("dark",n.isDarkMode),x(),xe(Y(2,5,"CANCEL")),x(2),ue("aria-label",Y(4,7,"PRINT")),x(2),xe(Y(6,9,"PRINT"))}}function qf(a,t){if(a&1){let n=_e();R(0,"button",22),G(1,"translate"),ce("click",function(){W(n);let i=w(2);return z(i.onClose(!0))}),me(2),G(3,"translate"),N()}a&2&&(ue("aria-label",Y(1,2,"CLOSE")),x(2),xe(Y(3,4,"CLOSE")))}function Kf(a,t){if(a&1){let n=_e();R(0,"pu-dialog",7),G(1,"async"),G(2,"async"),G(3,"translate"),ce("close",function(){W(n);let i=w();return z(i.onClose())}),se(4,Gf,2,3,"ng-template",null,0,ci)(6,Yf,4,3,"ng-template",null,1,ci)(8,Qf,7,11,"ng-template",null,2,ci)(10,qf,4,6,"ng-template",null,3,ci),N()}if(a&2){let n=ei(5),e=ei(7),i=ei(9),r=ei(11),l=w();O("bodyTemplate",Y(1,3,l.donePrint)?e:n)("footerTemplate",Y(2,5,l.donePrint)?r:i)("header",Y(3,7,"PRINT"))}}function Xf(a,t){if(a&1){let n=_e();R(0,"div")(1,"img",23),ce("load",function(){W(n);let i=w();return z(i.onLoad())})("error",function(i){W(n);let r=w();return z(r.onError(i))}),N()()}if(a&2){let n=t.$implicit;x(),ue("src",n,un)}}var ts=class ts{elementRef;annotService;acroFormService;contentService;changeDetectorRef;dataService;modalService;toastService;agentService;pageService;changeService;documentService;subscriptionService;dapService;store$;translatePipe;dialogService;downloadService;apiEventBridgeService;authService;printService;invisibleTracerService;muPDFService;renderingService;signatureService;PRINT_PROGRESS_RATIO=80;get RuntimeEnvKey(){return ne}get runtimeEnv(){return K}get lastCommonModal(){return(this.modalService.lastModal?.instance).nestedRef?.instance}get isDarkMode(){return this.screenTheme==="light"?!1:this.screenTheme==="dark"||window.matchMedia("(prefers-color-scheme: dark)")?.matches}doc;immediatePrintConfig;finish=new wo;currentPageNo;pageOption="all";pageRange=F.EMPTY_STRING;printImagesDataUrls=[];_dialogVisible=!0;tempDocId;enablePdfPages;pageNumbers=[];nLoadedImage=0;pageDescriptions;dominantPageOrientation="portrait";dejavuToken;tracerImageUrl;screenTheme;constructor(t,n,e,i,r,l,g,S,y,I,B,ee,ge,le,Te,$e,p,vt,gt,ft,Et,Li,si,Ii,Oe){this.elementRef=t,this.annotService=n,this.acroFormService=e,this.contentService=i,this.changeDetectorRef=r,this.dataService=l,this.modalService=g,this.toastService=S,this.agentService=y,this.pageService=I,this.changeService=B,this.documentService=ee,this.subscriptionService=ge,this.dapService=le,this.store$=Te,this.translatePipe=$e,this.dialogService=p,this.downloadService=vt,this.apiEventBridgeService=gt,this.authService=ft,this.printService=Et,this.invisibleTracerService=Li,this.muPDFService=si,this.renderingService=Ii,this.signatureService=Oe}get dialogVisible(){return this._dialogVisible}get pdfPages(){return this.enablePdfPages||this.pageService.originalPdfPages}get pageRangePlaceholder(){return`${this.translatePipe.transform("EX")} 1-5, 8, 11-13`}get openedDialogByApi(){return this.dialogService.openedDialogByApi}get donePrint(){return this.printService.doneEvent$}ngOnInit(){if(this.subscriptionService.push(this.store$.pipe(ii("screenTheme")).subscribe({next:t=>{this.screenTheme=t,this.changeDetectorRef.markForCheck()}}),this.store$.pipe(H("currentPageNo")).subscribe({next:t=>this.currentPageNo=t}),this.documentService.pdfInfo$.pipe(L(t=>t.DocumentType==="DAP")).subscribe({next:()=>this.initDapInfoSubscription()})),this.immediatePrintConfig){this._dialogVisible=!1,this.immediatePrint();return}!K.get(ne.BROWSER_PRINT)&&K.get(ne.PLUGIN_PRINT)&&!this.openedDialogByApi&&(this._dialogVisible=!1,this.onConfirm(!1)),this.dialogVisible&&this.elementRef.nativeElement.focus()}ngOnDestroy(){this.printImagesDataUrls.splice(0)}onConfirm(t){if(!window.print||Q.isKakaoInAppBrowser()){this.onClose(),t&&this.authService.deleteCookie("accessToken"),this.modalService.lastModal?.dispose(),this.modalService.createCommonModal({type:Ut.ERROR,content:this.translatePipe.transform("NOT_SUPPORTED_BROWSER_PRINT"),confirmButton:!0}).addOnDisposeListener(()=>this.finishPrint());return}this.modalService.createCommonModal({type:Ut.BASIC,title:this.translatePipe.transform("PRINT"),content:this.translatePipe.transform("PREPARING_TO_PRINT")}),this.subscriptionService.set("mainSub",Ka(this.documentService.isDAP?this.validateDAPInfo():Ln,this.validatePageRange(),t?Ln:this.checkLatestModuleInstallation(),t&&this.invisibleTracerService.isEnabled?this.prepareInvisibleTracer():Ln,this.saveChanges(t),t&&this.muPDFService.docRaw===null?this.getDejavuToken():Ln,Oo(()=>(this.pdfPages&&this.pdfPages.length!==0&&(this.dominantPageOrientation=this.determineDominantPageOrientation()),Ln)),Oo(()=>t?this.printUsingBrowser():this.printUsingModule())).subscribe({next:n=>{this.modalService.lastModal?.dispose(),this.modalService.createCommonModal({type:Ut.INFO,content:n||"",confirmButton:!0}).addOnDisposeListener(()=>this.finishPrint())},error:n=>{this.apiEventBridgeService.immediatePrintStartSrc.next({ok:!1,error:n instanceof Error?n:new ms(`Failed to print. (${n})`)}),this.modalService.lastModal?.dispose(),this.modalService.createCommonModal({type:Ut.ERROR,content:n?.message??this.translatePipe.transform("FAILED_TO_PRINT"),confirmButton:!0}).addOnDisposeListener(()=>this.finishPrint())},complete:()=>{!t||this.muPDFService.docRaw!==null||(this.dataService.getPostPrint(this.tempDocId,this.dejavuToken,this.tempDocId!==this.doc.streamdocsId?this.doc.streamdocsId:void 0).subscribe(),this.authService.deleteCookie("accessToken"))}}))}onClose(t){if(this.dialogService.openedDialogByApi=!1,!t&&(Q.isTablet()||Q.isMobile()||Q.isSamsungBrowser())){this.dialogService.toggleDialogVisibility($i.PRINT,!0),this.printService.finishPrint();return}this.dialogService.toggleDialogVisibility($i.PRINT,!1),this.nLoadedImage=0,this.finish.emit()}onLoad(){++this.nLoadedImage;let t=this.nLoadedImage/this.pageNumbers.length*(100-this.PRINT_PROGRESS_RATIO);this.lastCommonModal?.setProgressValue(this.PRINT_PROGRESS_RATIO+t),this.nLoadedImage===this.pageNumbers.length&&(window.print(),this.apiEventBridgeService.immediatePrintStartSrc.next({ok:!0,data:{status:"PRINTED"}}),this.modalService.lastModal?.dispose(),this.onClose())}onError(t){console.error(this.translatePipe.transform("FAILED_TO_LOAD_IMAGE"),t),this.changeDetectorRef.markForCheck(),this.modalService.lastModal?.dispose(),this.modalService.createCommonModal({type:Ut.ERROR,content:this.translatePipe.transform("FAILED_TO_LOAD_DOC_TO_PRINT"),confirmButton:!0}).addOnDisposeListener(()=>this.finishPrint())}trackByImage(t){return t}immediatePrint(){this.immediatePrintConfig.pageRange&&this.immediatePrintConfig.pageRange!=="all"&&(this.pageRange=this.immediatePrintConfig.pageRange,this.pageOption="partial"),this.onConfirm(!0)}initDapInfoSubscription(){this.subscriptionService.push(this.documentService.pageDescriptions$.pipe(L(F.isDefined)).subscribe({next:t=>{this.pageDescriptions=t,this.calcEnablePages()}}))}calcEnablePages(){let t=[];this.pageService.originalPdfPages.forEach((n,e)=>{this.dapService.isDisabled(this.dapService.getPageRefId(n))&&t.push(e)}),this.enablePdfPages=F.deepClone(this.pageService.originalPdfPages),t.sort((n,e)=>e-n),t.forEach(n=>this.enablePdfPages.splice(n,1))}finishPrint(){this.subscriptionService.get("mainSub")?.unsubscribe(),this.dialogVisible||this.onClose()}validateDAPInfo(){return new Kt(t=>{if(!this.pageDescriptions){t.error(new Nl("Printing is temporarily unavailable.")),this.modalService.lastModal?.dispose(),this.modalService.createCommonModal({type:Ut.WARN,content:this.translatePipe.transform("FAILED_TO_PRINT_TEMPORARILY"),confirmButton:!0}).addOnDisposeListener(()=>this.finishPrint());return}if(this.pageDescriptions.reduce((e,i)=>e.includes(i.refId)?e:e.concat(i.refId),[]).every(e=>this.dapService.isDisabled(e))){t.error(new Al("No document has been selected for printing.")),this.modalService.lastModal?.dispose(),this.modalService.createCommonModal({type:Ut.WARN,content:this.translatePipe.transform("ALL_DAP_DISABLED"),confirmButton:!0}).addOnDisposeListener(()=>this.finishPrint());return}t.complete()})}validatePageRange(){return new Kt(t=>{if(this.modalService.lastModal?.dispose(),this.modalService.createCommonModal({type:Ut.BASIC,title:this.translatePipe.transform("PRINT"),content:this.translatePipe.transform("CHECKING_PAGE_RANGE")}),this.pageOption!=="all"?(this.pageNumbers=uo.parse(this.pageRange,{min:1,max:this.pdfPages.length})??[],this.immediatePrintConfig&&this.pageNumbers.length>0&&(this.pageNumbers=this.pageNumbers.map(n=>n+1))):this.pageNumbers=Array.from({length:this.pdfPages.length}).map((n,e)=>e+1),!this.pageNumbers||this.pageNumbers.length===0||this.pageNumbers.filter(n=>!n||n>this.pdfPages.length).length>0){t.error(new Pl(`Invalid page range. (min: 0, max: ${this.pdfPages.length})`)),this.modalService.lastModal?.dispose(),this.modalService.createCommonModal({type:Ut.WARN,content:this.translatePipe.transform("INVALID_PAGE_RANGE"),confirmButton:!0}).addOnDisposeListener(()=>this.finishPrint());return}this.pageNumbers.length>Je.printCriticalPageLength?(this.modalService.lastModal?.dispose(),this.modalService.createCommonModal({type:Ut.WARN,content:Q.isPlatformWindows?this.translatePipe.transform("RECOMMEND_PRINT_PLUGIN"):this.translatePipe.transform("WARN_MANY_PAGES_PRINT"),confirmButton:!0,confirmLabel:this.translatePipe.transform("CONTINUE"),cancelButton:!0}).addOnDisposeListener(n=>{if(!n){this.finishPrint();return}t.complete()})):t.complete()})}checkLatestModuleInstallation(){return new Kt(t=>{this.modalService.lastModal?.dispose(),this.modalService.createCommonModal({type:Ut.BASIC,title:this.translatePipe.transform("PRINT"),content:this.translatePipe.transform("CHECKING_PRINT_PLUGIN")}),this.agentService.checkVersion().subscribe({next:n=>{if(n.body&&this.agentService.isLatestVersion(n.body)){t.complete();return}t.error(new Il("Please update the plugin.")),this.modalService.lastModal?.dispose(),this.modalService.createModal(_c,{status:"needUpdate"}).addOnDisposeListener(()=>this.finishPrint())},error:()=>{t.error(new Rl("The plugin is not installed.")),this.modalService.lastModal?.dispose(),this.modalService.createModal(_c,{status:"notInstall"}).addOnDisposeListener(()=>this.finishPrint())}})})}prepareInvisibleTracer(){return new Kt(t=>{if(!this.invisibleTracerService.isEnabled){t.complete();return}this.invisibleTracerService.printBinary$.subscribe(n=>{if(n?.binary?.type==="BLOB")this.tracerImageUrl=URL.createObjectURL(n.binary.data);else if(n?.binary?.type==="BASE64")this.tracerImageUrl=n?.binary.data;else{t.error("Binary data type error(RAW)");return}this.changeDetectorRef.markForCheck(),t.complete()})})}applyChangesForDap(t){return this.store$.pipe(ko("ALL",!0),ao(1),ut(n=>Rn.hasChanges(n)||this.annotService.hasLog()||this.invisibleTracerService.isEnabled?this.exportChanges({streamdocsId:this.tempDocId},t,!0):Ln))}saveChanges(t){return new Kt(n=>{if(this.muPDFService.docRaw!==null){this.muPDFService.applyChanges(this.annotService.getActionLog(),this.acroFormService.getActionLog(),()=>{this.annotService.clearActionLogs(),this.acroFormService.clearActionLogs()},this.documentService.openedDocument.streamdocsId).subscribe({error:e=>n.error(e),complete:()=>n.complete()});return}Ka(this.exportChanges(this.doc,t),this.prepareDocument(),this.doc.isDap?this.applyChangesForDap(t):Ln,Oo(()=>this.contentService.tsaValidation$?this.validateTSA():Ln)).subscribe({next:e=>n.next(e),error:e=>n.error(e),complete:()=>n.complete()})})}validateTSA(){let{fontName:t,text:n,validity:e}=this.contentService.tsaValidation$,i=this.changeService.exportExtraCommand({streamdocsId:this.tempDocId},[{command:"changeTsaAppearance",argument:[{fontName:t,validity:e,text:this.signatureService.shouldRenderTimeStamp?n:""}]}],{incremental:!1,toTemp:!0});if(i===void 0)throw new ir("Failed to create change observable for document validation.");return i.pipe(ct(r=>this.tempDocId=r.streamdocsId),ut(()=>Ln))}getNewRotatedImage(t,n){return new Kt(e=>{let i=this.getEffectiveRotation(n);if(i===180||i===0)e.next(t),e.complete();else{let r=new Image;r.onload=()=>{let l=document.createElement("canvas"),g=l.getContext("2d");if(g===null){e.error(new Tt("Failed to get CanvasRenderingContext2D"));return}l.width=r.height,l.height=r.width,g.translate(l.width/2,l.height/2),g.rotate(i*Math.PI/180),g.drawImage(r,-r.width/2,-r.height/2),e.next(l.toDataURL("image/png")),e.complete()},r.onerror=l=>e.error(l),r.src=t}})}getEffectiveRotation(t){let n=this.pdfPages[t];return this.getEffectivePageOrientation(n)===this.dominantPageOrientation?n.r:(n.r+90)%360}getEffectivePageOrientation(t){let n=Math.abs(t.r%360),e=t.bbox.w>t.bbox.h?"landscape":"portrait";return n===270||n===90?e==="portrait"?"landscape":"portrait":e}determineDominantPageOrientation(){let t=this.pdfPages.length,n=3,e=1,r=n-Math.exp(.05*(t-1)),l=Math.max(e,r),g=1,S={portrait:0,landscape:0};return this.pdfPages.forEach((y,I)=>{S[this.getEffectivePageOrientation(y)]+=I===0?l:g}),S.landscape>S.portrait?"landscape":"portrait"}prepareDocument(){return new Kt(t=>{if(!this.documentService.isDAP){t.complete();return}if(this.modalService.lastModal?.dispose(),this.pageDescriptions.reduce((i,r)=>i.includes(r.refId)?i:i.concat(r.refId),[]).every(i=>this.dapService.isDisabled(i))){t.next(this.translatePipe.transform("PRINT_CANCELLED"));return}this.modalService.createCommonModal({type:Ut.PROGRESS,title:this.translatePipe.transform("PRINT"),content:this.translatePipe.transform("PREPARING_TO_PRINT")});let e=this.downloadService.makeDownloadId(this.tempDocId);e.pipe(L(i=>i.status==="progress")).subscribe({next:i=>{i.action==="split"?this.lastCommonModal?.setProgressValue(Math.round(i.progress*50)):i.action==="merge"&&this.lastCommonModal?.setProgressValue(50+Math.round(i.progress*50))},error:()=>{this.modalService.lastModal?.dispose(),this.modalService.createCommonModal({type:Ut.ERROR,content:this.translatePipe.transform("FAILED_TO_SPLIT_MERGE_TO_PRINT"),confirmButton:!0})}}),e.pipe(L(i=>i.status==="complete")).subscribe({next:i=>{this.tempDocId=i.id,t.complete()}})})}exportChanges(t,n,e=!1){return new Kt(i=>{this.modalService.lastModal?.dispose(),this.modalService.createCommonModal({type:Ut.BASIC,title:this.translatePipe.transform("PRINT"),content:this.translatePipe.transform("SAVING_CHANGE_TO_PRINT_DOC")});let r=this.changeService.exportChange(t,{reload:!1,incremental:!1,toTemp:!0,print:!0,afterMergingDap:e,addInvisibleTracer:this.invisibleTracerService.isEnabled&&!n});if(!r){this.tempDocId=t.streamdocsId,i.complete();return}r.pipe(ut(l=>(this.tempDocId=l.streamdocsId,this.renderingService.renderingMode===Ci.CLIENT?this.dataService.getDocRaw(this.tempDocId).pipe(ut(g=>this.muPDFService.call(tc.OPEN_DOCUMENT,g.arrayBuffer,"temp.pdf",this.tempDocId)),us(g=>(console.error(g),g))):xt(null)))).subscribe({next:()=>i.complete(),error:()=>i.error(new ms(this.translatePipe.transform("FAILED_TO_SAVE_TO_PRINT")))})})}getDejavuToken(){return new Kt(t=>{this.dataService.getDejavuToken(this.tempDocId).subscribe({next:n=>{if(!n||!n.token){t.error(this.translatePipe.transform("FAILED_TO_PRINT"));return}this.dejavuToken=n.token,t.complete()},error:()=>t.error(this.translatePipe.transform("FAILED_TO_PRINT"))})})}printUsingBrowser(){return new Kt(t=>{this.modalService.lastModal?.dispose();let n=this.modalService.createCommonModal({type:Ut.PROGRESS,title:this.translatePipe.transform("PRINT"),content:this.translatePipe.transform("PRINTING"),cancelButton:!0});Rr.token!==null&&this.authService.setCookie("accessToken",Rr.token?.accessToken);let e=this.pageNumbers.map(l=>this.muPDFService.call(tc.GET_PRINT_URL,l-1,!0,Je.dpiForPrint,this.tempDocId).pipe(ut(g=>this.getNewRotatedImage(g,l-1)))),i=0,r=Ls(e).pipe(cl(Je.browserPrintImageRequestChunkSize),hl(l=>rl(l)),ct(l=>{i+=l.length,this.lastCommonModal.setProgressValue(Math.floor(i/this.pageNumbers.length*this.PRINT_PROGRESS_RATIO))}),pl((l,g)=>l.concat(g),[])).subscribe({next:l=>{this.printImagesDataUrls=l,this.changeDetectorRef.markForCheck(),t.complete()},error:l=>t.error(this.translatePipe.transform(l.message))});this.subscriptionService.set("fetchImage",r),n.addOnDisposeListener(l=>{l===!1&&(this.subscriptionService.get("fetchImage")?.unsubscribe(),this.toastService.create({toastStyle:jt.NOTIFICATION,content:this.translatePipe.transform("PRINT_CANCELLED"),header:this.translatePipe.transform("BROWSER_PRINT")}),this.apiEventBridgeService.immediatePrintStartSrc.next({ok:!1,error:new ms(this.translatePipe.transform("PRINT_CANCELLED"))}),this.finishPrint())})})}printUsingModule(){if(this.modalService.lastModal?.dispose(),this.printService.pluginPrintSub&&!this.printService.pluginPrintSub.closed)return new Kt(n=>{this.toastService.create({toastStyle:jt.NOTIFICATION,header:this.translatePipe.transform("PRINT"),content:this.translatePipe.transform("PENDING_PLUGIN_PRINT_REQUEST")}),n.complete()});let t=this.toastService.create({toastStyle:jt.NOTIFICATION,header:this.translatePipe.transform("PRINT"),content:this.translatePipe.transform("PRINTING"),timeout:null});return this.printService.pluginPrintSub=this.dataService.getDownloadUrl({docId:this.tempDocId,originalId:this.tempDocId!==this.doc.streamdocsId?this.doc.streamdocsId:void 0}).pipe(ut(n=>{let e=Q.nativeWindow;return this.agentService.print(e.location.hostname,n,e.location.port,e.location.protocol,this.contentService.tsaValidation$?.validity,`${this.currentPageNo-1}`,this.pageNumbers&&this.pageRange.length>0?uo.stringify(this.pageNumbers):void 0)}),ze(n=>{if(n.body===null)throw new Dl("No response body received.");return/([a-zA-Z]+#)?(\-?[0-9]+)/.exec(n.body)?.[2]||"Unknwon"}),ze(n=>{let e={success:!1,canceled:!1,message:""};if(Number(n)<0)switch(n){case"-3":e.canceled=!0,e.message=this.translatePipe.transform("PRINT_CANCELLED");break;case"-20":e.message=this.translatePipe.transform("FAILED_TO_LOAD_DOC_TO_PRINT");break;default:e.message=`${this.translatePipe.transform("FAILED_TO_PRINT")}
(${this.translatePipe.transform("ERROR_CODE")}: ${n})`;break}else e.success=!0,e.message=this.translatePipe.transform("PRINT_COMPLETED");return e}),ct(n=>{if(n.success||n.canceled){this.apiEventBridgeService.immediatePrintStartSrc.next({ok:!0,data:{status:n.canceled?"CANCELLED":"PRINTED"}});return}this.apiEventBridgeService.immediatePrintStartSrc.next({ok:!1,error:new ms(`Failed to print. (${n.message})`)})}),us(()=>{throw this.translatePipe.transform("FAILED_TO_PRINT")})).subscribe({next:n=>{t.dispose(),this.printService.pluginPrintSub=null,this.toastService.create({toastStyle:n.success?jt.SUCCESS:jt.FAILURE,header:this.translatePipe.transform("PRINT"),content:n.message})},error:n=>{t.dispose(),this.printService.pluginPrintSub=null,this.toastService.create({toastStyle:jt.FAILURE,header:this.translatePipe.transform("PRINT"),content:n})}}),new Kt(n=>{this.onClose(),n.complete()})}};A(ts,"\u0275fac",function(n){return new(n||ts)(v(Zt),v(ni),v(bn),v(it),v(ye),v(ia),v(Ki),v(Zi),v(es),v(Ht),v(Vo),v(ot),v(Z),v(ra),v(Ee),v(Ve),v(xn),v(Lo),v(Ei),v(Jl),v(Fr),v(oa),v(Ro),v(Io),v(Br))}),A(ts,"\u0275cmp",Ce({type:ts,selectors:[["sd-print-view"]],inputs:{doc:"doc",immediatePrintConfig:"immediatePrintConfig"},outputs:{finish:"finish"},standalone:!1,features:[be([Z])],decls:3,vars:3,consts:[["dialogBody",""],["finishDialogBody",""],["dialogFooter",""],["finishDialogFooter",""],["width","360",3,"bodyTemplate","footerTemplate","header","close",4,"ngIf"],["id","print-container"],[4,"ngFor","ngForOf","ngForTrackBy"],["width","360",3,"close","bodyTemplate","footerTemplate","header"],["class","dialog-body",4,"ngIf"],[1,"dialog-body"],["value","all",3,"ngModelChange","label","ngModel"],["value","partial",3,"ngModelChange","label","ngModel"],[1,"range-label"],["size","tiny",3,"ngModelChange","ariaLabel","disabled","placeholder","ngModel"],[4,"ngIf"],[1,"horizontal-division-line"],["tabindex","0",1,"plugin-label"],["tabindex","0",1,"plugin-description"],["color","grey","size","tiny",1,"ep-button",3,"click"],[1,"complete-description"],["color","white","size","small",1,"ep-button","cancel",3,"click"],["color","primary","size","small",1,"ep-button","print",3,"click"],["color","white","size","small",1,"ep-button",3,"click"],[3,"load","error"]],template:function(n,e){n&1&&(se(0,Kf,12,9,"pu-dialog",4),R(1,"div",5),se(2,Xf,2,1,"div",6),N()),n&2&&(O("ngIf",e.dialogVisible),x(2),O("ngForOf",e.printImagesDataUrls)("ngForTrackBy",e.trackByImage))},dependencies:[Si,lt,Sn,po,Qs,Hn,Ks,Yl,Tl,Ve],styles:[".dialog-body[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin-top:24px;margin-bottom:32px}.dialog-body[_ngcontent-%COMP%]   pu-radio-button[_ngcontent-%COMP%]{margin-top:16px}.dialog-body[_ngcontent-%COMP%]   pu-radio-button[_ngcontent-%COMP%]:first-child{margin-top:0}.dialog-body[_ngcontent-%COMP%]   .range-label[_ngcontent-%COMP%]{font-size:12px;line-height:20px;font-family:NotoSans-Medium,sans-serif;color:var(--mono-70);margin-top:18px}.dialog-body[_ngcontent-%COMP%]   .range-label.disabled[_ngcontent-%COMP%]{opacity:.5}.dialog-body[_ngcontent-%COMP%]   pu-input[_ngcontent-%COMP%]{width:160px}.dialog-body[_ngcontent-%COMP%]   .horizontal-division-line[_ngcontent-%COMP%]{width:100%;height:1px;margin:16px 0;background-color:var(--mono-30)}.dialog-body[_ngcontent-%COMP%]   .plugin-label[_ngcontent-%COMP%]{font-size:14px;line-height:24px;font-family:NotoSans-Medium,sans-serif;color:var(--mono-99);display:block}.dialog-body[_ngcontent-%COMP%]   .plugin-description[_ngcontent-%COMP%]{font-size:13px;line-height:22px;font-family:NotoSans-Regular,sans-serif;color:var(--mono-70);margin-top:6px}.dialog-body[_ngcontent-%COMP%]   nav[_ngcontent-%COMP%]{margin-top:24px}.dialog-body[_ngcontent-%COMP%]   .complete-description[_ngcontent-%COMP%]{font-size:13px;line-height:22px;font-family:NotoSans-Regular,sans-serif;color:var(--mono-70)}button[_ngcontent-%COMP%]{color:var(--mono-00)}button[_ngcontent-%COMP%] + button[_ngcontent-%COMP%]{margin-left:8px}button.print[_ngcontent-%COMP%]{color:var(--mono-00)}button.cancel.dark[_ngcontent-%COMP%]{color:var(--mono-90);background-color:var(--mono-30);border-color:var(--mono-30)}img[_ngcontent-%COMP%]{max-width:100%;max-height:100%;position:absolute;top:0;bottom:0;left:0;right:0;margin:auto}[_nghost-%COMP%] > div[_ngcontent-%COMP%]{display:none}"],changeDetection:0}));var is=ts;Qe([st(nt.printViewComp.printUsingBrowser)],is.prototype,"printUsingBrowser",null);Qe([st(nt.printViewComp.printUsingModule)],is.prototype,"printUsingModule",null);var em=["sdToastOutlet"],tm=["sdModalOutlet"],im=a=>({error:a});function nm(a,t){if(a&1){let n=_e();R(0,"sd-toolbar",19),ce("contextmenu",function(i){W(n);let r=w(2);return z(r.onContextMenu(i))}),N()}if(a&2){let n=w(2);Gi("display",n.isVisibleToolbar?void 0:"none"),O("doc",n.doc)}}function om(a,t){if(a&1&&X(0,"sd-annot-toolbar"),a&2){let n=w(2);Gi("display",!n.isSubToolbarOpened||n.isEbookMode()?"none":void 0)}}function rm(a,t){if(a&1&&(R(0,"aside"),X(1,"sd-side-view",18),N()),a&2){let n=w(2);Ye("side-view",!n.isRedactingOnMobile),O("@sideViewAnimation",n.isSmallWidthScreen&&!n.isRedactingOnMobile),x(),O("pdfDoc",n.doc)}}function sm(a,t){if(a&1&&(R(0,"aside",20),X(1,"sd-right-side-view",18),N()),a&2){let n=w(2);O("@sideViewAnimation",n.isSmallWidthScreen),x(),O("pdfDoc",n.doc)}}function am(a,t){if(a&1&&X(0,"sd-content-view",23),a&2){let n=w(3);O("pdfDoc",n.doc)("centerPoint",n.centerPointParam)("overWrittenZoom",n.zoomParam)("ngStyle",n.contentViewStyle)}}function cm(a,t){a&1&&X(0,"sd-ruler")}function lm(a,t){if(a&1){let n=_e();R(0,"span",24),ce("contextmenu",function(i){W(n);let r=w(3);return z(r.onContextMenu(i))}),me(1),N()}if(a&2){let n=w(3);ue("aria-label",n.pageNumberAriaLabel),x(),Hs("",n.currentPageNo,"/",n.pageCount,"")}}function pm(a,t){if(a&1&&(Lt(0),se(1,am,1,4,"sd-content-view",21)(2,cm,1,0,"sd-ruler",5)(3,lm,2,3,"span",22),Ft()),a&2){let n=w(2);x(),O("ngIf",n.doc),x(),O("ngIf",n.rulerActive),x(),O("ngIf",n.isPageIdxIndicatorVisible)}}function dm(a,t){a&1&&X(0,"sd-spreadsheets-view")}function hm(a,t){if(a&1&&(R(0,"div",29),me(1),N()),a&2){let n=w(4);x(),xe(n.passwordErrorMessage)}}function um(a,t){if(a&1){let n=_e();R(0,"div",26),me(1),G(2,"translate"),N(),R(3,"pu-input",27),G(4,"translate"),G(5,"translate"),yi("ngModelChange",function(i){W(n);let r=w(3);return wi(r.password,i)||(r.password=i),z(i)}),ce("keydown.enter",function(){W(n);let i=w(3);return z(i.password&&!i.passwordChecking?i.checkPassword():null)}),N(),se(6,hm,2,1,"div",28)}if(a&2){let n=w(3);x(),xe(Y(2,8,"THIS_DOCUMENT_WAS_ENCRYPTED")),x(2),O("autofocus",!0)("ngClass",_t(14,im,n.passwordErrorMessage))("placeholder",Y(4,10,"INPUT_PASSWORD"))("ariaLabel",Y(5,12,"INPUT_PASSWORD"))("readonly",n.passwordChecking),Mi("ngModel",n.password),x(3),O("ngIf",n.passwordErrorMessage)}}function gm(a,t){if(a&1){let n=_e();R(0,"button",30),G(1,"translate"),ce("click",function(){W(n);let i=w(3);return z(i.checkPassword())}),me(2),G(3,"translate"),N()}if(a&2){let n=w(3);O("disabled",!n.password||n.passwordChecking),ue("aria-label",Y(1,3,"OK")),x(2),xe(Y(3,5,"OK"))}}function fm(a,t){if(a&1&&(R(0,"pu-dialog",25),G(1,"translate"),se(2,um,7,16,"ng-template",null,3,ci)(4,gm,4,7,"ng-template",null,4,ci),N()),a&2){let n=ei(3),e=ei(5);O("bodyTemplate",n)("footerTemplate",e)("header",Y(1,4,"ENCRYPTED_DOCUMENT"))("headerIcon","papycon papycon-questionmark")}}function mm(a,t){if(a&1){let n=_e();R(0,"sd-print-view",31),ce("finish",function(){W(n);let i=w(2);return z(i.onFinishPrint())}),N()}if(a&2){let n=w(2);O("doc",n.doc)("immediatePrintConfig",n.immediatePrintConfig)}}function vm(a,t){if(a&1){let n=_e();Lt(0),se(1,nm,1,3,"sd-toolbar",6)(2,om,1,2,"sd-annot-toolbar",7),R(3,"div",8),ce("contextmenu",function(i){W(n);let r=w();return z(r.onContextMenu(i))}),se(4,rm,2,4,"aside",9)(5,sm,2,2,"aside",10),R(6,"section",11),se(7,pm,4,3,"ng-container",12)(8,dm,1,0,"ng-template",null,0,ci),R(10,"div",13),Pn(11,null,1),N(),R(13,"div",14),Pn(14,null,2),N()()(),R(16,"section",15),se(17,fm,6,6,"pu-dialog",16),N(),se(18,mm,1,2,"sd-print-view",17),X(19,"sd-dialog",18),Ft()}if(a&2){let n=ei(9),e=w();x(),O("ngIf",!e.hidableMenus[e.HidableView.TOOLBAR]),x(),O("ngIf",!e.supportTTS&&e.isSubToolbarOpened),x(2),O("ngIf",e.sideViewVisible),x(),O("ngIf",e.rightSideViewVisible),x(),O("ngClass",e.DragMode[e.dragMode]),x(),O("ngIf",!e.isSpreadsheets)("ngIfElse",n),x(10),O("ngIf",e.suspendedDocId),x(),O("ngIf",e.printDialogView||e.immediatePrintConfig),x(),O("pdfDoc",e.doc)}}var Od="400ms",Md="cubic-bezier(0.86, 0, 0.07, 1)",sy=(()=>{let t=class t{acroFormService;contentService;annotService;modalService;changeDetectorRef;textSearchService;dataService;toastService;annotSelectedService;documentService;viewerService;shortcutService;subscriptionService;sdContextMenuService;store$;externalApiService;dialogService;printService;apiEventBridgeService;translatePipe;localStorageService;configsService;preferencesService;router;muPDFService;redactionService;autoSaveService;loggingService;get DragMode(){return Ot}sdToastOutlet;sdModalOutlet;viewMode;dragMode;pageCount;currentPageNo;supportTTS;rulerActive;sideViewSize;rightSideViewSize;get contentViewStyle(){if(!this.rulerActive)return{};let e=`${36}px`,i=`calc(100% - ${36}px)`;return{top:e,left:e,width:i,height:i}}printDialogView=!1;immediatePrintConfig;suspendedDocId=F.EMPTY_STRING;password=F.EMPTY_STRING;passwordChecking=!1;passwordErrorMessage=F.EMPTY_STRING;sideViewVisible=!1;rightSideViewVisible=!1;isSmallWidthScreen=Q.isSmallWidth();loading=this.checkDelayLoading;isSpreadsheets=K.get(ne.USE_SPREADSHEETS_VIEWER);get checkDelayLoading(){return!!K.get(ne.DELAY_LOADING)&&!Q.isRootWindow()}get doc(){return this._doc}get isSubToolbarOpened(){return!this.viewerService.isSubToolbarType(null)}get HidableView(){return V}get isRedactingOnMobile(){return this.redactionService.isRedactingOnMobile()}get useLastViewedPage(){return this.localStorageService.isEnabledLocalStorage&&Je.continueFromLastView&&this.documentService.isConvPDFReady}get isVisibleToolbar(){return K.get(ne.SAVE_BUTTON)&&!K.get(ne.AUTO_SAVE)||K.get(ne.ORIGINAL_DOWNLOAD_BUTTON)||K.get(ne.PDF_DOWNLOAD_BUTTON)||K.get(ne.PRINT_BUTTON)&&K.get(Ct.PRINT_DIALOG)||K.get(ne.DOCUMENT_INFO_BUTTON)&&K.get(Ct.DOCUMENT_INFO_DIALOG)||K.get(ne.SLIDESHOW_BUTTON)||K.get(ne.EBOOK_BUTTON)||K.get(ne.PREFERENCES_BUTTON)&&K.get(Ct.PREFERENCES_DIALOG)||K.get(ne.SCREEN_THEME_MENU)||K.get(ne.SD_INFO_BUTTON)||K.get(Ct.LEFT_SIDE_VIEW_BUTTON)||K.get(ne.SCALE_DROPDOWN)||K.get(ne.FIT_BUTTON)||K.get(Ct.VIEW_MODE_BUTTON)||K.get(Ct.DRAG_MODE_BUTTONS)||K.get(Ct.ANNOT_TOOLBAR)||K.get(Ct.FORM_TOOLBAR)||K.get(Ct.PKI_SIGNATURE_TOOLBAR)||this.documentService.isDAP&&K.get(Ct.DAP_VIEW)&&K.get(ne.DAP_VIEW_BUTTON)}get isPageIdxIndicatorVisible(){return!!this.pageCount&&!this.hidableMenus[V.INDICATOR]&&!this.hidableMenus[V.INDICATOR_PAGE_NUMBER]}get lastViewScale(){return this.localStorageService.get("SD_Scale")??"100"}set lastViewScale(e){this.localStorageService.set("SD_Scale",e.toString())}get pageNumberAriaLabel(){return this.translatePipe.transform("CURRENT_PAGE_AND_TOTAL_PAGE").replace("%d",this.currentPageNo.toString()).replace("%d",this.pageCount.toString())}_doc=null;isFullScreen=F.isFullscreenMode();isContextMenuOpened=!1;hidableMenus={};zoomParam;centerPointParam;currentPageNoParam;constructor(e,i,r,l,g,S,y,I,B,ee,ge,le,Te,$e,p,vt,gt,ft,Et,Li,si,Ii,Oe,De,h,u,C,T){this.acroFormService=e,this.contentService=i,this.annotService=r,this.modalService=l,this.changeDetectorRef=g,this.textSearchService=S,this.dataService=y,this.toastService=I,this.annotSelectedService=B,this.documentService=ee,this.viewerService=ge,this.shortcutService=le,this.subscriptionService=Te,this.sdContextMenuService=$e,this.store$=p,this.externalApiService=vt,this.dialogService=gt,this.printService=ft,this.apiEventBridgeService=Et,this.translatePipe=Li,this.localStorageService=si,this.configsService=Ii,this.preferencesService=Oe,this.router=De,this.muPDFService=h,this.redactionService=u,this.autoSaveService=C,this.loggingService=T}ngOnInit(){this.checkDelayLoading||this.contentService.togglePageLoader(!1),this.initializeConfigToStore(),this.subscribe(),this.bindParams(),this.initSearchResult(),this.annotSelectedService.unselectAll(),this.subscriptionService.push(this.autoSaveService.initAutoSave(),this.shortcutService.getShortcutEvent(Ae.FULLSCREEN).subscribe({next:e=>{e.preventDefault(),e.stopPropagation(),this.isFullScreen?Q.exitFullScreen():Q.enterFullScreen()}}),Q.windowResize$.pipe(ct(()=>this.isSmallWidthScreen=Q.isSmallWidth()),L(()=>this.isFullScreen!==F.isFullscreenMode()),ut(()=>sl(100).pipe(L(()=>!F.isFullscreenMode()),ao(1)))).subscribe({next:()=>{Q.exitFullScreen()}}),this.documentService.openedDocument$.subscribe({next:e=>{if(this.initPassword(),!e){this.closeDocument();return}this._doc=e,this.viewerService.closeSubToolbar(),F.isDefined(this.currentPageNoParam)||this.checkLastViewedPage(),this.acroFormService.resetAcroFieldByPage(),this.changeDetectorRef.markForCheck()}}),this.localStorageService.localStorage$.subscribe({next:()=>{this.toastService.create({toastStyle:jt.FAILURE,content:this.translatePipe.transform("FAILED_TO_ACCESS_LOCAL_STORAGE")})}})),this.printService.setBrowserPrintGripperMargin(Je.defaultPrintMargin),this.localStorageService.isEnabledLocalStorage||this.toastService.create({toastStyle:jt.FAILURE,content:this.translatePipe.transform("FAILED_TO_ACCESS_LOCAL_STORAGE")})}ngOnDestroy(){this.viewerService.closeDocument()}ngAfterViewChecked(){this.sdToastOutlet&&this.sdModalOutlet&&(this.toastService.registerOutlet(this.sdToastOutlet),this.modalService.registerOutlet(this.sdModalOutlet))}isEbookMode(){return this.viewMode===4}checkPassword(e){this.passwordChecking=!0,this.passwordErrorMessage=F.EMPTY_STRING;let i=e||this.suspendedDocId;if(!F.isDefined(i))throw new Un("No valid document ID provided.");this.viewerService.openDocument(i,!Je.skipPasswordCheck,this.password).pipe(tr(()=>this.passwordChecking=!1)).subscribe({next:()=>{this.suspendedDocId=null},error:r=>{if(this.viewerService.closeSubToolbar(),r.fail){let l=Je.skipPasswordCheck&&r.log.status===401?`errorCode=${r.errorCode}`:"",g=[`view/error-pages/${r.log.status}`,l].join(";");this.router.navigateByUrl(g)}else this.suspendedDocId=e||this.suspendedDocId,e||(this.passwordErrorMessage=this.translatePipe.transform("WRONG_PASSWORD"));this.changeDetectorRef.markForCheck()}})}onContextMenu(e){e.preventDefault(),e.stopPropagation()}onFinishPrint(){this.immediatePrintConfig&&(this.immediatePrintConfig=null)}initSearchResult(){this.textSearchService.clear(),this.contentService.searchRedactionMark([])}bindParams(){let{streamdocsId:e,currentPage:i,viewmode:r,zoom:l,supportTTS:g,option:S,centerPoint:y}={},I=Number.parseInt(S,16),B={singlePage:0,singlePageScroll:1,doublePage:2,doublePageScroll:3,eBook:4};i!==""&&!Number.isNaN(Number(i))&&(this.currentPageNoParam=Number(i),this.store$.dispatch(he.set({key:"currentPageNo",value:Number(i)}))),B.hasOwnProperty(r)&&this.store$.dispatch(he.set({key:"viewMode",value:B[r]})),this.zoomParam=F.isDefined(l)?l:K.get(ne.DEFAULT_ZOOM_MAINTAIN)?this.lastViewScale:null,this.centerPointParam=typeof y=="string"?(()=>{let[ee,ge]=y.split(",").map(Number);return F.isDefined(ee)&&F.isDefined(ge)&&!Number.isNaN(ee)&&!Number.isNaN(ge)?{x:Math.floor(ee),y:Math.floor(ge)}:null})():null,this.store$.dispatch(he.set({key:"supportTTS",value:g==="true"})),this.store$.dispatch(he.set({key:"isScreenReaderActive",value:K.get(ne.PAGE_TEXT_FOR_SCREEN_READER)})),this.store$.dispatch(Cp.set({value:Number.isNaN(I)?0:I})),e&&this.checkPassword(e)}checkLastViewedPage(){if(!this.useLastViewedPage||!this.doc)return;let e=JSON.parse(this.localStorageService.get("SD_History")??"{}"),i=e[this.doc.streamdocsId]?.lastViewedPage;if(!e[this.doc.streamdocsId]){this.loggingService.common("debug",pi.NOT_EXIST,"history",`(${this.translatePipe.transform("LOCAL_STORAGE")})`);return}this.store$.dispatch(he.set({key:"currentPageNo",value:i>0?i:1}))}updateLastViewedPage(e){if(!this.useLastViewedPage||!this.doc)return;let i=JSON.parse(this.localStorageService.get("SD_History")??"{}");i[this.doc.streamdocsId]?i[this.doc.streamdocsId].lastViewedPage=e>0?e:1:i[this.doc.streamdocsId]={lastViewedPage:e>0?e:1},this.localStorageService.set("SD_History",JSON.stringify(i))}subscribe(){this.subscriptionService.push(this.store$.pipe(Ar("isSpreadsheets")).subscribe({next:e=>this.isSpreadsheets=e}),Ge(window,"mousedown").pipe(L(()=>this.isContextMenuOpened)).subscribe({next:()=>{this.sdContextMenuService.publishContextMenuStatus(!1)}}),this.store$.pipe(H("viewMode")).subscribe({next:e=>this.viewMode=e}),this.store$.pipe(H("pageCount")).subscribe({next:e=>this.pageCount=e}),this.store$.pipe(H("scale"),L(()=>K.get(ne.DEFAULT_ZOOM_MAINTAIN)),js(1),ri(100)).subscribe({next:e=>this.lastViewScale=e}),this.store$.pipe(H("currentPageNo")).subscribe({next:e=>{this.currentPageNo=e,this.updateLastViewedPage(e)}}),this.store$.pipe(H("supportTTS")).subscribe({next:e=>this.supportTTS=e}),this.store$.pipe(H("dragMode")).subscribe({next:e=>this.dragMode=e}),this.store$.pipe(H("sideViewVisible")).subscribe({next:e=>{this.sideViewVisible=e,this.changeDetectorRef.markForCheck()}}),this.store$.pipe(H("rightSideViewVisible")).subscribe({next:e=>{this.rightSideViewVisible=e,this.changeDetectorRef.markForCheck()}}),this.store$.pipe(H("sideViewSize")).subscribe({next:e=>{this.sideViewSize=e,this.changeDetectorRef.markForCheck()}}),this.store$.pipe(H("rightSideViewSize")).subscribe({next:e=>{this.rightSideViewSize=e,this.changeDetectorRef.markForCheck()}}),this.printService.print$.pipe(L(e=>e!==null)).subscribe({next:e=>{this.immediatePrintConfig=e,this.changeDetectorRef.markForCheck()}}),this.dialogService.dialogVisibilityChange$.subscribe({next:()=>{if(this.dialogService.dialogVisibility[$i.PRINT]){if(!this.documentService.checkAuthority(Le.PRINT_DOCUMENT)){this.apiEventBridgeService.dialogVisibilityChangedSrc.next({ok:!1,error:new Tt("Unauthorized")});return}if(!this.doc){this.toastService.create({toastStyle:jt.NOTIFICATION,header:this.translatePipe.transform("PRINT"),content:this.translatePipe.transform("SELECT_FILE")});return}}this.printDialogView=!!this.dialogService.dialogVisibility[$i.PRINT],this.changeDetectorRef.markForCheck(),setTimeout(()=>this.apiEventBridgeService.dialogVisibilityChangedSrc.next({ok:!0,data:void 0}))}}),Q.windowResize$.subscribe({next:()=>{this.changeDetectorRef.markForCheck(),!J.canSideViewBeDisplayed(this.sideViewVisible,this.rightSideViewVisible,this.sideViewSize,this.rightSideViewSize)&&(!this.sideViewVisible&&!this.rightSideViewVisible||(this.sideViewVisible&&this.store$.dispatch(he.set({key:"sideViewVisible",value:!1})),this.rightSideViewVisible&&this.store$.dispatch(he.set({key:"rightSideViewVisible",value:!1}))))}}),at(Q.windowResize$,this.store$.pipe(H("sideViewVisible")),this.store$.pipe(H("sideViewSize")),this.store$.pipe(H("rightSideViewVisible")),this.store$.pipe(H("rightSideViewSize"))).subscribe({next:()=>{this.changeDetectorRef.detectChanges()}}),this.documentService.docInfo$.subscribe({next:()=>{this.store$.dispatch(he.set({key:"rightSideViewMode",value:Nt.TextSearch})),this.store$.dispatch(he.set({key:"rightSideViewVisible",value:!1}))}}),this.documentService.pdfInfo$.subscribe({next:e=>{e.DocumentType==="DAP"&&K.get(Ct.DAP_VIEW)&&K.get(ne.DAP_VIEW_BUTTON)&&K.get(ne.DAP_VIEW_DEFAULT_OPEN)?Q.width>Je.rightSideView.initialSize*2&&(this.store$.dispatch(he.set({key:"rightSideViewMode",value:Nt.DAP})),this.store$.dispatch(he.set({key:"rightSideViewVisible",value:!0}))):(this.store$.dispatch(he.set({key:"rightSideViewMode",value:Nt.TextSearch})),this.store$.dispatch(he.set({key:"rightSideViewVisible",value:!1})))}}),Q.fullScreenState$.subscribe({next:e=>this.isFullScreen=e}),this.acroFormService.acroFieldsChange$.pipe(ri(300),ut(()=>F.isDefined(this.doc)?this.acroFormService.updateAcroFieldByPage(this.doc.streamdocsId):br(()=>new Un("Document is not defined.")))).subscribe(),this.store$.pipe(H("rulerActive")).subscribe({next:e=>{this.rulerActive=e,this.changeDetectorRef.markForCheck()}}),this.contentService.reload$.pipe(L(e=>Do.type(e,No.AcroForm)),ut(()=>(this.acroFormService.resetAcroFieldByPage(),F.isDefined(this.doc)?this.dataService.getPdfAcroFields(this.doc.streamdocsId):br(()=>new Un("Document is not defined.")))),ut(({fields:e,props:i})=>(this.acroFormService.publishAcroFields(e,i),F.isDefined(this.doc)?this.acroFormService.updateAcroFieldByPage(this.doc.streamdocsId):br(()=>new Un("Document is not defined."))))).subscribe(),Ge(document,"visibilitychange").pipe(L(()=>document.visibilityState==="hidden")).subscribe({next:()=>this.autoSaveService.fireAutoSave(nc.EXIT)}),Ge(window,"beforeunload").pipe(ct(()=>this.autoSaveService.fireAutoSave(nc.EXIT)),L(()=>{if(Q.isAOS()){let e=window.parent.document.referrer,i=window.parent.location.hostname,r=e?new URL(e).hostname!==i:!0;return(K.get(ne.WARNING_LEAVE_WITHOUT_SAVE)||K.get(ne.AUTO_SAVE))&&!!this.annotService.getActionLog().length&&!(history.length<=1||!e||r)}return(K.get(ne.WARNING_LEAVE_WITHOUT_SAVE)||K.get(ne.AUTO_SAVE))&&!!this.annotService.getActionLog().length})).subscribe({next:e=>e.preventDefault()}),this.sdContextMenuService.contextMenuStatus$.subscribe({next:e=>this.isContextMenuOpened=e}),dn([this.store$.pipe(H("renderingMode"),L(e=>e!==Ci.SERVER)),this.viewerService.loadMuPDF$.pipe(L(e=>e?.length>0),ct(()=>this.muPDFService.closeDocument()))]).subscribe({next:([e,i])=>{let r=e===Ci.CLIENT;xt(this.muPDFService.docRaw).pipe(L(F.isDefined),ut(({arrayBuffer:l,filename:g})=>this.muPDFService.prepareDocument(i,l,g,r)),tr(()=>this.modalService.lastModal?.dispose())).subscribe()}}),this.viewerService.requestPasswordToUser$.subscribe({next:e=>{this.initPassword(),this.suspendedDocId=e,this.changeDetectorRef.markForCheck()}}),this.shortcutService.getShortcutEvent(Ae.SEARCH).subscribe({next:e=>{e.preventDefault(),e.stopPropagation()}})),K.get(ne.RULER_BUTTON)&&this.subscriptionService.push(this.shortcutService.getShortcutEvent(Ae.RULER_VISIBILITY).subscribe({next:()=>this.store$.dispatch(he.set({key:"rulerActive",value:!this.rulerActive}))})),this.checkDelayLoading&&this.subscriptionService.push(this.contentService.pageLoader$.pipe(L(e=>!e),ao(1)).subscribe({next:e=>{this.loading=e,this.changeDetectorRef.markForCheck()}})),this.subscriptionService.push(this.store$.pipe(bi([V.TOOLBAR,V.TOOLBAR_LEFT,V.TOOLBAR_CENTER,V.TOOLBAR_RIGHT,V.INDICATOR,V.INDICATOR_PAGE_NUMBER])).subscribe({next:e=>{Object.assign(this.hidableMenus,e),this.changeDetectorRef.markForCheck()}}))}closeDocument(){this._doc=null,this.store$.dispatch(he.set({key:"sideViewVisible",value:!1})),this.store$.dispatch(he.set({key:"rightSideViewVisible",value:!1})),this.dialogService.closeAll(),this.store$.dispatch(he.set({key:"fitMode",value:null})),this.changeDetectorRef.detectChanges()}initializeConfigToStore(){let e=this.configsService.radioConfig,i=this.preferencesService.savedPreferences,r=Ci.SERVER;K.get(ne.USE_CLIENT_RENDERING)&&(this.muPDFService.initWorker(),r=Ci.CLIENT),this.store$.dispatch(he.set({key:"renderingMode",value:r})),[Po.DEFAULT_VIEW_MODE,Po.DEFAULT_DRAG_MODE].forEach(l=>{if(!go.hasDefinedProp(e,l))throw new fs(`Configuration for '${l}' is not defined in radioConfig.`);e[l].items.forEach(g=>{if(!K.get(g.key))return;let[S,y,I]=g.key.split(".");this.store$.dispatch(he.set({key:I,value:g.value}))})}),[Po.DEFAULT_ZOOM,Po.RENDERING_OPTION,Po.DEFAULT_SCREEN_THEME,Po.DEFAULT_CONTINUE_WRITING].forEach(l=>{if(!go.hasDefinedProp(e,l))throw new fs(`Configuration for '${l}' is not defined in radioConfig.`);e[l].items.forEach(g=>{if(!K.get(g.key))return;let[S,y,I]=g.key.split("."),B=[I];switch(l){case Po.DEFAULT_CONTINUE_WRITING:if(B=["annot","continueWriting"],F.isDefined(i.annot?.continueWriting))return;break;default:if(go.hasDefinedProp(i,I))return}this.store$.dispatch(tp.update({payload:{keys:B,value:g.value}}))})})}initPassword(){this.password=F.EMPTY_STRING,this.passwordChecking=!1,this.passwordErrorMessage=F.EMPTY_STRING,this.suspendedDocId=F.EMPTY_STRING}};A(t,"\u0275fac",function(i){return new(i||t)(v(bn),v(it),v(ni),v(Ki),v(ye),v(Ur),v(ia),v(Zi),v(Pi),v(ot),v(oi),v(Hi),v(Z),v(Bo),v(Ee),v(cr),v(xn),v(Fr),v(Ei),v(Ve),v(Js),v(wp),v(Eo),v(Mr),v(Ro),v(kr),v(Vr),v(ji))}),A(t,"\u0275cmp",Ce({type:t,selectors:[["sd-viewer"]],viewQuery:function(i,r){if(i&1&&(Ue(em,5,Xa),Ue(tm,5,Xa)),i&2){let l;Re(l=Ie())&&(r.sdToastOutlet=l.first),Re(l=Ie())&&(r.sdModalOutlet=l.first)}},standalone:!1,features:[be([Z])],decls:1,vars:1,consts:[["spreadsheetsViewRef",""],["sdToastOutlet",""],["sdModalOutlet",""],["dialogBody",""],["dialogFooter",""],[4,"ngIf"],[3,"doc","display","contextmenu",4,"ngIf"],[3,"display",4,"ngIf"],[1,"main-window",3,"contextmenu"],[3,"side-view",4,"ngIf"],["class","right-side-view",4,"ngIf"],[1,"main-view",3,"ngClass"],[4,"ngIf","ngIfElse"],[1,"sd-toast-container"],[1,"sd-modal-container"],[1,"dialogs"],["width","360","height","300",3,"bodyTemplate","footerTemplate","header","headerIcon",4,"ngIf"],[3,"doc","immediatePrintConfig","finish",4,"ngIf"],[3,"pdfDoc"],[3,"contextmenu","doc"],[1,"right-side-view"],[3,"pdfDoc","centerPoint","overWrittenZoom","ngStyle",4,"ngIf"],["class","page",3,"contextmenu",4,"ngIf"],[3,"pdfDoc","centerPoint","overWrittenZoom","ngStyle"],[1,"page",3,"contextmenu"],["width","360","height","300",3,"bodyTemplate","footerTemplate","header","headerIcon"],[1,"password-dialog-label"],["size","tiny","type","password",3,"ngModelChange","keydown.enter","autofocus","ngClass","placeholder","ariaLabel","readonly","ngModel"],["class","password-dialog-error",4,"ngIf"],[1,"password-dialog-error"],["color","primary","size","small",1,"ep-button",3,"click","disabled"],[3,"finish","doc","immediatePrintConfig"]],template:function(i,r){i&1&&se(0,vm,20,10,"ng-container",5),i&2&&O("ngIf",!r.loading)},dependencies:[mo,co,lt,Gt,So,dp,Sn,po,kp,On,Qs,Hn,yp,xp,fp,is,Ve],styles:["i.papycon-chevron3-down[_ngcontent-%COMP%]{transform:scale(.5);font-size:18px;line-height:48px;margin:-12px -7.5px;padding:0 6px;transform-origin:50% 50%}i[_ngcontent-%COMP%] + i.papycon-chevron3-down[_ngcontent-%COMP%]{margin:-12px -8.5px;padding:0 8px}i.papycon-chevron3-down.expanded[_ngcontent-%COMP%]{transform:scale(.5) rotate(-180deg)}@media print{[_nghost-%COMP%]   *[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   sd-print-view[_ngcontent-%COMP%]{display:block}}[_nghost-%COMP%]{display:flex;flex-direction:column;width:100%;height:100%}.pre-wrap[_ngcontent-%COMP%]{white-space:pre-wrap}sd-toolbar[_ngcontent-%COMP%], sd-annot-toolbar[_ngcontent-%COMP%]{flex:0 0 43px}.main-window[_ngcontent-%COMP%]{overflow:hidden;flex:1}.main-view[_ngcontent-%COMP%]{display:block;height:100%;position:relative;overflow:hidden}sd-content-view[_ngcontent-%COMP%]{position:absolute;left:0;top:0;width:100%;height:100%;display:block}.side-view[_ngcontent-%COMP%]{display:block;height:100%;position:relative;float:left}sd-side-view[_ngcontent-%COMP%]{height:100%;position:relative}.right-side-view[_ngcontent-%COMP%]{display:block;height:100%;position:relative;float:right}.sd-toast-container[_ngcontent-%COMP%]{position:absolute;top:40px;right:50px;display:flex;flex-direction:column;pointer-events:none;z-index:5}span.page[_ngcontent-%COMP%]{font-family:NotoSans-Regular,sans-serif;position:absolute;bottom:20px;right:40px;font-size:12px;color:var(--mono-70)}.password-dialog-label[_ngcontent-%COMP%]{font-size:12px;line-height:20px;font-family:NotoSans-Medium,sans-serif;color:var(--mono-70);margin-top:10px}.password-dialog-error[_ngcontent-%COMP%]{font-size:12px;line-height:20px;font-family:NotoSans-Medium,sans-serif;color:var(--exception)}pu-input[_ngcontent-%COMP%]{width:100%;margin-top:2px}pu-input.error[_ngcontent-%COMP%]  input{border-color:var(--exception)}sd-dialog[_ngcontent-%COMP%]{z-index:5}@media screen and (max-width: 577px){.main-window[_ngcontent-%COMP%]{position:relative}.side-view[_ngcontent-%COMP%], .right-side-view[_ngcontent-%COMP%]{position:absolute;width:100%;z-index:1}.sd-toast-container[_ngcontent-%COMP%]{top:32px;right:16px}}"],data:{animation:[jn("sideViewAnimation",[_n("void => true",[Di({transform:"translateY(calc(100% - 100px))"}),mn(`${Od} ${Md}`,Di({transform:"translateY(0)"}))]),_n("true => void",[Di({zIndex:1,position:"absolute"}),mn(`${Od} ${Md}`,Di({transform:"translateY(calc(100% - 53px))"}))])])]},changeDetection:0}));let a=t;return a})();var Ay=(()=>{let t=class t{};A(t,"\u0275fac",function(i){return new(i||t)}),A(t,"\u0275mod",Jt({type:t})),A(t,"\u0275inj",Xt({providers:[ha,Tn,cr],imports:[Kp,Ea,Ui,_d,_p,wr,da,Cn,bd,qs,Er,Gl,Xs,Ql,yr,Ep,la,mp,cp]}));let a=t;return a})();export{ha as a,Dm as b,S0 as c,P0 as d,Gp as e,cr as f,KM as g,Ay as h,sy as i};
